if (self.CavalryLogger) { CavalryLogger.start_js(["1QPTi"]); }

__d("MessagingTagUtils",["MercurySourceType","MessagingTagConstants"],(function(a,b,c,d,e,f){"use strict";var g=new Set(Object.values(b("MercurySourceType")));function a(a){for(var b=0;b<a.length;b++){var c=a[b];if(g.has(c))return c}return"source:unknown"}function h(a){for(var c=0;c<a.length;c++){var d=a[c];d=d.split(b("MessagingTagConstants").app_id_root);if(d.length>1)return d[1].trim()}return null}function c(a,c){var d=[],e=h(a);e&&b("MessagingTagConstants").orca_app_ids.indexOf(e)!==-1&&d.push("source:messenger");b("MessagingTagConstants").chat_sources.indexOf(c)!==-1&&d.push("source:chat");b("MessagingTagConstants").email_source===c&&d.push("source:email");b("MessagingTagConstants").mobile_sources.indexOf(c)!==-1&&d.push("source:mobile");a.indexOf("source:workchat:desktop")!==-1&&d.push("source:workchat:desktop");return d}e.exports={getSourceFromTags:a,getSourceTags:c}}),null);
__d("MessengerThreadFetchLoggerUtil",["FBLogger","MercuryIDs","QuickPerformanceLogger","performanceAbsoluteNow"],(function(a,b,c,d,e,f){"use strict";var g,h=1,i=new Map();a={markerStart:function(a){try{b("QuickPerformanceLogger").markerStart(25296904,h);a=b("MercuryIDs").isValid(a)?b("MercuryIDs").tokenize(a).value:a;i.set(a,h);h++}catch(a){b("FBLogger")("mercury").catching(a).warn("Logging thread info fetch encountered error")}},markerEnd:function(a,c){try{a=b("MercuryIDs").isValid(a)?b("MercuryIDs").tokenize(a).value:a;var d=i.get(a);d!=null&&(b("QuickPerformanceLogger").markerEnd(25296904,c,d),i["delete"](a))}catch(a){b("FBLogger")("mercury").catching(a).warn("Logging thread info fetch encountered error")}},markerPoint:function(a,c,d){d===void 0&&(d=(g||(g=b("performanceAbsoluteNow")))());a=i.get(a);a!=null&&b("QuickPerformanceLogger").markerPoint(25296904,c,{instanceKey:a,timestamp:d})}};e.exports=a}),null);
__d("MSuggestionDispatcher",["ExplicitRegistrationDispatcher"],(function(a,b,c,d,e,f){"use strict";e.exports=new(b("ExplicitRegistrationDispatcher"))({strict:!1})}),null);
__d("MSuggestionActions",["MSuggestionDispatcher","keyMirror"],(function(a,b,c,d,e,f){"use strict";a=b("keyMirror")({SAVE_ALL_SUGGESTIONS:null,REMOVE_ALL_SUGGESTIONS:null,REMOVE_SUGGESTIONS_BY_TYPE:null});var g={Types:a,saveAllSuggestions:function(a,c){b("MSuggestionDispatcher").dispatch({type:g.Types.SAVE_ALL_SUGGESTIONS,threadID:a,suggestions:c})},removeAllSuggestions:function(a){a&&b("MSuggestionDispatcher").dispatch({type:g.Types.REMOVE_ALL_SUGGESTIONS,threadID:a})},removeSuggestionsByType:function(a,c){b("MSuggestionDispatcher").dispatch({type:g.Types.REMOVE_SUGGESTIONS_BY_TYPE,threadID:a,typeID:c})}};e.exports=g}),null);
__d("MercuryAssert",["MercuryIDs"],(function(a,b,c,d,e,f){e.exports={isParticipantID:function(a){if(a==null)throw new Error("participant_id null/undefined");if(!b("MercuryIDs").isValid(a))throw new Error("bad_participant_id "+a)},allParticipantIDs:function(a){a.forEach(this.isParticipantID)},isUserParticipantID:function(a){var c=b("MercuryIDs").tokenize(a);if(a==null)throw new Error("participant_id null/undefined");if(c.type!="fbid")throw new Error("bad_user_id "+a)},isEmailParticipantID:function(a){var c=b("MercuryIDs").tokenize(a);if(a==null)throw new Error("participant_id null/undefined");if(c.type!="email")throw new Error("bad_email_id "+a)},allThreadID:function(a){a.forEach(this.isThreadID)},isThreadID:function(a){if(a==null)throw new Error("participant_id null/undefined");if(!b("MercuryIDs").isValid(a))throw new Error("bad_thread_id "+a)}}}),null);
__d("EmojiLikeConstants",["EmojiStaticConfig"],(function(a,b,c,d,e,f){"use strict";a=b("EmojiStaticConfig").sizeMap;c=Object.freeze({XSMALL:"xsmall",SMALL:"small",MEDIUM:"medium",LARGE:"large"});d={dp16:"xsmall",dp32:"small",dp64:"medium",db64:"medium",dp128:"large"};f=Object.freeze({PICKER:"picker",HOT_LIKE:"hot_like"});b=[983040];var g="hot_emoji_source",h="hot_emoji_size",i="emoji_like",j="\ud83d\udc4d",k=[128077];e.exports={FB_THUMBS_UP_EMOJI:b,size:c,sizeMap:a,sizeMapTransfer:d,source:f,SOURCE_TAG_PREFIX:g,TAG_PREFIX_NEW:h,TAG_PREFIX_OLD:i,THUMBS_UP_EMOJI:j,THUMBS_UP_EMOJI_CODES:k}}),null);
__d("MercuryTagHelper",[],(function(a,b,c,d,e,f){"use strict";a={get:function(a,b){a=a.find(function(a){return a!=null?a.startsWith(b):!1});return a==null?a:a.substr(a.indexOf(":")+1)}};e.exports=a}),null);
__d("EmojiLikeUtils",["EmojiLikeConstants","MercuryTagHelper"],(function(a,b,c,d,e,f){"use strict";function a(a,b){!a.tags?a.tags=[g(b)]:a.tags.push(g(b));return a}function g(a){var c=b("EmojiLikeConstants").TAG_PREFIX_NEW;return c+":"+a}function c(a,b){!a.tags?a.tags=[h(b)]:a.tags.push(h(b));return a}function h(a){return b("EmojiLikeConstants").SOURCE_TAG_PREFIX+":"+a}function d(a){return i(a)!=null}function i(a){if(!a.tags)return null;var c=b("MercuryTagHelper").get(a.tags,b("EmojiLikeConstants").TAG_PREFIX_NEW);return c?c:b("MercuryTagHelper").get(a.tags,b("EmojiLikeConstants").TAG_PREFIX_OLD)}e.exports={getEmojiSize:i,isEmojiLike:d,setEmojiSize:a,setEmojiSource:c}}),null);
__d("MercuryAttachment",["cx","EmojiLikeUtils","MercuryAudioType"],(function(a,b,c,d,e,f,g){"use strict";var h=function(a){return a===Object(a)},i="_1c_u",j=new Set(["animated_image","photo","video","third_party_sticker"]),k={getAttachIconClass:function(a){switch(a){case"attach:image":return"_y2-";case"attach:video":return"_y2_";case"attach:music":return"_y30";case"attach:voice":return"_y31";case"attach:text":return"_y32";case"attach:pdf":return"_1k9k";case"attach:richtext":return"_1k9l";case"attach:spreadsheet":return"_1k9p";case"attach:presentation":return"_1k9r";case"attach:archive":return"_1k9s";case"attach:ms:word":return"_y33";case"attach:ms:xls":return"_y34";case"attach:ms:ppt":return"_y35"}return"_y36"},getAttachIconClassByMime:function(a){return this.getAttachIconClass(this.getAttachTypeByMime(a))},getAttachTypeByMime:function(a){if(!a)return"attach:unknown";if(a.startsWith("image"))return"attach:image";else if(a.startsWith("video"))return"attach:video";else if(a.startsWith("audio"))return"attach:music";else if(a.startsWith("text/plain"))return"attach:text";else if(a=="text/pdf"||a=="application/pdf"||a=="application/vnd.pdf"||a=="application/x-pdf")return"attach:pdf";else if(a=="text/richtext"||a=="application/rtf"||a=="application/x-iwork-pages-sffkey")return"attach:richtext";else if(a=="text/csv"||a=="application/x-iwork-numbers-sffkey")return"attach:spreadsheet";else if(a=="application/x-iwork-keynote-sffkey")return"attach:presentation";else if(a=="application/vnd.ms-cab-compressed"||a=="application/x-7z-compressed"||a=="application/x-ace-compressed"||a=="application/x-apple-diskimage"||a=="application/x-compress"||a=="application/x-compressed"||a=="application/x-gzip"||a=="application/x-rar-compressed"||a=="application/x-tar"||a=="application/x-zip-compressed"||a=="application/zip")return"attach:archive";else if(a=="application/msword"||a.startsWith("application/vnd.ms-word")||a.startsWith("application/vnd.openxmlformats-officedocument.wordprocessingml"))return"attach:ms:word";else if(a.startsWith("application/vnd.ms-excel")||a.startsWith("application/vnd.openxmlformats-officedocument.spreadsheetml"))return"attach:ms:xls";else if(a.startsWith("application/vnd.ms-powerpoint")||a.startsWith("application/vnd.openxmlformats-officedocument.presentationml"))return"attach:ms:ppt";else return"attach:unknown"},convertRaw:function(a){var b=[];for(var c=0;c<a.length;c++){var d=a[c];if(d.attach_type==="photo")b.push(d);else if(d.filename){var e=k.getAttachTypeByMime(d.filetype),f={};f.attach_type="file";f.name=d.filename;f.icon_type=e;f.url="";b.push(f)}}return b},get:function(a){var c=[];a.attachments?c=a.attachments:a.raw_attachments&&(c=this.convertRaw(a.raw_attachments));var d=b("EmojiLikeUtils").getEmojiSize(a);d&&(c=c.concat([{attach_type:"emoji_like",size:d}]));if(!(a.attachments&&a.attachments.length>0)){if(a.sticker_id)return c.concat([{attach_type:"sticker"}]);if(a.preview_attachments&&a.preview_attachments.length>0)return c.concat(a.preview_attachments)}return c},resizeContain:function(a,b){var c=a.width/a.height,d=b.width/b.height;if(d<c)return{width:Math.ceil(Math.min(a.height*d,b.width)),height:Math.ceil(Math.min(a.height,b.height))};else return{width:Math.ceil(Math.min(a.width,b.width)),height:Math.ceil(Math.min(a.width/d,b.height))}},isBubblePreferred:function(a){return this.isFileAttachment(a)},isPhotoAttachment:function(a){return(this==null?void 0:this.getAttachTypeByMime)&&this.getAttachTypeByMime(a.mime_type)==="attach:pdf"?!1:!!(a.attach_type=="photo"||a.attach_type=="animated_image"||a.attach_type=="third_party_sticker"||a.attach_type=="file"&&a.preview_url)},isPhotoGroupAttachment:function(a){return j.has(a.attach_type)},isSinglePhotoGroupAttachment:function(a){return!!(a.attachments&&a.attachments.length===1&&a.attachments[0]&&this.isPhotoGroupAttachment(a.attachments[0]))},isVideoAttachment:function(a){return a.attach_type=="video"},isShareAttachment:function(a){return a.attach_type=="share"},isFileAttachment:function(a){return a.attach_type=="file"},isErrorAttachment:function(a){return a.attach_type=="error"},isStickerAttachment:function(a){return a.attach_type=="sticker"},isEmojiLikeAttachment:function(a){return a.attach_type==="emoji_like"},isVoiceAttachment:function(a){return!a.metadata?!1:a.metadata.type===b("MercuryAudioType").AudioClip||a.metadata.type===b("MercuryAudioType").VoiceMessageWithTranscript},hasAttribution:function(a){return!!a.app_attribution},isLightweightActionAttachment:function(a){return!!(k.isShareAttachment(a)&&a.share&&a.share.target!=null&&a.share.target.lwa_type!=null)},isSingleVideoAttachment:function(a){var b=this;a=this.get(a).filter(h).filter(function(a){return b.isVideoAttachment(a)});return a.length===1},isSharedVideoAttachment:function(a){a=a.attach_type==="share"&&a.share&&a.share.subattachments&&a.share.subattachments[0];return!!(a&&a.target&&a.target.video_id)},isGenieSharedVideoAttachment:function(a){return!!(a.attach_type==="share"&&a.share&&a.share.style_list.indexOf("genie_message")>-1&&a.share.target&&a.share.target.attachment&&this.isSharedVideoAttachment(a.share.target.attachment))},isSharedVideoAttachmentMessage:function(a){var b=this;a=this.get(a).filter(h).filter(function(a){return b.isSharedVideoAttachment(a)||b.isGenieSharedVideoAttachment(a)});return a.length===1},getVideoElem:function(a,b){b=b.getMessageElement(a);if(!b)return null;a=b.getElementsByClassName(i);return a&&a.length?a[0]:b}};e.exports=k}),null);
__d("MercuryDisplayTimeFilterMessageRenderer",["fbt"],(function(a,b,c,d,e,f,g){"use strict";a={renderFilteredContent:function(a){if(a.is_filtered_content_bh)return g._("This message was removed because it includes a link that goes against our Community Standards.");if(a.is_filtered_content_account)return g._("This message has been temporarily removed because the sender's account requires verification.");if(a.is_filtered_content_quasar)return g._("This message was removed because it contains blocked or harmful content.");return a.is_filtered_content_invalid_app?g._("This message was removed because the app that it's being sent from is blocked from sending messages."):g._("This message has been temporarily removed because the sender's account requires verification, or it has been identified as abusive.")}};e.exports=a}),null);
__d("MercuryLocalIDs",["randomInt"],(function(a,b,c,d,e,f){"use strict";var g={generateThreadID:function(a){return"root:"+g.generateOfflineThreadingID(a)},generateOfflineThreadingID:function(a){a=a!=null?a:Date.now();var c=b("randomInt")(0,4294967295);c=("0000000000000000000000"+c.toString(2)).slice(-22);a=a.toString(2)+c;return h(a.slice(-63))}};function h(a){var b="";a=a;while(a!="0"){var c=0,d="";for(var e=0;e<a.length;e++)c=2*c+parseInt(a[e],10),c>=10?(d+="1",c-=10):d+="0";b=c.toString()+b;a=d.slice(d.indexOf("1"))}return b}e.exports=g}),null);
__d("MercuryMessageClientState",[],(function(a,b,c,d,e,f){a=Object.freeze({DO_NOT_SEND_TO_SERVER:"do_not_send_to_server",SEND_TO_SERVER:"send_to_server"});e.exports=a}),null);
__d("MessengerMQTTConnectionEvents",[],(function(a,b,c,d,e,f){"use strict";e.exports={DELTA_EVENT:"messenger-mqtt-delta",STREAM_DISCONNECT:"messenger-mqtt-stream-disconnect",STREAM_CONNECTING:"messenger-mqtt-stream-connecting",STREAM_CONNECT:"messenger-mqtt-stream-connect",STATE_CONNECTED:"Connected",STATE_DISCONNECTED:"Disconnected",STATE_CONNECTING:"Connecting",TYP:"messenger-mqtt-typ"}}),null);
__d("MercurySyncEventsProxy",["Arbiter","ChannelConstants","LogHistory","MercurySingletonProvider","MessengerMQTTConnectionEvents"],(function(a,b,c,d,e,f){"use strict";var g=b("LogHistory").getInstance("mercury_event_proxy"),h={DELTA:"DELTA",FAKE_DFF:"FAKE_DFF",FLOW:"FLOW",FLOW_REJECT:"FLOW_REJECT",INIT:"MercurySyncDeltaHandler/initSeqID",CONNECTED:"CONNECTED",RECONNECTING:"RECONNECTING",SHUTDOWN:"SHUTDOWN",TYP:"TYP"};a=function(){a.getArbiterTypeForFBID=function(a,b){return a+"/"+b};a.getForFBID=function(a){return i.getForFBID(a)};a.get=function(){return i.get()};function a(a){this.$2=[],this.$1=a,this.init()}var c=a.prototype;c.getArbiterType=function(b){return a.getArbiterTypeForFBID(this.$1,b)};c.init=function(){var a=this,c,d;this.$2.forEach(function(a){return b("Arbiter").unsubscribe(a)});this.$2=[(c=b("Arbiter")).subscribe((d=b("MessengerMQTTConnectionEvents")).DELTA_EVENT,function(c){for(var d=arguments.length,e=new Array(d>1?d-1:0),f=1;f<d;f++)e[f-1]=arguments[f];return b("Arbiter").inform.apply(b("Arbiter"),[a.getArbiterType(h.DELTA)].concat(e))}),c.subscribe(d.STREAM_CONNECT,function(c){for(var d=arguments.length,e=new Array(d>1?d-1:0),f=1;f<d;f++)e[f-1]=arguments[f];return b("Arbiter").inform.apply(b("Arbiter"),[a.getArbiterType(h.CONNECTED)].concat(e))}),c.subscribe(d.STREAM_DISCONNECT,function(c){for(var d=arguments.length,e=new Array(d>1?d-1:0),f=1;f<d;f++)e[f-1]=arguments[f];return b("Arbiter").inform.apply(b("Arbiter"),[a.getArbiterType(h.SHUTDOWN)].concat(e))}),c.subscribe(d.STREAM_CONNECTING,function(c){for(var d=arguments.length,e=new Array(d>1?d-1:0),f=1;f<d;f++)e[f-1]=arguments[f];return b("Arbiter").inform.apply(b("Arbiter"),[a.getArbiterType(h.RECONNECTING)].concat(e))}),c.subscribe(b("ChannelConstants").getArbiterType(b("ChannelConstants").FAKE_DFF),function(c){g.debug("fakedff",JSON.stringify({fbid:a.$1}));for(var d=arguments.length,e=new Array(d>1?d-1:0),f=1;f<d;f++)e[f-1]=arguments[f];b("Arbiter").inform.apply(b("Arbiter"),[a.getArbiterType(h.FAKE_DFF)].concat(e))}),c.subscribe(d.TYP,function(c){for(var d=arguments.length,e=new Array(d>1?d-1:0),f=1;f<d;f++)e[f-1]=arguments[f];b("Arbiter").inform.apply(b("Arbiter"),[a.getArbiterType(h.TYP)].concat(e))})]};return a}();a.Events=h;var i=new(b("MercurySingletonProvider"))(a);e.exports=a}),null);
__d("MercuryThreadInfo",["MercuryIDs"],(function(a,b,c,d,e,f){"use strict";var g={canReply:function(a){return!!(a.is_subscribed&&(a.can_reply===void 0||a.can_reply)&&!a.has_email_participant&&!a.read_only)},getMuteSetting:function(a){return a.mute_until==null?void 0:a.mute_until},isEmptyLocalThread:function(a){return b("MercuryIDs").tokenize(a.thread_id).type==="root"&&!a.timestamp},isMuted:function(a){a=g.getMuteSetting(a);return a!=null&&(a>Date.now()/1e3||a===-1)},areMentionsMuted:function(a){return a.mentions_mute_mode===1},areReactionsMuted:function(a){return a.reactions_mute_mode===1},isNewEmptyLocalThread:function(a){return!!(g.isEmptyLocalThread(a)&&a.participants&&a.participants.length===0)},showSettingsMenu:function(a){return!!((a.can_reply||!a.cannot_reply_reason||a.cannot_reply_reason.toLowerCase()==="blocked"||a.cannot_reply_reason.toLowerCase()==="messenger_blockee")&&!a.has_email_participant&&!a.read_only&&a.is_subscribed)},isColdOpen:function(a){return!!(a.is_canonical_user&&(a.message_count===0||!a.timestamp))}};e.exports=g}),null);
__d("MercuryThreadInformer",["ArbiterMixin","LogHistory","MercuryAssert","MercurySingletonProvider","mixin"],(function(a,b,c,d,e,f){"use strict";var g=b("LogHistory").getInstance("mercury_informer");a=function(a){babelHelpers.inheritsLoose(c,a);c.get=function(){return h.get()};c.getForFBID=function(a){return h.getForFBID(a)};function c(b){var c;c=a.call(this)||this;c.$MercuryThreadInformer1=b;c.$MercuryThreadInformer2={};c.$MercuryThreadInformer3={};c.$MercuryThreadInformer4={};c.$MercuryThreadInformer5={};c.$MercuryThreadInformer6=!1;c.$MercuryThreadInformer7=!1;c.$MercuryThreadInformer8=!1;c.$MercuryThreadInformer9=!1;c.$MercuryThreadInformer10={};c.$MercuryThreadInformer11={};c.$MercuryThreadInformer12={};c.$MercuryThreadInformer13={};c.$MercuryThreadInformer14=0;return c}var d=c.prototype;d.informNewMessage=function(a,b){this.inform("new-message",{threadID:a,message:b})};d.informNewLogMessage=function(a,b){this.inform("new-log-message",{threadID:a,message:b})};d.updatedThread=function(a){this.$MercuryThreadInformer3[a]=!0,this.$MercuryThreadInformer15()};d.invalidatedThread=function(a){this.$MercuryThreadInformer4[a]=!0,this.$MercuryThreadInformer15()};d.deletedThread=function(a){this.$MercuryThreadInformer2[a]=!0,this.$MercuryThreadInformer15()};d.updatedThreadlist=function(){this.$MercuryThreadInformer6=!0,this.$MercuryThreadInformer15()};d.updatedUnseenState=function(){this.$MercuryThreadInformer7=!0,this.$MercuryThreadInformer15()};d.updatedUnseenTimestamp=function(){this.$MercuryThreadInformer8=!0,this.$MercuryThreadInformer15()};d.updatedUnreadState=function(){this.$MercuryThreadInformer9=!0,this.$MercuryThreadInformer15()};d.changedThreadReadState=function(a,b,c){(!this.$MercuryThreadInformer5[a]||this.$MercuryThreadInformer5[a].timestamp<c)&&(this.$MercuryThreadInformer5[a]={mark_as_read:b,timestamp:c}),this.$MercuryThreadInformer15()};d.receivedMessage=function(a){b("MercuryAssert").isThreadID(a.thread_id);var c=a.thread_id;this.$MercuryThreadInformer10[c]||(this.$MercuryThreadInformer10[c]=[]);this.$MercuryThreadInformer10[c].push(a);this.updatedThread(c)};d.reorderedMessages=function(a,b){this.$MercuryThreadInformer11[a]={source:b},this.$MercuryThreadInformer15()};d.updatedMessage=function(a,b,c){this.$MercuryThreadInformer12[a]||(this.$MercuryThreadInformer12[a]={}),this.$MercuryThreadInformer12[a][b]={source:c},this.updatedThread(a)};d.deletedMessage=function(a,b,c,d){this.$MercuryThreadInformer13[a]||(this.$MercuryThreadInformer13[a]={}),this.$MercuryThreadInformer13[a][b]={attachmentIDs:d,source:c},this.updatedThread(a)};d.synchronizeInforms=function(a){this.$MercuryThreadInformer14++;try{a()}catch(a){throw a}finally{this.$MercuryThreadInformer14--,this.$MercuryThreadInformer15()}};d.listen=function(a,b){return this.subscribe("threads-updated",function(c,d){d[a]&&b(a)})};d.$MercuryThreadInformer15=function(){if(!this.$MercuryThreadInformer14){var a=this.$MercuryThreadInformer2,b=this.$MercuryThreadInformer3,c=this.$MercuryThreadInformer4,d=this.$MercuryThreadInformer5,e=this.$MercuryThreadInformer6,f=this.$MercuryThreadInformer7,g=this.$MercuryThreadInformer8,h=this.$MercuryThreadInformer9,i=this.$MercuryThreadInformer10,j=this.$MercuryThreadInformer11,k=this.$MercuryThreadInformer12,l=this.$MercuryThreadInformer13;this.$MercuryThreadInformer2={};this.$MercuryThreadInformer3={};this.$MercuryThreadInformer4={};this.$MercuryThreadInformer5={};this.$MercuryThreadInformer6=!1;this.$MercuryThreadInformer7=!1;this.$MercuryThreadInformer8=!1;this.$MercuryThreadInformer9=!1;this.$MercuryThreadInformer10={};this.$MercuryThreadInformer11={};this.$MercuryThreadInformer12={};this.$MercuryThreadInformer13={};var m=Object.keys(b);(m.length||e)&&this.inform("threadlist-updated",m);m.length&&this.$MercuryThreadInformer16("threads-updated",b);for(var e in c){this.$MercuryThreadInformer16("thread-invalidated",c);break}for(var e in d){this.$MercuryThreadInformer16("thread-read-changed",d);break}for(e in a){this.$MercuryThreadInformer16("threads-deleted",a);break}f&&this.$MercuryThreadInformer16("unseen-updated",null);g&&this.$MercuryThreadInformer16("unseen-timestamp-updated",null);h&&this.$MercuryThreadInformer16("unread-updated",null);for(e in i){this.$MercuryThreadInformer16("messages-received",i);break}for(e in j){this.$MercuryThreadInformer16("messages-reordered",j);break}for(e in k){this.$MercuryThreadInformer16("messages-updated",k);break}for(e in l){this.$MercuryThreadInformer16("messages-deleted",l);break}}};d.$MercuryThreadInformer16=function(a,b){a==="threads-updated"&&g.debug(a,JSON.stringify(b)),this.inform(a,b)};return c}(b("mixin")(b("ArbiterMixin")));var h=new(b("MercurySingletonProvider"))(a);e.exports=a}),null);
__d("MercuryViewer",["CurrentUser","MercuryAssert"],(function(a,b,c,d,e,f){"use strict";var g="fbid:"+b("CurrentUser").getID();a={getID:function(){return g},isViewer:function(a){b("MercuryAssert").isParticipantID(a);return a===g}};e.exports=a}),null);
__d("getPageIDFromThreadID",["FBIDCheck","MercuryIDs"],(function(a,b,c,d,e,f){"use strict";function a(a){a=b("MercuryIDs").getUserIDFromThreadID(a);return!a||b("FBIDCheck").isUser_deprecated(a)?null:a}e.exports=a}),null);
__d("MessageRequestUtils",["CurrentUser","MercuryIDs","MessagingTag","ThreadConnectivityStatusGraphQLType.re","getPageIDFromThreadID"],(function(a,b,c,d,e,f){"use strict";a={isMessageRequest:function(a){return(a.folder===b("MessagingTag").PENDING||a.folder===b("MessagingTag").OTHER)&&a.can_reply},isFiltered:function(a){return a.folder===b("MessagingTag").OTHER},shouldShowComposerPendingActions:function(a){return this.isMessageRequest(a)&&(b("MercuryIDs").isGroupChat(a.thread_id)||!!b("getPageIDFromThreadID")(a.thread_id)||b("CurrentUser").isWorkUser())},shouldShowThreadlistPendingActions:function(a){return a.folder===b("MessagingTag").PENDING&&a.can_reply&&(b("MercuryIDs").isGroupChat(a.thread_id)||!!b("getPageIDFromThreadID")(a.thread_id)||b("CurrentUser").isWorkUser())},shouldShowUnconnectedThreadInfoText:function(a){var c;return!b("CurrentUser").isWorkUser()&&b("CurrentUser").getID()!==a.other_user_fbid&&((c=a.thread_connectivity_data)==null?void 0:c.connectivity_status)===b("ThreadConnectivityStatusGraphQLType.re").unconnected&&((c=a.thread_connectivity_data)==null?void 0:c.first_sender_id)===a.other_user_fbid},shouldSendTypingIndicators:function(a){if(!a)return!1;if(this.isMessageRequest(a))return!1;return b("CurrentUser").isWorkUser()||b("MercuryIDs").isGroupChat(a.thread_id)?!0:((a=a.thread_connectivity_data)==null?void 0:a.connectivity_status)===b("ThreadConnectivityStatusGraphQLType.re").implicitOrTwoWayMessaging}};e.exports=a}),null);
__d("MercuryMessageDeliveryState",[],(function(a,b,c,d,e,f){"use strict";a=Object.freeze({SENDING:1,SENT:2,DELIVERED:3,ERROR:0,UNKNOWN:-1});e.exports=a}),null);
__d("MessengerState.bs",["invariant","URI","FBID.bs","bs_array","bs_block","bs_curry","JSSet.bs","React","Utils.bs","FBJSON","Arbiter","gkx","bs_js_dict","qex","bs_belt_Map","bs_belt_Set","bs_caml_obj","ThreadId.bs","FBIDCheck","immutable","bs_belt_Array","bs_caml_array","ChatConfig","LogHistory","MercuryIDs","bs_pervasives","bs_belt_Option","bs_caml_option","CurrentUser","requireCond","AsyncRequest","MessagingTag","RemoteAction.bs","TypingStates","MercuryAssert","MercuryViewer","ParticipantId.bs","bs_belt_MapString","bs_caml_primitive","MercuryFilters.bs","ImmutableObject","MercuryLocalIDs","ChannelConstants","MessengerFolders.bs","MessengerMessage.bs","bs_js_null_undefined","MercuryActionType","MercuryAttachment","MercuryDispatcher","MercuryMessageIDs.bs","MercuryThreadInfo","MessengerPersonas.bs","MessengerWebEvent","XGroupsController","MercuryThreadIDMap","PageCommItemStatus","MercuryActionStatus","MessageRequestUtils","MessagingThreadType","MercuryPayloadSource","MessengerEnvironment","MessengerThreadUtils.bs","recoverableViolation","MercuryLogMessageType","MercuryServerRequests","MercuryThreadInformer","MercurySyncEventsProxy","unrecoverableViolation","MercuryGlobalActionType","MessageProfileRangeType","ThreadConnectivityStatus.bs","MercuryMessageClientState","MessengerGroupsSyncStatus","MercuryThreadlistConstants","MessageUnsendabilityStatus","setTimeoutAcrossTransitions","MessagingGenericAdminTextType","MessengerDesktopNotifications","ChatReliabilityInstrumentation","RemovedMessageTombstoneContent","MWChatDeleteMessageEventEmitter","MessengerThreadCannotReplyReason.bs","RepliedToMessageStatusForGraphQL","XMercuryThreadLikeIconController","MessengerSharedMediaActionsLoader","MessengerSharedPhotosVideosBaseData.bs","MercuryDisplayTimeFilterMessageRenderer","cr:1299779"],(function(a,b,c,d,e,f,g){"use strict";var h,i=b("React");function j(a){var c={};b("bs_belt_Map").forEach(a,function(b,a){c[b]=a;return 0});return c}function a(a){return j(a.threads)}function k(a,c){return b("bs_js_null_undefined").fromOption(b("bs_belt_Map").get(a.threads,c))}function c(a){return a.fbid}function d(a){return a.deliveryReceipts}function e(a){return a.readReceiptsPerThread}function l(a){return a.ignoredIds}function m(a){return a.blockedIds}function aa(a){return a.pendingFolderUnseenCount}function ba(a){return a.typing}function ca(a){return a.pendingReadStatusThreads}function da(a){return a.messages}function n(a){return a.localIDsMap}function o(a){return a.messagesWithUploadsInFlight}function p(a){return a.threadlistOrderMap}function q(a){return a.pinnedThreads}function ea(a){return a.montage}function fa(a){return a.orderedMessageLists}function ga(a){return a.unreadCounts}function r(a){return a.initialUnreadCounts}function ha(a){return a.unseenTimestamp}function ia(a){b("ChatReliabilityInstrumentation").logMESSAGE_RECEIVED(b("FBJSON").stringify({otid:a.offline_threading_id,message_id:a.message_id,other_user_fbid:a.other_user_fbid}));return 0}function ja(a,c,d){d=d.reduce(b("bs_belt_Set").remove,c.reduce(b("bs_belt_Set").add,a.ignoredIds));if(d===a.ignoredIds)return a;else return{fbid:a.fbid,deliveryReceipts:a.deliveryReceipts,readReceiptsPerThread:a.readReceiptsPerThread,ignoredIds:d,blockedIds:a.blockedIds,pendingFolderUnseenCount:a.pendingFolderUnseenCount,typing:a.typing,threads:a.threads,pendingReadStatusThreads:a.pendingReadStatusThreads,messages:a.messages,localIDsMap:a.localIDsMap,messagesWithUploadsInFlight:a.messagesWithUploadsInFlight,threadlistOrderMap:a.threadlistOrderMap,pinnedThreads:a.pinnedThreads,montage:a.montage,orderedMessageLists:a.orderedMessageLists,unreadCounts:a.unreadCounts,initialUnreadCounts:a.initialUnreadCounts,unseenTimestamp:a.unseenTimestamp}}var ka=function(a,b){delete a[b];return 0};function la(a,c,d){var e=b("bs_belt_MapString").get(a,c);if(e!==void 0){e=b("bs_caml_option").valFromOption(e);var f=b("bs_belt_Map").get(e,d);if(f!==void 0)return b("bs_belt_MapString").set(a,c,b("bs_belt_Map").remove(e,d));else return a}else return a}function ma(a,c){var d=c.thread_fbid;if(d==null)if(c.type==="typ"||c.type==="page_typing"){c=b("FBID.bs").ofString(c.from.toString());if(c!==void 0)return b("MercuryIDs").getThreadIDFromUserID(b("bs_caml_option").valFromOption(c));else return null}else return null;else{c=b("MercuryThreadIDMap").getForFBID(a);return c.getClientIDFromServerIDNow(d.toString())}}var na=b("gkx")("1275193")?b("MercuryFilters.bs").getSupportedFilters(0).concat([b("MercuryFilters.bs").all,b("MercuryFilters.bs").groups,b("MercuryFilters.bs").named,b("MercuryFilters.bs").unnamed]):b("MercuryFilters.bs").getSupportedFilters(0).concat([b("MercuryFilters.bs").all,b("MercuryFilters.bs").groups]),oa=b("MessengerFolders.bs").getSupportedFolders(0).concat([b("MessagingTag").SPAM,b("MessagingTag").PAGE_BACKGROUND]);function pa(a){var b={};oa.forEach(function(a){var c={};na.forEach(function(a){c[a]={threadlist:[],reachedEnd:!1,existingIDs:new Set()};return 0});b[a]=c;return 0});return b}function qa(a,c){a=b("MercuryThreadInformer").getForFBID(a);a.invalidatedThread(c);return 0}function s(a,c){a=b("MercuryThreadInformer").getForFBID(a);a.updatedThread(c);return 0}function ra(a,c){a=b("MercuryThreadInformer").getForFBID(a);a.deletedThread(c);return 0}function sa(a,c,d,e){a=b("MercuryThreadInformer").getForFBID(a);a.changedThreadReadState(c,d,e);return 0}function t(a,c){var d=new Map();c.forEach(function(a,b){d.set(a,b);return 0});return c.sort(function(c,e){var f=b("bs_belt_Map").get(a.threads,c),g=b("bs_belt_Map").get(a.threads,e);if(f!==void 0&&g!==void 0){g=b("bs_caml_option").valFromOption(g).timestamp-b("bs_caml_option").valFromOption(f).timestamp;if(g>0)return 1;else if(g<0)return-1;else return 0}f=d.get(c);g=d.get(e);return b("bs_belt_Option").getExn(f==null?void 0:b("bs_caml_option").some(f))-b("bs_belt_Option").getExn(g==null?void 0:b("bs_caml_option").some(g))|0})}function ta(a,c,d,e){a=b("bs_js_dict").get(a.threadlistOrderMap,d);if(a!==void 0){d=b("bs_js_dict").get(b("bs_caml_option").valFromOption(a),e);if(d!==void 0){var f=b("bs_caml_option").valFromOption(d);c.forEach(function(a){if(f.existingIDs.has(a)){f.existingIDs["delete"](a);a=f.threadlist.indexOf(a);f.threadlist.splice(a,1);return 0}else return 0});return 0}else return 0}else return 0}function u(a,c,d,e){a=a!==void 0?a:function(a){return!0};var f=b("bs_belt_Map").get(c.threads,d);if(f!==void 0){f=b("bs_caml_option").valFromOption(f);if(b("bs_curry")._1(a,f)){a=b("ImmutableObject").set(f,e);f=b("bs_belt_Map").set(c.threads,d,a);s(c.fbid,d);return{fbid:c.fbid,deliveryReceipts:c.deliveryReceipts,readReceiptsPerThread:c.readReceiptsPerThread,ignoredIds:c.ignoredIds,blockedIds:c.blockedIds,pendingFolderUnseenCount:c.pendingFolderUnseenCount,typing:c.typing,threads:f,pendingReadStatusThreads:c.pendingReadStatusThreads,messages:c.messages,localIDsMap:c.localIDsMap,messagesWithUploadsInFlight:c.messagesWithUploadsInFlight,threadlistOrderMap:c.threadlistOrderMap,pinnedThreads:c.pinnedThreads,montage:c.montage,orderedMessageLists:c.orderedMessageLists,unreadCounts:c.unreadCounts,initialUnreadCounts:c.initialUnreadCounts,unseenTimestamp:c.unseenTimestamp}}else return c}else return c}function ua(c,a,d){var e=new Set(a.participants);Object.assign(a,{participants:Array.from(a.participants)});d.forEach(function(d){if(e.has(d))return 0;else{a.participants.push(d);if(b("bs_caml_obj").caml_equal(d,c)){Object.assign(a,{is_subscribed:!0,can_reply:!0,cannot_reply_reason:null});return 0}else return 0}});return 0}var va=b("XGroupsController");function wa(a){var c=[b("MercuryFilters.bs").all];a.unread_count>0&&c.push(b("MercuryFilters.bs").unread);a.is_canonical||c.push(b("MercuryFilters.bs").groups);if(b("gkx")("1275193"))if(a.name.length!==0){c.push(b("MercuryFilters.bs").named);return c}else{c.push(b("MercuryFilters.bs").unnamed);return c}else return c}function xa(a,c,d,e){oa.forEach(function(b){if(b!==d)return ta(a,c,b,e);else return 0});var f=b("bs_js_dict").get(a.threadlistOrderMap,d);if(f!==void 0){f=b("bs_js_dict").get(b("bs_caml_option").valFromOption(f),e);if(f!==void 0){f=b("bs_caml_option").valFromOption(f);f=[f.threadlist,f.existingIDs]}else f=[[],new Set()]}else f=[[],new Set()];var g=f[1],h=f[0];c.forEach(function(a){if(g.has(a))return 0;else{g.add(a);h.push(a);return 0}});return[t(a,h),g]}function v(a,c,d,e){c=b("gkx")("1275193")?c.filter(function(c){c=b("bs_belt_Map").get(a.threads,c);if(c!==void 0){c=wa(b("bs_caml_option").valFromOption(c));return c.some(function(a){return a===e})}else return!1}):c;return xa(a,c,d,e)}function ya(a,c,d){if(d!==void 0){var e=b("bs_js_dict").get(a.unreadCounts,c);if(e!==void 0){b("bs_caml_option").valFromOption(e).add(b("bs_caml_option").valFromOption(d));e=b("MercuryThreadInformer").getForFBID(a.fbid);e.updatedUnreadState();return 0}else{d=b("MercuryServerRequests").getForFBID(a.fbid);d.fetchUnreadThreadIDs(c);return 0}}else return 0}var za=b("MessengerFolders.bs").getSupportedFolders(0).filter(function(a){return a!==b("MessagingTag").ACTION_ARCHIVED});function Aa(a,c,d){if(d!==void 0){var e=b("bs_js_dict").get(a.unreadCounts,c);if(e!==void 0){b("bs_caml_option").valFromOption(e)["delete"](b("bs_caml_option").valFromOption(d));e=b("MercuryThreadInformer").getForFBID(a.fbid);e.updatedUnreadState();return 0}else{d=b("MercuryServerRequests").getForFBID(a.fbid);d.fetchUnreadThreadIDs(c);return 0}}else return 0}function Ba(c,a,d){var e=b("MessengerFolders.bs").getFromMeta(a);if(d!==e){za.includes(e)&&a.unread_count>0&&ya(c,e,b("bs_caml_option").some(a.thread_id));if(za.includes(d))return Aa(c,d,b("bs_caml_option").some(a.thread_id));else return 0}else return 0}function Ca(a,c,d,e,f){var g=b("gkx")("1275193"),h=a.threadlistOrderMap[c][d],i=h.existingIDs.has(e);!f&&g?v(a,[e],c,d):xa(a,[e],c,d);if(!g||h.threadlist.length!==0){f=b("bs_caml_array").caml_array_get(h.threadlist,h.threadlist.length-1|0)===e;if(!h.reachedEnd&&!i&&f)return ta(a,[e],c,d);else return 0}else return 0}function Da(a,c,d){if(oa.includes(c))if((c===b("MessagingTag").INBOX||c===b("MessagingTag").ACTION_ARCHIVED||c===b("MessagingTag").PENDING)&&b("gkx")("1275193"))return Ca(a,c,b("MercuryFilters.bs").unread,d,!0);else{xa(a,[d],c,b("MercuryFilters.bs").unread);return 0}else return 0}function Ea(c,a){var d=b("MessengerFolders.bs").getFromMeta(a);if(oa.includes(d)){na.forEach(function(b){return Ca(c,d,b,a.thread_id,!1)});return 0}else return 0}function Fa(a,c,d,e){var f=b("bs_belt_Map").get(a.threads,c);if(f!==void 0){f=b("bs_caml_option").valFromOption(f);var g=b("MessengerFolders.bs").getFromMeta(f);if(g!==d){if(e){e=f.comm_status;e=e==null?b("ImmutableObject").set(f,{folder:d}):d===b("MessagingTag").OTHER?b("ImmutableObject").set(f,{folder:d,comm_status:b("PageCommItemStatus").SPAM}):d===b("MessagingTag").INBOX?b("ImmutableObject").set(f,{folder:d,comm_status:b("PageCommItemStatus").TODO}):b("ImmutableObject").set(f,{folder:d})}else e=f;var h=f.other_user_fbid;h=h==null?[]:d===b("MessagingTag").OTHER?[b("MercuryIDs").getParticipantIDFromUserID(h)]:[];var i=f.other_user_fbid;d=i==null?[]:d===b("MessagingTag").OTHER?[]:[b("MercuryIDs").getParticipantIDFromUserID(i)];i=ja(a,h,d);h=b("bs_belt_Map").set(i.threads,c,e);Ba(i,e,g);Ea(i,e);s(i.fbid,c);return{fbid:i.fbid,deliveryReceipts:i.deliveryReceipts,readReceiptsPerThread:i.readReceiptsPerThread,ignoredIds:i.ignoredIds,blockedIds:i.blockedIds,pendingFolderUnseenCount:i.pendingFolderUnseenCount,typing:i.typing,threads:h,pendingReadStatusThreads:i.pendingReadStatusThreads,messages:i.messages,localIDsMap:i.localIDsMap,messagesWithUploadsInFlight:i.messagesWithUploadsInFlight,threadlistOrderMap:i.threadlistOrderMap,pinnedThreads:i.pinnedThreads,montage:i.montage,orderedMessageLists:i.orderedMessageLists,unreadCounts:i.unreadCounts,initialUnreadCounts:i.initialUnreadCounts,unseenTimestamp:i.unseenTimestamp}}else{Ea(a,f);return a}}else return a}function Ga(a,c,d){d=c.is_filtered_content?b("MercuryDisplayTimeFilterMessageRenderer").renderFilteredContent(c):d!==void 0?d:c.body;var e=c.raw_attachments;e=!(e==null)&&e.length!==0?b("MercuryAttachment").convertRaw(e):c.attachments;var f=c.removed_timestamp;if(f==null){f=c.log_message_type;d={snippet:d,snippet_attachments:e,snippet_sender:f==null?c.author:null}}else d={snippet:b("RemovedMessageTombstoneContent").getTombstoneContentForSnippet(c.author),snippet_attachments:null,snippet_sender:null};return Object.assign(a,d)}function Ha(a,c,d){var e=a.event_title,f=a.event_time;a=a.event_location_name;return{creator_id:null,latitude:null,location_address:null,longitude:null,note:"",related_event:{id:""},repeat_mode:null,seconds_to_notify_before:0,status:null,track_rsvp:c.track_rsvp,title:e==null?c.title:e,event_time:f==null?c.event_time:parseInt(f,10),location_name:a==null?c.location_name:a,event_members:d!==void 0?b("bs_caml_option").valFromOption(d):c.event_members,oid:c.oid,event_type:c.event_type}}function Ia(b,a){var c={};Object.keys(b).forEach(function(a){c[a]=b[a];return 0});c[a.guest_id]=a.guest_status;return c}var w=function(a,b){delete a[b];return 0},Ja=function(a,b){delete a[b];return 0};function x(a){var c={contents:-1},d={contents:null},e=Math.floor(Date.now()/1e3);b("bs_js_dict").entries(a).forEach(function(a){a=a[1];var b=a.event_time;if(b>e&&(c.contents<0||c.contents>b)){c.contents=b;d.contents=a;return 0}else return 0});return d.contents}var y=b("XMercuryThreadLikeIconController");function Ka(a,c,d){d=y.getURIBuilder().setString("emoji",d).getURI();new(b("AsyncRequest"))(d).setHandler(function(d){var e=b("MercuryDispatcher").getForFBID(a);e.handleUpdate({actions:[{action_type:b("MercuryActionType").UPDATE_CUSTOM_LIKE,thread_id:c,custom_like:d.getPayload()}],from_client:!0,payload_source:b("MercuryPayloadSource").CLIENT_CHANGE_CUSTOM_LIKE});return 0}).send();return 0}function La(d,a,c,e){c=c.log_message_data;if(c==null)return 0;else{var f=c.untypedData;if(c.message_type===b("MessagingGenericAdminTextType").CHANGE_THREAD_NICKNAME){var g=a.custom_nickname;if(!(g==null)){g=b("bs_js_dict").fromArray(b("bs_js_dict").entries(g));var h=f.nickname;h.trim().length>0?g[f.participant_id]=h:Ja(g,f.participant_id);Object.assign(a,{custom_nickname:g})}s(d,e)}else if(c.message_type===b("MessagingGenericAdminTextType").CHANGE_THREAD_ICON)Ka(d,e,f.thread_icon);else if(c.message_type===b("MessagingGenericAdminTextType").CHANGE_THREAD_THEME){if(!b("ChatConfig").get("chat_tab_has_gradients")){h=f.theme_color;if(h==null)Object.assign(a,{solid_color:null,header_color:null,footer_color:null,gradient_colors:[]});else if(h.length>0){g="#"+h.slice(2);Object.assign(a,{solid_color:g,header_color:g,footer_color:g,gradient_colors:[g]})}else Object.assign(a,{solid_color:null,header_color:null,footer_color:null,gradient_colors:[]});s(d,e)}}else if(f!==void 0)if(c.message_type===b("MessagingGenericAdminTextType").LIGHTWEIGHT_EVENT_CREATE){var i={},j=f.event_creator_id;a.participants.forEach(function(a){a=b("MercuryIDs").getUserIDFromParticipantID(a);if(a==null)return 0;else{i[a]=b("bs_caml_obj").caml_equal(a,j)?"GOING":"INVITED";return 0}});h=b("bs_js_dict").fromArray(b("bs_js_dict").entries(a.lightweight_events));g=f.event_time;g={track_rsvp:f.event_track_rsvp,title:f.event_title,event_time:g==null?0:parseInt(g,10),location_name:f.event_location_name,event_members:i,oid:f.event_id,event_type:f.event_type};Object.assign(a,{lightweight_event:g});h[f.event_id]=Object.assign({},g);Object.assign(a,{lightweight_events:h});s(d,e)}else if(c.message_type===b("MessagingGenericAdminTextType").LIGHTWEIGHT_EVENT_UPDATE||c.message_type===b("MessagingGenericAdminTextType").LIGHTWEIGHT_EVENT_UPDATE_TIME||c.message_type===b("MessagingGenericAdminTextType").LIGHTWEIGHT_EVENT_UPDATE_TITLE||c.message_type===b("MessagingGenericAdminTextType").LIGHTWEIGHT_EVENT_UPDATE_LOCATION){g=a.lightweight_event;if(!(g==null)){h=b("bs_js_dict").fromArray(b("bs_js_dict").entries(a.lightweight_events));g.oid===f.event_id&&Object.assign(a,{lightweight_event:Ha(f,g,b("bs_caml_option").some(g.event_members))});g=b("bs_js_dict").get(h,f.event_id);g!==void 0&&(h[f.event_id]=Ha(f,b("bs_caml_option").valFromOption(g),void 0),Object.assign(a,{lightweight_events:h}))}s(d,e)}else if(c.message_type===b("MessagingGenericAdminTextType").LIGHTWEIGHT_EVENT_RSVP){g=b("bs_js_dict").fromArray(b("bs_js_dict").entries(a.lightweight_events));h=a.lightweight_event;if(!(h==null)&&h.oid===f.event_id){var l=Ia(h.event_members,f);Object.assign(a,{lightweight_event:Ha(f,h,b("bs_caml_option").some(l))})}h=b("bs_js_dict").get(g,f.event_id);if(h!==void 0){l=b("bs_caml_option").valFromOption(h);h=Ia(l.event_members,f);g[f.event_id]=Ha(f,l,b("bs_caml_option").some(h));Object.assign(a,{lightweight_events:g})}s(d,e)}else if(c.message_type===b("MessagingGenericAdminTextType").LIGHTWEIGHT_EVENT_DELETE||c.message_type===b("MessagingGenericAdminTextType").LIGHTWEIGHT_EVENT_NOTIFY){l=b("bs_js_dict").fromArray(b("bs_js_dict").entries(a.lightweight_events));w(l,f.event_id);Object.assign(a,{lightweight_event:x(l),lightweight_events:l});s(d,e)}return 0}}function Ma(a,c,d){if(b("CurrentUser").isWorkUser()&&b("gkx")("1179386")){var e=a;c=c;var f=d;d=b("bs_belt_Map").get(e.threads,c);if(d!==void 0){d=b("bs_caml_option").valFromOption(d);var g=d.pinned_messages;g=g==null?void 0:g.map(function(a){if(f.findIndex(function(b){return b===a.message_id})!==-1)return{message_id:a.message_id,pinning_time:a.pinning_time,message:null};else return a});if(g!==void 0){d=b("ImmutableObject").set(d,{pinned_messages:g});g=b("bs_belt_Map").set(e.threads,c,d);s(e.fbid,c);d=g}else d=e.threads}else d=e.threads;return{fbid:e.fbid,deliveryReceipts:e.deliveryReceipts,readReceiptsPerThread:e.readReceiptsPerThread,ignoredIds:e.ignoredIds,blockedIds:e.blockedIds,pendingFolderUnseenCount:e.pendingFolderUnseenCount,typing:e.typing,threads:d,pendingReadStatusThreads:e.pendingReadStatusThreads,messages:e.messages,localIDsMap:e.localIDsMap,messagesWithUploadsInFlight:e.messagesWithUploadsInFlight,threadlistOrderMap:e.threadlistOrderMap,pinnedThreads:e.pinnedThreads,montage:e.montage,orderedMessageLists:e.orderedMessageLists,unreadCounts:e.unreadCounts,initialUnreadCounts:e.initialUnreadCounts,unseenTimestamp:e.unseenTimestamp}}else return a}function Na(a,c,d,e){a=b("MercuryThreadInformer").getForFBID(a);a.updatedMessage(c,d,b("bs_js_null_undefined").fromOption(e));return 0}function z(c,a){c=b("MercuryThreadInformer").getForFBID(c);c.receivedMessage(a);return 0}function Oa(a,c,d){a=b("MercuryThreadInformer").getForFBID(a);a.reorderedMessages(c,d);return 0}function Pa(a,c,d,e,f){a=b("MercuryThreadInformer").getForFBID(a);f=b("bs_belt_Option").getWithDefault(b("bs_belt_Option").map(f==null?void 0:b("bs_caml_option").some(f),function(a){return b("bs_belt_Array").keepMap(a,function(a){return b("bs_caml_option").nullable_to_opt(a.message_file_fbid)})}),[]);b("MWChatDeleteMessageEventEmitter").emit(d);a.deletedMessage(c,d,b("bs_js_null_undefined").fromOption(e),f);return 0}function Qa(a,c,d,e){a=b("MercuryThreadInformer").getForFBID(a);a.deletedMessage(c,d,b("bs_js_null_undefined").fromOption(e),null);return 0}var Ra=function(a,b){delete a[b];return 0};function Sa(c,a){var d=c.localIDsMap.get(a);return b("bs_caml_option").nullable_to_opt(c.messages.get(b("bs_belt_Option").getWithDefault(d==null?void 0:b("bs_caml_option").some(d),a)))}function Ta(a,c,d){a=a!==void 0?a:!1;d=b("bs_belt_Array").keepMap(d,function(a){return Sa(c,a)});if(a)return d.slice().reverse();else return d}function Ua(a,c){return b("bs_belt_Array").keepMap(c,function(b){return Sa(a,b)}).sort(function(a,c){return b("MessengerMessage.bs").compare(c,a)}).map(function(a){return a.message_id})}function Va(a,b){return{fbid:a.fbid,deliveryReceipts:a.deliveryReceipts,readReceiptsPerThread:a.readReceiptsPerThread,ignoredIds:a.ignoredIds,blockedIds:a.blockedIds,pendingFolderUnseenCount:a.pendingFolderUnseenCount,typing:a.typing,threads:a.threads,pendingReadStatusThreads:a.pendingReadStatusThreads,messages:a.messages.set(b[0],b[1]),localIDsMap:a.localIDsMap,messagesWithUploadsInFlight:a.messagesWithUploadsInFlight,threadlistOrderMap:a.threadlistOrderMap,pinnedThreads:a.pinnedThreads,montage:a.montage,orderedMessageLists:a.orderedMessageLists,unreadCounts:a.unreadCounts,initialUnreadCounts:a.initialUnreadCounts,unseenTimestamp:a.unseenTimestamp}}function Wa(b,a){b.localIDsMap.set(a.message_id,a.message_id);return{fbid:b.fbid,deliveryReceipts:b.deliveryReceipts,readReceiptsPerThread:b.readReceiptsPerThread,ignoredIds:b.ignoredIds,blockedIds:b.blockedIds,pendingFolderUnseenCount:b.pendingFolderUnseenCount,typing:b.typing,threads:b.threads,pendingReadStatusThreads:b.pendingReadStatusThreads,messages:b.messages,localIDsMap:b.localIDsMap,messagesWithUploadsInFlight:b.messagesWithUploadsInFlight,threadlistOrderMap:b.threadlistOrderMap,pinnedThreads:b.pinnedThreads,montage:b.montage,orderedMessageLists:b.orderedMessageLists,unreadCounts:b.unreadCounts,initialUnreadCounts:b.initialUnreadCounts,unseenTimestamp:b.unseenTimestamp}}var Xa=function(a,b){delete a[b];return 0};function Ya(c,d){var a=c.orderedMessageLists;Object.keys(d).forEach(function(e){var f=b("bs_js_dict").get(d,e);if(f!==void 0){f=f;var g=f[0],h=g.limit,i=g.offset;g=a.get(g.threadID);if(g==null)return 0;else{g=g.messageIDs;if(g.length>=(i+h|0)){Xa(d,e);return b("bs_curry")._1(f[1],Ta(!0,c,g.slice(i,i+h|0)))}else return 0}}else return 0});return 0}function Za(d,c,e){var a=e[1],f=e[0];b("MessengerMessage.bs").finalizeRanges(a);var g=a.offline_threading_id;if(!(g==null)&&g!==a.message_id){d.localIDsMap.set(g,a.message_id);b("MercuryMessageIDs.bs").addServerID(g,a.message_id);g=a.threading_id;g==null||b("MercuryMessageIDs.bs").addServerID(g,a.message_id)}g=d.messages.has(f);var h=d.fbid,i=d.deliveryReceipts,j=d.readReceiptsPerThread,k=d.ignoredIds,l=d.blockedIds,m=d.pendingFolderUnseenCount,aa=d.typing,ba=d.threads,ca=d.pendingReadStatusThreads,da=d.messages.set(f,a),n=d.localIDsMap,o=d.messagesWithUploadsInFlight,p=d.threadlistOrderMap,q=d.pinnedThreads,ea=d.montage,fa=d.orderedMessageLists,ga=d.unreadCounts,r=d.initialUnreadCounts;d=d.unseenTimestamp;h={fbid:h,deliveryReceipts:i,readReceiptsPerThread:j,ignoredIds:k,blockedIds:l,pendingFolderUnseenCount:m,typing:aa,threads:ba,pendingReadStatusThreads:ca,messages:da,localIDsMap:n,messagesWithUploadsInFlight:o,threadlistOrderMap:p,pinnedThreads:q,montage:ea,orderedMessageLists:fa,unreadCounts:ga,initialUnreadCounts:r,unseenTimestamp:d};if(!g&&e[2]===1){i=b("bs_belt_Option").getWithDefault(b("bs_belt_Option").flatMap(b("bs_caml_option").nullable_to_opt(a.thread_id),function(a){return b("bs_caml_option").nullable_to_opt(fa.get(a))}),{messageLoadingState:b("MercuryIDs").isLocalThread(a.thread_id)?1:0,messageIDs:[]});j=a.thread_id;if(!(j==null)){k=Ua(h,[f].concat(i.messageIDs.filter(function(c){return b("bs_caml_obj").caml_notequal(c,a.offline_threading_id)})));fa.set(j,{messageLoadingState:i.messageLoadingState,messageIDs:k})}Ya(h,c.messageCallbacks.contents)}return h}function A(b,c,a){b.messagesWithUploadsInFlight.set(c,a);return{fbid:b.fbid,deliveryReceipts:b.deliveryReceipts,readReceiptsPerThread:b.readReceiptsPerThread,ignoredIds:b.ignoredIds,blockedIds:b.blockedIds,pendingFolderUnseenCount:b.pendingFolderUnseenCount,typing:b.typing,threads:b.threads,pendingReadStatusThreads:b.pendingReadStatusThreads,messages:b.messages,localIDsMap:b.localIDsMap,messagesWithUploadsInFlight:b.messagesWithUploadsInFlight,threadlistOrderMap:b.threadlistOrderMap,pinnedThreads:b.pinnedThreads,montage:b.montage,orderedMessageLists:b.orderedMessageLists,unreadCounts:b.unreadCounts,initialUnreadCounts:b.initialUnreadCounts,unseenTimestamp:b.unseenTimestamp}}function $a(a,c){var d=c[1];c=c[0];var e=a.messagesWithUploadsInFlight.get(c);b("bs_belt_Option").isSome(e==null?void 0:b("bs_caml_option").some(e))||g(0,1777);a.messagesWithUploadsInFlight["delete"](c);if(e==null)return b("bs_pervasives").failwith("Message must exist to update");else return Object.assign(e,{image_ids:d.image_ids,file_ids:d.file_ids,audio_ids:d.audio_ids,gif_ids:d.gif_ids,video_ids:d.video_ids,client_state:b("MercuryMessageClientState").SEND_TO_SERVER})}function ab(a,c){var d=c[1],e=c[0],f=a.orderedMessageLists.get(e);if(f==null)return a;else{var g=b("bs_belt_Array").keepMap(d,function(b){return Sa(a,b)}).map(function(a){return a.message_id}),h=Ua(a,f.messageIDs.filter(function(a){return g.indexOf(a)===-1}));a.orderedMessageLists.set(e,{messageLoadingState:f.messageLoadingState,messageIDs:h});Oa(a.fbid,e,b("bs_js_null_undefined").fromOption(c[2]));f=Ma(a,e,d);return{fbid:f.fbid,deliveryReceipts:f.deliveryReceipts,readReceiptsPerThread:f.readReceiptsPerThread,ignoredIds:f.ignoredIds,blockedIds:f.blockedIds,pendingFolderUnseenCount:f.pendingFolderUnseenCount,typing:f.typing,threads:f.threads,pendingReadStatusThreads:f.pendingReadStatusThreads,messages:f.messages,localIDsMap:f.localIDsMap,messagesWithUploadsInFlight:f.messagesWithUploadsInFlight,threadlistOrderMap:f.threadlistOrderMap,pinnedThreads:f.pinnedThreads,montage:f.montage,orderedMessageLists:f.orderedMessageLists,unreadCounts:f.unreadCounts,initialUnreadCounts:f.initialUnreadCounts,unseenTimestamp:f.unseenTimestamp}}}function bb(c,d){var e={snippet:"...",snippet_attachments:null,snippet_sender:null};d=b("bs_belt_Option").flatMap(b("bs_caml_option").nullable_to_opt(c.orderedMessageLists.get(d)),function(a){return b("bs_belt_Array").get(Ta(void 0,c,a.messageIDs),0)});if(d!==void 0){var a=b("bs_caml_option").valFromOption(d);a=a.is_filtered_content?b("MercuryDisplayTimeFilterMessageRenderer").renderFilteredContent(a):a.body}else a=null;if(d!==void 0){d=b("bs_caml_option").valFromOption(d);var f=d.removed_timestamp;if(f==null)if(a==null)return e;else{f=d.log_message_type;return{snippet:a,snippet_attachments:d.attachments,snippet_sender:f==null?d.author:null}}else return{snippet:b("RemovedMessageTombstoneContent").getTombstoneContentForSnippet(d.author),snippet_attachments:null,snippet_sender:null}}else return e}function cb(c,a){var d=a.attachments;if(d==null)return 0;else{var e=b("bs_belt_Array").keepMap(d,function(a){if(b("MercuryAttachment").isPhotoAttachment(a)||b("MercuryAttachment").isVideoAttachment(a)){a=a.metadata;if(a==null)return;else return b("bs_caml_option").nullable_to_opt(a.fbid)}});b("MessengerSharedMediaActionsLoader").deletePhotos(b("MercuryIDs").getThreadFBIDFromThreadID(a.thread_id),e);if(c!==void 0)return b("MessengerSharedPhotosVideosBaseData.bs").localRemove(b("bs_caml_option").valFromOption(c),b("bs_belt_Array").keepMap(d,function(a){if(b("MercuryAttachment").isPhotoAttachment(a)||b("MercuryAttachment").isVideoAttachment(a)){a=a.metadata;if(a==null)return;else return b("bs_caml_option").nullable_to_opt(a.fbid)}}));else return 0}}function db(a,c,d){d=a.orderedMessageLists.get(d);if(d==null)return a;else{d=d.messageIDs;var e={contents:!0};return b("bs_belt_Array").reduce(d,a,function(d,a){if(e.contents){var f=d.localIDsMap.get(a);f=b("bs_belt_Option").getWithDefault(f==null?void 0:b("bs_caml_option").some(f),a);if(f===c){e.contents=!1;return d}else{a=Sa(d,f);if(a!==void 0){a=b("bs_caml_option").valFromOption(a);var g=a.replied_to_message,h;if(g==null)h=void 0;else{g=g.message;if(g==null)h=void 0;else{var i=d.localIDsMap.get(g.message_id);h=b("bs_belt_Option").getWithDefault(i==null?void 0:b("bs_caml_option").some(i),g.message_id)}}if(h!==void 0&&h===c){i={status:b("RepliedToMessageStatusForGraphQL").DELETED,message:null};g=Object.assign(Object.assign({},a),{replied_to_message:i});return Va(d,[f,g])}else return d}else return d}}else return d})}}function eb(a,c){if(a==null||a.length===0)return 0;else{a=b("bs_array").map(function(a){var d=a.type;if(b("bs_caml_obj").caml_equal(d,b("MessageProfileRangeType").THREAD_ACTIVE)||b("bs_caml_obj").caml_equal(d,b("MessageProfileRangeType").THREAD))return b("gkx")("678578");else{d=a.id;if(d==null)return!1;else return b("bs_caml_obj").caml_equal(b("FBID.bs").ofStringExn(d),c)}},a);return b("bs_array").fold_left(function(a,b){if(b)return a+1|0;else return a},0,a)}}function fb(a,c,d){if(b("cr:1299779")==null)return 0;else{var e=b("MercuryIDs").getThreadFBIDFromThreadID(a);return b("bs_curry")._1(b("cr:1299779").log,{event_name:b("MessengerWebEvent").SENT_MSG,mid:c,offline_threading_id:d,other_user_fbid:b("MercuryIDs").isCanonical(a)?e:null,thread_fbid:b("MercuryIDs").isGroupChat(a)?e:null})}}function gb(d,c,e,f){var g=e.client_message_id,h;if(g==null)h=d;else{var i=Sa(d,g);if(i!==void 0){i=b("bs_caml_option").valFromOption(i);var j=e.message_id,k=e.status;if(b("bs_caml_obj").caml_equal(i.status,b("MercuryActionStatus").SUCCESS))h=d;else if(d.messages.has(j)){var a=Object.assign(Object.assign({},i),e);Na(d.fbid,a.thread_id,a.message_id,f);h=Va(d,[j,a])}else{a=b("bs_caml_obj").caml_equal(e.status,b("MercuryActionStatus").SUCCESS)?e.error_data:null;b("MercuryMessageIDs.bs").addServerID(g,j);d.localIDsMap.set(g,j);i=Object.assign(Object.assign({},i),{status:k,error_data:a,timestamp:e.timestamp,log_message_data:e.log_message_data,ranges:e.ranges,attachments:e.attachments,has_attachment:e.has_attachment,is_one_way_sent:e.is_one_way_sent,is_forwarded:e.is_forwarded});b("MessengerMessage.bs").finalizeRanges(i);k=Va(d,[j,i]);k.messages.set(g,{});k.messages["delete"](g);a=i.thread_id;var l=k.orderedMessageLists.get(a);if(!(l==null)){var m=Ua(k,l.messageIDs);k.orderedMessageLists.set(a,{messageLoadingState:l.messageLoadingState,messageIDs:m})}Na(k.fbid,i.thread_id,i.message_id,f);a=b("MessengerMessage.bs").isTitanMessage(i);l=c.localTitanMessageCount.get(i.thread_id);a&&(l==null||c.localTitanMessageCount.set(i.thread_id,l-1|0));h={fbid:k.fbid,deliveryReceipts:k.deliveryReceipts,readReceiptsPerThread:k.readReceiptsPerThread,ignoredIds:k.ignoredIds,blockedIds:k.blockedIds,pendingFolderUnseenCount:k.pendingFolderUnseenCount,typing:k.typing,threads:k.threads,pendingReadStatusThreads:k.pendingReadStatusThreads,messages:k.messages,localIDsMap:k.localIDsMap.set(g,j),messagesWithUploadsInFlight:k.messagesWithUploadsInFlight,threadlistOrderMap:k.threadlistOrderMap,pinnedThreads:k.pinnedThreads,montage:k.montage,orderedMessageLists:k.orderedMessageLists,unreadCounts:k.unreadCounts,initialUnreadCounts:k.initialUnreadCounts,unseenTimestamp:k.unseenTimestamp}}}else h=d}m={};f=e.log_message_type;if(f==null)Object.assign(m,{snippet_attachments:e.attachments});else{if(b("bs_caml_obj").caml_equal(f,b("MercuryLogMessageType").THREAD_IMAGE)){a=e.log_message_data;if(a==null)c=null;else{i=a.image;c=i==null?null:i.preview_url}Object.assign(m,{image_src:c});s(h.fbid,e.thread_id)}b("bs_caml_obj").caml_notequal(f,b("MercuryLogMessageType").SUBSCRIBE)&&b("bs_caml_obj").caml_notequal(f,b("MercuryLogMessageType").UNSUBSCRIBE)&&Object.assign(m,{snippet_attachments:e.attachments})}fb(e.thread_id,e.message_id,e.offline_threading_id);return u(void 0,h,e.thread_id,m)}function hb(c,a,d,e){if(b("bs_caml_obj").caml_equal(d.action_type,b("MercuryActionType").SEND_MESSAGE))return gb(c,a,d,e);else{var f=d.offline_threading_id;f=b("bs_belt_Option").flatMap(f==null?void 0:b("bs_caml_option").some(f),function(a){return b("bs_caml_option").nullable_to_opt(c.localIDsMap.get(a))});var g=Sa(c,d.message_id);if(f!==void 0)if(g!==void 0){f=b("bs_caml_option").valFromOption(g);if(b("bs_caml_option").nullable_to_opt(f.sticker_id)!==void 0){var h=Object.assign(f,{attachments:d.attachments});return Va(c,[f.message_id,h])}else return c}else return c;else if(g!==void 0)return c;else{f=b("bs_caml_obj").caml_equal(e,b("bs_caml_option").some(b("MercuryPayloadSource").CLIENT_SEND_MESSAGE))?Wa(c,d):c;h=b("bs_caml_obj").caml_equal(d.client_state,b("MercuryMessageClientState").DO_NOT_SEND_TO_SERVER);g=d.upload_id;e=h&&!(g==null)?A(f,g,d):f;h=b("MessengerMessage.bs").isErrorLogMessage(d);g=d.thread_id;h&&(g==null||(a.failedHistoryFetchThreads.contents[g]=!0));f=d.manual_retry_cnt;h=d.thread_id;f==null||!(h==null)&&f>0&&Oa(e.fbid,h,b("MercuryPayloadSource").CLIENT_SEND_MESSAGE);g=Za(e,a,[d.message_id,d,1]);z(g.fbid,d);return g}}}function ib(a,c,d,e){if(c!==void 0){c=b("bs_caml_obj").caml_equal(b("bs_caml_option").valFromOption(c),b("MercuryPayloadSource").CLIENT_CHANNEL_MESSAGE);var f=d.thread_id;if(c&&!(f==null)){c=b("MercuryThreadInformer").getForFBID(a);return b("bs_curry")._3(e,c,f,d)}else return 0}else return 0}function jb(a,b){var c=a.participants.indexOf(b);if(c>0){Object.assign(a,{participants:[b].concat(a.participants.slice(0,c),a.participants.slice(c+1|0))});return 0}else return 0}function kb(a,c,d,e){var f=c.thread_id;if(f==null)return a;else{var g=b("bs_belt_Map").get(a.threads,f);if(g!==void 0){g=b("bs_caml_option").valFromOption(g);var h={};if(!c.skip_bump_thread&&b("bs_caml_obj").caml_notequal(d,b("bs_caml_option").some(b("MercuryPayloadSource").SERVER_FETCH_THREAD_INFO))){Ga(h,c,b("bs_caml_option").nullable_to_opt(c.log_message_body));if(c.timestamp>g.timestamp){Object.assign(h,{timestamp:c.timestamp});if(c.is_unread){Object.assign(h,{unread_count:g.unread_count+1|0});d=eb(c.profile_ranges,a.fbid);d>0&&Object.assign(h,{unread_mentions_count:g.unread_mentions_count+d|0})}}Object.assign(h,{message_count:g.message_count+1|0,is_archived:!1})}e!==!0&&(c.timestamp>h.server_timestamp&&Object.assign(h,{server_timestamp:c.timestamp}));if(b("bs_caml_obj").caml_notequal(h,{}))return u(void 0,a,f,h);else return a}else return a}}function lb(b,a,c){var d=new Set(c);Object.assign(a,{participants:a.participants.filter(function(a){return!d.has(a)})});if(d.has(b)){Object.assign(a,{can_reply:!1,is_subscribed:!1});return 0}else return 0}function B(c,a,d){a=a.specific_to_list;if(a==null){d=b("MercuryIDs").tokenize(d);if(d.type!=="user"||d.value.length===0)return[c];else return[b("MercuryIDs").getParticipantIDFromUserID(b("FBID.bs").ofStringExn(d.value)),c]}else return a}function C(c,a,d){var e=b("MercuryIDs").tokenize(d),f=e.type==="user",g=a.specific_to_list;g=f?!0:g==null?!1:b("MessengerThreadUtils.bs").isCanonicalFromInitialParticipants(c,g);if(g||f)c=B(c,a,d);else{var h=a.specific_to_list;c=h==null?[]:h}return new(b("ImmutableObject"))({admins:{},admin_model_status:null,approval_mode:0,approval_queue_ids:[],associated_object:null,can_reply:!0,cannot_reply_reason:null,can_viewer_report:!1,comm_item_owners:null,comm_source_id:null,comm_status:null,comm_icon_type:[],composer_input_disabled:null,custom_like_icon:null,custom_nickname:null,customization_enabled:!1,description:null,ephemeral_ttl_mode:0,footer_color:null,game_id:null,gradient_colors:[],accessibility_label:null,reverse_gradients_for_radial:null,group_approval_queue:null,group_thread_subtype:null,work_associated_group:null,pinned_messages:null,groups_sync_status:null,has_email_participant:!1,has_montage:!1,unread_mentions_count:0,header_color:null,is_canonical_neo_user:!1,is_from_weak_entry_point:!1,is_pin_protected:!1,is_pinned:!1,is_thread_queue_enabled:!1,joinable_mode:{link:"",mode:0},last_message_timestamp:0,last_message_type:null,last_message_admin_text_type:null,last_message_unsendability_status:null,last_message_id:null,last_read_timestamp:0,lightweight_event:null,lightweight_events:{},marketplace_thread_data:null,mentions_mute_mode:0,mute_until:null,page_comm_item_id:null,page_thread_info:null,page_unsubscribe_status:!1,participant_add_mode:null,participants_event_status:null,reactions_mute_mode:0,read_only:!1,recipients_loadable:!0,rtc_call_data:null,server_timestamp:0,solid_color:null,subtitle:null,theme_id:null,reactions:void 0,thread_associated_job_applications:null,thread_associated_page_admin:null,thread_connectivity_data:null,thread_fbid:null,thread_type:null,thread_pin_timestamp:null,thread_id:d,participants:c,preloaded_participants:[],name:"",snippet:a.body,snippet_attachments:[],snippet_sender:a.author,unread_count:0,message_count:0,image_src:null,square_image_src:null,timestamp:a.timestamp,other_user_fbid:f?b("FBID.bs").ofStringExn(e.value):null,is_canonical_user:f,is_other_recipient_page:!1,is_canonical:g,is_subscribed:!0,folder:b("MessagingTag").INBOX,is_archived:!1,is_page_follow_up:!1,is_page_unresponded_thread:!1,object_association_type:null,joinable_link:null,linked_mentorship_programs:null,thread_unsendability_status:null,is_business_page_active:!1,graphql_token:null,conversion_detection_data:null})}function mb(c,d,a,e){e=b("MessengerMessage.bs").hasServerTimestamp(a,e);var f=a.thread_id;if(f==null)return;else{b("MercuryAssert").isThreadID(f);d=b("bs_belt_Map").get(d,f);if(d!==void 0)return b("bs_caml_option").some(b("bs_caml_option").valFromOption(d));else if(b("bs_caml_obj").caml_equal(a.action_type,b("MercuryActionType").USER_GENERATED_MESSAGE)&&!e)return b("bs_caml_option").some(C(b("MercuryIDs").getParticipantIDFromUserID(c),a,f));else return}}function nb(a,c){var d=c.other_user_fbid;if(d==null){var e=c.thread_fbid;e=e==null?void 0:b("bs_caml_option").some(b("MercuryIDs").getThreadIDFromThreadFBID(e))}else e=b("bs_caml_option").some(b("MercuryIDs").getThreadIDFromUserID(d));d=c.thread_id;e=d==null?e:d==null?void 0:b("bs_caml_option").some(d);d=c.thread_id;var f;if(d==null)f="";else{d=b("bs_belt_Map").get(a.threads,d);f=d!==void 0?b("MessengerFolders.bs").getFromMeta(b("bs_caml_option").valFromOption(d)):c.folder}za.includes(f)&&((b("bs_caml_obj").caml_equal(c.action_type,b("MercuryActionType").USER_GENERATED_MESSAGE)||b("bs_caml_obj").caml_equal(c.action_type,b("MercuryActionType").LOG_MESSAGE))&&c.is_unread&&ya(a,f,e));return{fbid:a.fbid,deliveryReceipts:a.deliveryReceipts,readReceiptsPerThread:a.readReceiptsPerThread,ignoredIds:a.ignoredIds,blockedIds:a.blockedIds,pendingFolderUnseenCount:a.pendingFolderUnseenCount,typing:a.typing,threads:a.threads,pendingReadStatusThreads:a.pendingReadStatusThreads,messages:a.messages,localIDsMap:a.localIDsMap,messagesWithUploadsInFlight:a.messagesWithUploadsInFlight,threadlistOrderMap:a.threadlistOrderMap,pinnedThreads:a.pinnedThreads,montage:a.montage,orderedMessageLists:a.orderedMessageLists,unreadCounts:a.unreadCounts,initialUnreadCounts:a.initialUnreadCounts,unseenTimestamp:a.unseenTimestamp}}var ob=function(a,b){delete a[b];return 0};function pb(a,c){Object.keys(c).forEach(function(d){var e=b("bs_js_dict").get(c,d);if(e!==void 0){e=e;var f=e[0],g=j(f.reduce(function(d,e){var c=b("bs_belt_Map").get(a,e);if(c!==void 0)return b("bs_belt_Map").set(d,e,b("bs_caml_option").valFromOption(c));else return d},b("bs_belt_Map").make(b("ThreadId.bs"))));if(Object.keys(g).length===f.length){ob(c,d);return b("bs_curry")._1(e[1],g)}else return 0}else return 0});return 0}function qb(c,a,d,e,f){var g=c.fbid;d!==0&&sa(g,a.thread_id,f,d);if(a.timestamp===0){b("ChatReliabilityInstrumentation").logERROR("thread timestamp is 0");e.add(a.thread_id);return}else{d=a.unread_count===0;if(d===f)return;else{s(g,a.thread_id);if(f)e=0;else{d=b("bs_belt_Option").flatMap(b("bs_caml_option").nullable_to_opt(c.orderedMessageLists.get(a.thread_id)),function(a){return b("bs_belt_Array").get(Ta(void 0,c,a.messageIDs),0)});g=d!==void 0?b("bs_caml_option").valFromOption(d).profile_ranges:null;e=eb(g,c.fbid)}return{unread_count:f?0:1,unread_mentions_count:e}}}}function rb(a,c,d,e,f){f=b("gkx")("1275193")?v(a,f,c,d):xa(a,f,c,d);a=a.threadlistOrderMap[c];c=b("bs_js_dict").get(a,d);c=c!==void 0?b("bs_caml_option").valFromOption(c).reachedEnd:!1;a[d]={reachedEnd:e.contents?e.contents:c,threadlist:f[0],existingIDs:f[1]};return 0}function sb(a,c,d,e){var f=b("bs_belt_Array").make(e.length,[]),g={contents:!1};d.forEach(function(d){d.thread_ids.forEach(function(c){var h=b("bs_belt_Map").get(a.threads,c);if(h!==void 0){h=wa(b("bs_caml_option").valFromOption(h));for(var g=0,d=e.length-1|0;g<=d;++g){var i=h.find(function(a){return function(c){return c===b("bs_caml_array").caml_array_get(e,a)}}(g));(i===void 0?void 0:b("bs_caml_option").some(i))!==void 0&&b("bs_caml_array").caml_array_get(f,g).push(c)}return 0}else return 0});d=d.limit;var h=e.find(function(a){return a===b("MercuryFilters.bs").all});h=h===void 0?void 0:b("bs_caml_option").some(h);for(var i=0,c=f.length-1|0;i<=c;++i)h===void 0&&b("bs_caml_array").caml_array_get(f,i).length<d?g.contents=!0:b("bs_caml_array").caml_array_get(e,i)===b("MercuryFilters.bs").all&&b("bs_caml_array").caml_array_get(f,i).length<d&&(g.contents=!0);return 0});for(var d=0,h=e.length-1|0;d<=h;++d)rb(a,c,b("bs_caml_array").caml_array_get(e,d),g,b("bs_caml_array").caml_array_get(f,d));return 0}function tb(c,a){var d;if(a.is_archived)d=b("MessagingTag").ACTION_ARCHIVED;else{var e=a.thread_type;d=e==null||e!==b("MessagingThreadType").MARKETPLACE?a.folder:b("MessagingTag").MARKETPLACE_FOLDER}e=b("bs_js_dict").get(c.threadlistOrderMap,d);if(e!==void 0)return d}function ub(a,c){var d={};oa.forEach(function(a){var b={};na.forEach(function(a){b[a]=[];return 0});d[a]=b;return 0});c.forEach(function(c){var e=b("bs_belt_Map").get(a.threads,c.thread_id);if(e!==void 0){var f=b("bs_caml_option").valFromOption(e);e=tb(a,f);if(e!==void 0){var g=e;wa(f).forEach(function(a){if(f.timestamp!==0){d[g][a].push(c.thread_id);return 0}else return 0});return 0}else return 0}else return 0});oa.forEach(function(c){na.forEach(function(e){var f=d[c][e];if(b("gkx")("1275193")){v(a,f,c,e);return 0}else{xa(a,f,c,e);return 0}});return 0});return{fbid:a.fbid,deliveryReceipts:a.deliveryReceipts,readReceiptsPerThread:a.readReceiptsPerThread,ignoredIds:a.ignoredIds,blockedIds:a.blockedIds,pendingFolderUnseenCount:a.pendingFolderUnseenCount,typing:a.typing,threads:a.threads,pendingReadStatusThreads:a.pendingReadStatusThreads,messages:a.messages,localIDsMap:a.localIDsMap,messagesWithUploadsInFlight:a.messagesWithUploadsInFlight,threadlistOrderMap:a.threadlistOrderMap,pinnedThreads:a.pinnedThreads,montage:a.montage,orderedMessageLists:a.orderedMessageLists,unreadCounts:a.unreadCounts,initialUnreadCounts:a.initialUnreadCounts,unseenTimestamp:a.unseenTimestamp}}function vb(a){b("bs_belt_Map").map(a.threads,function(c){c=b("bs_belt_Map").get(a.threads,c.thread_id);if(c!==void 0){c=b("bs_caml_option").valFromOption(c);if(b("bs_caml_option").nullable_to_opt(c.thread_type)===b("MessagingThreadType").MARKETPLACE){c=b("ImmutableObject").set(c,{folder:"marketplace_folder"});ub(a,[c]);return 0}else return 0}else return 0});return 0}function wb(c,a,d){var e=function(a){return a.timestamp>(d&&c.unseenTimestamp<=a.last_read_timestamp?a.last_read_timestamp:c.unseenTimestamp)},f=function(a){var d;return(d=b("bs_belt_Option")).mapWithDefault(d.flatMap(d.map(d.map(b("bs_caml_option").nullable_to_opt(c.orderedMessageLists.get(a.thread_id)),function(a){return b("bs_caml_array").caml_array_get(a.messageIDs,0)}),function(a){return b("bs_belt_Option").getWithDefault(b("bs_caml_option").nullable_to_opt(c.localIDsMap.get(a)),a)}),function(a){return b("bs_caml_option").nullable_to_opt(c.messages.get(a))}),!1,function(a){return a.author===b("MercuryIDs").getParticipantIDFromUserID(c.fbid)})},g=function(a,c){if(e(a)&&!b("MercuryThreadInfo").isMuted(a)&&!f(a))return c+1|0;else return c};return b("bs_belt_Option").getWithDefault(b("bs_belt_Option").map(b("bs_belt_Option").flatMap(b("bs_js_dict").get(c.threadlistOrderMap,b("MessagingTag").INBOX),function(a){return b("bs_js_dict").get(a,b("MercuryFilters.bs").all)}),function(d){d=d.threadlist;if(d.length!==0)return d.reduce(function(a,d){d=b("bs_belt_Map").get(c.threads,d);if(d!==void 0)return g(b("bs_caml_option").valFromOption(d),a);else return a},0);else if(b("bs_belt_Map").isEmpty(c.threads))return a.fallbackUnseenCount.contents;else return b("bs_belt_Map").reduce(c.threads,0,function(d,e,a){e=tb(c,a);if(e!==void 0&&e===b("MessagingTag").INBOX)return g(a,d);else return d})}),a.fallbackUnseenCount.contents)}function xb(c,a){return b("bs_belt_Option").getWithDefault(b("bs_belt_Option").map(b("bs_belt_Option").flatMap(b("bs_js_dict").get(c.threadlistOrderMap,b("MessagingTag").INBOX),function(a){return b("bs_js_dict").get(a,b("MercuryFilters.bs").all)}),function(d){if(d.threadlist.length===0)if(b("bs_belt_Map").isEmpty(c.threads))return a.fallbackUnseenCount.contents;else return b("bs_belt_Map").reduce(c.threads,0,function(d,e,a){var f=tb(c,a);if(f!==void 0&&f===b("MessagingTag").INBOX&&a.timestamp>c.unseenTimestamp&&!b("MercuryThreadInfo").isMuted(a)){f=b("bs_js_dict").get(c.unreadCounts,b("MessagingTag").INBOX);if(f!==void 0&&b("bs_caml_option").valFromOption(f).has(e))return d+1|0;else return d}else return d});else return d.threadlist.reduce(function(a,d){var e=b("bs_belt_Map").get(c.threads,d);if(e!==void 0){e=b("bs_caml_option").valFromOption(e);if(e.timestamp>c.unseenTimestamp&&!b("MercuryThreadInfo").isMuted(e)){e=b("bs_js_dict").get(c.unreadCounts,b("MessagingTag").INBOX);if(e!==void 0&&b("bs_caml_option").valFromOption(e).has(d))return a+1|0;else return a}else return a}else return a},0)}),a.fallbackUnseenCount.contents)}function yb(c,a,d){if(d===b("MessagingTag").PENDING)return{fbid:c.fbid,deliveryReceipts:c.deliveryReceipts,readReceiptsPerThread:c.readReceiptsPerThread,ignoredIds:c.ignoredIds,blockedIds:c.blockedIds,pendingFolderUnseenCount:0,typing:c.typing,threads:c.threads,pendingReadStatusThreads:c.pendingReadStatusThreads,messages:c.messages,localIDsMap:c.localIDsMap,messagesWithUploadsInFlight:c.messagesWithUploadsInFlight,threadlistOrderMap:c.threadlistOrderMap,pinnedThreads:c.pinnedThreads,montage:c.montage,orderedMessageLists:c.orderedMessageLists,unreadCounts:c.unreadCounts,initialUnreadCounts:c.initialUnreadCounts,unseenTimestamp:c.unseenTimestamp};else{if(b("gkx")("969964")){d=b("MercuryThreadInformer").getForFBID(c.fbid);d.updatedUnseenTimestamp()}return{fbid:c.fbid,deliveryReceipts:c.deliveryReceipts,readReceiptsPerThread:c.readReceiptsPerThread,ignoredIds:c.ignoredIds,blockedIds:c.blockedIds,pendingFolderUnseenCount:c.pendingFolderUnseenCount,typing:c.typing,threads:c.threads,pendingReadStatusThreads:c.pendingReadStatusThreads,messages:c.messages,localIDsMap:c.localIDsMap,messagesWithUploadsInFlight:c.messagesWithUploadsInFlight,threadlistOrderMap:c.threadlistOrderMap,pinnedThreads:c.pinnedThreads,montage:c.montage,orderedMessageLists:c.orderedMessageLists,unreadCounts:c.unreadCounts,initialUnreadCounts:c.initialUnreadCounts,unseenTimestamp:a}}}function zb(a,c,d){var e=[];d=b("bs_array").fold_left(function(f,g){switch(g.tag|0){case 0:e.push(g[0].tag|0);break;case 1:case 2:break}switch(g.tag|0){case 0:var i=g[0];if(typeof i==="number"){var l=f,m=a;m.threadCallbacks.contents={};m.threadSubToken.contents=m.threadSubToken.contents;m.failedHistoryFetchThreads.contents={};m.localTitanMessageCount.clear();b("bs_belt_Map").keysToArray(l.threads).forEach(function(a){return qa(l.fbid,a)});return{fbid:l.fbid,deliveryReceipts:l.deliveryReceipts,readReceiptsPerThread:null,ignoredIds:l.ignoredIds,blockedIds:l.blockedIds,pendingFolderUnseenCount:l.pendingFolderUnseenCount,typing:l.typing,threads:b("bs_belt_Map").make(b("ThreadId.bs")),pendingReadStatusThreads:new Set(),messages:new Map(),localIDsMap:new Map(),messagesWithUploadsInFlight:l.messagesWithUploadsInFlight,threadlistOrderMap:pa(0),pinnedThreads:l.pinnedThreads,montage:l.montage,orderedMessageLists:new Map(),unreadCounts:l.unreadCounts,initialUnreadCounts:l.initialUnreadCounts,unseenTimestamp:l.unseenTimestamp}}else switch(i.tag|0){case 0:m=f;var aa=i[0],ca={contents:!1},da={contents:m.deliveryReceipts};Object.keys(aa).forEach(function(a){var c=aa[a],d=b("bs_belt_Option").getWithDefault(b("bs_belt_MapString").get(da.contents,a),0);if(c>d){ca.contents=!0;da.contents=b("bs_belt_MapString").set(da.contents,a,c);return 0}else return 0});if(ca.contents)return{fbid:m.fbid,deliveryReceipts:da.contents,readReceiptsPerThread:m.readReceiptsPerThread,ignoredIds:m.ignoredIds,blockedIds:m.blockedIds,pendingFolderUnseenCount:m.pendingFolderUnseenCount,typing:m.typing,threads:m.threads,pendingReadStatusThreads:m.pendingReadStatusThreads,messages:m.messages,localIDsMap:m.localIDsMap,messagesWithUploadsInFlight:m.messagesWithUploadsInFlight,threadlistOrderMap:m.threadlistOrderMap,pinnedThreads:m.pinnedThreads,montage:m.montage,orderedMessageLists:m.orderedMessageLists,unreadCounts:m.unreadCounts,initialUnreadCounts:m.initialUnreadCounts,unseenTimestamp:m.unseenTimestamp};else return m;case 1:return ja(f,i[0],[]);case 2:m=f;var n=i[0],o=i[1];o=o.reduce(b("bs_belt_Set").remove,n.reduce(b("bs_belt_Set").add,m.blockedIds));if(o===m.blockedIds)return m;else return{fbid:m.fbid,deliveryReceipts:m.deliveryReceipts,readReceiptsPerThread:m.readReceiptsPerThread,ignoredIds:m.ignoredIds,blockedIds:o,pendingFolderUnseenCount:m.pendingFolderUnseenCount,typing:m.typing,threads:m.threads,pendingReadStatusThreads:m.pendingReadStatusThreads,messages:m.messages,localIDsMap:m.localIDsMap,messagesWithUploadsInFlight:m.messagesWithUploadsInFlight,threadlistOrderMap:m.threadlistOrderMap,pinnedThreads:m.pinnedThreads,montage:m.montage,orderedMessageLists:m.orderedMessageLists,unreadCounts:m.unreadCounts,initialUnreadCounts:m.initialUnreadCounts,unseenTimestamp:m.unseenTimestamp};case 3:n=f;o=i[0];m=o.reduce(function(c,d){var a=d.is_messenger_ignored;if(a==null)return c;else if(a)return b("bs_belt_Set").add(c,b("MercuryIDs").getParticipantIDFromUserID(d.fbid));else return b("bs_belt_Set").remove(c,b("MercuryIDs").getParticipantIDFromUserID(d.fbid))},n.ignoredIds);if(m===n.ignoredIds)return n;else return{fbid:n.fbid,deliveryReceipts:n.deliveryReceipts,readReceiptsPerThread:n.readReceiptsPerThread,ignoredIds:m,blockedIds:n.blockedIds,pendingFolderUnseenCount:n.pendingFolderUnseenCount,typing:n.typing,threads:n.threads,pendingReadStatusThreads:n.pendingReadStatusThreads,messages:n.messages,localIDsMap:n.localIDsMap,messagesWithUploadsInFlight:n.messagesWithUploadsInFlight,threadlistOrderMap:n.threadlistOrderMap,pinnedThreads:n.pinnedThreads,montage:n.montage,orderedMessageLists:n.orderedMessageLists,unreadCounts:n.unreadCounts,initialUnreadCounts:n.initialUnreadCounts,unseenTimestamp:n.unseenTimestamp};case 4:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("SetInitialPendingFolderUnseenCount");o=f;m=i[0];return{fbid:o.fbid,deliveryReceipts:o.deliveryReceipts,readReceiptsPerThread:o.readReceiptsPerThread,ignoredIds:o.ignoredIds,blockedIds:o.blockedIds,pendingFolderUnseenCount:m,typing:o.typing,threads:o.threads,pendingReadStatusThreads:o.pendingReadStatusThreads,messages:o.messages,localIDsMap:o.localIDsMap,messagesWithUploadsInFlight:o.messagesWithUploadsInFlight,threadlistOrderMap:o.threadlistOrderMap,pinnedThreads:o.pinnedThreads,montage:o.montage,orderedMessageLists:o.orderedMessageLists,unreadCounts:o.unreadCounts,initialUnreadCounts:o.initialUnreadCounts,unseenTimestamp:o.unseenTimestamp};case 5:n=f;m=i[0];o=ma(n.fbid,m);if(o==null)return n;else{var p=b("FBID.bs").ofString(m.from.toString());if(p!==void 0){b("MessengerPersonas.bs").addPersona(m.persona);var q=m.persona;p=q==null?b("MercuryIDs").getParticipantIDFromUserID(b("bs_caml_option").valFromOption(p)):b("MercuryIDs").getParticipantIDFromUserID(q.id);if(m.st===b("TypingStates").TYPING){q=b("bs_belt_MapString").get(n.typing,o);if(q!==void 0)return{fbid:n.fbid,deliveryReceipts:n.deliveryReceipts,readReceiptsPerThread:n.readReceiptsPerThread,ignoredIds:n.ignoredIds,blockedIds:n.blockedIds,pendingFolderUnseenCount:n.pendingFolderUnseenCount,typing:b("bs_belt_MapString").set(n.typing,o,b("bs_belt_Map").set(b("bs_caml_option").valFromOption(q),p,Date.now())),threads:n.threads,pendingReadStatusThreads:n.pendingReadStatusThreads,messages:n.messages,localIDsMap:n.localIDsMap,messagesWithUploadsInFlight:n.messagesWithUploadsInFlight,threadlistOrderMap:n.threadlistOrderMap,pinnedThreads:n.pinnedThreads,montage:n.montage,orderedMessageLists:n.orderedMessageLists,unreadCounts:n.unreadCounts,initialUnreadCounts:n.initialUnreadCounts,unseenTimestamp:n.unseenTimestamp};else{q=b("bs_belt_Map").set(b("bs_belt_Map").make(b("ParticipantId.bs")),p,Date.now());return{fbid:n.fbid,deliveryReceipts:n.deliveryReceipts,readReceiptsPerThread:n.readReceiptsPerThread,ignoredIds:n.ignoredIds,blockedIds:n.blockedIds,pendingFolderUnseenCount:n.pendingFolderUnseenCount,typing:b("bs_belt_MapString").set(n.typing,o,q),threads:n.threads,pendingReadStatusThreads:n.pendingReadStatusThreads,messages:n.messages,localIDsMap:n.localIDsMap,messagesWithUploadsInFlight:n.messagesWithUploadsInFlight,threadlistOrderMap:n.threadlistOrderMap,pinnedThreads:n.pinnedThreads,montage:n.montage,orderedMessageLists:n.orderedMessageLists,unreadCounts:n.unreadCounts,initialUnreadCounts:n.initialUnreadCounts,unseenTimestamp:n.unseenTimestamp}}}else if(m.st===b("TypingStates").INACTIVE){q=la(n.typing,o,p);if(q!==n.typing)return{fbid:n.fbid,deliveryReceipts:n.deliveryReceipts,readReceiptsPerThread:n.readReceiptsPerThread,ignoredIds:n.ignoredIds,blockedIds:n.blockedIds,pendingFolderUnseenCount:n.pendingFolderUnseenCount,typing:q,threads:n.threads,pendingReadStatusThreads:n.pendingReadStatusThreads,messages:n.messages,localIDsMap:n.localIDsMap,messagesWithUploadsInFlight:n.messagesWithUploadsInFlight,threadlistOrderMap:n.threadlistOrderMap,pinnedThreads:n.pinnedThreads,montage:n.montage,orderedMessageLists:n.orderedMessageLists,unreadCounts:n.unreadCounts,initialUnreadCounts:n.initialUnreadCounts,unseenTimestamp:n.unseenTimestamp};else return n}else return n}else return n}case 6:m=f;var ea=i[0],fa={contents:!1},ga={contents:m.readReceiptsPerThread};Object.keys(ea).forEach(function(c){Object.keys(ea[c]).forEach(function(d){var a=b("bs_belt_MapString").get(ga.contents,c);a=a!==void 0?b("bs_caml_option").valFromOption(a):b("immutable").OrderedMap();var e=a.get(d),f=ea[c][d];if(!(e==null)&&f.watermark<=e.watermark)return 0;fa.contents=!0;ga.contents=b("bs_belt_MapString").set(ga.contents,c,a.set(d,f));return 0});var a=b("bs_belt_MapString").get(ga.contents,c);if(a!==void 0){fa.contents=!0;ga.contents=b("bs_belt_MapString").set(ga.contents,c,b("bs_caml_option").valFromOption(a).sort(function(a,c){return b("bs_caml_primitive").caml_float_compare(a.watermark,c.watermark)}));return 0}else return 0});if(fa.contents)return{fbid:m.fbid,deliveryReceipts:m.deliveryReceipts,readReceiptsPerThread:ga.contents,ignoredIds:m.ignoredIds,blockedIds:m.blockedIds,pendingFolderUnseenCount:m.pendingFolderUnseenCount,typing:m.typing,threads:m.threads,pendingReadStatusThreads:m.pendingReadStatusThreads,messages:m.messages,localIDsMap:m.localIDsMap,messagesWithUploadsInFlight:m.messagesWithUploadsInFlight,threadlistOrderMap:m.threadlistOrderMap,pinnedThreads:m.pinnedThreads,montage:m.montage,orderedMessageLists:m.orderedMessageLists,unreadCounts:m.unreadCounts,initialUnreadCounts:m.initialUnreadCounts,unseenTimestamp:m.unseenTimestamp};else return m;case 7:var r=f;o=a;p=i[0];if(p.length!==0){q=r.threads;n=p.reduce(function(c,a){return b("bs_belt_Map").set(c,a.thread_id,new(b("ImmutableObject"))(a))},q);pb(n,o.threadCallbacks.contents);p.forEach(function(a){return s(r.fbid,a.thread_id)});return{fbid:r.fbid,deliveryReceipts:r.deliveryReceipts,readReceiptsPerThread:r.readReceiptsPerThread,ignoredIds:r.ignoredIds,blockedIds:r.blockedIds,pendingFolderUnseenCount:r.pendingFolderUnseenCount,typing:r.typing,threads:n,pendingReadStatusThreads:r.pendingReadStatusThreads,messages:r.messages,localIDsMap:r.localIDsMap,messagesWithUploadsInFlight:r.messagesWithUploadsInFlight,threadlistOrderMap:r.threadlistOrderMap,pinnedThreads:r.pinnedThreads,montage:r.montage,orderedMessageLists:r.orderedMessageLists,unreadCounts:r.unreadCounts,initialUnreadCounts:r.initialUnreadCounts,unseenTimestamp:r.unseenTimestamp}}else return r;case 8:m=f;q=i[0];if(q.length!==0){var ia=m.pendingReadStatusThreads,sa=b("MercuryServerRequests").getForFBID(m.fbid);q.forEach(function(a){var b=a.thread_id;if(ia.has(b)){ia["delete"](b);if(a.unread_count>0){sa.changeThreadReadStatus(b,!0,null,null,null,null);return 0}else return 0}else return 0});return{fbid:m.fbid,deliveryReceipts:m.deliveryReceipts,readReceiptsPerThread:m.readReceiptsPerThread,ignoredIds:m.ignoredIds,blockedIds:m.blockedIds,pendingFolderUnseenCount:m.pendingFolderUnseenCount,typing:m.typing,threads:m.threads,pendingReadStatusThreads:ia,messages:m.messages,localIDsMap:m.localIDsMap,messagesWithUploadsInFlight:m.messagesWithUploadsInFlight,threadlistOrderMap:m.threadlistOrderMap,pinnedThreads:m.pinnedThreads,montage:m.montage,orderedMessageLists:m.orderedMessageLists,unreadCounts:m.unreadCounts,initialUnreadCounts:m.initialUnreadCounts,unseenTimestamp:m.unseenTimestamp}}else return m;case 9:var t=f,wa=i[0];b("qex")._("998180")&&b("MessengerEnvironment").messengerdotcom&&vb(t);oa.forEach(function(a){na.forEach(function(d){var c=t,e=wa,f=a,g=d;d=e.filter(function(c){var a=c.filter;a=a==null?b("MercuryFilters.bs").all:a;c=c.folder;c=c==null?f===b("MessagingTag").INBOX:c===f;if(c)return a===g;else return!1});if(!b("gkx")("1275193")||f!==b("MessagingTag").INBOX&&f!==b("MessagingTag").ACTION_ARCHIVED&&f!==b("MessagingTag").PENDING||g===b("MercuryFilters.bs").groups){var h=[],i={contents:!1};d.forEach(function(a){a.thread_ids.forEach(function(a){h.push(a);return 0});var b=a.limit;if(a.thread_ids.length<b){i.contents=!0;return 0}else return 0});return rb(c,f,g,i,h)}else if(g===b("MercuryFilters.bs").all){return sb(c,f,d,[(e=b("MercuryFilters.bs")).all,e.unread,e.named,e.unnamed])}else return sb(c,f,d,[b("MercuryFilters.bs").all,g])});return 0});return{fbid:t.fbid,deliveryReceipts:t.deliveryReceipts,readReceiptsPerThread:t.readReceiptsPerThread,ignoredIds:t.ignoredIds,blockedIds:t.blockedIds,pendingFolderUnseenCount:t.pendingFolderUnseenCount,typing:t.typing,threads:t.threads,pendingReadStatusThreads:t.pendingReadStatusThreads,messages:t.messages,localIDsMap:t.localIDsMap,messagesWithUploadsInFlight:t.messagesWithUploadsInFlight,threadlistOrderMap:t.threadlistOrderMap,pinnedThreads:t.pinnedThreads,montage:t.montage,orderedMessageLists:t.orderedMessageLists,unreadCounts:t.unreadCounts,initialUnreadCounts:t.initialUnreadCounts,unseenTimestamp:t.unseenTimestamp};case 10:return ub(f,i[0]);case 11:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("UpdatePinnedThreads");var v=f,Ca=a;o=i[0];if(o.length!==0){o.forEach(function(a){if(Ca.existingPinnedThreads.has(a))return 0;else{v.pinnedThreads.push(a);Ca.existingPinnedThreads.add(a);return 0}});p=b("MercuryThreadInformer").getForFBID(v.fbid);p.updatedThreadlist();return{fbid:v.fbid,deliveryReceipts:v.deliveryReceipts,readReceiptsPerThread:v.readReceiptsPerThread,ignoredIds:v.ignoredIds,blockedIds:v.blockedIds,pendingFolderUnseenCount:v.pendingFolderUnseenCount,typing:v.typing,threads:v.threads,pendingReadStatusThreads:v.pendingReadStatusThreads,messages:v.messages,localIDsMap:v.localIDsMap,messagesWithUploadsInFlight:v.messagesWithUploadsInFlight,threadlistOrderMap:v.threadlistOrderMap,pinnedThreads:v.pinnedThreads,montage:v.montage,orderedMessageLists:v.orderedMessageLists,unreadCounts:v.unreadCounts,initialUnreadCounts:v.initialUnreadCounts,unseenTimestamp:v.unseenTimestamp}}else return v;case 12:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("UnSubscribeStatusUpdate");n=f;q=i[0];var Ga=i[1];return u(function(a){return a.page_unsubscribe_status!==Ga},n,q,{page_unsubscribe_status:Ga});case 13:m=f;o=i[0];p=i[1];n=i[2];return u(void 0,m,o,{can_reply:p,cannot_reply_reason:n});case 14:q=f;m=i[0];o=i[1];p=b("bs_belt_Map").get(q.threads,m);if(p!==void 0){n=Object.assign({},b("bs_caml_option").valFromOption(p));ua(b("MercuryIDs").getParticipantIDFromUserID(q.fbid),n,o);return u(void 0,q,m,n)}else return q;case 15:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("ChangeFlag");p=f;o=i[0];m=i[1];n=b("bs_belt_Map").get(p.threads,o);if(n!==void 0){q=b("bs_caml_option").valFromOption(n);n=q.page_thread_info;q=b("ImmutableObject").set(q,{page_thread_info:Object.assign(n==null?{}:n,{flagged:m})});n=b("bs_belt_Map").set(p.threads,o,q);s(p.fbid,o);return{fbid:p.fbid,deliveryReceipts:p.deliveryReceipts,readReceiptsPerThread:p.readReceiptsPerThread,ignoredIds:p.ignoredIds,blockedIds:p.blockedIds,pendingFolderUnseenCount:p.pendingFolderUnseenCount,typing:p.typing,threads:n,pendingReadStatusThreads:p.pendingReadStatusThreads,messages:p.messages,localIDsMap:p.localIDsMap,messagesWithUploadsInFlight:p.messagesWithUploadsInFlight,threadlistOrderMap:p.threadlistOrderMap,pinnedThreads:p.pinnedThreads,montage:p.montage,orderedMessageLists:p.orderedMessageLists,unreadCounts:p.unreadCounts,initialUnreadCounts:p.initialUnreadCounts,unseenTimestamp:p.unseenTimestamp}}else return p;case 16:m=f;q=i[0];return u(function(a){return b("MessageRequestUtils").isMessageRequest(a)},m,q,{folder:b("MessagingTag").INBOX});case 17:o=f;n=i[0];p=i[1];return u(void 0,o,n,{custom_like_icon:p});case 18:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("PromoteGroupAdmins");m=f;q=i[0];o=i[1];n=b("bs_belt_Map").get(m.threads,q);if(n!==void 0){p=b("bs_caml_option").valFromOption(n);n=b("bs_js_dict").fromArray(b("bs_js_dict").entries(p.admins));p=b("ImmutableObject").set(p,{admins:b("bs_array").fold_left(function(a,b){a[b.admin_fbid]=b.admin_type;return a},n,o)});n=b("bs_belt_Map").set(m.threads,q,p);s(m.fbid,q);return{fbid:m.fbid,deliveryReceipts:m.deliveryReceipts,readReceiptsPerThread:m.readReceiptsPerThread,ignoredIds:m.ignoredIds,blockedIds:m.blockedIds,pendingFolderUnseenCount:m.pendingFolderUnseenCount,typing:m.typing,threads:n,pendingReadStatusThreads:m.pendingReadStatusThreads,messages:m.messages,localIDsMap:m.localIDsMap,messagesWithUploadsInFlight:m.messagesWithUploadsInFlight,threadlistOrderMap:m.threadlistOrderMap,pinnedThreads:m.pinnedThreads,montage:m.montage,orderedMessageLists:m.orderedMessageLists,unreadCounts:m.unreadCounts,initialUnreadCounts:m.initialUnreadCounts,unseenTimestamp:m.unseenTimestamp}}else return m;case 19:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("RemoveGroupAdmins");o=f;p=i[0];q=i[1];n=b("bs_belt_Map").get(o.threads,p);if(n!==void 0){m=b("bs_caml_option").valFromOption(n);n=b("bs_js_dict").fromArray(b("bs_js_dict").entries(m.admins));m=b("ImmutableObject").set(m,{admins:b("bs_array").fold_left(function(d,c){var a=b("bs_js_dict").get(d,c);a!==void 0&&ka(d,c);return d},n,q)});n=b("bs_belt_Map").set(o.threads,p,m);s(o.fbid,p);return{fbid:o.fbid,deliveryReceipts:o.deliveryReceipts,readReceiptsPerThread:o.readReceiptsPerThread,ignoredIds:o.ignoredIds,blockedIds:o.blockedIds,pendingFolderUnseenCount:o.pendingFolderUnseenCount,typing:o.typing,threads:n,pendingReadStatusThreads:o.pendingReadStatusThreads,messages:o.messages,localIDsMap:o.localIDsMap,messagesWithUploadsInFlight:o.messagesWithUploadsInFlight,threadlistOrderMap:o.threadlistOrderMap,pinnedThreads:o.pinnedThreads,montage:o.montage,orderedMessageLists:o.orderedMessageLists,unreadCounts:o.unreadCounts,initialUnreadCounts:o.initialUnreadCounts,unseenTimestamp:o.unseenTimestamp}}else return o;case 20:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("JoinableMode");q=f;m=i[0];p=i[1];return u(void 0,q,m,{joinable_mode:p});case 21:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("ApprovalMode");n=f;o=i[0];q=i[1];return u(void 0,n,o,{approval_mode:q});case 22:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("ApprovalQueue");m=f;p=i[0];n=i[1];o=i[2];var Ha=i[3],Ia=i[4];q=b("bs_belt_Map").get(m.threads,p);if(q!==void 0){q=b("bs_caml_option").valFromOption(q);var w=q.group_approval_queue;q={approval_queue_ids:q.approval_queue_ids.slice(),group_approval_queue:w==null?null:w.slice()};n==null||q.approval_queue_ids.indexOf(n)===-1&&Object.assign(q,{approval_queue_ids:q.approval_queue_ids.concat([n])});if(!(o==null)){w=q.group_approval_queue;w==null?Object.assign(q,{group_approval_queue:[o]}):w.map(function(a){return a.requester.id}).indexOf(o.requester.id)===-1&&Object.assign(q,{group_approval_queue:w.concat([o])})}Ha==null||Object.assign(q,{approval_queue_ids:q.approval_queue_ids.filter(function(a){return b("bs_caml_obj").caml_notequal(a,Ha)})});if(!(Ia==null)){n=q.group_approval_queue;Object.assign(q,{group_approval_queue:(n==null?[]:n).filter(function(a){return a.requester.id!==Ia})})}return u(void 0,m,p,q)}else return m;case 23:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("IsPinProtected");w=f;o=i[0];n=i[1];return u(void 0,w,o,{is_pin_protected:n});case 24:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("UpdateRtcCallData");p=f;q=i[0];m=i[1];w=i[2];o=i[3];n=b("bs_belt_Map").get(p.threads,q);if(n!==void 0){if(m==null){n=b("bs_caml_option").valFromOption(n).rtc_call_data;n=n==null?void 0:m}else n=m;return u(void 0,p,q,{rtc_call_data:new(b("ImmutableObject"))({call_state:w,server_info_data:o,initiator_fbid:n})})}else return p;case 25:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("UpdateCommStatus");m=f;q=i[0];w=i[1];return u(void 0,m,q,{comm_status:w});case 26:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("UpdateCommItemOwner");o=f;n=i[0];p=i[1];m=i[2];q=i[3];w=p==null?{nodes:[]}:{nodes:[{admin:{id:p,name:m,profile_picture:{uri:q}}}]};u(void 0,o,n,{comm_item_owners:w});if(p==null)return u(void 0,o,n,{thread_associated_page_admin:null});else return u(void 0,o,n,{thread_associated_page_admin:{id:p,name:m,profile_picture:{uri:q}}});case 27:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("EventRsvpChanged");w=f;o=i[0];var Ja=i[1];n=i[2];p=b("bs_belt_Map").get(w.threads,o);if(p!==void 0){m=b("bs_caml_option").valFromOption(p).participants_event_status;q=(m==null?[]:m).filter(function(a){return b("bs_caml_obj").caml_notequal(a.participant_id,Ja)});q.push({participant_id:Ja,event_status:n});return u(void 0,w,o,{participants_event_status:q})}else return w;case 28:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("GroupsSyncStatusChanged");p=f;m=i[0];n=i[1];o=i[2];return!(o==null)&&b("bs_caml_obj").caml_equal(o,b("MessengerGroupsSyncStatus").OPT_IN)?u(void 0,p,m,{groups_sync_status:n}):u(void 0,p,m,{groups_sync_status:n,work_associated_group:null});case 29:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("GroupsSyncMetadataUpdate");q=f;w=i[0];o=i[1];p=i[2];m=i[3];if(o==null)return u(void 0,q,w,{work_associated_group:null});else if(b("bs_caml_obj").caml_equal(o,b("MessengerGroupsSyncStatus").OPT_IN)){n=new(h||(h=b("URI")))(document.URL);var x=n.getDomain();x=va.getURIBuilder().setString("idorvanity",p).getURI().setDomain(x==null?"":x.replace("messenger.com","facebook.com")).setPort(n.getPort()).setProtocol("https");return u(void 0,q,w,{work_associated_group:{id:p,url:x.toString(),group_saves:{count:0},group_events:{count:0}}})}else if(b("bs_caml_obj").caml_equal(o,b("MessengerGroupsSyncStatus").UPDATE_EMOJI))return u(void 0,q,w,{work_associated_group:{id:p,group_icon:{emoji_codepoints:m}}});else return u(void 0,q,w,{work_associated_group:null});case 30:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("DescriptionChanged");n=f;x=i[0];o=i[1];return u(void 0,n,x,{description:o});case 31:p=f;m=i[0];q=i[1];return u(void 0,p,m,{solid_color:q.solid_color,header_color:q.header_color,footer_color:q.footer_color,gradient_colors:q.gradient_colors,theme_id:q.theme_id,reactions:q.reactions});case 32:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("UpdateJoinableLink");w=f;n=i[0];x=i[1];return u(void 0,w,n,{joinable_link:x});case 33:var y=f,Ka=i[0];o=b("bs_belt_Map").toArray(y.threads).reduce(function(c,d){var a=d[1];d=d[0];if(a.folder===Ka){s(y.fbid,d);return b("bs_belt_Map").set(c,d,b("ImmutableObject").set(a,{unread_count:0,unread_mentions_count:0}))}else return c},y.threads);y.unreadCounts[Ka]=new Set();p=b("MercuryThreadInformer").getForFBID(y.fbid);p.updatedUnreadState();return{fbid:y.fbid,deliveryReceipts:y.deliveryReceipts,readReceiptsPerThread:y.readReceiptsPerThread,ignoredIds:y.ignoredIds,blockedIds:y.blockedIds,pendingFolderUnseenCount:y.pendingFolderUnseenCount,typing:y.typing,threads:o,pendingReadStatusThreads:y.pendingReadStatusThreads,messages:y.messages,localIDsMap:y.localIDsMap,messagesWithUploadsInFlight:y.messagesWithUploadsInFlight,threadlistOrderMap:y.threadlistOrderMap,pinnedThreads:y.pinnedThreads,montage:y.montage,orderedMessageLists:y.orderedMessageLists,unreadCounts:y.unreadCounts,initialUnreadCounts:y.initialUnreadCounts,unseenTimestamp:y.unseenTimestamp};case 34:var z=f,Ta=i[0];b("gkx")("1199097")&&(b("ChatReliabilityInstrumentation").logDELETE_THREAD(Ta),b("LogHistory").getInstance("messenger_state").debug("delete_thread",Ta));m=b("bs_belt_Map").remove(z.threads,Ta);z.orderedMessageLists["delete"](Ta);z.messages.forEach(function(a,c,d){if(b("bs_caml_obj").caml_equal(a.thread_id,Ta)){z.messages["delete"](a.message_id);c=a.offline_threading_id;if(!(c==null)){d=z.localIDsMap.get(c);d==null||(z.messages["delete"](d),z.localIDsMap["delete"](c))}z.localIDsMap["delete"](a.message_id);return 0}else return 0});qa(z.fbid,Ta);return{fbid:z.fbid,deliveryReceipts:z.deliveryReceipts,readReceiptsPerThread:z.readReceiptsPerThread,ignoredIds:z.ignoredIds,blockedIds:z.blockedIds,pendingFolderUnseenCount:z.pendingFolderUnseenCount,typing:z.typing,threads:m,pendingReadStatusThreads:z.pendingReadStatusThreads,messages:z.messages,localIDsMap:z.localIDsMap,messagesWithUploadsInFlight:z.messagesWithUploadsInFlight,threadlistOrderMap:z.threadlistOrderMap,pinnedThreads:z.pinnedThreads,montage:z.montage,orderedMessageLists:z.orderedMessageLists,unreadCounts:z.unreadCounts,initialUnreadCounts:z.initialUnreadCounts,unseenTimestamp:z.unseenTimestamp};case 35:q=i[0];return Za(f,a,[q.message_id,q,i[1]]);case 36:w=f;n=[i[0],i[1],i[2]];var Wa=n[2];x=n[1];var Xa=n[0];if(x.length!==0){p=ab(w,[Xa,x,Wa]);o=0;Wa!==void 0&&b("bs_caml_obj").caml_equal(b("bs_caml_option").valFromOption(Wa),b("MercuryPayloadSource").CLIENT_CHANNEL_MESSAGE)||(o=1);o===1&&b("MercuryServerRequests").getForFBID(p.fbid).deleteMessages(Xa,x);return b("bs_belt_Array").reduce(x,p,function(c,e){var a=Sa(c,e),d=b("bs_belt_Map").get(c.threads,Xa);if(d!==void 0){d=b("bs_caml_option").valFromOption(d);d=b("ImmutableObject").set(b("ImmutableObject").set(d,bb(c,Xa)),{message_count:d.message_count-1|0});d=b("bs_belt_Map").set(c.threads,Xa,d);s(c.fbid,Xa);d={fbid:c.fbid,deliveryReceipts:c.deliveryReceipts,readReceiptsPerThread:c.readReceiptsPerThread,ignoredIds:c.ignoredIds,blockedIds:c.blockedIds,pendingFolderUnseenCount:c.pendingFolderUnseenCount,typing:c.typing,threads:d,pendingReadStatusThreads:c.pendingReadStatusThreads,messages:c.messages,localIDsMap:c.localIDsMap,messagesWithUploadsInFlight:c.messagesWithUploadsInFlight,threadlistOrderMap:c.threadlistOrderMap,pinnedThreads:c.pinnedThreads,montage:c.montage,orderedMessageLists:c.orderedMessageLists,unreadCounts:c.unreadCounts,initialUnreadCounts:c.initialUnreadCounts,unseenTimestamp:c.unseenTimestamp}}else d=c;if(a!==void 0){c=b("bs_caml_option").valFromOption(a);cb(b("bs_caml_option").some(Xa),c);Pa(d.fbid,Xa,e,Wa,c.attachments)}return d})}else return w;case 37:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("ChangeFolder");return Fa(f,i[0],i[1],1);case 38:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("ChangeMuteSettings");m=f;q=i[0];n=i[1];o=b("bs_belt_Map").get(m.threads,q);if(o!==void 0){x=b("bs_caml_option").valFromOption(o);var Ya;switch(n.tag|0){case 0:Ya=b("ImmutableObject").set(x,{reactions_mute_mode:n[0]?1:0});break;case 1:Ya=b("ImmutableObject").set(x,{mentions_mute_mode:n[0]?1:0});break;case 2:p=n[0];Ya=b("ImmutableObject").set(x,{mute_until:p===0?void 0:p});break}w=b("bs_belt_Map").set(m.threads,q,Ya);s(m.fbid,q);return{fbid:m.fbid,deliveryReceipts:m.deliveryReceipts,readReceiptsPerThread:m.readReceiptsPerThread,ignoredIds:m.ignoredIds,blockedIds:m.blockedIds,pendingFolderUnseenCount:m.pendingFolderUnseenCount,typing:m.typing,threads:w,pendingReadStatusThreads:m.pendingReadStatusThreads,messages:m.messages,localIDsMap:m.localIDsMap,messagesWithUploadsInFlight:m.messagesWithUploadsInFlight,threadlistOrderMap:m.threadlistOrderMap,pinnedThreads:m.pinnedThreads,montage:m.montage,orderedMessageLists:m.orderedMessageLists,unreadCounts:m.unreadCounts,initialUnreadCounts:m.initialUnreadCounts,unseenTimestamp:m.unseenTimestamp}}else return m;case 39:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("ChangeArchivedStatus");o=f;n=i[0];x=i[1];p=b("bs_belt_Map").get(o.threads,n);if(p!==void 0){q=b("bs_caml_option").valFromOption(p);if(q.is_archived!==x){w=b("MessengerFolders.bs").getFromMeta(q);m=q.comm_status;p=m==null?b("ImmutableObject").set(q,{is_archived:x}):b("ImmutableObject").set(q,{is_archived:x,comm_status:x?b("PageCommItemStatus").DONE:b("PageCommItemStatus").TODO});m=b("bs_belt_Map").set(o.threads,n,p);Ba(o,p,w);Ea(o,p);s(o.fbid,n);return{fbid:o.fbid,deliveryReceipts:o.deliveryReceipts,readReceiptsPerThread:o.readReceiptsPerThread,ignoredIds:o.ignoredIds,blockedIds:o.blockedIds,pendingFolderUnseenCount:o.pendingFolderUnseenCount,typing:o.typing,threads:m,pendingReadStatusThreads:o.pendingReadStatusThreads,messages:o.messages,localIDsMap:o.localIDsMap,messagesWithUploadsInFlight:o.messagesWithUploadsInFlight,threadlistOrderMap:o.threadlistOrderMap,pinnedThreads:o.pinnedThreads,montage:o.montage,orderedMessageLists:o.orderedMessageLists,unreadCounts:o.unreadCounts,initialUnreadCounts:o.initialUnreadCounts,unseenTimestamp:o.unseenTimestamp}}else return o}else return o;case 40:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("ChangePageFollowUpStatus");q=f;x=i[0];w=i[1];p=b("bs_belt_Map").get(q.threads,x);if(p!==void 0){n=b("bs_caml_option").valFromOption(p);if(n.is_page_follow_up!==w){m=b("ImmutableObject").set(n,{is_page_follow_up:w});o=b("bs_belt_Map").set(q.threads,x,m);s(q.fbid,x);return{fbid:q.fbid,deliveryReceipts:q.deliveryReceipts,readReceiptsPerThread:q.readReceiptsPerThread,ignoredIds:q.ignoredIds,blockedIds:q.blockedIds,pendingFolderUnseenCount:q.pendingFolderUnseenCount,typing:q.typing,threads:o,pendingReadStatusThreads:q.pendingReadStatusThreads,messages:q.messages,localIDsMap:q.localIDsMap,messagesWithUploadsInFlight:q.messagesWithUploadsInFlight,threadlistOrderMap:q.threadlistOrderMap,pinnedThreads:q.pinnedThreads,montage:q.montage,orderedMessageLists:q.orderedMessageLists,unreadCounts:q.unreadCounts,initialUnreadCounts:q.initialUnreadCounts,unseenTimestamp:q.unseenTimestamp}}else return q}else return q;case 41:p=f;n=i[0];w=i[1];m=i[2];x=i[3];o=i[4];q=b("bs_belt_Map").get(p.threads,n);if(q!==void 0){q=b("bs_caml_option").valFromOption(q);m=qb(p,q,m,p.pendingReadStatusThreads,w);m=m!==void 0&&q.last_message_timestamp>q.last_read_timestamp?b("bs_caml_option").some(Object.assign(b("bs_caml_option").valFromOption(m),{last_read_timestamp:q.last_message_timestamp})):m;if(m!==void 0){m=b("ImmutableObject").set(q,b("bs_caml_option").valFromOption(m));var A=b("bs_belt_Map").set(p.threads,n,m);if(x){x=!q.read_only&&q.folder===b("MessagingTag").INBOX;var B=b("MercuryServerRequests").getForFBID(p.fbid);B.changeThreadReadStatus(m.thread_id,w,o,m.last_read_timestamp,x,m.last_message_type)}B=A}else B=p.threads;o=b("MessengerFolders.bs").getFromMeta(q);w?(ta(p,[n],o,b("MercuryFilters.bs").unread),Aa(p,o,b("bs_caml_option").some(n))):(b("gkx")("1275193")?Da(p,o,n):xa(p,[n],o,b("MercuryFilters.bs").unread),ya(p,o,b("bs_caml_option").some(n)));return{fbid:p.fbid,deliveryReceipts:p.deliveryReceipts,readReceiptsPerThread:p.readReceiptsPerThread,ignoredIds:p.ignoredIds,blockedIds:p.blockedIds,pendingFolderUnseenCount:p.pendingFolderUnseenCount,typing:p.typing,threads:B,pendingReadStatusThreads:p.pendingReadStatusThreads,messages:p.messages,localIDsMap:p.localIDsMap,messagesWithUploadsInFlight:p.messagesWithUploadsInFlight,threadlistOrderMap:p.threadlistOrderMap,pinnedThreads:p.pinnedThreads,montage:p.montage,orderedMessageLists:p.orderedMessageLists,unreadCounts:p.unreadCounts,initialUnreadCounts:p.initialUnreadCounts,unseenTimestamp:p.unseenTimestamp}}else return p;case 42:var C=f,tb=i[0];x=b("bs_belt_Option").getWithDefault(b("bs_belt_Option").map(b("bs_caml_option").nullable_to_opt(C.orderedMessageLists.get(tb)),function(a){return{messageLoadingState:a.messageLoadingState,messageIDs:[]}}),{messageLoadingState:0,messageIDs:[]});C.orderedMessageLists.set(tb,x);m=b("bs_belt_Option").map(b("bs_belt_Map").get(C.threads,tb),function(a){return b("ImmutableObject").set(a,{message_count:0})});if(m!==void 0){var xb=b("bs_caml_option").valFromOption(m);A=b("bs_belt_Map").set(C.threads,tb,xb);na.forEach(function(a){return ta(C,[tb],b("MessengerFolders.bs").getFromMeta(xb),a)});q=A}else q=C.threads;za.forEach(function(a){a=b("bs_js_dict").get(C.unreadCounts,a);if(a!==void 0){b("bs_caml_option").valFromOption(a)["delete"](tb);return 0}else return 0});ra(C.fbid,tb);return{fbid:C.fbid,deliveryReceipts:C.deliveryReceipts,readReceiptsPerThread:C.readReceiptsPerThread,ignoredIds:C.ignoredIds,blockedIds:C.blockedIds,pendingFolderUnseenCount:C.pendingFolderUnseenCount,typing:C.typing,threads:q,pendingReadStatusThreads:C.pendingReadStatusThreads,messages:C.messages,localIDsMap:C.localIDsMap,messagesWithUploadsInFlight:C.messagesWithUploadsInFlight,threadlistOrderMap:C.threadlistOrderMap,pinnedThreads:C.pinnedThreads,montage:C.montage,orderedMessageLists:C.orderedMessageLists,unreadCounts:C.unreadCounts,initialUnreadCounts:C.initialUnreadCounts,unseenTimestamp:C.unseenTimestamp};case 43:w=f;o=a;n=[i[0],i[1],i[2]];B=$a(w,[n[0],n[1]]);p=B.thread_id;x=ab(w,[p,[B.message_id],n[2]]);m=o.localTitanMessageCount.get(p);m==null||o.localTitanMessageCount.set(p,Math.max(0,m-1|0));return x;case 44:A=f;q=[i[0],i[1]];w=$a(A,[q[0],q[1]]);b("MercuryServerRequests").getForFBID(A.fbid).sendNewMessage(Object.assign(w,{preview_attachments:void 0}));return A;case 45:B=f;n=[i[0],i[1],i[2],i[3]];o=n[2];p=n[1];m=n[0];x=Sa(B,m);if(x!==void 0){q=b("bs_caml_option").valFromOption(x);w=b("bs_js_dict").map(function(a){return a},b("bs_belt_Option").getWithDefault(b("bs_caml_option").nullable_to_opt(q.reactions),{}));p!==void 0?w[o]=p:Ra(w,o);A=Object.assign(Object.assign({},q),{reactions:w});x=q.thread_id;x==null||Na(B.fbid,x,m,n[3]);return Va(B,[m,A])}else return B;case 46:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("MontageDirectExpire");p=f;o=i[0];w=Sa(p,o);if(w!==void 0){q=b("bs_caml_option").valFromOption(w);x=q.attachments;if(x==null||x.length===0)return p;else{n=b("bs_caml_array").caml_array_get(x,0);m=n.share;if(m==null)return p;else{A=m.target;if(A==null)return p;else{B=A.message_state;if(B==null)return p;else{w=Object.assign(Object.assign({},q),{attachments:b("bs_caml_array").caml_array_set(b("bs_array").copy(x),0,Object.assign(Object.assign({},n),{share:Object.assign(Object.assign({},m),{target:Object.assign(Object.assign({},A),{message_state:"EXPIRED"})})}))});return Va(p,[o,w])}}}}}else return p;case 47:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("LiveLocationUpdate");B=f;q=[i[0],i[1],i[2]];x=q[0];n=Sa(B,x);if(n!==void 0){m=b("bs_caml_option").valFromOption(n);A=m.attachments;if(A==null||A.length===0)return B;else{o=b("bs_caml_array").caml_array_get(A,0);w=o.share;if(w==null)return B;else{p=w.target;if(p==null)return B;else{n=b("bs_array").copy(A);b("bs_caml_array").caml_array_set(n,0,Object.assign(Object.assign({},o),{share:Object.assign(Object.assign({},w),{target:Object.assign(Object.assign({},q[1]),{live_location_id:p.live_location_id})})}));A=Object.assign(Object.assign({},m),{attachments:n});o=m.thread_id;o==null||Na(B.fbid,o,x,q[2]);return Va(B,[x,A])}}}}else return B;case 48:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("ReplaceMessage");w=f;p=i[0];n=i[1];var zb=p.replaced_message_id;if(zb==null)return w;else{m=Sa(w,zb);if(m!==void 0){o=p.message_id;q={timestamp:p.timestamp};x=b("bs_caml_option").nullable_to_opt(p.status);x!==void 0&&(q.status=b("bs_caml_option").valFromOption(x));A=b("bs_caml_option").nullable_to_opt(p.log_message_data);A!==void 0&&(q.log_message_data=b("bs_caml_option").valFromOption(A));B=b("bs_caml_option").nullable_to_opt(p.meta_ranges);B!==void 0&&(q.meta_ranges=b("bs_caml_option").valFromOption(B));x=b("bs_caml_option").nullable_to_opt(p.ranges);x!==void 0&&(q.ranges=b("bs_caml_option").valFromOption(x));A=b("bs_caml_option").nullable_to_opt(p.raw_attachments);A!==void 0&&(q.raw_attachments=b("bs_caml_option").valFromOption(A));B=b("bs_caml_option").nullable_to_opt(p.attachments);B!==void 0&&(q.attachments=b("bs_caml_option").valFromOption(B));x=b("bs_caml_option").nullable_to_opt(p.body);x!==void 0&&(q.body=b("bs_caml_option").valFromOption(x));A=b("bs_caml_option").nullable_to_opt(p.platform_xmd);A!==void 0&&(q.platform_xmd=b("bs_caml_option").valFromOption(A));B=b("bs_caml_option").nullable_to_opt(p.profile_ranges);B!==void 0&&(q.profile_ranges=b("bs_caml_option").valFromOption(B));x=q;A=Object.assign(Object.assign({},b("bs_caml_option").valFromOption(m)),x);b("MercuryMessageIDs.bs").addServerID(o,o);var D=Va(w,[o,A]);if(o!==zb){D.messages["delete"](zb);D.localIDsMap.set(zb,o);B=b("bs_belt_Option").flatMap(b("bs_caml_option").nullable_to_opt(p.thread_id),function(a){return b("bs_caml_option").nullable_to_opt(D.orderedMessageLists.get(a))});q=p.thread_id;if(B!==void 0&&!(q==null)){m=B;x=Ua(D,[o].concat(m.messageIDs.filter(function(a){return a!==zb})));D.orderedMessageLists.set(q,{messageLoadingState:m.messageLoadingState,messageIDs:x})}}A=p.message_id;B=p.thread_id;B==null||(Na(D.fbid,B,zb,n),Na(D.fbid,B,A,n));return{fbid:D.fbid,deliveryReceipts:D.deliveryReceipts,readReceiptsPerThread:D.readReceiptsPerThread,ignoredIds:D.ignoredIds,blockedIds:D.blockedIds,pendingFolderUnseenCount:D.pendingFolderUnseenCount,typing:D.typing,threads:D.threads,pendingReadStatusThreads:D.pendingReadStatusThreads,messages:D.messages,localIDsMap:D.localIDsMap,messagesWithUploadsInFlight:D.messagesWithUploadsInFlight,threadlistOrderMap:D.threadlistOrderMap,pinnedThreads:D.pinnedThreads,montage:D.montage,orderedMessageLists:D.orderedMessageLists,unreadCounts:D.unreadCounts,initialUnreadCounts:D.initialUnreadCounts,unseenTimestamp:D.unseenTimestamp}}else return w}case 49:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("UpdateLocalTitanMessagesCount");o=f;q=a;m=[i[0],i[1]];x=m[0];p=Sa(o,m[1]);if(p!==void 0&&b("MessengerMessage.bs").isTitanMessage(b("bs_caml_option").valFromOption(p))){B=q.localTitanMessageCount.get(x);B==null?q.localTitanMessageCount.set(x,1):q.localTitanMessageCount.set(x,1+B|0)}return o;case 50:return gb(f,a,i[0],i[1]);case 51:A=f;n=a;w=i[0];m=i[1];p=i[2];q=w.author;if(q==null)x=!1;else{B=b("MercuryIDs").getUserIDFromParticipantID(q);x=B==null?!1:B===b("CurrentUser").getID()}o=w.offline_threading_id;q=o==null?void 0:b("bs_caml_option").nullable_to_opt(A.localIDsMap.get(o));B=q!==void 0;if(b("gkx")("1491696")&&!x&&b("bs_caml_obj").caml_equal(m,b("bs_caml_option").some(b("MercuryPayloadSource").CLIENT_CHANNEL_MESSAGE))&&B)return A;else{o=kb(A,w,m,p==null?void 0:b("bs_caml_option").some(p));ib(o.fbid,m,w,function(a,b,c){a.informNewMessage(b,c);return 0});q=o.fbid;if(w.folder===b("MessagingTag").PENDING&&b("bs_caml_obj").caml_equal(m,b("bs_caml_option").some(b("MercuryPayloadSource").CLIENT_CHANNEL_MESSAGE)))x={fbid:o.fbid,deliveryReceipts:o.deliveryReceipts,readReceiptsPerThread:o.readReceiptsPerThread,ignoredIds:o.ignoredIds,blockedIds:o.blockedIds,pendingFolderUnseenCount:o.pendingFolderUnseenCount+1|0,typing:o.typing,threads:o.threads,pendingReadStatusThreads:o.pendingReadStatusThreads,messages:o.messages,localIDsMap:o.localIDsMap,messagesWithUploadsInFlight:o.messagesWithUploadsInFlight,threadlistOrderMap:o.threadlistOrderMap,pinnedThreads:o.pinnedThreads,montage:o.montage,orderedMessageLists:o.orderedMessageLists,unreadCounts:o.unreadCounts,initialUnreadCounts:o.initialUnreadCounts,unseenTimestamp:o.unseenTimestamp};else if(w.folder===b("MessagingTag").INBOX){B=w.thread_id;x=B==null?o:Fa(o,B,w.folder,0)}else{A=w.thread_id;if(A==null)x=o;else{B=mb(o.fbid,o.threads,w,p);if(B!==void 0){p=b("bs_caml_option").valFromOption(B);B=o.fbid;var E=o.deliveryReceipts,F=o.readReceiptsPerThread,G=o.ignoredIds,H=o.blockedIds,I=o.pendingFolderUnseenCount,J=o.typing,K=b("bs_belt_Map").set(o.threads,p.thread_id,p),L=o.pendingReadStatusThreads,M=o.messages,N=o.localIDsMap,O=o.messagesWithUploadsInFlight,P=o.threadlistOrderMap,Q=o.pinnedThreads,R=o.montage,S=o.orderedMessageLists,T=o.unreadCounts,U=o.initialUnreadCounts,Bb=o.unseenTimestamp;B={fbid:B,deliveryReceipts:E,readReceiptsPerThread:F,ignoredIds:G,blockedIds:H,pendingFolderUnseenCount:I,typing:J,threads:K,pendingReadStatusThreads:L,messages:M,localIDsMap:N,messagesWithUploadsInFlight:O,threadlistOrderMap:P,pinnedThreads:Q,montage:R,orderedMessageLists:S,unreadCounts:T,initialUnreadCounts:U,unseenTimestamp:Bb};if(b("bs_caml_obj").caml_equal(m,b("bs_caml_option").some(b("MercuryPayloadSource").CLIENT_CHANNEL_MESSAGE))){E=w.offline_threading_id;E==null?Object.assign(w,{folder:p.folder}):b("bs_caml_obj").caml_equal(b("bs_caml_option").nullable_to_opt(N.get(E)),E)?Object.assign(w,{client_message_id:w.offline_threading_id,status:b("MercuryActionStatus").SUCCESS,action_type:b("MercuryActionType").SEND_MESSAGE}):Object.assign(w,{folder:p.folder})}Ea(B,p);F=Object.assign({},p);G=w.offline_threading_id;if(!(G==null)){if(G!==w.message_id){Object.assign(F,{last_message_timestamp:w.timestamp});H=w.comm_status;H==null||Object.assign(F,{last_message_id:w.message_id})}I=w.author;if(!(b("cr:1299779")==null)&&!(I==null)){J=b("MercuryIDs").getParticipantIDFromUserID(q);w.has_attachment&&J===I&&fb(A,w.message_id,G)}}K=w.comm_status;L=F.comm_status;K==null||!(L==null)&&b("bs_caml_obj").caml_notequal(L,b("PageCommItemStatus").FOLLOW_UP)&&Object.assign(F,{comm_status:K});M=w.creator_info;M==null||b("bs_caml_obj").caml_equal(M.pageID,q)&&Object.assign(F,{folder:w.folder});O=w.author;O==null||jb(F,O);x=u(void 0,B,A,F)}else x=o}}P=hb(x,n,w,m);Q=nb(P,w);R=Q;S=w;T=b("bs_caml_obj").caml_notequal(S.author,b("MercuryViewer").getID());U=S.thread_id;Bb=S.author;if(T&&!(U==null||Bb==null)){N=la(R.typing,U,Bb);if(N!==R.typing)return{fbid:R.fbid,deliveryReceipts:R.deliveryReceipts,readReceiptsPerThread:R.readReceiptsPerThread,ignoredIds:R.ignoredIds,blockedIds:R.blockedIds,pendingFolderUnseenCount:R.pendingFolderUnseenCount,typing:N,threads:R.threads,pendingReadStatusThreads:R.pendingReadStatusThreads,messages:R.messages,localIDsMap:R.localIDsMap,messagesWithUploadsInFlight:R.messagesWithUploadsInFlight,threadlistOrderMap:R.threadlistOrderMap,pinnedThreads:R.pinnedThreads,montage:R.montage,orderedMessageLists:R.orderedMessageLists,unreadCounts:R.unreadCounts,initialUnreadCounts:R.initialUnreadCounts,unseenTimestamp:R.unseenTimestamp};else return R}else return R}case 52:E=f;p=a;H=i[0];J=i[1];I=i[2];G=b("bs_caml_obj").caml_notequal(I==null?void 0:b("bs_caml_option").some(I),!1);L=b("bs_caml_obj").caml_equal(I==null?void 0:b("bs_caml_option").some(I),!0);K=E.fbid;M=b("MercuryIDs").getParticipantIDFromUserID(K);q=hb(E,p,H,J);ib(q.fbid,J,H,function(a,b,c){a.informNewLogMessage(b,c);return 0});O=kb(q,H,J,I==null?void 0:b("bs_caml_option").some(I));B=H.thread_id;if(B==null)A=O;else{F=b("bs_belt_Map").get(O.threads,B);if(F!==void 0){o=Object.assign({},b("bs_caml_option").valFromOption(F));Ea(O,o);o.last_message_timestamp<H.timestamp&&Object.assign(o,{last_message_timestamp:H.timestamp});if(H.timestamp>=o.timestamp||b("gkx")("1183082")){x=H.log_message_type;if(!(x==null))if(b("bs_caml_obj").caml_equal(x,b("MercuryLogMessageType").SUBSCRIBE)&&!L){n=H.log_message_data;if(n==null)m=[];else{P=n.added_participants;m=P==null?[]:P}ua(M,o,m);s(K,B)}else if(b("bs_caml_obj").caml_equal(x,b("MercuryLogMessageType").UNSUBSCRIBE)&&!L){Q=H.log_message_data;if(Q==null)w=[];else{S=Q.removed_participants;w=S==null?[]:S}lb(M,o,w);s(K,B)}else if(b("bs_caml_obj").caml_equal(x,b("MercuryLogMessageType").THREAD_IMAGE)){if(!G){T=H.log_message_data;if(T==null)U=null;else{Bb=T.image;U=Bb==null?null:Bb.preview_url}Object.assign(o,{image_src:U})}}else if(b("bs_caml_obj").caml_equal(x,b("MercuryLogMessageType").THREAD_NAME)){N=H.log_message_data;if(!(N==null)){R=N.name;!(R==null)&&o.name===R||s(K,B);Object.assign(o,{name:N.name})}}else b("bs_caml_obj").caml_equal(x,b("MercuryLogMessageType").GENERIC_ADMIN_TEXT)&&La(K,o,H,B)}A=u(void 0,O,B,o)}else A=O}return nb(A,H);case 53:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("PinMessage");if(b("gkx")("1179386")){E=f;p=i[0];var Cb=i[1];q=b("bs_belt_Map").get(E.threads,p);if(q!==void 0&&!(Cb==null)){J=b("bs_caml_option").valFromOption(q);I=J.pinned_messages;F=I==null?[Cb.message]:I.findIndex(function(a){return a.message_id===Cb.message.message_id})===-1?[Cb.message]:void 0;if(F!==void 0){n=b("ImmutableObject").set(J,{pinned_messages:b("bs_belt_Option").getExn(F)});P=b("bs_belt_Map").set(E.threads,p,n);s(E.fbid,p);m=P}else m=E.threads}else m=E.threads;return{fbid:E.fbid,deliveryReceipts:E.deliveryReceipts,readReceiptsPerThread:E.readReceiptsPerThread,ignoredIds:E.ignoredIds,blockedIds:E.blockedIds,pendingFolderUnseenCount:E.pendingFolderUnseenCount,typing:E.typing,threads:m,pendingReadStatusThreads:E.pendingReadStatusThreads,messages:E.messages,localIDsMap:E.localIDsMap,messagesWithUploadsInFlight:E.messagesWithUploadsInFlight,threadlistOrderMap:E.threadlistOrderMap,pinnedThreads:E.pinnedThreads,montage:E.montage,orderedMessageLists:E.orderedMessageLists,unreadCounts:E.unreadCounts,initialUnreadCounts:E.initialUnreadCounts,unseenTimestamp:E.unseenTimestamp}}else return f;case 54:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("UnpinMessage");if(b("gkx")("1179386")){L=f;Q=i[0];var Db=i[1];S=b("bs_belt_Map").get(L.threads,Q);if(S!==void 0&&!(Db==null)){M=b("bs_caml_option").valFromOption(S);w=M.pinned_messages;G=w==null?void 0:w.filter(function(a){return a.message_id!==Db.message_id});if(G!==void 0){T=b("ImmutableObject").set(M,{pinned_messages:b("bs_belt_Option").getExn(G)});Bb=b("bs_belt_Map").set(L.threads,Q,T);s(L.fbid,Q);U=Bb}else U=L.threads}else U=L.threads;return{fbid:L.fbid,deliveryReceipts:L.deliveryReceipts,readReceiptsPerThread:L.readReceiptsPerThread,ignoredIds:L.ignoredIds,blockedIds:L.blockedIds,pendingFolderUnseenCount:L.pendingFolderUnseenCount,typing:L.typing,threads:U,pendingReadStatusThreads:L.pendingReadStatusThreads,messages:L.messages,localIDsMap:L.localIDsMap,messagesWithUploadsInFlight:L.messagesWithUploadsInFlight,threadlistOrderMap:L.threadlistOrderMap,pinnedThreads:L.pinnedThreads,montage:L.montage,orderedMessageLists:L.orderedMessageLists,unreadCounts:L.unreadCounts,initialUnreadCounts:L.initialUnreadCounts,unseenTimestamp:L.unseenTimestamp}}else return f;case 55:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("ChangePinnedStatus");R=f;N=a;x=i[0];K=i[1];B=i[2];o=b("bs_belt_Map").get(R.threads,x);O=!1;if(K&&!N.existingPinnedThreads.has(x))R.pinnedThreads.push(x),N.existingPinnedThreads.add(x),O=!0;else if(!K&&N.existingPinnedThreads.has(x)){A=R.pinnedThreads.indexOf(x);A>-1&&R.pinnedThreads.splice(A,1);N.existingPinnedThreads["delete"](x);O=!0}if(o!==void 0){H=b("bs_caml_option").valFromOption(o);q=b("bs_belt_Option").getWithDefault(b("bs_caml_option").nullable_to_opt(H.thread_pin_timestamp),0);if(H.is_pinned!==K||q!==B){I=b("ImmutableObject").set(H,{is_pinned:K,thread_pin_timestamp:B});J=b("bs_belt_Map").set(R.threads,x,I);s(R.fbid,x);O=!0;F=J}else F=R.threads}else F=R.threads;if(O)return{fbid:R.fbid,deliveryReceipts:R.deliveryReceipts,readReceiptsPerThread:R.readReceiptsPerThread,ignoredIds:R.ignoredIds,blockedIds:R.blockedIds,pendingFolderUnseenCount:R.pendingFolderUnseenCount,typing:R.typing,threads:F,pendingReadStatusThreads:R.pendingReadStatusThreads,messages:R.messages,localIDsMap:R.localIDsMap,messagesWithUploadsInFlight:R.messagesWithUploadsInFlight,threadlistOrderMap:R.threadlistOrderMap,pinnedThreads:R.pinnedThreads,montage:R.montage,orderedMessageLists:R.orderedMessageLists,unreadCounts:R.unreadCounts,initialUnreadCounts:R.initialUnreadCounts,unseenTimestamp:R.unseenTimestamp};else return R;case 56:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("InvalidateMontageState");n=f;p=i[0];P=b("bs_js_dict").fromArray(b("bs_js_dict").entries(n.montage));P[p]=[];return{fbid:n.fbid,deliveryReceipts:n.deliveryReceipts,readReceiptsPerThread:n.readReceiptsPerThread,ignoredIds:n.ignoredIds,blockedIds:n.blockedIds,pendingFolderUnseenCount:n.pendingFolderUnseenCount,typing:n.typing,threads:n.threads,pendingReadStatusThreads:n.pendingReadStatusThreads,messages:n.messages,localIDsMap:n.localIDsMap,messagesWithUploadsInFlight:n.messagesWithUploadsInFlight,threadlistOrderMap:n.threadlistOrderMap,pinnedThreads:n.pinnedThreads,montage:P,orderedMessageLists:n.orderedMessageLists,unreadCounts:n.unreadCounts,initialUnreadCounts:n.initialUnreadCounts,unseenTimestamp:n.unseenTimestamp};case 57:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("NewMontageMessage");m=f;E=i[0];S=b("bs_js_dict").fromArray(b("bs_js_dict").entries(m.montage));w=E.actor.id;M=b("bs_js_dict").get(S,w);if(M!==void 0){G=M;G.push(E);S[w]=G}else S[w]=[E];return{fbid:m.fbid,deliveryReceipts:m.deliveryReceipts,readReceiptsPerThread:m.readReceiptsPerThread,ignoredIds:m.ignoredIds,blockedIds:m.blockedIds,pendingFolderUnseenCount:m.pendingFolderUnseenCount,typing:m.typing,threads:m.threads,pendingReadStatusThreads:m.pendingReadStatusThreads,messages:m.messages,localIDsMap:m.localIDsMap,messagesWithUploadsInFlight:m.messagesWithUploadsInFlight,threadlistOrderMap:m.threadlistOrderMap,pinnedThreads:m.pinnedThreads,montage:S,orderedMessageLists:m.orderedMessageLists,unreadCounts:m.unreadCounts,initialUnreadCounts:m.initialUnreadCounts,unseenTimestamp:m.unseenTimestamp};case 58:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("InstantiateMontageThread");T=f;Q=i[0];Bb=b("bs_js_dict").fromArray(b("bs_js_dict").entries(T.montage));U=b("bs_js_dict").get(Bb,Q);U===void 0&&(Bb[Q]=[]);return{fbid:T.fbid,deliveryReceipts:T.deliveryReceipts,readReceiptsPerThread:T.readReceiptsPerThread,ignoredIds:T.ignoredIds,blockedIds:T.blockedIds,pendingFolderUnseenCount:T.pendingFolderUnseenCount,typing:T.typing,threads:T.threads,pendingReadStatusThreads:T.pendingReadStatusThreads,messages:T.messages,localIDsMap:T.localIDsMap,messagesWithUploadsInFlight:T.messagesWithUploadsInFlight,threadlistOrderMap:T.threadlistOrderMap,pinnedThreads:T.pinnedThreads,montage:Bb,orderedMessageLists:T.orderedMessageLists,unreadCounts:T.unreadCounts,initialUnreadCounts:T.initialUnreadCounts,unseenTimestamp:T.unseenTimestamp};case 59:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("DeleteMontageMessage");L=f;var Eb=i[0],Fb=b("bs_js_dict").fromArray(b("bs_js_dict").entries(L.montage));A=Object.keys(Fb);A.forEach(function(c){var a=b("bs_js_dict").get(Fb,c);if(a!==void 0){a=a.filter(function(a){return a.id!==Eb.messageFBID});Fb[c]=a;return 0}else return 0});return{fbid:L.fbid,deliveryReceipts:L.deliveryReceipts,readReceiptsPerThread:L.readReceiptsPerThread,ignoredIds:L.ignoredIds,blockedIds:L.blockedIds,pendingFolderUnseenCount:L.pendingFolderUnseenCount,typing:L.typing,threads:L.threads,pendingReadStatusThreads:L.pendingReadStatusThreads,messages:L.messages,localIDsMap:L.localIDsMap,messagesWithUploadsInFlight:L.messagesWithUploadsInFlight,threadlistOrderMap:L.threadlistOrderMap,pinnedThreads:L.pinnedThreads,montage:Fb,orderedMessageLists:L.orderedMessageLists,unreadCounts:L.unreadCounts,initialUnreadCounts:L.initialUnreadCounts,unseenTimestamp:L.unseenTimestamp};case 60:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("AddFetchedAllHistoryMarkers");var V=f;N=[i[0],i[1]];var Gb=N[1];N[0].forEach(function(b){var a=V.orderedMessageLists.get(b);a==null?V.orderedMessageLists.set(b,{messageLoadingState:1,messageIDs:[]}):V.orderedMessageLists.set(b,{messageLoadingState:1,messageIDs:a.messageIDs});return Oa(V.fbid,b,Gb)});return{fbid:V.fbid,deliveryReceipts:V.deliveryReceipts,readReceiptsPerThread:V.readReceiptsPerThread,ignoredIds:V.ignoredIds,blockedIds:V.blockedIds,pendingFolderUnseenCount:V.pendingFolderUnseenCount,typing:V.typing,threads:V.threads,pendingReadStatusThreads:V.pendingReadStatusThreads,messages:V.messages,localIDsMap:V.localIDsMap,messagesWithUploadsInFlight:V.messagesWithUploadsInFlight,threadlistOrderMap:V.threadlistOrderMap,pinnedThreads:V.pinnedThreads,montage:V.montage,orderedMessageLists:V.orderedMessageLists,unreadCounts:V.unreadCounts,initialUnreadCounts:V.initialUnreadCounts,unseenTimestamp:V.unseenTimestamp};case 61:var W=f;o=i[0];o.forEach(function(c){var a=c.folder;if(za.includes(a)){c=c.thread_fbids.map(function(a){return b("MercuryIDs").getThreadIDFromThreadFBID(a)}).concat(c.other_user_fbids.map(function(a){return b("MercuryIDs").getThreadIDFromUserID(a)}));W.unreadCounts[a]=new Set(c);a=b("MercuryThreadInformer").getForFBID(W.fbid);a.updatedUnreadState();return 0}else return 0});return{fbid:W.fbid,deliveryReceipts:W.deliveryReceipts,readReceiptsPerThread:W.readReceiptsPerThread,ignoredIds:W.ignoredIds,blockedIds:W.blockedIds,pendingFolderUnseenCount:W.pendingFolderUnseenCount,typing:W.typing,threads:W.threads,pendingReadStatusThreads:W.pendingReadStatusThreads,messages:W.messages,localIDsMap:W.localIDsMap,messagesWithUploadsInFlight:W.messagesWithUploadsInFlight,threadlistOrderMap:W.threadlistOrderMap,pinnedThreads:W.pinnedThreads,montage:W.montage,orderedMessageLists:W.orderedMessageLists,unreadCounts:W.unreadCounts,initialUnreadCounts:W.initialUnreadCounts,unseenTimestamp:W.unseenTimestamp};case 62:var X=f,Hb=a;q=i[0];var d={contents:X.unseenTimestamp};q.forEach(function(a){X.initialUnreadCounts[a.folder]=a.unread_count;a.unread_count===0&&(X.unreadCounts[a.folder]=new Set());a.folder===b("MessagingTag").INBOX&&(d.contents=b("bs_belt_Option").getWithDefault(b("bs_caml_option").nullable_to_opt(a.seen_timestamp),d.contents),Hb.fallbackUnseenCount.contents=a.unseen_count);a=b("MercuryThreadInformer").getForFBID(X.fbid);a.updatedUnreadState();a.updatedUnseenState();return 0});return{fbid:X.fbid,deliveryReceipts:X.deliveryReceipts,readReceiptsPerThread:X.readReceiptsPerThread,ignoredIds:X.ignoredIds,blockedIds:X.blockedIds,pendingFolderUnseenCount:X.pendingFolderUnseenCount,typing:X.typing,threads:X.threads,pendingReadStatusThreads:X.pendingReadStatusThreads,messages:X.messages,localIDsMap:X.localIDsMap,messagesWithUploadsInFlight:X.messagesWithUploadsInFlight,threadlistOrderMap:X.threadlistOrderMap,pinnedThreads:X.pinnedThreads,montage:X.montage,orderedMessageLists:X.orderedMessageLists,unreadCounts:X.unreadCounts,initialUnreadCounts:X.initialUnreadCounts,unseenTimestamp:d.contents};case 63:var Y=f,Ib=i[0];za.forEach(function(a){a=b("bs_js_dict").get(Y.unreadCounts,a);if(a!==void 0){var c=b("bs_caml_option").valFromOption(a);b("bs_js_dict").entries(Ib).forEach(function(a){var b=a[0];if(c.has(b)){c.add(a[1]);c["delete"](b);return 0}else return 0});return 0}else return 0});return{fbid:Y.fbid,deliveryReceipts:Y.deliveryReceipts,readReceiptsPerThread:Y.readReceiptsPerThread,ignoredIds:Y.ignoredIds,blockedIds:Y.blockedIds,pendingFolderUnseenCount:Y.pendingFolderUnseenCount,typing:Y.typing,threads:Y.threads,pendingReadStatusThreads:Y.pendingReadStatusThreads,messages:Y.messages,localIDsMap:Y.localIDsMap,messagesWithUploadsInFlight:Y.messagesWithUploadsInFlight,threadlistOrderMap:Y.threadlistOrderMap,pinnedThreads:Y.pinnedThreads,montage:Y.montage,orderedMessageLists:Y.orderedMessageLists,unreadCounts:Y.unreadCounts,initialUnreadCounts:Y.initialUnreadCounts,unseenTimestamp:Y.unseenTimestamp};case 64:H=f;K=i[0];B=i[1];I=i[2];x=i[3];J=i[4];O=Ma(H,K,[B]);F=Sa(O,B);if(F!==void 0){R=b("bs_caml_option").valFromOption(F);cb(b("bs_caml_option").some(K),R);p=b("MessengerMessage.bs").makeFakeMessage(R.message_id,R.thread_id,R.author,R.action_type,R.timestamp,{removed_timestamp:x,message_unsendability_status:b("MessageUnsendabilityStatus").DENY_TOMBSTONE_MESSAGE,unsender:{id:I}});P=Va(O,[B,p]);n=R.thread_id;if(n==null)return P;else{M=db(P,B,n);Na(M.fbid,n,B,J);Pa(M.fbid,n,B,J,R.attachments);G=b("bs_belt_Map").get(M.threads,n);if(G!==void 0){w=b("bs_caml_option").valFromOption(G);E=eb(R.profile_ranges,M.fbid);S=b("ImmutableObject").set(b("ImmutableObject").set(w,bb(M,n)),{unread_mentions_count:w.unread_mentions_count-E|0});m=b("bs_belt_Map").set(M.threads,n,S);s(M.fbid,n);return{fbid:M.fbid,deliveryReceipts:M.deliveryReceipts,readReceiptsPerThread:M.readReceiptsPerThread,ignoredIds:M.ignoredIds,blockedIds:M.blockedIds,pendingFolderUnseenCount:M.pendingFolderUnseenCount,typing:M.typing,threads:m,pendingReadStatusThreads:M.pendingReadStatusThreads,messages:M.messages,localIDsMap:M.localIDsMap,messagesWithUploadsInFlight:M.messagesWithUploadsInFlight,threadlistOrderMap:M.threadlistOrderMap,pinnedThreads:M.pinnedThreads,montage:M.montage,orderedMessageLists:M.orderedMessageLists,unreadCounts:M.unreadCounts,initialUnreadCounts:M.initialUnreadCounts,unseenTimestamp:M.unseenTimestamp}}else return M}}else{Qa(O.fbid,K,B,J);return O}case 65:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("UpdateConnectivityStatus");U=f;Q=i[0];Bb=i[1];T=b("ThreadConnectivityStatus.bs").toGraphQLValue(Bb);A=b("bs_belt_Map").get(U.threads,Q);if(A!==void 0){L=b("bs_caml_option").valFromOption(A);N=L.thread_connectivity_data;o=N==null?b("ImmutableObject").set(L,{thread_connectivity_data:{connectivity_status:T,first_sender_id:null}}):b("ImmutableObject").set(L,{thread_connectivity_data:{connectivity_status:T,first_sender_id:N.first_sender_id}});return{fbid:U.fbid,deliveryReceipts:U.deliveryReceipts,readReceiptsPerThread:U.readReceiptsPerThread,ignoredIds:U.ignoredIds,blockedIds:U.blockedIds,pendingFolderUnseenCount:U.pendingFolderUnseenCount,typing:U.typing,threads:b("bs_belt_Map").set(U.threads,Q,o),pendingReadStatusThreads:U.pendingReadStatusThreads,messages:U.messages,localIDsMap:U.localIDsMap,messagesWithUploadsInFlight:U.messagesWithUploadsInFlight,threadlistOrderMap:U.threadlistOrderMap,pinnedThreads:U.pinnedThreads,montage:U.montage,orderedMessageLists:U.orderedMessageLists,unreadCounts:U.unreadCounts,initialUnreadCounts:U.initialUnreadCounts,unseenTimestamp:U.unseenTimestamp}}else return U;case 66:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("DeltaMarkFolderSeen");q=f;var Jb=i[0];return b("bs_belt_Array").reduceU(Jb.folders,q,function(c,a){a=b("bs_js_dict").get(b("MessagingTag").IRIS_MAPPING,a);if(a!==void 0)return yb(c,Number(Jb.timestamp),a);else return c});case 67:H=f;F=[i[0],i[1],i[2],i[3]];var Kb=F[2];x=F[0];I=Sa(H,x);if(I!==void 0){p=b("bs_caml_option").valFromOption(I);P=F[1].concat(p.tags).filter(function(a){return Kb.indexOf(a)===-1});G=Object.assign(Object.assign({},p),{tags:P});R=p.thread_id;R==null||Na(H.fbid,R,x,F[3]);return Va(H,[x,G])}else return H;case 68:w=f;E=i[0];S=i[1];return u(void 0,w,E,{conversion_detection_data:S});case 69:n=f;m=[i[0],i[1],i[2],i[3],i[4]];M=m[0];K=Sa(n,M);if(K!==void 0){B=b("bs_caml_option").valFromOption(K);J=B.attachments;if(J==null||J.length!==1)return n;else{O=J[0];Bb=m[2]?[Object.assign(Object.assign({},O),{blurred_image_uri:void 0})]:[Object.assign(Object.assign({},O),{blurred_image_uri:m[3]})];A=Object.assign(Object.assign({},B),{attachments:Bb});L=B.thread_id;L==null||Na(n.fbid,L,M,m[4]);return Va(n,[M,A])}}else return n}case 1:T=g[0];if(typeof T==="number")if(T===0){N=f;var Lb=[];b("bs_belt_MapString").forEach(N.typing,function(a,c){return b("bs_belt_Map").forEach(c,function(b,c){if(c<Date.now()-3e4){Lb.push([a,b]);return 0}else return 0})});if(Lb.length!==0){var c={contents:N.typing};Lb.forEach(function(a){c.contents=la(c.contents,a[0],a[1]);return 0});return{fbid:N.fbid,deliveryReceipts:N.deliveryReceipts,readReceiptsPerThread:N.readReceiptsPerThread,ignoredIds:N.ignoredIds,blockedIds:N.blockedIds,pendingFolderUnseenCount:N.pendingFolderUnseenCount,typing:c.contents,threads:N.threads,pendingReadStatusThreads:N.pendingReadStatusThreads,messages:N.messages,localIDsMap:N.localIDsMap,messagesWithUploadsInFlight:N.messagesWithUploadsInFlight,threadlistOrderMap:N.threadlistOrderMap,pinnedThreads:N.pinnedThreads,montage:N.montage,orderedMessageLists:N.orderedMessageLists,unreadCounts:N.unreadCounts,initialUnreadCounts:N.initialUnreadCounts,unseenTimestamp:N.unseenTimestamp}}else return N}else{Q=f;o=a;if(wb(Q,o,!1)>0){U=b("MercuryServerRequests").getForFBID(Q.fbid);U.markSeen();return yb(Q,U.getLastActionTimestamp(),b("MessagingTag").INBOX)}else return Q}else switch(T.tag|0){case 0:var Z=f,Mb=a;q=T[0];I=T[1];P=T[2];p=T[3];var Nb=Z.threads,Ob=[];R=j(q.reduce(function(d,a){var c=b("bs_belt_Map").get(Nb,a);if(c!==void 0)return b("bs_belt_Map").set(d,a,b("bs_caml_option").valFromOption(c));else{Ob.push(a);return d}},b("bs_belt_Map").make(b("ThreadId.bs"))));if(Ob.length!==0){F=Mb.threadSubToken;x=F.contents.toString();Mb.threadSubToken.contents=F.contents+1|0;Mb.threadCallbacks.contents[x]=[q,P];G=b("MercuryServerRequests").getForFBID(Z.fbid);H=Ob.reduce(function(c,a){var d=b("MercuryIDs").tokenize(a),e=d.type;d=d.value;if(e==="user"){e=b("MercuryIDs").getParticipantIDFromUserID(b("FBID.bs").ofStringExn(d));d=b("MercuryIDs").getParticipantIDFromUserID(Z.fbid);d=b("MessengerThreadUtils.bs").createNewLocalThread(d,a,b("bs_caml_obj").caml_equal(e,d)?[d]:[d,e],null);e=b("bs_belt_Map").set(c,a,d);b("gkx")("1074761")||pb(e,Mb.threadCallbacks.contents);return e}else return c},Z.threads);G.fetchThreadData(Ob,p);b("bs_curry")._1(I,x);if(H===Z.threads)return Z;else return{fbid:Z.fbid,deliveryReceipts:Z.deliveryReceipts,readReceiptsPerThread:Z.readReceiptsPerThread,ignoredIds:Z.ignoredIds,blockedIds:Z.blockedIds,pendingFolderUnseenCount:Z.pendingFolderUnseenCount,typing:Z.typing,threads:H,pendingReadStatusThreads:Z.pendingReadStatusThreads,messages:Z.messages,localIDsMap:Z.localIDsMap,messagesWithUploadsInFlight:Z.messagesWithUploadsInFlight,threadlistOrderMap:Z.threadlistOrderMap,pinnedThreads:Z.pinnedThreads,montage:Z.montage,orderedMessageLists:Z.orderedMessageLists,unreadCounts:Z.unreadCounts,initialUnreadCounts:Z.initialUnreadCounts,unseenTimestamp:Z.unseenTimestamp}}else{b("bs_curry")._1(P,R);return Z}case 1:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("UnsubscribeThread");w=a.threadCallbacks.contents;ob(w,T[0]);a.threadCallbacks.contents=w;return f;case 2:var $=f;E=T[0];S=b("bs_belt_Array").keepMap(E,function(a){a=Sa($,a);if(a!==void 0)return b("bs_caml_option").nullable_to_opt(b("bs_caml_option").valFromOption(a).offline_threading_id)});S.forEach(function(a){$.localIDsMap["delete"](a);return 0});return{fbid:$.fbid,deliveryReceipts:$.deliveryReceipts,readReceiptsPerThread:$.readReceiptsPerThread,ignoredIds:$.ignoredIds,blockedIds:$.blockedIds,pendingFolderUnseenCount:$.pendingFolderUnseenCount,typing:$.typing,threads:$.threads,pendingReadStatusThreads:$.pendingReadStatusThreads,messages:$.messages,localIDsMap:$.localIDsMap,messagesWithUploadsInFlight:$.messagesWithUploadsInFlight,threadlistOrderMap:$.threadlistOrderMap,pinnedThreads:$.pinnedThreads,montage:$.montage,orderedMessageLists:$.orderedMessageLists,unreadCounts:$.unreadCounts,initialUnreadCounts:$.initialUnreadCounts,unseenTimestamp:$.unseenTimestamp};case 3:b("ChatReliabilityInstrumentation").logPROCESS_DELTA("MontagePollStickerVoted");i=f;var Pb=T[0];K=b("bs_js_dict").fromArray(b("bs_js_dict").entries(i.montage));J=Pb.montageActorID;O=b("bs_js_dict").get(K,J);if(O!==void 0){Bb=O.map(function(a){if(b("bs_caml_obj").caml_equal(Pb.montageMessageID,a.id)){var c=a,d=Pb,e=c.montage_overlays.map(function(a){if(b("bs_caml_obj").caml_equal(a.poll.id,d.pollID)){var c=a.poll.poll_options.map(function(a,c){if(c===d.optionVotedIndex)return new(b("ImmutableObject"))({text:a.text,vote_count:a.vote_count+1|0});else return a});c=new(b("ImmutableObject"))({can_viewer_vote:a.poll.can_viewer_vote,id:a.poll.id,poll_options:c,viewer_vote_index:d.optionVotedIndex});return b("ImmutableObject").set(new(b("ImmutableObject"))(a),{poll:c})}else return a});return b("ImmutableObject").set(new(b("ImmutableObject"))(c),{montage_overlays:e})}else return a});K[J]=Bb}return{fbid:i.fbid,deliveryReceipts:i.deliveryReceipts,readReceiptsPerThread:i.readReceiptsPerThread,ignoredIds:i.ignoredIds,blockedIds:i.blockedIds,pendingFolderUnseenCount:i.pendingFolderUnseenCount,typing:i.typing,threads:i.threads,pendingReadStatusThreads:i.pendingReadStatusThreads,messages:i.messages,localIDsMap:i.localIDsMap,messagesWithUploadsInFlight:i.messagesWithUploadsInFlight,threadlistOrderMap:i.threadlistOrderMap,pinnedThreads:i.pinnedThreads,montage:K,orderedMessageLists:i.orderedMessageLists,unreadCounts:i.unreadCounts,initialUnreadCounts:i.initialUnreadCounts,unseenTimestamp:i.unseenTimestamp};case 4:B=b("bs_belt_Map").set(f.threads,T[0],T[1]);return{fbid:f.fbid,deliveryReceipts:f.deliveryReceipts,readReceiptsPerThread:f.readReceiptsPerThread,ignoredIds:f.ignoredIds,blockedIds:f.blockedIds,pendingFolderUnseenCount:f.pendingFolderUnseenCount,typing:f.typing,threads:B,pendingReadStatusThreads:f.pendingReadStatusThreads,messages:f.messages,localIDsMap:f.localIDsMap,messagesWithUploadsInFlight:f.messagesWithUploadsInFlight,threadlistOrderMap:f.threadlistOrderMap,pinnedThreads:f.pinnedThreads,montage:f.montage,orderedMessageLists:f.orderedMessageLists,unreadCounts:f.unreadCounts,initialUnreadCounts:f.initialUnreadCounts,unseenTimestamp:f.unseenTimestamp};case 5:b("MercuryServerRequests").getForFBID(f.fbid).updateLastActionTimestamp(T[0]);return f}case 2:L=g[0];switch(L.tag|0){case 0:b("bs_curry")._1(L[0],{blocked_ids:f.blockedIds});break;case 1:b("bs_curry")._1(L[1],b("bs_belt_Map").get(f.threads,L[0]));break;case 2:b("bs_curry")._1(L[0],f.pinnedThreads.concat([]));break;case 3:b("bs_curry")._2(L[0],f,a);break}return f}},d,c);e.length>0&&b("LogHistory").getInstance("messenger_state").debug("actions",b("bs_belt_Option").getWithDefault(JSON.stringify(e),""));return d}function D(a){var c=[b("MercurySyncEventsProxy").getArbiterTypeForFBID(a,"TYP")];b("FBIDCheck").isUser_deprecated(a)||c.push(b("ChannelConstants").getArbiterType("page_typing"));return c}function E(a){return{fbid:a,deliveryReceipts:null,readReceiptsPerThread:null,ignoredIds:b("bs_belt_Set").make(b("ParticipantId.bs")),blockedIds:b("bs_belt_Set").make(b("ParticipantId.bs")),pendingFolderUnseenCount:0,typing:null,threads:b("bs_belt_Map").make(b("ThreadId.bs")),pendingReadStatusThreads:new Set(),messages:new Map(),localIDsMap:new Map(),messagesWithUploadsInFlight:new Map(),threadlistOrderMap:pa(0),pinnedThreads:[],montage:{},orderedMessageLists:new Map(),unreadCounts:{},initialUnreadCounts:{},unseenTimestamp:0}}var F={contents:{}},G={contents:0},H=new Map(),I={contents:{}},J={contents:0},K=new Set(),L={contents:{}},M={contents:0},N={threadCallbacks:F,threadSubToken:G,localTitanMessageCount:H,messageCallbacks:I,messageSubToken:J,existingPinnedThreads:K,failedHistoryFetchThreads:L,fallbackUnseenCount:M},Ab={contents:0},O={};function P(a,c,d){d=c!==void 0?b("bs_caml_option").valFromOption(c):b("RemoteAction.bs").create(0);c=b("bs_js_dict").get(O,a);if(c!==void 0)return 0;else{O[a]={subscriptions:new Set(),state:E(a),remoteAction:d};b("RemoteAction.bs").subscribe(function(c){var d=b("bs_js_dict").get(O,a);if(d!==void 0){d=d;var e=d.state;c=zb(N,c,e);O[a]={subscriptions:d.subscriptions,state:c,remoteAction:d.remoteAction};if(c!==e){d=b("bs_js_dict").get(O,a);if(d!==void 0){d.subscriptions.forEach(function(a){return b("bs_curry")._1(a.fn,0)});return 0}else{b("recoverableViolation")("Subscriptions deleted after createion","messenger_comet");return 0}}else return 0}else{b("recoverableViolation")("State deleted after creation","messenger_comet");return 0}},d);var e=b("bs_caml_option").some(a),f=a,g=function(a){return Q(e,a)},h=function(a){b("bs_curry")._1(g,[b("bs_block").__(0,[b("bs_block").__(5,[a])])]);b("setTimeoutAcrossTransitions")(function(a){return b("bs_curry")._1(g,[b("bs_block").__(1,[0])])},3e4);return 0};b("Arbiter").subscribe(D(f),function(a,b){a=b.obj;b=a.to;if(!(b==null)&&b.toString()!==f)return 0;else{h(a);return 0}});return 0}}function Q(a,c){a=a!==void 0?b("bs_caml_option").valFromOption(a):b("CurrentUser").getID();P(a,void 0,0);a=b("bs_js_dict").get(O,a);if(a!==void 0)return b("RemoteAction.bs").send(a.remoteAction,c);else{b("recoverableViolation")("Subscriptions deleted after createion","messenger_comet");return 0}}function R(a,c,d,e){var f=a!==void 0?b("bs_caml_option").valFromOption(a):b("CurrentUser").getID();e=c!==void 0?b("bs_caml_option").valFromOption(c):b("RemoteAction.bs").create(0);P(f,b("bs_caml_option").some(e),0);a=i.useState(function(){var a=b("bs_js_dict").get(O,f);if(a!==void 0)return a.state;else return b("unrecoverableViolation")("Rendering without state initialized","messenger_comet")});var g=a[1],h=a[0];c=b("bs_js_dict").get(O,f);var j=i.useCallback(function(a){a=b("bs_js_dict").get(O,f);var c=a!==void 0?a.state:b("unrecoverableViolation")("Rendering without state initialized","messenger_comet");if(d!==void 0)if(b("bs_curry")._2(d,h,c))return b("bs_curry")._1(g,function(a){return c});else return 0;else return b("bs_curry")._1(g,function(a){return c})},[d,h,g,c,f]);i.useEffect(function(){Ab.contents=Ab.contents+1|0;var a=Ab.contents,c={id:a,fn:j};a=b("bs_js_dict").get(O,f);a!==void 0?a.subscriptions.add(c):b("recoverableViolation")("Subscriptions deleted after createion, can't add subscription","messenger_comet");b("bs_curry")._1(j,0);return function(a){a=b("bs_js_dict").get(O,f);if(a!==void 0){a.subscriptions["delete"](c);return 0}else{b("recoverableViolation")("Subscriptions deleted after createion, can't remove subscription","messenger_comet");return 0}}},[j,f]);return h}function S(a){var c=a.shouldUpdate,d=a.remoteAction,e=a.fbid;a=a.children;e=e!==void 0?b("bs_caml_option").valFromOption(e):b("CurrentUser").getID();return b("bs_curry")._1(a,R(b("bs_caml_option").some(e),d,c,0))}function T(a){return R(b("bs_caml_option").some(a),void 0,void 0,0)}function U(a,c){return Q(b("bs_caml_option").some(a),[b("bs_block").__(2,[b("bs_block").__(0,[c])])])}function Bb(a,c){b("MercuryAssert").isThreadID(c);var d={contents:void 0},e=function(a){d.contents=a;return 0};Q(b("bs_caml_option").some(a),[b("bs_block").__(2,[b("bs_block").__(1,[c,e])])]);return b("bs_js_null_undefined").fromOption(d.contents)}function Cb(a,c,d,e){if(c.length!==0){b("MercuryAssert").allThreadID(c);var f={contents:null},g=function(a){f.contents=a;return 0};Q(b("bs_caml_option").some(a),[b("bs_block").__(1,[b("bs_block").__(0,[c,g,d,e])])]);return f.contents}else{b("bs_curry")._1(d,{});return null}}function Db(a,c,d,e){return Cb(a,[c],function(a){return b("bs_curry")._1(d,a[c])},e)}function Eb(a,c,d,e){var f={contents:void 0},g=function(a){f.contents=a;return 0};Q(b("bs_caml_option").some(a),[b("bs_block").__(2,[b("bs_block").__(1,[c,g])])]);g=f.contents;if(g!==void 0)return b("bs_caml_option").valFromOption(g);else{g=b("MessengerThreadUtils.bs").createNewLocalThread(b("MercuryIDs").getParticipantIDFromUserID(a),c,d,e);Q(b("bs_caml_option").some(a),[b("bs_block").__(1,[b("bs_block").__(4,[c,g])])]);return g}}function Fb(a){var c=b("MercuryLocalIDs").generateThreadID(null);Eb(a,c,[],null);return c}function V(a,c,d,e){var f={contents:void 0},g=function(a){f.contents=a;return 0};Q(b("bs_caml_option").some(a),[b("bs_block").__(2,[b("bs_block").__(1,[c,g])])]);g=f.contents;if(g!==void 0)return b("bs_caml_option").valFromOption(g);else{g=b("MessengerThreadUtils.bs").createNewLocalGroupGeneralThread(b("MercuryIDs").getParticipantIDFromUserID(a),c,d,e);Q(b("bs_caml_option").some(a),[b("bs_block").__(1,[b("bs_block").__(4,[c,g])])]);return g}}function Gb(a,c,d){var e=b("MercuryLocalIDs").generateThreadID(null);V(a,e,c,d);return e}function W(a,c){var d={contents:void 0},e=function(a){d.contents=a;return 0};Q(b("bs_caml_option").some(a),[b("bs_block").__(2,[b("bs_block").__(1,[c,e])])]);a=d.contents;if(a!==void 0)return b("MercuryThreadInfo").isEmptyLocalThread(b("bs_caml_option").valFromOption(a));else return!1}function X(a,c){var d={contents:void 0},e=function(a){d.contents=a;return 0};Q(b("bs_caml_option").some(a),[b("bs_block").__(2,[b("bs_block").__(1,[c,e])])]);a=d.contents;if(a!==void 0)return b("MercuryThreadInfo").isNewEmptyLocalThread(b("bs_caml_option").valFromOption(a));else return!1}function Hb(c){var a={contents:[]},d=function(b){a.contents=b;return 0};Q(b("bs_caml_option").some(c),[b("bs_block").__(2,[b("bs_block").__(2,[d])])]);return a.contents}function Y(a,c){return Q(b("bs_caml_option").some(a),[b("bs_block").__(1,[b("bs_block").__(1,[c])])])}function Ib(a){var c=a.payload_source;if(c==null)return!1;else if(b("bs_caml_obj").caml_equal(c,b("MercuryPayloadSource").CLIENT_CHANGE_ARCHIVED_STATUS)||b("bs_caml_obj").caml_equal(c,b("MercuryPayloadSource").CLIENT_CHANNEL_MESSAGE)||b("bs_caml_obj").caml_equal(c,b("MercuryPayloadSource").CLIENT_SEND_MESSAGE)||b("bs_caml_obj").caml_equal(c,b("MercuryPayloadSource").SERVER_SEND_MESSAGE)||b("bs_caml_obj").caml_equal(c,b("MercuryPayloadSource").SERVER_FETCH_THREADLIST_INFO)||b("bs_caml_obj").caml_equal(c,b("MercuryPayloadSource").SERVER_THREAD_SYNC)||b("bs_caml_obj").caml_equal(c,b("MercuryPayloadSource").SERVER_CHANGE_PINNED_STATUS)||b("bs_caml_obj").caml_equal(c,b("MercuryPayloadSource").SERVER_CHANGE_PINNED_MESSAGES)||b("bs_caml_obj").caml_equal(c,b("MercuryPayloadSource").SERVER_INVALIDATE_GLOBAL_STATE)||b("bs_caml_obj").caml_equal(c,b("MercuryPayloadSource").CLIENT_UPDATE_COMM_STATUS))return!0;else if(b("bs_caml_obj").caml_equal(c,b("MercuryPayloadSource").SERVER_INITIAL_DATA)){c=a.ordered_threadlists;return!(c==null)}else return!1}function Jb(a,c){c=b("bs_block").__(1,[b("bs_block").__(3,[c])]);return Q(b("bs_caml_option").some(a),[c])}function Kb(a,c){return Q(a==null?void 0:b("bs_caml_option").some(a),c)}function Lb(a){var c=[],d=!1;if(!(a==null)){var e=a.payload_source;!(e==null)&&b("bs_caml_obj").caml_equal(e,b("MercuryPayloadSource").SERVER_INVALIDATE_GLOBAL_STATE)&&(d=!0);e=a.newlyAddedClientIDs;e==null||Object.keys(e).length>0&&c.push(b("bs_block").__(0,[b("bs_block").__(63,[e])]));e=a.delivery_receipts;e==null||c.push(b("bs_block").__(0,[b("bs_block").__(0,[e])]));e=a.message_ignored_ids;e==null||c.push(b("bs_block").__(0,[b("bs_block").__(1,[e])]));e=a.threads;if(!(e==null)){var f=a.payload_source;f==null||(b("bs_caml_obj").caml_equal(f,b("MercuryPayloadSource").SERVER_FETCH_THREAD_INFO)&&c.push(b("bs_block").__(0,[b("bs_block").__(8,[e])])),b("bs_caml_obj").caml_equal(f,b("MercuryPayloadSource").SERVER_INVALIDATE_THREAD_STATE)&&(e.length>0&&c.unshift(b("bs_block").__(0,[b("bs_block").__(34,[b("bs_caml_array").caml_array_get(e,0).thread_id])]))));c.push(b("bs_block").__(0,[b("bs_block").__(7,[e])]))}f=a.participants;if(!(f==null)){c.push(b("bs_block").__(0,[b("bs_block").__(3,[f])]));var g=[],h=[];f.forEach(function(a){if(a.is_messenger_blocked||a.is_facebook_blocked){g.push(b("MercuryIDs").getParticipantIDFromUserID(a.fbid));return 0}else{h.push(b("MercuryIDs").getParticipantIDFromUserID(a.fbid));return 0}});e=0;(g.length!==0||h.length!==0)&&(e=1);e===1&&c.push(b("bs_block").__(0,[b("bs_block").__(2,[g,h])]))}f=a.message_blocked_ids;f==null||f.length>0&&c.push(b("bs_block").__(0,[b("bs_block").__(2,[f,[]])]));e=a.message_unblocked_ids;e==null||e.length>0&&c.push(b("bs_block").__(0,[b("bs_block").__(2,[[],e])]));f=a.pending_folder_unseen_count;f==null||c.push(b("bs_block").__(0,[b("bs_block").__(4,[f])]));e=a.global_actions;e==null||e.forEach(function(a){if(b("bs_caml_obj").caml_equal(a.action_type,b("MercuryGlobalActionType").MARK_ALL_READ)){c.push(b("bs_block").__(0,[b("bs_block").__(33,[a.folder])]));return 0}else return 0});if(Ib(a)){f=a.ordered_threadlists;e=0;f==null||f.length===0?e=1:c.push(b("bs_block").__(0,[b("bs_block").__(9,[f])]));if(e===1){f=a.threads;e=a.payload_source;f==null||!(e==null)&&f.length>0&&e!==b("MercuryPayloadSource").SERVER_CHANGE_PINNED_STATUS&&c.push(b("bs_block").__(0,[b("bs_block").__(10,[f])]))}}e=a.pinned_thread_ids;e==null||e.length>0&&Ib(a)&&c.push(b("bs_block").__(0,[b("bs_block").__(11,[e])]));f=a.roger;f==null||c.push(b("bs_block").__(0,[b("bs_block").__(6,[f])]));e=a.montage_delete_message_delta;e==null||c.push(b("bs_block").__(0,[b("bs_block").__(59,[e])]));f=a.montage_new_message_delta;f==null||c.push(b("bs_block").__(0,[b("bs_block").__(57,[f])]));e=a.montage_poll_sticker_vote;e==null||e.forEach(function(a){c.push(b("bs_block").__(1,[b("bs_block").__(3,[a])]));return 0});f=a.current_montage_thread;if(!(f==null)){e=f.user;if(!(e==null)){f=e.messenger_montage_thread;f==null||(c.push(b("bs_block").__(0,[b("bs_block").__(58,[e.id])])),f.montage_messages.edges.forEach(function(a){c.push(b("bs_block").__(0,[b("bs_block").__(57,[a.node])]));return 0}))}}e=a.unread_thread_fbids;e==null||c.push(b("bs_block").__(0,[b("bs_block").__(61,[e])]));f=a.message_counts;f==null||c.push(b("bs_block").__(0,[b("bs_block").__(62,[f])]));e=a.actions;if(!(e==null)){var i=a.payload_source,j=i==null?void 0:b("bs_caml_option").some(i);e.forEach(function(d){var e=d.action_type,f=0;(i==null||!i.startsWith("server"))&&(f=1);f===1&&c.push(b("bs_block").__(1,[b("bs_block").__(5,[d.timestamp])]));if(b("bs_caml_obj").caml_equal(j,b("bs_caml_option").some(b("MercuryPayloadSource").SERVER_SEARCH))||b("bs_caml_obj").caml_equal(b("bs_caml_option").nullable_to_opt(d.client_state),b("bs_caml_option").some(b("MercuryMessageClientState").SEND_TO_SERVER))){c.push(b("bs_block").__(0,[b("bs_block").__(35,[d,0])]));return 0}else{f=d.thread_id;var g=d.upload_id,h=d.upload_data,k=d.message_ids;ia(d);if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").DELETE_MESSAGES))if(!(f==null)&&!(k==null)){c.push(b("bs_block").__(0,[b("bs_block").__(36,[f,k,j])]));return 0}else return 0;else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").CHANGE_FOLDER)){k=d.new_folder;if(!(f==null)&&!(k==null)){c.push(b("bs_block").__(0,[b("bs_block").__(37,[f,k])]));return 0}else return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").CHANGE_ARCHIVED_STATUS))if(f==null)return 0;else{c.push(b("bs_block").__(0,[b("bs_block").__(39,[f,d.archived])]));return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").CHANGE_MUTE_SETTINGS)){k=d.reactions_mute_mode;var l=d.mentions_mute_mode,m=d.mute_until;l=k==null?l==null?m==null?void 0:b("bs_block").__(2,[m]):m==null?b("bs_block").__(1,[l===1]):void 0:!(l==null)||!(m==null)?void 0:b("bs_block").__(0,[k===1]);if(!(f==null)&&l!==void 0){c.push(b("bs_block").__(0,[b("bs_block").__(38,[f,l])]));return 0}else return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").CHANGE_READ_STATUS))if(f==null)return 0;else{m=a.from_client;c.push(b("bs_block").__(0,[b("bs_block").__(41,[f,d.mark_as_read,d.timestamp,m==null?!1:m,d.source])]));return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").CHANGE_PAGE_FOLLOW_UP_STATUS))if(f==null)return 0;else{c.push(b("bs_block").__(0,[b("bs_block").__(40,[f,d.is_page_follow_up])]));return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").BLOCK_STATUS_CHANGED))if(f==null)return 0;else{k=d.canViewerReply?null:b("MessengerThreadCannotReplyReason.bs").fromMessageThreadCannotReplyReason(d.reason);c.push(b("bs_block").__(0,[b("bs_block").__(13,[f,d.canViewerReply,k])]));return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").DELETE_THREAD))if(f==null)return 0;else{c.push(b("bs_block").__(0,[b("bs_block").__(42,[f])]));return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").REACTION_UPDATE)){l=d.messageId;m=d.userId;if(!(l==null)&&!(m==null)){c.push(b("bs_block").__(0,[b("bs_block").__(45,[l,b("bs_caml_option").nullable_to_opt(d.reaction),m,j])]));return 0}else return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").MONTAGE_DIRECT_EXPIRE)){k=d.messageId;if(k==null)return 0;else{c.push(b("bs_block").__(0,[b("bs_block").__(46,[k,j])]));return 0}}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").LIVE_LOCATION_UPDATE)){l=d.messageId;m=d.liveLocation;if(!(l==null)&&!(m==null)){c.push(b("bs_block").__(0,[b("bs_block").__(47,[l,m,j])]));return 0}else return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").REPLACE_MESSAGE)){c.push(b("bs_block").__(0,[b("bs_block").__(48,[d,j])]));return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").CONFIRM_ATTACHMENT_PLACEHOLDER))if(!(g==null)&&!(h==null)){c.push(b("bs_block").__(0,[b("bs_block").__(44,[g,h])]));return 0}else return 0;else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").CANCEL_ATTACHMENT_PLACEHOLDER))if(!(g==null)&&!(h==null)){c.push(b("bs_block").__(0,[b("bs_block").__(43,[g,h,j])]));return 0}else return 0;else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").SEND_MESSAGE)){c.push(b("bs_block").__(0,[b("bs_block").__(50,[d,j])]));return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").USER_GENERATED_MESSAGE)){c.push(b("bs_block").__(0,[b("bs_block").__(51,[d,j,a.from_client])]));return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").LOG_MESSAGE))if(b("MessengerMessage.bs").isLocalMessage(d))return 0;else{c.push(b("bs_block").__(0,[b("bs_block").__(52,[d,j,a.from_client])]));return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").CHANGE_PINNED_STATUS))if(f==null)return 0;else{c.push(b("bs_block").__(0,[b("bs_block").__(55,[f,d.is_pinned,d.thread_pin_timestamp])]));return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").PIN_MESSAGE))if(f==null)return 0;else{c.push(b("bs_block").__(0,[b("bs_block").__(53,[f,d.pin_message_action])]));return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").UNPIN_MESSAGE))if(f==null)return 0;else{c.push(b("bs_block").__(0,[b("bs_block").__(54,[f,d.unpin_message_action])]));return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").REMOVE_MESSAGE)){k=d.thread_id;l=d.messageId;m=d.removed_timestamp;g=d.author;if(!(k==null)&&!(l==null)&&!(m==null)&&!(g==null)){c.push(b("bs_block").__(0,[b("bs_block").__(64,[k,l,g,m,j])]));b("MessengerDesktopNotifications").removeNotification(l);return 0}else return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").UNSUBSCRIBE_STATUS_UPDATE))if(f==null)return 0;else{c.push(b("bs_block").__(0,[b("bs_block").__(12,[f,d.page_unsubscribe_status])]));return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").BLURRED_IMAGE_STATUS)){h=d.image_message_id;k=d.image_id;g=d.should_show;m=d.blurred_image_uri;if(!(h==null)&&!(k==null)&&!(g==null)&&!(m==null)){c.push(b("bs_block").__(0,[b("bs_block").__(69,[h,k,g,m,j])]));return 0}else return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").ADD_PARTICIPANTS))if(f==null)return 0;else{c.push(b("bs_block").__(0,[b("bs_block").__(14,[f,d.participants])]));return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").CHANGE_FLAG))if(f==null)return 0;else{c.push(b("bs_block").__(0,[b("bs_block").__(15,[f,d.mark_as_flag])]));return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").MOVE_PENDING_TO_INBOX))if(f==null)return 0;else{c.push(b("bs_block").__(0,[b("bs_block").__(16,[f])]));return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").UPDATE_CUSTOM_LIKE))if(f==null)return 0;else{c.push(b("bs_block").__(0,[b("bs_block").__(17,[f,d.custom_like])]));return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").PROMOTE_GROUP_ADMINS)){l=d.promoted_admins;if(!(f==null)&&!(l==null)){c.push(b("bs_block").__(0,[b("bs_block").__(18,[f,l])]));return 0}else return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").REMOVE_GROUP_ADMINS)){h=d.removed_admin_ids;if(!(f==null)&&!(h==null)){c.push(b("bs_block").__(0,[b("bs_block").__(19,[f,h])]));return 0}else return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").JOINABLE_MODE))if(f==null)return 0;else{c.push(b("bs_block").__(0,[b("bs_block").__(20,[f,d.joinable_mode])]));return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").APPROVAL_MODE))if(f==null)return 0;else{c.push(b("bs_block").__(0,[b("bs_block").__(21,[f,d.approval_mode])]));return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").APPROVAL_QUEUE))if(f==null)return 0;else{c.push(b("bs_block").__(0,[b("bs_block").__(22,[f,d.added_id,d.added_group_id,d.removed_id,d.removed_group_id])]));return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").IS_PIN_PROTECTED))if(f==null)return 0;else{c.push(b("bs_block").__(0,[b("bs_block").__(23,[f,d.is_pin_protected])]));return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").UPDATE_RTC_CALL_DATA))if(f==null)return 0;else{c.push(b("bs_block").__(0,[b("bs_block").__(24,[f,d.initiator_fbid,d.call_state,d.server_info_data])]));return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").UPDATE_COMM_STATUS))if(f==null)return 0;else{c.push(b("bs_block").__(0,[b("bs_block").__(25,[f,d.comm_status])]));return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").UPDATE_COMM_ITEM_OWNER))if(f==null)return 0;else{c.push(b("bs_block").__(0,[b("bs_block").__(26,[f,d.id,d.name,d.profile_pic_uri])]));return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").EVENT_RSVP_CHANGED))if(f==null)return 0;else{c.push(b("bs_block").__(0,[b("bs_block").__(27,[f,d.actor_fbid,d.rsvp_status])]));return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").UPDATE_CONNECTIVITY_STATUS)){k=d.thread_connectivity_status;if(!(f==null)&&!(k==null)){c.push(b("bs_block").__(0,[b("bs_block").__(65,[f,k])]));return 0}else return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").GROUPS_SYNC_STATUS_CHANGED))if(f==null)return 0;else{c.push(b("bs_block").__(0,[b("bs_block").__(28,[f,d.groups_sync_action,d.groups_sync_status_string])]));return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").GROUPS_SYNC_METADATA_UPDATE))if(f==null)return 0;else{c.push(b("bs_block").__(0,[b("bs_block").__(29,[f,d.groups_sync_action,d.fb_group_id,d.emoji_codepoints])]));return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").DESCRIPTION_CHANGED))if(f==null)return 0;else{c.push(b("bs_block").__(0,[b("bs_block").__(30,[f,d.group_thread_description_string])]));return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").UPDATE_THREAD_THEME))if(f==null)return 0;else{c.push(b("bs_block").__(0,[b("bs_block").__(31,[f,{solid_color:d.solid_color,header_color:d.header_color,footer_color:d.footer_color,gradient_colors:d.gradient_colors,theme_id:d.theme_id,reactions:d.reactions}])]));return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").UPDATE_JOINABLE_LINK))if(f==null)return 0;else{c.push(b("bs_block").__(0,[b("bs_block").__(32,[f,d.joinable_link])]));return 0}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").MUTATE_TAGS)){g=d.tags_to_add;m=g==null?[]:g;l=d.tags_to_delete;h=l==null?[]:l;k=d.messageId;if(k==null)return 0;else{c.push(b("bs_block").__(0,[b("bs_block").__(67,[k,m,h,j])]));return 0}}else if(b("bs_caml_obj").caml_equal(e,b("MercuryActionType").ADS_CONVERSION_UPDATE)){g=d.conversion_detection_data;if(!(f==null)&&!(g==null)){c.push(b("bs_block").__(0,[b("bs_block").__(68,[f,g])]));return 0}else return 0}else return 0}});b("Utils.bs").isTruthy(a.from_client)&&e.forEach(function(d){var a=d.thread_id;if(a==null)return 0;else{c.push(b("bs_block").__(0,[b("bs_block").__(49,[a,d.message_id])]));return 0}})}f=a.end_of_history;f==null||c.push(b("bs_block").__(0,[b("bs_block").__(60,[f,a.payload_source])]))}d&&c.unshift(b("bs_block").__(0,[0]));return c}function Z(c,d){var a={contents:[]},e=function(b,c){c=b.orderedMessageLists.get(d);if(c==null)return 0;else{a.contents=Ta(!0,b,c.messageIDs);return 0}};Q(b("bs_caml_option").some(c),[b("bs_block").__(2,[b("bs_block").__(3,[e])])]);return a.contents}function Mb(c,d){var a={contents:d},e=function(b,c){c=b.localIDsMap.get(d);if(c==null)return 0;else{a.contents=c;return 0}};Q(b("bs_caml_option").some(c),[b("bs_block").__(2,[b("bs_block").__(3,[e])])]);return a.contents}function Nb(a,c){var d={contents:void 0},e=function(a,b){d.contents=a;return 0};Q(b("bs_caml_option").some(a),[b("bs_block").__(2,[b("bs_block").__(3,[e])])]);a=d.contents;if(a!==void 0)return Ta(!1,a,c);else return[]}function Ob(a,c){var d={contents:void 0},e=function(a,b){d.contents=a;return 0};Q(b("bs_caml_option").some(a),[b("bs_block").__(2,[b("bs_block").__(3,[e])])]);a=d.contents;if(a!==void 0)return b("bs_caml_option").nullable_to_opt(a.messages.get(c))}function $(a,c,d){var e={contents:!1},f=function(a,b){b=a.orderedMessageLists.get(c);if(b==null)return 0;else{a=b.messageLoadingState;b=b.messageIDs.length;if(a){e.contents=!0;return 0}else{e.contents=b>=d;return 0}}};Q(b("bs_caml_option").some(a),[b("bs_block").__(2,[b("bs_block").__(3,[f])])]);return e.contents}function Pb(a,c){var d={contents:!1},e=function(a,b){b=a.orderedMessageLists.get(c);if(b==null)return 0;else{a=b.messageLoadingState;if(a){d.contents=!0;return 0}else{d.contents=!1;return 0}}};Q(b("bs_caml_option").some(a),[b("bs_block").__(2,[b("bs_block").__(3,[e])])]);return d.contents}function Qb(a,c){return Q(b("bs_caml_option").some(a),[b("bs_block").__(1,[b("bs_block").__(2,[c])])])}function Rb(a,c,d,e){var f=[],g=function(g,h){h=g.orderedMessageLists.get(c);if(h==null)return 0;else{h=h.messageIDs;for(var i=d,j=d+e|0;i<=j;++i){var a=b("bs_belt_Option").flatMap(b("bs_belt_Array").get(h,i),function(a){return Sa(g,a)});a!==void 0&&f.push(b("bs_caml_option").valFromOption(a))}return 0}};Q(b("bs_caml_option").some(a),[b("bs_block").__(2,[b("bs_block").__(3,[g])])]);return f}var Sb={contents:void 0};function Tb(a,c,d,e,f,g,h){var i=function(j,i){Sb.contents=[c,d,e];var k=j.orderedMessageLists.get(c);k=k==null?[[],void 0]:[k.messageIDs,k.messageLoadingState];var l=k[0];if(b("bs_js_dict").get(i.failedHistoryFetchThreads.contents,c)!==!0){var m=i.localTitanMessageCount;m=l.length-b("bs_belt_Option").getWithDefault(b("bs_caml_option").nullable_to_opt(m.get(c)),0)|0;m>0&&b("ChatReliabilityInstrumentation").logERROR("fetch made with message in flight");var aa=m-d|0;aa=e-aa|0;if(aa>0&&b("bs_caml_obj").caml_notequal(k[1],1)){k=b("MercuryServerRequests").getForFBID(a);var ba=b("bs_js_null_undefined").fromOption(b("bs_belt_Option").map(b("bs_belt_Option").flatMap(b("bs_belt_Array").get(l,m-1|0),function(a){return Sa(j,a)}),function(a){return a.timestamp})),ca=i.messageSubToken.contents;i.messageSubToken.contents=ca+1|0;i.messageCallbacks.contents[String(ca)]=[{threadID:c,offset:d,limit:e},f];if(b("bs_caml_obj").caml_equal([c,d,e],Sb.contents)){k.fetchThreadMessages(c,m,aa,ba,g,h);return 0}else return 0}else return b("bs_curry")._1(f,b("bs_belt_Array").keepMap(l,function(a){return Sa(j,a)}).slice(d,e))}else{Sb.contents=void 0;i.failedHistoryFetchThreads.contents[c]=!1;return 0}};return Q(b("bs_caml_option").some(a),[b("bs_block").__(2,[b("bs_block").__(3,[i])])])}function Ub(a,b,c,d,e,f,g){if(Pb(a,b))return 0;else return Tb(a,b,c,d,e,f,g)}function Vb(a){var c={contents:0},d=function(d,a){c.contents=b("bs_caml_primitive").caml_int_min(xb(d,a),b("MercuryThreadlistConstants").MAX_UNSEEN_COUNT);return 0};Q(b("bs_caml_option").some(a),[b("bs_block").__(2,[b("bs_block").__(3,[d])])]);return c.contents}function Wb(a){var c={contents:0},d=function(b,a){c.contents=xb(b,a);return 0};Q(b("bs_caml_option").some(a),[b("bs_block").__(2,[b("bs_block").__(3,[d])])]);return c.contents}function Xb(a){var c={contents:0},d=function(d,a){c.contents=b("bs_caml_primitive").caml_int_min(wb(d,a,!0),b("MercuryThreadlistConstants").MAX_UNSEEN_COUNT);return 0};Q(b("bs_caml_option").some(a),[b("bs_block").__(2,[b("bs_block").__(3,[d])])]);return c.contents}function Yb(a){return Q(b("bs_caml_option").some(a),[b("bs_block").__(1,[1])])}function Zb(a,c){var d={contents:null},e=function(a,e){e=b("bs_js_dict").get(a.unreadCounts,c);d.contents=e!==void 0?b("bs_belt_Array").keepMap(b("JSSet.bs").values(b("bs_caml_option").valFromOption(e)),function(c){return b("bs_caml_option").nullable_to_opt(k(a,c))}).filter(function(a){return!b("MercuryThreadInfo").isMuted(a)}).length:null;return 0};Q(b("bs_caml_option").some(a),[b("bs_block").__(2,[b("bs_block").__(3,[e])])]);return d.contents}function $b(a){var c={contents:[]},d=function(a,d){c.contents=b("bs_belt_Map").keysToArray(a.threads);return 0};Q(b("bs_caml_option").some(a),[b("bs_block").__(2,[b("bs_block").__(3,[d])])]);return c.contents}F={make:S};G=S;f.fbid=c;f.deliveryReceipts=d;f.readReceiptsPerThread=e;f.ignoredIds=l;f.blockedIds=m;f.pendingFolderUnseenCount=aa;f.typing=ba;f.pendingReadStatusThreads=ca;f.messages=da;f.localIDsMap=n;f.messagesWithUploadsInFlight=o;f.threadlistOrderMap=p;f.pinnedThreads=q;f.montage=ea;f.orderedMessageLists=fa;f.unreadCounts=ga;f.initialUnreadCounts=r;f.unseenTimestamp=ha;f.threads=a;f.thread=k;f.send=Q;f.compute=U;f.getThreadMetaNow=Bb;f.getMultiThreadMeta=Cb;f.getThreadMeta=Db;f.createNewLocalThread=Eb;f.createNewLocalThreadGenerateID=Fb;f.createNewLocalGroupGeneralThreadGenerateID=Gb;f.isEmptyLocalThread=W;f.isNewEmptyLocalThread=X;f.getPinnedThreadlist=Hb;f.unsubscribeThread=Y;f.sendJS=Kb;f.invalidateSearchedMessages=Qb;f.hasLoadedNMessages=$;f.hasLoadedAllMessages=Pb;f.getCurrentlyLoadedMessages=Z;f.getServerMessageID=Mb;f.getMessagesFromIDs=Nb;f.getMessageFromID=Ob;f.getThreadMessagesRange=Tb;f.getThreadMessagesRangeNow=Rb;f.fetchMoreMessages=Ub;f.processPollStickerVoted=Jb;f.getUnseenUnreadCount=Vb;f.getUnseenUnreadCountRaw=Wb;f.getUnseenCount=Xb;f.getThreadIDs_debug=$b;f.getUnreadThreadCount=Zb;f.markAsSeen=Yb;f.processJSActions=Lb;f.Provider=F;f.jsComponent=G;f.useHook=T}),null);
__d("MessengerState.re",["bs_curry","MessengerState.bs"],(function(a,b,c,d,e,f){c=(a=b("MessengerState.bs")).fbid;f.fbid=c;d=a.deliveryReceipts;f.deliveryReceipts=d;e=a.readReceiptsPerThread;f.readReceiptsPerThread=e;c=a.ignoredIds;f.ignoredIds=c;d=a.blockedIds;f.blockedIds=d;e=a.pendingFolderUnseenCount;f.pendingFolderUnseenCount=e;c=a.typing;f.typing=c;d=a.pendingReadStatusThreads;f.pendingReadStatusThreads=d;e=a.messages;f.messages=e;c=a.localIDsMap;f.localIDsMap=c;d=a.messagesWithUploadsInFlight;f.messagesWithUploadsInFlight=d;e=a.threadlistOrderMap;f.threadlistOrderMap=e;c=a.pinnedThreads;f.pinnedThreads=c;d=a.montage;f.montage=d;e=a.orderedMessageLists;f.orderedMessageLists=e;c=a.unreadCounts;f.unreadCounts=c;d=a.initialUnreadCounts;f.initialUnreadCounts=d;e=a.unseenTimestamp;f.unseenTimestamp=e;c=a.threads;f.threads=c;d=function(a,c){a=b("bs_curry")._2(b("MessengerState.bs").thread,a,c);return a};f.thread=d;e=function(a,c){a=b("bs_curry")._2(b("MessengerState.bs").compute,a,c);return a};f.compute=e;c=function(a,c){a=b("bs_curry")._2(b("MessengerState.bs").getThreadMetaNow,a,c);return a};f.getThreadMetaNow=c;d=function(a,c,d,e){a=b("bs_curry")._4(b("MessengerState.bs").getMultiThreadMeta,a,c,d,e);return a};f.getMultiThreadMeta=d;e=function(a,c,d,e){a=b("bs_curry")._4(b("MessengerState.bs").getThreadMeta,a,c,d,e);return a};f.getThreadMeta=e;c=function(a,c){a=b("bs_curry")._2(b("MessengerState.bs").isEmptyLocalThread,a,c);return a};f.isEmptyLocalThread=c;d=a.getPinnedThreadlist;f.getPinnedThreadlist=d;e=function(a,c){a=b("bs_curry")._2(b("MessengerState.bs").unsubscribeThread,a,c);return a};f.unsubscribeThread=e;c=function(a,c,d){a=b("bs_curry")._3(b("MessengerState.bs").hasLoadedNMessages,a,c,d);return a};f.hasLoadedNMessages=c;d=function(a,c){a=b("bs_curry")._2(b("MessengerState.bs").getCurrentlyLoadedMessages,a,c);return a};f.getCurrentlyLoadedMessages=d;e=function(a,c){a=b("bs_curry")._2(b("MessengerState.bs").getServerMessageID,a,c);return a};f.getServerMessageID=e;c=function(a,c){a=b("bs_curry")._2(b("MessengerState.bs").getMessagesFromIDs,a,c);return a};f.getMessagesFromIDs=c;d=function(a,c){a=b("bs_curry")._2(b("MessengerState.bs").getMessageFromID,a,c);return a};f.getMessageFromID=d;e=function(a,c,d,e,f,g,h){a=b("bs_curry")._7(b("MessengerState.bs").getThreadMessagesRange,a,c,d,e,f,g,h);return a};f.getThreadMessagesRange=e;c=function(a,c,d,e){a=b("bs_curry")._4(b("MessengerState.bs").getThreadMessagesRangeNow,a,c,d,e);return a};f.getThreadMessagesRangeNow=c;d=function(a,c,d,e,f,g,h){a=b("bs_curry")._7(b("MessengerState.bs").fetchMoreMessages,a,c,d,e,f,g,h);return a};f.fetchMoreMessages=d;e=a.getUnseenUnreadCount;f.getUnseenUnreadCount=e;c=a.getUnseenCount;f.getUnseenCount=c;d=a.getThreadIDs_debug;f.getThreadIDs_debug=d;e=function(a,c){a=b("bs_curry")._2(b("MessengerState.bs").getUnreadThreadCount,a,c);return a};f.getUnreadThreadCount=e;(function(a){return null});c=a.jsComponent;f.jsComponent=c;d=a.useHook;f.useHook=d}),null);
__d("MercuryDelayedDispatcher",["MercuryDispatcher","MercuryServerPayloadPreprocessor","MercuryServerRequests","MercurySingletonProvider","MercuryThreadIDMap"],(function(a,b,c,d,e,f){"use strict";a=function(){function a(a){var c=this;this.$1=a;this.$2=[];this.$3=b("MercuryThreadIDMap").getForFBID(this.$1);this.$4=b("MercuryDispatcher").getForFBID(this.$1);this.$5=b("MercuryServerRequests").getForFBID(this.$1);this.$6=b("MercuryServerPayloadPreprocessor").getForFBID(this.$1);this.$4.subscribe("model-update-completed",function(a,b){return c.$7()})}a.getForFBID=function(a){return g.getForFBID(a)};a.get=function(){return g.get()};var c=a.prototype;c.handleUpdateWaitForThread=function(a,b){var c=this,d=this.$3.getClientIDFromServerIDNow(b);if(d){this.$8(a);return}this.$3.getClientIDFromServerID(b,function(){return c.$2.push({thread_fbid:b,payload:a})});this.$5.ensureThreadIsFetched(b)};c.$7=function(){if(this.$2&&this.$2.length){var a=this.$2.shift(),b=a.thread_fbid;a=a.payload;this.handleUpdateWaitForThread(a,b)}};c.$8=function(a){a.from_client?this.$4.handleUpdate(a):this.$6.handleUpdate(a)};return a}();var g=new(b("MercurySingletonProvider"))(a);e.exports=a}),null);
__d("MercuryDispatcher",["invariant","ArbiterMixin","LogHistory","MercurySingletonProvider","MercuryThreadInformer","MessengerParticipants.bs","MessengerState.bs","gkx","isEmpty","mixin"],(function(a,b,c,d,e,f,g){"use strict";var h,i=b("LogHistory").getInstance("mercury_dispatcher");a=function(a){babelHelpers.inheritsLoose(c,a);c.getForFBID=function(a){return j.getForFBID(a)};c.get=function(){return j.get()};function c(b){var c;c=a.call(this)||this;c.$MercuryDispatcher1=b;return c}var d=c.prototype;d.handlePreprocessedUpdate=function(a){a.preprocessed=!0,this.handleUpdate(a)};d.handleUpdate=function(a){var c=this;this.$MercuryDispatcher2(a);!!a.from_client!==!!a.preprocessed||g(0,5757);delete a.preprocessed;(h||(h=b("isEmpty")))(a)||b("MercuryThreadInformer").getForFBID(this.$MercuryDispatcher1).synchronizeInforms(function(){a.payload_source==="server_invalidate_global_state"&&(c.inform("invalidate-global-state",{}),b("MessengerParticipants.bs").reset());if(a.payload_source==="server_invalidate_thread_state"){var d=a.threads&&a.threads.length>0&&a.threads[0]&&a.threads[0].thread_id;d&&c.inform("invalidate-thread-state",d)}a.threads&&Array.isArray(a.threads)&&a.threads.length>0&&b("gkx")("1443200")&&b("MessengerParticipants.bs").addPreloadedParticipants(a.threads[0]);b("MessengerParticipants.bs").addParticipants(a);b("MessengerState.bs").sendJS(c.$MercuryDispatcher1,b("MessengerState.bs").processJSActions(a));c.inform("update-threadlist",a);c.inform("update-messages",a);c.inform("model-update-completed",null)})};d.$MercuryDispatcher2=function(a){var b=a.payload_source;if(b==="client_change_read_status"||b==="client_mark_thread_seen")return;var c={from_client:a.from_client,messages:null};if(a.actions){a=a.actions.filter(function(a){return a.action_type==="ma-type:user-generated-message"||a.action_type==="ma-type:log-message"}).map(function(a){return{action_type:a.action_type,other_user_fbid:a.other_user_fbid,thread_fbid:a.thread_fbid,message_id:a.message_id}});a.length&&(c.messages=a)}i.debug("update:"+b,JSON.stringify(c))};return c}(b("mixin")(b("ArbiterMixin")));var j=new(b("MercurySingletonProvider"))(a);e.exports=a}),null);
__d("MercurySendErrorLogger",["Banzai","BanzaiLogger"],(function(a,b,c,d,e,f){var g=b("BanzaiLogger").create({retry:!0}),h=b("Banzai").isEnabled("mercury_send_error_logging");a={log:function(a){if(!h)return;a={message_id:a.message_id,timestamp_client:Date.now(),error_type:a.error_data.type,error_code:a.error_data.code,error_description:a.error_data.description,is_transient:a.error_data.is_transient};g.log("MercurySendErrorLoggerConfig",a)}};e.exports=a}),null);
__d("MercuryServerPayloadPreprocessor",["invariant","ChatReliabilityInstrumentation","LogHistory","MercuryAttachment","MercuryDispatcher","MercuryIDs","MercurySendErrorLogger","MercurySingletonProvider","MercuryThreadIDMap","MessengerEnvironment","MessengerState.re","URI","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(){function a(a){this.$4=b("LogHistory").getInstance("MercuryServerPayloadPreprocessor"),this.$1=a,this.$2=b("MercuryThreadIDMap").getForFBID(this.$1),this.$3=b("MercuryDispatcher").getForFBID(this.$1)}a.getForFBID=function(a){return i.getForFBID(a)};a.get=function(){return i.get()};var c=a.prototype;c.handleUpdate=function(a){var c=this,e={};a.from_client&&g(0,2150);(a.threads||[]).forEach(function(a){c.$5(a,e);var b=c.$2.getServerIDFromClientIDNow(a.thread_id);d(["MercuryServerRequests"],function(d){d=d.getForFBID(c.$1);d.markThreadFetched(a.thread_id);b&&d.markThreadFetched(b);d.updateLastActionTimestamp(a.timestamp)})});a.pinned_thread_ids=(a.pinned_thread_ids||[]).map(function(a){return c.$2.getClientIDFromServerIDNow(a)});(a.ordered_threadlists||[]).forEach(function(a){var b=a.thread_fbids||[];b=b.concat(a.other_user_fbids||[]);a.thread_ids=b.map(function(a){return c.$2.getClientIDFromServerIDNow(a.toString())})});if(a.delivery_receipts){var f={};for(var h=a.delivery_receipts,i=Array.isArray(h),j=0,h=i?h:h[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var k;if(i){if(j>=h.length)break;k=h[j++]}else{j=h.next();if(j.done)break;k=j.value}k=k;var l=k.other_user_fbid?b("MercuryIDs").getThreadIDFromUserID(k.other_user_fbid):this.$2.getClientIDFromServerIDNow(k.thread_fbid);l&&(f[l]=k.time)}a.delivery_receipts=f}a.actions=a.actions||[];a.actions.forEach(function(f){f.action_type==="ma-type:send-message"&&f.status===10&&b("MercurySendErrorLogger").log(f);var h=null,i=null;f.other_user_fbid?(i=b("MercuryIDs").getThreadIDFromUserID(f.other_user_fbid),h=f.other_user_fbid):f.thread_fbid?(i=b("MercuryIDs").getThreadIDFromThreadFBID(f.thread_fbid),h=f.thread_fbid):f.thread_id?(i=b("MercuryIDs").getThreadIDFromThreadFBID(f.thread_id),h=f.thread_id):f.status&&f.status!=1&&f.client_thread_id?i=f.client_thread_id:g(0,2151,f.action_type,f.status);h=h&&h.toString();f.thread_id=c.$2.hasClientIDForServerID(h)?c.$2.getClientIDFromServerIDNow(h):i;f.action_type=="ma-type:send-message"&&f.client_thread_id&&h&&(f.thread_id=f.client_thread_id,c.$6("forceSetServerIDToClientID",h,f.client_thread_id)&&b("ChatReliabilityInstrumentation").logSET_THREAD_ID_MAP(h+":"+f.client_thread_id),c.$2.forceSetServerIDToClientID(h,f.client_thread_id),e[h]=f.client_thread_id);f.thread_id||g(0,2152,f.action_type);(!a.payload_source||!a.payload_source.startsWith("server"))&&d(["MercuryServerRequests"],function(a){a.getForFBID(c.$1).updateLastActionTimestamp(f.timestamp)})});this.$7(a);this.$8(a);if(a.end_of_history){l=[];for(var k=0;k<a.end_of_history.length;k++){j=a.end_of_history[k];j.type=="user"?l.push("user:"+j.fbid):j.type=="thread"&&this.$2.hasClientIDForServerID(j.fbid)&&l.push(this.$2.getClientIDFromServerIDNow(j.fbid))}a.end_of_history=l}if(a.roger){var m={};Object.keys(a.roger).forEach(function(d){var e=Object.keys(a.roger[d]),f;d?f=c.$2.getClientIDFromServerIDNow(d):e.length===1&&(f=b("MercuryIDs").getThreadIDFromUserID(e[0]));if(f){e=a.roger[d];m[f]={};for(var g in e)if(Object.prototype.hasOwnProperty.call(e,g)){d=b("MercuryIDs").getParticipantIDFromUserID(g);m[f][d]=e[g]}}});a.roger=m}a.newlyAddedClientIDs=e;a.preprocessed=!0;this.$3.handleUpdate(a)};c.$6=function(a,c,d){if(!b("gkx")("1199097"))return;var e=b("MessengerState.re").getThreadMetaNow(this.$1,d);if(e==null){this.$4.debug(a,c+":"+d);return!0}return!1};c.$5=function(a,c){var d=a.other_user_fbid?a.other_user_fbid:a.thread_fbid;d||g(0,2153);var e=this.$2.getClientIDFromServerIDNow(d);e||(e=a.other_user_fbid?b("MercuryIDs").getThreadIDFromUserID(a.other_user_fbid):b("MercuryIDs").getThreadIDFromThreadFBID(a.thread_fbid),this.$6("setServerIDToClientID",d,e),this.$2.setServerIDToClientID(d,e),this.$2.setDeprecatedServerIDToClientID(a.thread_id,e),c[d]=e);a.thread_id=e};c.$7=function(a){a.actions.forEach(function(a){a.action_type==="ma-type:user-generated-message"&&(a.attachments=a.attachments||[],a.attachments.forEach(function(a){if(b("MercuryAttachment").isShareAttachment(a)&&a.share&&b("MessengerEnvironment").messengerui){var c=new(h||(h=b("URI")))(a.share.uri);c.getDomain()||(a.share.uri=c.setDomain("facebook.com").setSubdomain((h||(h=b("URI"))).getRequestURI().getSubdomain()).setProtocol("https").toString())}}))})};c.$8=function(a){a.actions.forEach(function(a){if(a.action_type!=="ma-type:user-generated-message")return;a=a;if(!a.has_attachment||!a.attachments)return;for(var c=a.attachments.length-1;c>=0;c-=1){var d=a.attachments[c];if(!d.share||!d.share.style_list||d.share.style_list[0]!="genie_message")continue;d.share.target.genie_id&&(a.author=b("MercuryIDs").getParticipantIDFromUserID(d.share.target.genie_id));d.share.target&&!d.share.target.attachment&&(a.attachments.splice(c,1),a.has_attachment=a.attachments.length>0)}})};return a}();var i=new(b("MercurySingletonProvider"))(a);e.exports=a}),null);
__d("MercuryServerURIs",[],(function(a,b,c,d,e,f){"use strict";e.exports={THREAD_INFO:"/ajax/mercury/thread_info.php",MARK_FOLDER_READ:"/ajax/mercury/mark_folder_as_read.php",CHANGE_READ_STATUS:"/ajax/mercury/change_read_status.php",MARK_SEEN:"/ajax/mercury/mark_seen.php",THREADLIST_INFO:"/ajax/mercury/threadlist_info.php",MARK_SPAM:"/ajax/mercury/mark_spam.php",UNMARK_SPAM:"/ajax/mercury/unmark_spam.php",UNREAD_THREADS:"/ajax/mercury/unread_threads.php",CHANGE_PINNED_STATUS:"/ajax/mercury/change_pinned_status.php",CHANGE_ARCHIVED_STATUS:"/ajax/mercury/change_archived_status.php",CHANGE_PAGE_FOLLOW_UP_STATUS:"/ajax/mercury/change_page_follow_up_status.php",DELETE_THREAD:"/ajax/mercury/delete_thread.php",DELETE_MESSAGES:"/ajax/mercury/delete_messages.php",DELIVERY_RECEIPTS:"/ajax/mercury/delivery_receipts.php",MOVE_THREAD:"/ajax/mercury/move_thread.php",CHANGE_MUTE_THREAD:"/ajax/mercury/change_mute_thread.php"}}),null);
__d("MercuryServerDispatcher",["AsyncRequest","AsyncResponse","BanzaiLogger","Bootloader","ChatReliabilityInstrumentation","CurrentUser","FBIDCheck","LogHistory","MercuryServerURIs","MessagingTag","MessengerWebGraphQLTypedLogger","areJSONRepresentationsEqual","debounceAcrossTransitions","getByPath","performanceAbsoluteNow"],(function(a,b,c,d,e,f){"use strict";var g,h={},i=b("LogHistory").getInstance("mercury_server_dispatcher"),j=50,k=[],l=!1,m={IMMEDIATE:"immediate",IDEMPOTENT:"idempotent",BATCH_SUCCESSIVE:"batch-successive",BATCH_SUCCESSIVE_UNIQUE:"batch-successive-unique",BATCH_SUCCESSIVE_PIGGYBACK_ON_ERROR:"batch-successive-piggyback-retry",BATCH_DEFERRED_MULTI:"batch-deferred-multi",BATCH_CONDITIONAL:"batch-conditional",DEFAULT_ENDPOINT_ID:"mercuryServerDispatcherDefaultEndpointID",registerEndpoints:function(a){for(var c in a){var d=a[c],e=d.request_user_id||b("CurrentUser").getID(),f=d.endpoint_id||m.DEFAULT_ENDPOINT_ID;h[c]||(h[c]={});h[c][e]||(h[c][e]={});h[c][e][f]=new n(c,d)}},trySend:function(a,c,d,e,f){e=e||b("CurrentUser").getID(),f=f||m.DEFAULT_ENDPOINT_ID,h[a][e][f].trySend(c,d)},getRequestErrors:function(){return k}};function n(a,c){var d=c.mode||m.IMMEDIATE;switch(d){case m.IMMEDIATE:case m.IDEMPOTENT:case m.BATCH_SUCCESSIVE:case m.BATCH_SUCCESSIVE_UNIQUE:case m.BATCH_SUCCESSIVE_PIGGYBACK_ON_ERROR:case m.BATCH_DEFERRED_MULTI:case m.BATCH_CONDITIONAL:break;default:throw new Error("Invalid MercuryServerDispatcher mode "+d)}this._endpoint=a;this._mode=d;this._customHeader=c.customHeader;this._requestUserID=c.request_user_id;this._combineData=c.batch_function;this._combineDataIf=c.batch_if;this._batches=[];this._handler=c.handler;this._errorHandler=c.error_handler;this._transportErrorHandler=c.transport_error_handler||c.error_handler;this._connectionRetries=c.connection_retries||0;this._timeoutHandler=c.timeout_handler;this._timeout=c.timeout;this._serverDialogCancelHandler=c.server_dialog_cancel_handler||c.error_handler;this._deferredSend=b("debounceAcrossTransitions")(this._batchSend,0,this)}Object.assign(n.prototype,{_inFlight:0,_handler:null,_errorHandler:null,_transportErrorHandler:null,_timeoutHandler:null,_timeout:null,_serverDialogCancelHandler:null,_combineData:null,trySend:function(a,b){if(l)return;a===void 0&&(a=null);b=b||this._mode;if(b==m.IMMEDIATE)this._send(a);else if(b==m.IDEMPOTENT)this._inFlight||this._send(a);else if(b==m.BATCH_SUCCESSIVE||b==m.BATCH_SUCCESSIVE_UNIQUE)!this._inFlight?this._send(a):this._batchData(a);else if(b==m.BATCH_CONDITIONAL){var c=this._batches[0]&&this._batches[0].getData();this._inFlight&&(this._combineDataIf(this._pendingRequestData,a)||this._combineDataIf(c,a))?this._batchData(a):this._send(a)}else b==m.BATCH_DEFERRED_MULTI?(this._batchData(a),this._deferredSend()):b==m.BATCH_SUCCESSIVE_PIGGYBACK_ON_ERROR&&(this._batchData(a),this._inFlight||this._batchSend())},_send:function(a){var c=this;this._inFlight++;this._pendingRequestData=babelHelpers["extends"]({},a);this._requestUserID!=b("CurrentUser").getID()&&(a.request_user_id=this._requestUserID);i.log("send",JSON.stringify({endpoint:this._endpoint,inflight_count:this._inFlight}));var d=(g||(g=b("performanceAbsoluteNow")))(),e=new(b("AsyncRequest"))(this._endpoint).setData(a).setOption("retries",this._connectionRetries).setAllowCrossPageTransition(!0);this._customHeader&&e.setRequestHeader(this._customHeader.name,this._customHeader.value);if(this._endpoint===b("MercuryServerURIs").THREADLIST_INFO){b("Bootloader").loadModules(["MessengerGraphQLThreadlistFetcher.bs","MercuryJewelBootloadModules"],function(f,g){var h=a.request_user_id||b("CurrentUser").getID(),d=a.request_user_id&&!b("FBIDCheck").isUser_deprecated(a.request_user_id);g=(g={},g[b("MessagingTag").INBOX]="INBOX",g[b("MessagingTag").OTHER]="OTHER",g[b("MessagingTag").ACTION_ARCHIVED]="ARCHIVED",g[b("MessagingTag").SPAM]="SPAM",g[b("MessagingTag").PENDING]="PENDING",g[b("MessagingTag").PAGE_BACKGROUND]="PAGE_BACKGROUND",g);var i=[],j=Object.keys(g);for(var k=0;k<j.length;k++){var l=j[k];if(Object.prototype.hasOwnProperty.call(a,l)){var m=a[l];i.push({limit:m.before?m.limit+1:m.limit,folder:l,tags:m.filter?[g[l],m.filter]:[g[l]],timestamp:m.before,filter:m.filter,includeDeliveryReceipts:!0,includeSeqID:!1})}}l=function(){f.fetchAll(h,i,d,"fetch_threadlist").done(function(a){a=new(b("AsyncResponse"))(e,babelHelpers["extends"]({},a,{payload_source:"server_fetch_threadlist_info"}));c._handleResponse(a)},function(a){c._handleGraphQLError("threadlist_failure",i,a,e)})};l()},"MercuryServerDispatcher");return}if(this._endpoint===b("MercuryServerURIs").THREAD_INFO){var f,h=(f=b("getByPath"))(a,["threads","user_ids"],[]),j=f(a,["threads","thread_fbids"],[]),k=f(a,["messages","user_ids"],{}),l=f(a,["messages","thread_fbids"],{}),m=a.request_user_id&&!b("FBIDCheck").isUser_deprecated(a.request_user_id);b("Bootloader").loadModules(["MessengerGraphQLThreadFetcher.bs"],function(d){var f=a.request_user_id||b("CurrentUser").getID(),g=Object.keys(k),i=g.map(function(a){var b=k[a].limit,c=k[a].timestamp;return{id:a,limit:c?b+1:b,loadReadReceipts:!0,loadDeliveryReceipts:!0,timestamp:c,isCanonical:!0}}),n=new Set(g);h.forEach(function(a){if(n.has(a))return;i.push({id:a,limit:0,loadReadReceipts:!1,loadDeliveryReceipts:!1,timestamp:null,isCanonical:!0})});g=Object.keys(l);var o=g.map(function(a){var b=l[a].limit,c=l[a].timestamp;return{id:a,limit:c?b+1:b,loadReadReceipts:!0,loadDeliveryReceipts:!0,timestamp:c,isCanonical:!1}}),p=new Set(g);j.forEach(function(a){if(p.has(a))return;o.push({id:a,limit:0,loadReadReceipts:!1,loadDeliveryReceipts:!1,timestamp:null,isCanonical:!1})});var q=[].concat(i,o);q.forEach(function(a){a.limit>21&&b("ChatReliabilityInstrumentation").logFETCHING_MANY_MESSAGES(JSON.stringify(a))});d.fetchAll(f,q,m).done(function(a){a=a.slice(0);if(a.length>0){var d={};a.forEach(function(a){return Object.assign(d,a.roger)});var f=[];a.forEach(function(a){return f.push.apply(f,a.delivery_receipts)});var g=[];a.forEach(function(a){return g=g.concat(a.actions)});g=g.filter(Boolean);a={actions:g,threads:a.map(function(a){return a.thread}).filter(Boolean),end_of_history:a.map(function(a){return a.end_of_history}).filter(Boolean),roger:d,delivery_receipts:f,payload_source:"server_fetch_thread_info"};a=new(b("AsyncResponse"))(e,a);c._handleResponse(a)}else c._handleResponse(new(b("AsyncResponse"))(e,{}))},function(a){c._handleGraphQLError("thread_failure",q,a,e)})},"MercuryServerDispatcher");return}e.setHandler(function(a){b("BanzaiLogger").log("ChatPerfLoggerConfig",{event:"async_request",duration:(g||(g=b("performanceAbsoluteNow")))()-d,endpoint:c._endpoint}),c._handleResponse(a)}).setErrorHandler(this._handleError.bind(this)).setTransportErrorHandler(this._handleTransportError.bind(this)).setServerDialogCancelHandler(this._handleServerDialogCancel.bind(this));this._timeout&&this._timeoutHandler&&e.setTimeoutHandler(this._timeout,this._handleTimeout.bind(this));e.send()},_handleGraphQLError:function(a,c,d,e){var f=null,g=e.getData().retry_count;typeof d.toString==="function"&&(f=d.toString());if(typeof d.getRequest!=="function"){var h=d.errors&&d.errors[0];d=new(b("AsyncResponse"))(e,d);d.errorSummary=d.errors&&d.errors.map();d.errorDescription=h?h.message:null;f=h&&h.message?h.message:f;d.silentError=h&&h.is_silent;d.transientError=h&&h.is_transient}g||new(b("MessengerWebGraphQLTypedLogger"))().setErrorMessage(f).setEvent(a).setQueryParams(JSON.stringify(c)).log();this._handleError(d)},_batchData:function(a,c){if(this._mode==m.BATCH_SUCCESSIVE_UNIQUE&&this._pendingRequestData!==void 0&&b("areJSONRepresentationsEqual")(a,this._pendingRequestData))return;else{var d=this._batches.length-1;d>=0?c?this._batches[d].combineWithOlder(a,this._combineData):this._batches[d].combineWith(a,this._combineData):this._batches.push(new o(a));i.debug("batch",JSON.stringify({endpoint:this._endpoint}))}},_batchSend:function(){this._batches[0]&&(this._send(this._batches[0].getData()),this._batches.shift())},_handleResponse:function(a){this._inFlight--;i.log("response",JSON.stringify({endpoint:this._endpoint,inflight_count:this._inFlight}));var b=a.getPayload();l=b&&b.kill_chat;l&&i.log("killswitch_enabled",JSON.stringify({endpoint:this._endpoint,inflight_count:this._inFlight}));b&&b.error_payload?this._errorHandler&&this._errorHandler(a):this._handler&&this._handler(b,a.getRequest());(this._mode==m.BATCH_SUCCESSIVE||this._mode==m.BATCH_SUCCESSIVE_UNIQUE||this._mode==m.BATCH_SUCCESSIVE_PIGGYBACK_ON_ERROR||this._mode==m.BATCH_CONDITIONAL)&&this._batchSend();delete this._pendingRequestData},_createErrorRecord:function(a){return a instanceof b("AsyncResponse")?{endpoint:this._endpoint,user:this._requestUserID,time:Date.now(),code:a.getError(),description:a.getErrorDescriptionString(),summary:a.getErrorSummary(),isSilent:a.isSilent,isTransient:a.isTransient(),isBlockedAction:a.isBlockedAction(),isWarning:a.getErrorIsWarning(),payload:a.getPayload()}:{endpoint:this._endpoint,user:this._requestUserID,time:Date.now(),description:a.toString()}},_postErrorHandler:function(a){this._inFlight--;i.error("error",JSON.stringify({endpoint:this._endpoint,inflight_count:this._inFlight,error:a instanceof b("AsyncResponse")?a.getError()+" "+a.getErrorDescription():a instanceof Error?a.toString():"Unknown"}));k.push(this._createErrorRecord(a));k.length>j&&(k=k.slice(-1*j));a=this._mode;a==m.BATCH_SUCCESSIVE||a==m.BATCH_SUCCESSIVE_UNIQUE||a==m.BATCH_CONDITIONAL?this._batchSend():a==m.BATCH_SUCCESSIVE_PIGGYBACK_ON_ERROR&&(this._batches[0]?(this._batchData(this._pendingRequestData,!0),this._batchSend()):this._batchData(this._pendingRequestData,!0));delete this._pendingRequestData},_handleError:function(a){this._errorHandler&&this._errorHandler(a),this._postErrorHandler(a)},_handleTransportError:function(a){this._transportErrorHandler&&this._transportErrorHandler(a),this._postErrorHandler(a)},_handleTimeout:function(a){this._timeoutHandler&&this._timeoutHandler(a),this._postErrorHandler(new Error("Endpoint Timeout"))},_handleServerDialogCancel:function(a){this._serverDialogCancelHandler&&this._serverDialogCancelHandler(a),this._postErrorHandler(a)}});function o(a){this._data=a,this._size=1}Object.assign(o.prototype,{getData:function(){return this._data},getSize:function(){return this._size},combineWith:function(a,b){this._data=b(this._data,a),this._size++},combineWithOlder:function(a,b){this._data=b(a,this._data),this._size++}});e.exports=m}),null);
__d("MercuryServerSendMessageQueueOptions",[],(function(a,b,c,d,e,f){a=function(a,b,c,d,e,f){"use strict";this.success_handler=a,this.error_handler=b,this.transport_error_handler=c,this.timeout_handler=d,this.timeout=e,this.connection_retries=f};e.exports=a}),null);
__d("MercurySyncDeltaHolder",["MercurySingletonProvider"],(function(a,b,c,d,e,f){"use strict";a=function(){function a(){this.$2=new Map(),this.$3=[],this.$1=0}a.getForFBID=function(a){return g.getForFBID(a)};a.get=function(){return g.get()};var b=a.prototype;b.peek=function(){this.$3=this.$3.sort(function(a,b){return a-b});return this.$3[0]};b.getTop=function(){this.$3=this.$3.sort(function(a,b){return a-b});return this.$3.reverse()[0]};b.pop=function(){this.$3=this.$3.sort(function(a,b){return a-b});if(this.$3.length===0)return void 0;var a=this.$3.shift(),b=this.$2.get(a);this.$2["delete"](a);return{seqID:a,delta:b}};b.push=function(a,b){if(this.$2.has(a))return;this.$2.set(a,b);this.$3.push(a)};b.getLastSeqID=function(){return this.$1};b.updateLastSeqID=function(a){this.$1=a};b.updateLastSeqIDAndClearHistory=function(a){this.$2=new Map(),this.$3=[],this.$1=a};return a}();var g=new(b("MercurySingletonProvider"))(a);e.exports=a}),null);
__d("MercuryServerRequests",["errorCode","invariant","Promise","Arbiter","AsyncResponse","AvailableListConstants","BanzaiODS","Bootloader","ChannelConstants","ChatReliabilityInstrumentation","CurrentUser","Env","EventProfiler","LogHistory","MercuryAPIArgsSource","MercuryAssert","MercuryDispatcher","MercuryIDs","MercuryMessageClientState","MercuryMessageIDs.bs","MercurySendErrorLogger","MercuryServerDispatcher","MercuryServerPayloadPreprocessor","MercuryServerRequestsConfig","MercuryServerSendMessageQueueOptions","MercuryServerSendMessageQueueRouter","MercuryServerURIs","MercurySingletonProvider","MercurySyncDeltaHolder","MercuryTagHelper","MercuryThreadIDMap","MessagingConfig","MessagingTag","MessengerEnvironment","MessengerWebStgTypedLoggerLite","PresenceStatus","ScriptPath","XMercuryUnseenThreadIDsController","XMessagingChangeMentionsMuteModeController","XMessagingChangeReactionsMuteModeController","createObjectFrom","promiseDone","setTimeoutAcrossTransitions"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=b("MessengerWebStgTypedLoggerLite").log,k=b("LogHistory").getInstance("mercury_server"),l=b("MercuryAPIArgsSource").MERCURY,m=30*1e3,n=!0;function o(a){return a.getError()?"_"+a.getError():""}function p(a,c){var d=babelHelpers["extends"]({},a),e;if(c.threads){d.threads||(d.threads={});for(e in c.threads)d.threads[e]=Object.keys(b("createObjectFrom")((d.threads[e]||[]).concat(c.threads[e]||[])))}if(c.messages){d.messages||(d.messages={});for(e in c.messages){d.messages[e]||(d.messages[e]={});for(var f in c.messages[e])d.messages[e][f]?d.messages[e][f]=t(d.messages[e][f],c.messages[e][f]):d.messages[e][f]=c.messages[e][f]}}d.client=a.client||c.client;return d}function q(a,c){var d=Object.assign(b("createObjectFrom")(a.folders,!0),b("createObjectFrom")(c.folders,!0));a=a.client||c.client;return{folders:Object.keys(d),client:a}}function r(a,b){for(var c in b)if(a[c]&&typeof a[c]==="object")a[c]=t(a[c],b[c]);else if(b[c]&&typeof b[c]==="object"){var d={};Object.assign(d,b[c]);a[c]=d}return a}function s(a,b){return b}function t(a,b){var c=Math.max(a.limit,b.limit),d;!a.timestamp?d=b.timestamp:!b.timestamp?d=a.timestamp:d=Math.min(a.timestamp,b.timestamp);return{limit:c,timestamp:d}}function u(a,b){var c=a.client||b.client;c={ids:{},client:c};Object.assign(c.ids,a.ids,b.ids);return c}function v(a,c){var d={},e,f=a.client||c.client;delete a.client;delete c.client;for(e in a)Object.assign(d,b("createObjectFrom")(a[e],e));for(e in c)Object.assign(d,b("createObjectFrom")(c[e],e));a={client:f};for(var g in d)e=d[g],a[e]||(a[e]=[]),a[e].push(g);return a}function w(a,c){var d=a.client||c.client;a=b("createObjectFrom")(a.ids,!0);c=b("createObjectFrom")(c.ids,!0);a=Object.assign(a,c);return{ids:Object.keys(a),client:d}}a=function(){function a(a){var c=this;this.$1=a;this.$2=0;this.$3={};this.$4={};this.__threadIDMap=b("MercuryThreadIDMap").getForFBID(this.$1);this.$5=b("MercuryDispatcher").getForFBID(this.$1);this.$6=b("MercuryServerPayloadPreprocessor").getForFBID(this.$1);this.$7=new(b("MercuryServerSendMessageQueueOptions"))(function(a,b){c.__handleUpdate(a,b)},function(a){return c.$9(a)},function(a){c.$10(a)},function(a){return c.$11(a)},b("MercuryServerRequestsConfig").sendMessageTimeout,b("MessagingConfig").SEND_CONNECTION_RETRIES);this.$8=b("MercurySyncDeltaHolder").getForFBID(this.$1);this.$12()}a.getForFBID=function(a){return x.getForFBID(a)};a.get=function(){return x.get()};var c=a.prototype;c.fetchThreadlistInfo=function(a,c,d,e,f,g){d===void 0&&(d=b("MessagingTag").INBOX);f===void 0&&(f=l);n&&(n=!1,b("EventProfiler").tagCurrentActiveInteractionsAs("FirstMercuryThreadFetch"));var h=e?b("MercuryServerDispatcher").IMMEDIATE:null;f={client:f};f[d]={offset:a,limit:c,filter:e,before:g};this.__sendRequest(b("MercuryServerURIs").THREADLIST_INFO,f,h)};c.fetchUnseenThreadIDs=function(a,c){a===void 0&&b("MessagingTag").INBOX,c===void 0&&(c=l),this.__sendRequest(b("XMercuryUnseenThreadIDsController").getURIBuilder().getURI().toString(),{})};c.fetchUnreadThreadIDs=function(a,c){c===void 0&&(c=l),this.__sendRequest(b("MercuryServerURIs").UNREAD_THREADS,{folders:[a],client:c})};c.fetchThreadData=function(a,c){var d=this;c===void 0&&(c=l);b("MercuryAssert").allThreadID(a);var e={threads:{},client:c},f=[],g=[];a.forEach(function(a){if(d.$3[a])return;d.$3[a]=!0;var c=d.__threadIDMap.getServerIDFromClientIDNow(a);a=b("MercuryIDs").tokenize(a);if(a.type=="user")f.push(a.value),e.threads.user_ids=f;else if(a.type=="thread")c?g.push(c):g.push(a.value),e.threads.thread_fbids=g;else if(a.type=="root")c&&(g.push(c),e.threads.thread_fbids=g);else if(a.type!="pending")throw new Error("Unknown thread type",a)});e.threads.user_ids&&e.threads.user_ids.forEach(function(a){a||(k.error("empty user id",JSON.stringify(f)),b("ChatReliabilityInstrumentation").logERROR("Invalid user ID sent to thread_info.php: "+JSON.stringify(f)))});e.threads.thread_fbids&&e.threads.thread_fbids.forEach(function(c){c||b("ChatReliabilityInstrumentation").logERROR("Invalid FBID sent to thread_info.php: "+JSON.stringify(a))});for(var h in e.threads){this.__sendRequest(b("MercuryServerURIs").THREAD_INFO,e);break}};c.ensureThreadIsFetched=function(a,c){c===void 0&&(c=l);if(!this.__threadIDMap.getClientIDFromServerIDNow(a)&&!this.$3[a]){if(!a){b("ChatReliabilityInstrumentation").logERROR("Ensure invalid FBID sent to thread_info.php");k.error("attempting to fetch empty thread_fbid. Bad idea!");return}this.$3[a]=!0;this.__sendRequest(b("MercuryServerURIs").THREAD_INFO,{threads:{thread_fbids:[a]},client:c})}};c.fetchThreadMessages=function(a,c,d,e,f,g){var h=this;g===void 0&&(g=l);b("MercuryAssert").isThreadID(a);var i;c=b("MercuryIDs").tokenize(a);var j=this.__threadIDMap.getServerIDFromClientIDNow(a),k=!1;if(j)j=j,i=c.type=="user"?"user_ids":"thread_fbids";else{j=c.value;switch(c.type){case"user":i="user_ids";k=!0;break;case"thread":i="thread_fbids";break}}var m={messages:{},threads:{},client:g};i?(m.messages[i]={},m.messages[i][j]={timestamp:e,limit:d},k&&(m.threads[i]=[j]),this.__sendRequest(b("MercuryServerURIs").THREAD_INFO,m,f)):this.__threadIDMap.getServerIDFromClientID(a,function(a){m.messages.thread_fbids={},m.messages.thread_fbids[a]={timestamp:e,limit:d},h.__sendRequest(b("MercuryServerURIs").THREAD_INFO,m,f)})};c.handleThreadInfoError=function(a,c){var d=a.getData();c=[];if(d.messages){for(var e in d.messages.thread_fbids){a=this.__threadIDMap.getClientIDFromServerIDNow(e);a&&c.push(this.$13(a))}for(var f in d.messages.user_ids)c.push(this.$13("user:"+f));for(var g in d.messages.group_ids)c.push(this.$13("group:"+g))}c.length&&this.$5.handleUpdate({actions:c,from_client:!0,payload_source:"client_channel_message"});if(d.threads&&(d.threads.user_ids||d.threads.thread_fbids||d.threads.group_ids||d.threads.thread_ids)){a=5;c=!0;d.retry_count||(d.retry_count=0,d.messages&&delete d.messages);if(c){c=Math.pow(2,Math.min(d.retry_count,a))*1e3;b("setTimeoutAcrossTransitions")(function(){k.log("retry_thread","{}"),this.__sendRequest(b("MercuryServerURIs").THREAD_INFO,d)}.bind(this),c);d.retry_count++}}};c.markFolderAsRead=function(a){this.__sendRequest(b("MercuryServerURIs").MARK_FOLDER_READ,{folder:a});a=[{action_type:"mga-type:mark-all-read",folder:a}];this.$5.handleUpdate({global_actions:a,from_client:!0,payload_source:"client_change_read_status"})};c.changeThreadReadStatus=function(a,c,d,e,f,g){var h=this;b("MercuryAssert").isThreadID(a);this.__threadIDMap.getServerIDFromClientID(a,function(i){var j;j={ids:(j={},j[i]=c,j),source:d,watermarkTimestamp:e,shouldSendReadReceipt:f,commerce_last_message_type:g};k.log("initiate_change_read_status",JSON.stringify({thread_id:a,thread_fbid:i,mark_as_read:c,watermarkTimestamp:e}));h.__sendRequest(b("MercuryServerURIs").CHANGE_READ_STATUS,j)})};c.changeThreadArchivedStatus=function(a,c,d){var e=this;b("MercuryAssert").isThreadID(a);this.__threadIDMap.getServerIDFromClientID(a,function(a){var f={ids:{},source:d};f.ids[a]=c;e.__sendRequest(b("MercuryServerURIs").CHANGE_ARCHIVED_STATUS,f)})};c.changeThreadPinnedStatus=function(a,c,d){var e=this;b("MercuryAssert").isThreadID(a);this.__threadIDMap.getServerIDFromClientID(a,function(a){var f={ids:{},source:d};f.ids[a]=c;e.__sendRequest(b("MercuryServerURIs").CHANGE_PINNED_STATUS,f)})};c.changeThreadPageFollowUpStatus=function(a,c,d){var e=this;b("MercuryAssert").isThreadID(a);this.__threadIDMap.getServerIDFromClientID(a,function(a){var f={ids:{},source:d};f.ids[a]=c;e.__sendRequest(b("MercuryServerURIs").CHANGE_PAGE_FOLLOW_UP_STATUS,f)})};c.changeThreadFolder=function(a,c){var d=this;b("MercuryAssert").isThreadID(a);this.__threadIDMap.getServerIDFromClientID(a,function(a){var e={};e[c]=[a];d.__sendRequest(b("MercuryServerURIs").MOVE_THREAD,e)})};c.changeMutingOnThread=function(a,c){var d=this;b("MercuryAssert").isThreadID(a);this.__threadIDMap.getServerIDFromClientID(a,function(a){d.__sendRequest(b("MercuryServerURIs").CHANGE_MUTE_THREAD,{thread_fbid:a,mute_settings:c,payload_source:l})})};c.changeMentionsMutingOnThread=function(a,c){var d=this;b("MercuryAssert").isThreadID(a);this.__threadIDMap.getServerIDFromClientID(a,function(a){d.__sendRequest(b("XMessagingChangeMentionsMuteModeController").getURIBuilder().getURI(),{thread_fbid:a,mentions_mute_mode:c,payload_source:l})})};c.changeReactionsMutingOnThread=function(a,c){var d=this;b("MercuryAssert").isThreadID(a);this.__threadIDMap.getServerIDFromClientID(a,function(a){d.__sendRequest(b("XMessagingChangeReactionsMuteModeController").getURIBuilder().getURI(),{thread_fbid:a,reactions_mute_mode:c,payload_source:l})})};c.markThreadSpam=function(a,c){var d=this;b("MercuryAssert").isThreadID(a);this.__threadIDMap.getServerIDFromClientID(a,function(a){d.__sendRequest(b("MercuryServerURIs").MARK_SPAM,{id:a,source:c})})};c.unmarkThreadSpam=function(a,c){var d=this;b("MercuryAssert").isThreadID(a);this.__threadIDMap.getServerIDFromClientID(a,function(a){d.__sendRequest(b("MercuryServerURIs").UNMARK_SPAM,{id:a,source:c})})};c.deleteThread=function(a,b){this.deleteThreads([a],b)};c.deleteThreads=function(a,c){var d=this;b("promiseDone")(b("Promise").all(a.map(function(a){b("MercuryAssert").isThreadID(a);return new(b("Promise"))(function(b){return d.__threadIDMap.getServerIDFromClientID(a,b)})})).then(function(a){d.__sendRequest(b("MercuryServerURIs").DELETE_THREAD,{ids:a,source:c})}))};c.deleteMessages=function(a,c){b("MercuryMessageIDs.bs").getServerIDs(c||[],function(a){this.__sendRequest(b("MercuryServerURIs").DELETE_MESSAGES,{message_ids:a})}.bind(this))};c.sendDeliveryReceipts=function(a,c){b("MercuryMessageIDs.bs").getServerIDs(a||[],function(a){this.__sendRequest(b("MercuryServerURIs").DELIVERY_RECEIPTS,{message_ids:a,thread_ids:c})}.bind(this))};c.sendNewMessage=function(a,c){var d=this;c===void 0&&(c=l);a.offline_threading_id||b("BanzaiODS").bumpEntityKey(3303,"chat.web","missing_otid_on_send");if(a.client_state&&a.client_state!==b("MercuryMessageClientState").SEND_TO_SERVER)return;var e=b("MercuryIDs").tokenize(a.thread_id),f=e.type,g=babelHelpers["extends"]({},a);g.thread_id=null;f=="user"?(g.other_user_fbid=e.value,this.$14(g,c)):f=="thread"?(g.thread_fbid=e.value,this.$14(g,c)):f=="root"&&e.value==g.offline_threading_id?(g.client_thread_id=a.thread_id,this.$14(g,c)):(b("MercuryIDs").isLocalThread(a.thread_id)||h(0,5587,a.thread_id),this.__threadIDMap.getServerIDFromClientID(a.thread_id,function(a){g.thread_fbid=a,d.$14(g,c)}));this.$15("send_msg",a);b("Bootloader").loadModules(["QuickPerformanceLogger","MessengerWebQuickLogModule"],function(b,c){b.markerStart(c.SEND_MESSAGE,a.offline_threading_id)},"MercuryServerRequests")};c.$15=function(a,c){try{var d=(i||(i=b("Env"))).isCQuick?"Comet Inbox":b("MessengerEnvironment").messengerdotcom?"messenger_dot_com":b("MessengerEnvironment").facebookdotcom?"Facebook Messenger (other)":"Other",e=b("MercuryTagHelper").get(c.tags||[],"entrypoint"),f=b("MercuryIDs").getThreadFBIDFromThreadID(c.thread_id),g=b("PresenceStatus").get(f)===b("AvailableListConstants").ACTIVE;j({attachment_infos:void 0,client_timestamp:Date.now(),entry_point:e,event_name:a,first_attachment_type:void 0,"interface":d,mid:c.message_id,offline_threading_id:c.offline_threading_id,other_user_fbid:b("MercuryIDs").isGroupChat(c.thread_id)?void 0:f,thread_fbid:b("MercuryIDs").isGroupChat(c.thread_id)?f:void 0,extra_data:{pathName:b("ScriptPath").getScriptPath(),isActiveNow:g}})}catch(a){b("BanzaiODS").bumpEntityKey(3303,"chat.web","logging_error")}};c.$14=function(a,c){b("Arbiter").inform(b("ChannelConstants").ATTEMPT_RECONNECT),this.$4[a.message_id]=Date.now(),b("MercuryServerSendMessageQueueRouter").getForFBID(this.$1).enqueue(a.other_user_fbid||a.thread_fbid||a.client_thread_id,this.$7,c,a)};c.__getSendMessageQueueOptions=function(){return this.$7};c.markSeen=function(){var a=this.$2;this.__sendRequest(b("MercuryServerURIs").MARK_SEEN,{seen_timestamp:a})};c.$16=function(a,c,d,e){a=a.getData();a=a.message_batch||[a];k.debug("handle_send_message_error_common",JSON.stringify({reliability_error_status:d,request_error_status:c,error_data:e,message_list:a}));b("ChatReliabilityInstrumentation").logERROR("send_message_fail");var f=a.map(function(a){a={action_type:"ma-type:send-message",other_user_fbid:a.other_user_fbid,thread_fbid:a.thread_fbid,client_message_id:a.message_id,message_id:a.message_id,client_thread_id:a.client_thread_id,status:c,error_data:e};return a});f.forEach(function(a){a.action_type==="ma-type:send-message"&&a.status===10&&this.__logMercurySendError(a)},this);d={actions:f,payload_source:"client_handle_error"};b("Bootloader").loadModules(["QuickPerformanceLogger","MessengerWebQuickLogModule"],function(a,b){f.map(function(c){a.markerEnd(b.SEND_MESSAGE,"FAIL",c.client_message_id)})},"MercuryServerRequests");this.$6.handleUpdate(d)};c.handleSendMessageError=function(a){var c=a.getPayload(),d=null,e=null;c&&c.error_payload?(d=3,e="send_error"):(d=10,e="request_error"+o(a));c=a.error;c===1404102?b("AsyncResponse").verboseErrorHandler(a):(c===1545052||c===1409009||c===1409008||c===1409007||c===1409006||c===1545083||c===1545084)&&b("AsyncResponse").defaultErrorHandler(a);c=/<.*>/.test(a.getErrorDescription())?a.getErrorSummary():a.getErrorDescription();this.$16(a.getRequest(),d,e,{type:1,code:a.getError(),description:c,is_transient:a.isTransient()})};c.handleSendMessageTransportError=function(a){this.$16(a.getRequest(),10,"transport_error"+o(a),{type:2,code:a.getError(),is_transient:!0})};c.handleSendMessageTimeout=function(a){this.$16(a,10,"transport_timeout",{type:3,is_transient:!0})};c.getLastActionTimestamp=function(){return this.$2};c.__logMercurySendError=function(a){b("MercurySendErrorLogger").log(a)};c.updateLastActionTimestamp=function(a){var b=Date.now()-1e3*60*60*24;a&&a>b&&(this.$2=Math.max(this.$2,a))};c.markThreadFetched=function(a){delete this.$3[a]};c.$13=function(a){return{action_type:"ma-type:log-message",thread_id:a,message_id:a,timestamp:Date.now(),is_unread:!1,source:"source:unknown",log_message_body:"",log_message_type:"log:error-msg",log_message_data:{}}};c.__getForAsyncRequest=function(c){c=c.getData();c=c.request_user_id?c.request_user_id:b("CurrentUser").getID();return a.getForFBID(c)};c.__handleUpdate=function(a,c){a.payload_source==="server_send_message"&&b("Bootloader").loadModules(["QuickPerformanceLogger","MessengerWebQuickLogModule"],function(b,c){var d=a.actions&&a.actions[0]&&a.actions[0].client_message_id;d&&b.markerEnd(c.SEND_MESSAGE,"SUCCESS",d)},"MercuryServerRequests"),this.__getForAsyncRequest(c).$6.handleUpdate(a)};c.$17=function(a){var b=this.__getForAsyncRequest(a);b.handleThreadInfoError(a)};c.$18=function(a){var b=this.__getForAsyncRequest(a);b.handleThreadInfoError(a,!0)};c.$9=function(a){var b=this.__getForAsyncRequest(a.getRequest());b.handleSendMessageError(a)};c.$10=function(a){var b=this.__getForAsyncRequest(a.getRequest());b.handleSendMessageTransportError(a)};c.$11=function(a){var b=this.__getForAsyncRequest(a);b.handleSendMessageTimeout(a)};c.$12=function(){var a=this,c,d=null;b("MercuryServerRequestsConfig").msgrRegion&&(d={name:"X-MSGR-Region",value:b("MercuryServerRequestsConfig").msgrRegion});c=(c={},c[b("MercuryServerURIs").THREAD_INFO]={request_user_id:this.$1,mode:b("MercuryServerDispatcher").BATCH_DEFERRED_MULTI,customHeader:d,batch_function:p,handler:function(b,c){return a.__handleUpdate(b,c)},error_handler:function(b){return a.$17(b.getRequest())},timeout_handler:function(b){return a.$18(b)},timeout:m},c[b("MercuryServerURIs").MARK_FOLDER_READ]={request_user_id:this.$1,mode:b("MercuryServerDispatcher").IMMEDIATE,customHeader:d,handler:function(b,c){return a.__handleUpdate(b,c)}},c[b("MercuryServerURIs").CHANGE_READ_STATUS]={request_user_id:this.$1,mode:b("MercuryServerDispatcher").IMMEDIATE,customHeader:d,handler:function(b,c){a.__handleUpdate(b,c);c=(b.threads||[]).map(function(a){return a&&a.thread_id});k.log("response_change_read_status",JSON.stringify({threads:c}))}},c[b("MercuryServerURIs").MARK_SEEN]={request_user_id:this.$1,mode:b("MercuryServerDispatcher").BATCH_SUCCESSIVE,customHeader:d,batch_function:s,handler:function(b,c){return a.__handleUpdate(b,c)}},c[b("MercuryServerURIs").THREADLIST_INFO]={request_user_id:this.$1,mode:b("MercuryServerDispatcher").BATCH_SUCCESSIVE_UNIQUE,customHeader:d,batch_function:r,handler:function(b,c){return a.__handleUpdate(b,c)}},c[b("MercuryServerURIs").MARK_SPAM]={request_user_id:this.$1,mode:b("MercuryServerDispatcher").IMMEDIATE,customHeader:d,handler:function(b,c){return a.__handleUpdate(b,c)}},c[b("MercuryServerURIs").UNMARK_SPAM]={request_user_id:this.$1,mode:b("MercuryServerDispatcher").IMMEDIATE,customHeader:d,handler:function(b,c){return a.__handleUpdate(b,c)}},c[b("MercuryServerURIs").UNREAD_THREADS]={request_user_id:this.$1,mode:b("MercuryServerDispatcher").BATCH_SUCCESSIVE_UNIQUE,customHeader:d,batch_function:q,handler:function(b,c){return a.__handleUpdate(b,c)}},c[b("MercuryServerURIs").CHANGE_ARCHIVED_STATUS]={request_user_id:this.$1,mode:b("MercuryServerDispatcher").BATCH_SUCCESSIVE,customHeader:d,batch_function:u,handler:function(b,c){return a.__handleUpdate(b,c)}},c[b("MercuryServerURIs").CHANGE_PINNED_STATUS]={request_user_id:this.$1,mode:b("MercuryServerDispatcher").BATCH_SUCCESSIVE,customHeader:d,batch_function:u,handler:function(b,c){return a.__handleUpdate(b,c)}},c[b("MercuryServerURIs").CHANGE_PAGE_FOLLOW_UP_STATUS]={request_user_id:this.$1,mode:b("MercuryServerDispatcher").BATCH_SUCCESSIVE,customHeader:d,batch_function:u,handler:function(b,c){return a.__handleUpdate(b,c)}},c[b("MercuryServerURIs").DELETE_THREAD]={request_user_id:this.$1,mode:b("MercuryServerDispatcher").BATCH_SUCCESSIVE,customHeader:d,batch_function:w,handler:function(b,c){return a.__handleUpdate(b,c)}},c[b("MercuryServerURIs").DELETE_MESSAGES]={request_user_id:this.$1,mode:b("MercuryServerDispatcher").IMMEDIATE,customHeader:d,handler:function(b,c){return a.__handleUpdate(b,c)}},c[b("MercuryServerURIs").DELIVERY_RECEIPTS]={request_user_id:this.$1,mode:b("MercuryServerDispatcher").IMMEDIATE,customHeader:d,handler:function(b,c){return a.__handleUpdate(b,c)}},c[b("MercuryServerURIs").MOVE_THREAD]={request_user_id:this.$1,mode:b("MercuryServerDispatcher").BATCH_SUCCESSIVE,customHeader:d,batch_function:v,handler:function(b,c){return a.__handleUpdate(b,c)}},c[b("MercuryServerURIs").CHANGE_MUTE_THREAD]={request_user_id:this.$1,mode:b("MercuryServerDispatcher").IMMEDIATE,customHeader:d,handler:function(b,c){return a.__handleUpdate(b,c)}},c);var e=b("XMercuryUnseenThreadIDsController").getURIBuilder().getURI().toString();c[e]={request_user_id:this.$1,mode:b("MercuryServerDispatcher").IMMEDIATE,customHeader:d,handler:function(b,c){return a.__handleUpdate(b,c)}};e=b("XMessagingChangeMentionsMuteModeController").getURIBuilder().getURI().toString();c[e]={request_user_id:this.$1,mode:b("MercuryServerDispatcher").IMMEDIATE,customHeader:d,handler:function(b,c){return a.__handleUpdate(b,c)}};e=b("XMessagingChangeReactionsMuteModeController").getURIBuilder().getURI().toString();c[e]={request_user_id:this.$1,mode:b("MercuryServerDispatcher").IMMEDIATE,customHeader:d,handler:function(b,c){return a.__handleUpdate(b,c)}};b("MercuryServerDispatcher").registerEndpoints(c)};c.__sendRequest=function(a,c,d){if(this.$8)switch(a){case b("MercuryServerURIs").THREADLIST_INFO:case b("MercuryServerURIs").THREAD_INFO:c.cachius_min_seq_id=this.$8.getLastSeqID();break;default:break}b("MercuryServerDispatcher").trySend(a,c,d,this.$1)};c.__getFBID=function(){return this.$1};return a}();var x=new(b("MercurySingletonProvider"))(a);e.exports=a}),null);
__d("MercuryThreadIDMap",["KeyedCallbackManager","MercuryAssert","MercuryIDs","MercurySingletonProvider"],(function(a,b,c,d,e,f){"use strict";a=function(){function a(a){this.$1=a,this.$2=new(b("KeyedCallbackManager"))(),this.$3=new(b("KeyedCallbackManager"))()}a.getForFBID=function(a){return g.getForFBID(a)};a.get=function(){return g.get()};var c=a.prototype;c.setServerIDToClientID=function(a,b){var c=this.getClientIDFromServerIDNow(a);if(c)return;this.forceSetServerIDToClientID(a,b)};c.forceSetServerIDToClientID=function(a,b){this.$2.setResource(a,b),this.$3.setResource(b,a)};c.setDeprecatedServerIDToClientID=function(a,b){a&&this.$2.setResource(a,b)};c.getClientIDFromServerIDNow=function(a){return this.$2.getResource(a)};c.getClientIDFromServerID=function(a,b){var c=this;this.$2.executeOrEnqueue(a,b);d(["MercuryServerRequests"],function(b){b.getForFBID(c.$1).ensureThreadIsFetched(a)})};c.getServerIDFromClientIDNow=function(a){return this.$3.getResource(a)};c.getServerIDFromClientID=function(a,c){var e=this;b("MercuryAssert").isThreadID(a);var f=this.$3.executeOrEnqueue(a,c);d(["MercuryServerRequests"],function(c){var d=e.$3.getUnavailableResources(f),g=b("MercuryIDs").tokenize(a);d.length&&g.type!="root"&&c.getForFBID(e.$1).fetchThreadData(d)})};c.hasClientIDForServerID=function(a){return!!this.getClientIDFromServerIDNow(a)};c.convertThreadIDIfAvailable=function(a){var b=this.getClientIDFromServerIDNow(a);return b||a};c.canLinkExternally=function(a){b("MercuryAssert").isThreadID(a);var c=b("MercuryIDs").tokenize(a);return c.type=="user"||!!this.getServerIDFromClientIDNow(a)};c.reset=function(){this.$3.reset(),this.$2.reset()};return a}();var g=new(b("MercurySingletonProvider"))(a);e.exports=a}),null);
__d("MercuryLoggingHelper",[],(function(a,b,c,d,e,f){a={obfuscateThread:function(a){var b=babelHelpers["extends"]({},a);a&&a.snippet&&a.snippet.length>0&&(b.snippet="*** [redacted] ***");return b},obfuscateMessage:function(a){var b=babelHelpers["extends"]({},a);a&&a.body&&a.body.length>0&&(b.body="*** [redacted] ***");return b}};e.exports=a}),null);
__d("MercuryServerSendMessageQueueSimulatedError",["AsyncRequest","AsyncResponse"],(function(a,b,c,d,e,f){var g=9999;a={create:function(a){a=new(b("AsyncRequest"))(this.endpoint_uri).setData({message_batch:[a],client:this.client});var c=new(b("AsyncResponse"))(a,{});Object.assign(c,{error:g,silentError:!1,transientError:!0,request:a});return c}};e.exports=a}),null);
__d("MercuryServerSendMessageQueue",["fbt","BanzaiODS","ChatReliabilityInstrumentation","CurrentUser","LogHistory","MercuryIDs","MercuryLoggingHelper","MercuryServerDispatcher","MercuryServerRequestsConfig","MercuryServerSendMessageQueueSimulatedError","MercurySyncDeltaHandler","MessengerAttachmentTransformerForSend.bs","MessengerObjectAssociationType","MessengerState.bs","Run","XMessagingSendController"],(function(a,b,c,d,e,f,g){"use strict";var h=b("LogHistory").getInstance("mercury_server_send_message_queue");a=function(){function a(a,c,d,e){var f=this;this.pending_message=null;this.queue=[];this.$6=function(){return f.queue.length||f.pending_message?g._("You haven't sent your message yet. Do you want to leave without sending?"):void 0};this.sender_id=a;this.queue_id=c;this.$2=d.success_handler;this.$1=d.error_handler;this.$4=d.transport_error_handler;this.$3=d.timeout_handler;this.$5=b("MercurySyncDeltaHandler").getForFBID(this.sender_id);this.client=e;b("Run").onBeforeUnload(this.$6,!1);a=null;b("MercuryServerRequestsConfig").msgrRegion&&(a={name:"X-MSGR-Region",value:b("MercuryServerRequestsConfig").msgrRegion});c=this.__getSendURI();c=(e={},e[c]={request_user_id:this.sender_id,endpoint_id:this.queue_id,mode:b("MercuryServerDispatcher").IMMEDIATE,customHeader:a,handler:this.handleSuccess.bind(this),error_handler:this.handleError.bind(this),transport_error_handler:this.handleTransportError.bind(this),timeout:d.timeout,timeout_handler:this.handleTimeout.bind(this),connection_retries:d.connection_retries},e);b("MercuryServerDispatcher").registerEndpoints(c)}var c=a.prototype;c.__getSendURI=function(){return b("XMessagingSendController").getURIBuilder().getURI().toString()};c.__preparePayload=function(a){var c;c=(c=a)!=null?(c=c.replied_to_message)!=null?(c=c.message)!=null?c.message_id:c:c:c;var d=null,e=a.client_thread_id;if(b("MercuryIDs").isLocalThread(e)){e=b("MessengerState.bs").getThreadMetaNow(b("CurrentUser").getID(),e);if(e&&e.message_count===1&&e.object_association_type===b("MessengerObjectAssociationType").GENERAL_CHAT){d=(e=e)!=null?(e=e.associated_object)!=null?e.id:e:e}}e=c?b("MessengerState.bs").getServerMessageID(b("CurrentUser").getID(),c):null;return{client:this.client,action_type:a.action_type,app_id:a.app_id,audio_ids:a.audio_ids,body:a.body,client_thread_id:a.client_thread_id,ephemeral_ttl_mode:a.ephemeral_ttl_mode,file_ids:a.file_ids,gif_ids:a.gif_ids,has_attachment:a.has_attachment,image_ids:a.image_ids,location_attachment:a.location_attachment,lightweight_action_attachment:a.lightweight_action_attachment,log_message_data:a.log_message_data,log_message_type:a.log_message_type,message_id:a.message_id,message_source_data:a.message_source_data,montage_reply_data:a.montage_reply_data,offline_threading_id:a.offline_threading_id,other_user_fbid:a.other_user_fbid,photo_fbids:a.photo_fbids,shareable_attachment:a.shareable_attachment,signature_id:a.signatureID,source:a.source,specific_to_list:a.specific_to_list,sticker_id:a.sticker_id,tags:a.tags,thread_fbid:a.thread_fbid,timestamp:a.timestamp,ui_push_phase:a.ui_push_phase,video_ids:a.video_ids,platform_xmd:a.platform_xmd,profile_xmd:a.profile_xmd,replied_to_message_id:e,work_synced_group_id:d,to_list_md5:a.to_list_md5,mib_direct_message_data:a.mib_direct_message_data}};c.enqueue=function(a){this.queue.push(a),this.$7()};c.$7=function(){if(this.pending_message||!this.queue.length){this.pending_message&&this.$8();return}this.pending_message=this.queue.shift();var a=this.__preparePayload(this.pending_message);for(var c in a)(a[c]===void 0||a[c]===null)&&delete a[c];if(!a.action_type){var d=b("MercuryLoggingHelper").obfuscateMessage(a);b("ChatReliabilityInstrumentation").logERROR("missing action type before sending to send controller");h.debug("missing_action_type",JSON.stringify(d))}if(!a.message_id){d=b("MercuryLoggingHelper").obfuscateMessage(a);b("ChatReliabilityInstrumentation").logERROR("missing action type before sending to send controller"+JSON.stringify(d));h.debug("missing_message_id",JSON.stringify(d))}this.$9();b("MercuryServerDispatcher").trySend(this.__getSendURI(),a,null,this.sender_id,this.queue_id)};c.$10=function(){while(this.queue.length)this.$11(this.queue.shift())};c.$11=function(a){this.$1(b("MercuryServerSendMessageQueueSimulatedError").create(a)),h.error("mark_as_failed",JSON.stringify({fbid:this.sender_id,queue_id:this.queue_id,message:b("MercuryLoggingHelper").obfuscateMessage(a)}))};c.handleSuccess=function(a,c){var d=this;this.pending_message=null;var e=(a.actions||[]).map(function(a){var c=babelHelpers["extends"]({},a);if(a.graphql_payload&&a.graphql_payload.length>0){var e=b("MessengerAttachmentTransformerForSend.bs").transform(d.sender_id,a.graphql_payload,a.message_id,a.for_page);c=Object.assign(c,{attachments:e})}e=(e=a)!=null?(e=e.log_message_data)!=null?e.graphql_image:e:e;if(e){e=b("MessengerAttachmentTransformerForSend.bs").transform(d.sender_id,[e],a.message_id,a.for_page);c=Object.assign(c,{log_message_data:{image:e[0]}})}return c});a.actions=e;this.resumeAfterSuccess(a,c)};c.resumeAfterSuccess=function(a,b){this.$2(a,b),this.$12(),this.$7()};c.handleError=function(a){this.pending_message=null,this.$12(),this.$1(a),this.$10()};c.handleTransportError=function(a){this.pending_message=null,this.$12(),this.$4(a),this.$10()};c.handleTimeout=function(a){this.pending_message=null,this.$12(),this.$3(a),this.$10()};c.$9=function(){this.$5.pause()};c.$12=function(){this.$5.resume()};c.$8=function(){h.debug("maybe_send_next_pending_message",JSON.stringify({fbid:this.sender_id,queue_id:this.queue_id,pending_message:b("MercuryLoggingHelper").obfuscateMessage(this.pending_message),queue:this.queue.map(function(a){return b("MercuryLoggingHelper").obfuscateMessage(a)})}));var a="send_queue.delayed.queue_length."+this.queue.length.toString();b("BanzaiODS").bumpEntityKey(3303,"chat.web",a)};return a}();e.exports=a}),null);
__d("MercurySingletonMixin",["CurrentUser"],(function(a,b,c,d,e,f){a={_getInstances:function(){this._instances||(this._instances={});return this._instances},get:function(){return this.getForFBID(b("CurrentUser").getID())},getForFBID:function(a){var b=this._getInstances();b[a]||(b[a]=new this(a));return b[a]}};e.exports=a}),null);
__d("MercuryServerSendMessageQueueRouter",["BanzaiODS","LogHistory","MercuryServerSendMessageQueue","MercurySingletonMixin"],(function(a,b,c,d,e,f){var g=b("LogHistory").getInstance("mercury_server_send_message_queue_router"),h="chat.web.send_queue_router";b("BanzaiODS").setEntitySample(h,.1);a=function(){"use strict";function a(a){this.queues=new Map(),this.fbid=a}var c=a.prototype;c.enqueue=function(a,c,d,e){var f=this.queues.get(a);f===void 0&&(f=new(b("MercuryServerSendMessageQueue"))(this.fbid,a,c,d),this.queues.set(a,f),g.debug("added queue",JSON.stringify({fbid:this.fbid,queue_id:a})),b("BanzaiODS").bumpEntityKey(3303,h,"new_queue"));f.enqueue(e)};return a}();Object.assign(a,b("MercurySingletonMixin"));e.exports=a}),null);
__d("MercurySyncDataFetcherImpl",["invariant","Promise","AsyncResponse","Bootloader","CurrentUser","FBIDCheck","MercuryConfig","MercuryThreadlistConstants","MessagingConfig","QE2Logger","UserActivity","clearTimeout","setTimeoutAcrossTransitions"],(function(a,b,c,d,e,f,g){"use strict";var h=null,i=null,j=null,k={limit:b("MercuryThreadlistConstants").WEBMESSENGER_THREAD_COUNT+1,folder:"inbox",tags:["INBOX"],timestamp:null,filter:null,includeDeliveryReceipts:!1,includeSeqID:!0},l={};function a(a){return new(b("Promise"))(function(b,c){m(a,b,c,0)})}function m(a,c,d,e){if(!b("CurrentUser").isLoggedInNow()||e>b("MessagingConfig").syncFetchRetries){b("clearTimeout")(l[a]);d();return}var f=e===0?0:b("MessagingConfig").syncFetchInitialTimeoutMs*Math.pow(b("MessagingConfig").syncFetchTimeoutMultiplier,e);b("UserActivity").isOnTab()||(b("QE2Logger").logExposureForUser("mercury_dff_fetch_delay",a),f+=b("MercuryConfig").DFFD*Math.random());b("clearTimeout")(l[a]);l[a]=b("setTimeoutAcrossTransitions")(function(){var f=!1,n=function(h){if(f)return;if(h.errors&&h.errors.length>0){var k=h.errors[0].message;if(k){var l=function(){j&&i||g(0,3650),new j().setErrorMessage(k).setEvent(i.DFF_FAILURE).setQueryParams(a).log()};j&&i?l():b("Bootloader").loadModules(["MessengerWebGraphQLTypedLogger","MessengerWebGraphQLEvent"],function(a,b){j=a,i=b,l()},"MercurySyncDataFetcherImpl")}}f=!0;m(a,c,d,e+1)},o=function(){if(!b("CurrentUser").isLoggedInNow())return;h||g(0,3651);h.fetchAll(a,[k],!b("FBIDCheck").isUser_deprecated(a),"dff").then(function(d){f=!0,c(new(b("AsyncResponse"))(null,babelHelpers["extends"]({},d,{payload_source:"server_invalidate_global_state"}))),b("clearTimeout")(l[a])},n)};h?o():b("Bootloader").loadModules(["MessengerGraphQLThreadlistFetcher.bs"],function(a){h=a,o()},"MercurySyncDataFetcherImpl")},f)}function c(a,c,d){return new(b("Promise"))(function(b,e){n(a,c,d,b,e,0)})}function n(a,c,d,e,f,g){if(g>b("MessagingConfig").syncFetchRetries){f();return}var h=g===0?0:b("MessagingConfig").syncFetchInitialTimeoutMs*Math.pow(b("MessagingConfig").syncFetchTimeoutMultiplier,g);b("setTimeoutAcrossTransitions")(function(){var h=!1,i=function(b){if(h)return;h=!0;n(a,c,d,e,f,g+1)};b("Bootloader").loadModules(["MessengerThreadDFFFetcher.bs"],function(f){return f.fetch_(a,{id:c,limit:d},!b("FBIDCheck").isUser_deprecated(a)).then(function(a){h=!0,e(new(b("AsyncResponse"))(null,babelHelpers["extends"]({},a,{payload_source:"server_invalidate_thread_state"})))},i)},"MercurySyncDataFetcherImpl")},h)}function d(a,c,d){return new(b("Promise"))(function(b,e){o(a,c,d,b,e,0)})}function o(a,c,d,e,f,g){if(g>b("MessagingConfig").syncFetchRetries){f();return}var h=g===0?0:b("MessagingConfig").syncFetchInitialTimeoutMs*Math.pow(b("MessagingConfig").syncFetchTimeoutMultiplier,g);b("setTimeoutAcrossTransitions")(function(){var h=!1,i=function(b){if(h)return;h=!0;o(a,c,d,e,f,g+1)};b("Bootloader").loadModules(["MessengerMessageDFFFetcher.bs"],function(f){return f.fetch_(a,{thread_id:c,message_id:d},!b("FBIDCheck").isUser_deprecated(a)).then(function(a){h=!0,e(new(b("AsyncResponse"))(null,babelHelpers["extends"]({},a)))},i)},"MercurySyncDataFetcherImpl")},h)}e.exports={fetchThreadlistFromGraphQL:a,fetchThreadFromGraphQL:c,fetchMessageFromGraphQL:d}}),null);
__d("MercurySyncDataFetcher",["Promise","LogHistory","MercurySyncDataFetcherImpl","MessagingConfig","WebGraphQLConfig","clearTimeout","promiseDone","setTimeoutAcrossTransitions"],(function(a,b,c,d,e,f){"use strict";var g=b("LogHistory").getInstance("mercury_sync_data_fetcher");function a(){var a=0;for(var c=0;c<b("MessagingConfig").syncFetchRetries;c++){var d=c===0?0:b("MessagingConfig").syncFetchInitialTimeoutMs*Math.pow(b("MessagingConfig").syncFetchTimeoutMultiplier,c);a+=d+b("MessagingConfig").syncFetchRequestTimeoutMs}return a}var h=a();function c(a){var c=null;return new(b("Promise"))(function(d,e){var f=function(a){g.error("fetch_threadlist_graphql_timeout",JSON.stringify({timeout:h})),b("clearTimeout")(c),e(a)};c=b("setTimeoutAcrossTransitions")(f,Math.max(h,b("WebGraphQLConfig").timeout*b("MessagingConfig").syncFetchRetries));b("promiseDone")(b("MercurySyncDataFetcherImpl").fetchThreadlistFromGraphQL(a),function(a){b("clearTimeout")(c),d(a)},f)})}function d(a,c,d){return new(b("Promise"))(function(e,f){var i=function(a){g.error("fetch_thread_graphql_timeout",JSON.stringify({timeout:h})),f(a)},j=b("setTimeoutAcrossTransitions")(i,h);b("promiseDone")(b("MercurySyncDataFetcherImpl").fetchThreadFromGraphQL(a,c,d),function(a){b("clearTimeout")(j),e(a)},i)})}function f(a,c,d){return new(b("Promise"))(function(e,f){var i=function(a){g.error("fetch_message_graphql_timeout",JSON.stringify({timeout:h})),f(a)},j=b("setTimeoutAcrossTransitions")(i,h);b("promiseDone")(b("MercurySyncDataFetcherImpl").fetchMessageFromGraphQL(a,c,d),function(a){b("clearTimeout")(j),e(a)},i)})}e.exports={fetchThreadlistFromGraphQL:c,fetchThreadFromGraphQL:d,fetchMessageFromGraphQL:f,getMaxTimeoutMs:a}}),null);
__d("MercurySyncDFFDataFetcher",["Promise","CurrentUser","MercurySingletonProvider","MercurySyncDataFetcher","MercuryThreadIDMap","MessengerState.bs"],(function(a,b,c,d,e,f){"use strict";a=function(){function a(a){this.$1=a,this.__threadIDMap=b("MercuryThreadIDMap").getForFBID(this.$1)}a.getForFBID=function(a){return g.getForFBID(a)};a.get=function(){return g.get()};var c=a.prototype;c.fetchInvalidateGlobalStateForGraphQL=function(){return this.$1&&this.$1!=="0"&&b("CurrentUser").isLoggedIn()?b("MercurySyncDataFetcher").fetchThreadlistFromGraphQL(this.$1):new(b("Promise"))(function(a,b){return b(!0)})};c.fetchInvalidateThreadState=function(a,c){var d=11,e=3;a=a||c;c=this.__threadIDMap.getClientIDFromServerIDNow(a);if(!c)return b("Promise").resolve({getPayload:function(){return{}}});e=e+b("MessengerState.bs").getCurrentlyLoadedMessages(this.$1,c).length;return!a?b("Promise").resolve({getPayload:function(){return{}}}):b("MercurySyncDataFetcher").fetchThreadFromGraphQL(this.$1,a,Math.max(e,d))};c.fetchInvalidateMessage=function(a,c,d){a=a||c;return!a?b("Promise").resolve({getPayload:function(){return{}}}):b("MercurySyncDataFetcher").fetchMessageFromGraphQL(this.$1,a,d)};return a}();var g=new(b("MercurySingletonProvider"))(a);e.exports=a}),null);
__d("MercurySyncConstants",[],(function(a,b,c,d,e,f){"use strict";a=Object.freeze({ARBITER_EVENT_INVALID_STATE:"SYNC:INVALID_STATE",ARBITER_EVENT_INVALID_STATE_RETRY:"SYNC:INVALID_STATE_RETRY",ARBITER_EVENT_INVALID_STATE_RECOVER:"SYNC:INVALID_STATE_RECOVER",ARBITER_EVENT_INVALID_STATE_STALE:"SYNC:INVALID_STATE_STALE"});e.exports=a}),null);
__d("MercurySyncDeltaHandler",["invariant","Arbiter","Bootloader","ChatReliabilityInstrumentation","CurrentUser","LogHistory","MercuryDelayedDispatcher","MercuryServerPayloadPreprocessor","MercurySingletonProvider","MercurySyncConstants","MercurySyncDeltaHolder","MercurySyncDeltaTypes","MercurySyncEventsProxy","MercurySyncForcedFetchHandler","MercurySyncHolesTypedLogger","MercurySyncTopicType","MercuryThreadIDMap","MessengerDeltaTransformer.bs","gkx","onAfterLoadSafe","performanceAbsoluteNow","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h,i=b("LogHistory").getInstance("mercury_sync_delta_handler"),j="app_id:219994525426954";a=function(){a.getForFBID=function(a){return k.getForFBID(a)};a.get=function(){return k.get()};function a(a){var c=this;this.$1=a;this.$2=b("MercurySyncForcedFetchHandler").getForFBID(this.$1);this.__payloadPreprocessor=b("MercuryServerPayloadPreprocessor").getForFBID(this.$1);this.__delayedDispatcher=b("MercuryDelayedDispatcher").getForFBID(this.$1);this.$3=b("MercurySyncDeltaHolder").getForFBID(this.$1);this.$4=0;this.$11=b("MercuryThreadIDMap").getForFBID(this.$1);this.$5=[];this.$10=b("MercurySyncEventsProxy").getForFBID(this.$1);i.debug("constructor",JSON.stringify({fbid:this.$1}));b("Arbiter").subscribe(b("MercurySyncEventsProxy").Events.INIT,function(a,d){i.debug("initSeqID",JSON.stringify(d));a=d&&d.seqID;d=d&&d.fbid;if(!d)return;if(d!==c.$1)return;a?c.$3.updateLastSeqID(a):c.$3.updateLastSeqID(0);c.$12();b("gkx")("678667")&&b("onAfterLoadSafe")(function(){b("Bootloader").loadModules(["MessengerSyncSeqIDSanityCheck"],function(a){a.getForFBID(c.$1).init()},"MercurySyncDeltaHandler")})})}var c=a.prototype;c.$12=function(){var a=this;i.debug("setUpSubscriptionsToRealTimeUpdates",JSON.stringify({fbid:this.$1}));this.$6=b("Arbiter").subscribe(this.$10.getArbiterType(b("MercurySyncEventsProxy").Events.DELTA),function(c,d){c=d&&d.obj&&d.obj.queue;if(c&&c.toString()!==a.$1)return;c=d&&d.obj&&d.obj.delta;d=d&&d.obj&&d.obj.iseq;if(!c||!d)return;a.$13(d,b("MercurySyncTopicType").DELTA);a.$14(d,c);a.$3.push(d,c);a.$15()});this.$8=b("Arbiter").subscribe(this.$10.getArbiterType(b("MercurySyncEventsProxy").Events.FLOW_REJECT),function(b,c){b=c&&c.obj&&c.obj.queue;if(b&&b.toString()!==a.$1)return;a.$9&&a.$16()});this.$7=b("Arbiter").subscribe(this.$10.getArbiterType(b("MercurySyncEventsProxy").Events.FAKE_DFF),function(b,c){b=c&&c.obj&&c.obj.queue;if(b&&b.toString()!==a.$1)return;b=c&&c.obj&&c.obj.delta;if(!b)return;if(a.$17(b))if(a.$5.some(function(b){return a.$17(b)}))return;else a.$5.push(b);else a.$5.push(b);a.$15()});this.$9=!0};c.$17=function(a){return a["class"]===b("MercurySyncDeltaTypes").ForcedFetch&&!a.threadKey&&!a.messageId};c.$15=function(){if(this.$4>0)return;if(this.$5.length>0){var a=this.$5.shift();this.$18(this.$3.getLastSeqID(),a);this.$15()}a=this.$3.peek();if(!a)return;a=a-this.$3.getLastSeqID();if(a===1){var b=this.$3.pop();if(!b)return;var c=b.seqID;b=b.delta;this.$18(c,b);this.$15()}else a>1?this.$19():(this.$3.pop(),this.$15())};c.$18=function(a,c){c.numNoOps&&c.numNoOps>1?this.$3.updateLastSeqID(a+c.numNoOps-1):this.$3.updateLastSeqID(a),c["class"]===b("MercurySyncDeltaTypes").ForcedFetch?(i.debug("DFF",JSON.stringify(c)),c.threadKey!==void 0&&c.messageId===void 0?this.$20(a,c):c.threadKey!==void 0&&c.messageId!==void 0?this.$21(a,c):(b("ChatReliabilityInstrumentation").logDFF_DELTA_INIT(JSON.stringify(c)),this.$22(a))):b("MessengerDeltaTransformer.bs").transform(this.$1,c)};c.$19=function(){var a=JSON.stringify({$23:this.$3.getLastSeqID(),nextSeqID:this.$3.peek()});i.warn("hole",a);var c=this.$3.peek();!c&&g(0,5132);c=c-1;b("ChatReliabilityInstrumentation").logDFF_HOLE_INIT(a);this.$22(c)};c.$24=function(a,c,d,e){var f=this;this.$4&&g(0,5134);this.$4++;i.debug("_scheduleDataFetch:start",JSON.stringify({seqID:a}));b("promiseDone")(c(),function(b){i.debug("_scheduleDataFetch:success",JSON.stringify({seqID:a})),f.$4--,d(a,b),f.$15()},function(b){i.error("_scheduleDataFetch:failure",JSON.stringify({seqID:a})),f.$4--,e(a,b),f.$15()})};c.emergencyDFF=function(a,b){this.$22(0,a,b)};c.$22=function(a,c,d){var e=this;if(!b("CurrentUser").isLoggedInNow())return;this.$24(void 0,function(){return e.$2.processGlobalDFFForGraphQL()},function(a,d){b("gkx")("1199098")&&e.$11.reset();a=d.getPayload();e.__payloadPreprocessor.handleUpdate(a);a.sequence_id&&(i.debug("_initiateGlobalDFF:success",JSON.stringify({seqID:a.sequence_id})),b("gkx")("678668")?e.$3.updateLastSeqIDAndClearHistory(a.sequence_id):e.$3.updateLastSeqID(a.sequence_id));b("Arbiter").inform(b("MercurySyncConstants").ARBITER_EVENT_INVALID_STATE_RECOVER);c&&c(a.sequence_id)},function(f,g){i.error("_initiateGlobalDFF:failure",""),g?(e.$9&&e.$16(),d&&d()):(b("Arbiter").inform(b("MercurySyncConstants").ARBITER_EVENT_INVALID_STATE_RETRY),i.debug("_initiateGlobalDFF:retry",""),e.$22(a,c,d))})};c.$20=function(a,b){var c=this;this.$24(a,function(){return c.$2.processThreadDFF(a,b.threadKey,b.isLazy)},function(a,b){c.__payloadPreprocessor.handleUpdate(b.getPayload()),c.$3.updateLastSeqID(a)},function(){i.error("_initiateThreadDFF:failure",JSON.stringify(b));var d=babelHelpers["extends"]({},b);delete d.threadKey;c.$3.updateLastSeqID(a-1);c.$3.push(a,d)})};c.$21=function(a,b){var c=this;this.$24(a,function(){return c.$2.processMessageDFF(a,b.threadKey,b.messageId,b.isLazy)},function(a,b){b=b.getPayload();var d=b.other_user_fbid?b.other_user_fbid:b.thread_fbid;b=[babelHelpers["extends"]({},b)];var e="client_channel_message";c.__delayedDispatcher.handleUpdateWaitForThread({actions:b,payload_source:e},d);c.$3.updateLastSeqID(a)},function(){i.error("_initiateMessageDFF:failure",JSON.stringify(b));var d=babelHelpers["extends"]({},b);delete d.messageId;c.$3.updateLastSeqID(a-1);c.$3.push(a,d)})};c.$13=function(a,c){var d=a-this.$3.getLastSeqID();if(d!==1&&d!==0){if(!b("CurrentUser").isEmployee())return;new(b("MercurySyncHolesTypedLogger"))().setSeqID(a).setDifference(d).setTopicType(c).log()}};c.$14=function(a,c){switch(c["class"]){case b("MercurySyncDeltaTypes").NewMessage:var d=(h||(h=b("performanceAbsoluteNow")))();b("Bootloader").loadModules(["QuickPerformanceLogger","MessengerWebQuickLogModule"],function(a,b){var e=c.messageMetadata.tags;Array.isArray(e)&&e.includes(j)&&a.markerEnd(b.SEND_MESSAGE,"SUCCESS",c.messageMetadata.offlineThreadingId,d)},"MercurySyncDeltaHandler");i.debug("message_delta",JSON.stringify({seqID:a,threadKey:c.messageMetadata.threadKey,messageId:c.messageMetadata.messageId}));break;case b("MercurySyncDeltaTypes").ReadReceipt:i.debug("read_receipt_delta",JSON.stringify({seqID:a,threadKey:c.threadKey,actionTimestampMs:c.actionTimestampMs,watermarkTimestampMs:c.watermarkTimestampMs}));break;case b("MercurySyncDeltaTypes").DeliveryReceipt:i.debug("delivery_receipt_delta",JSON.stringify({seqID:a,deliveredWatermarkTimestampMs:c.deliveredWatermarkTimestampMs,messageIds:c.messageIds}));break}};c.pause=function(){this.$4++};c.resume=function(){this.$4--,this.$15()};c.$16=function(a){a===void 0&&(a=!1),this.$9=!1,b("Arbiter").unsubscribe(this.$6),b("Arbiter").unsubscribe(this.$7),b("Arbiter").unsubscribe(this.$8),a||b("Arbiter").inform(b("MercurySyncConstants").ARBITER_EVENT_INVALID_STATE)};return a}();var k=new(b("MercurySingletonProvider"))(a);e.exports=a}),null);
__d("MercurySyncForcedFetchHandler",["Promise","MercurySingletonProvider","MercurySyncDFFDataFetcher","MercuryThreadIDMap","MessengerState.bs"],(function(a,b,c,d,e,f){"use strict";function g(a){return{getPayload:function(){return{sequence_id:a}}}}a=function(){a.getForFBID=function(a){return h.getForFBID(a)};a.get=function(){return h.get()};function a(a){this.$1=a,this.$2=b("MercuryThreadIDMap").getForFBID(this.$1),this.$3=b("MercurySyncDFFDataFetcher").getForFBID(this.$1)}var c=a.prototype;c.processMessageDFF=function(a,c,d,e){if(e){e=c.otherUserFbId!==void 0?c.otherUserFbId.toString():c.threadFbId.toString();e=this.$2.getClientIDFromServerIDNow(e);if(e===void 0)return b("Promise").resolve(g(a));e=b("MessengerState.bs").getMessagesFromIDs(this.$1,[d]);if(e.length===0)return b("Promise").resolve(g(a))}return this.$3.fetchInvalidateMessage(c.otherUserFbId,c.threadFbId,d)};c.processThreadDFF=function(a,c,d){if(d){d=c.otherUserFbId!==void 0?c.otherUserFbId.toString():c.threadFbId.toString();d=this.$2.getClientIDFromServerIDNow(d);if(d===void 0)return b("Promise").resolve(g(a))}return this.$3.fetchInvalidateThreadState(c.otherUserFbId,c.threadFbId)};c.processGlobalDFFForGraphQL=function(){return this.$3.fetchInvalidateGlobalStateForGraphQL()};return a}();var h=new(b("MercurySingletonProvider"))(a);e.exports=a}),null);
__d("MontageDispatcher",["ExplicitRegistrationDispatcher"],(function(a,b,c,d,e,f){"use strict";a=function(a){babelHelpers.inheritsLoose(b,a);function b(){return a.apply(this,arguments)||this}return b}(b("ExplicitRegistrationDispatcher"));e.exports=new a({strict:!1})}),null);
__d("MontageActions",["Bootloader","CurrentUser","MercuryServerPayloadPreprocessor","MontageDispatcher","WebGraphQL","keyMirror","promiseDone","uniqueID"],(function(a,b,c,d,e,f){"use strict";var g=b("keyMirror")({REQUEST_UPDATE:null,HAS_UPDATED:null,HANDLE_ACTION:null}),h=new Set();a={Types:g,requestUpdate:function(a){b("MontageDispatcher").dispatch({type:g.REQUEST_UPDATE,threadFBID:a})},montageThreadChanged:function(a,c){b("MontageDispatcher").dispatch({type:g.REQUEST_UPDATE,threadFBID:a})},hasUpdated:function(a){b("MontageDispatcher").dispatch({type:g.HAS_UPDATED,threadFBID:a})},loadMontageThreadForActor:function(a){if(h.has(a))return;h.add(a);b("Bootloader").loadModules(["MessengerMontageThreadQueryWebGraphQLQuery"],function(c){c=b("WebGraphQL").exec(new c({id:a}));b("promiseDone")(c,function(c){b("MercuryServerPayloadPreprocessor").getForFBID(b("CurrentUser").getID()).handleUpdate({current_montage_thread:c}),h["delete"](a)})},"MontageActions")},deleteMontage:function(a,c){b("MercuryServerPayloadPreprocessor").getForFBID(b("CurrentUser").getID()).handleUpdate({montage_delete_message_delta:c})},handleNewMontageDelta:function(a,c){b("Bootloader").loadModules(["MessengerNewMontageMessageWebGraphQLQuery"],function(a){a=b("WebGraphQL").exec(new a({id:c.message_fbid}));b("promiseDone")(a,function(a){b("MercuryServerPayloadPreprocessor").getForFBID(b("CurrentUser").getID()).handleUpdate({montage_new_message_delta:a.montage_message})})},"MontageActions")},updatePollStickerChoice:function(a){b("Bootloader").loadModules(["MessengerState.bs","MessengerMontagePollVoteMutationWebGraphQLMutation"],function(c,d){b("MercuryServerPayloadPreprocessor").getForFBID(b("CurrentUser").getID()).handleUpdate({montage_poll_sticker_vote:[a]});c=b("WebGraphQL").exec(new d({input:{client_mutation_id:b("uniqueID")(),story_card_poll_id:a.pollID,option:a.optionVotedIndex,actor_id:b("CurrentUser").getID()}}));b("promiseDone")(c,function(a){},function(a){})},"MontageActions")}};e.exports=a}),null);
__d("RemovedMessageTombstoneContent",["fbt","CurrentUser","GenderConst","IntlVariations","MercuryIDs","MessengerParticipants.bs","MessengerState.bs","immutable"],(function(a,b,c,d,e,f,g){"use strict";a={getRemovedMessageTombstoneContent:function(a,c){var d;d=((d=a.unsender)==null?void 0:d.id)||a.author;var e=b("MercuryIDs").getUserIDFromParticipantID(d),f=b("CurrentUser").getID();if(e===f)return this._getFbtForCurrentViewerAuthor();f=b("MessengerState.bs").getThreadMetaNow(f,a.thread_id);f=f==null?void 0:(f=f.custom_nickname)==null?void 0:f[e];f=f||((e=c.get(d))==null?void 0:e.short_name)||((f=a.unsender)==null?void 0:f.short_name)||((e=a.unsender)==null?void 0:e.name);e=(a=c.get(d))==null?void 0:a.gender;if(f)return this._getFbtForOtherAuthor(f,e);else return this._getFbtForUnknownAuthor()},getTombstoneContentForSnippet:function(a){if(a==null)return this._getFbtForUnknownAuthor().toString();var c=b("MercuryIDs").getUserIDFromParticipantID(a);if(c===b("CurrentUser").getID())return this._getFbtForCurrentViewerAuthor().toString();c=b("MessengerParticipants.bs").getNow(a);a=c&&c.short_name;c=c&&c.gender;if(a)return this._getFbtForOtherAuthor(a,c).toString();else return this._getFbtForUnknownAuthor().toString()},_getFbtForCurrentViewerAuthor:function(){return g._("You removed a message")},_getFbtForOtherAuthor:function(a,c){return g._({"*":"{name} removed a message"},[g._param("name",a,[1,c===b("GenderConst").FEMALE_SINGULAR?b("IntlVariations").GENDER_FEMALE:b("IntlVariations").GENDER_MALE])])},_getFbtForUnknownAuthor:function(){return g._("A contact removed a message")}};e.exports=a}),null);
__d("LongpressHook.bs",["bs_curry","React","setTimeout","bs_caml_option","clearTimeout"],(function(a,b,c,d,e,f){"use strict";var g=b("React");function a(a,c,d){var e=g.useRef(void 0),f=g.useCallback(function(a){a=e.current;a!==void 0&&b("clearTimeout")(b("bs_caml_option").valFromOption(a));e.current=void 0;return 0},[e]),h=g.useCallback(function(a){a=b("setTimeout")(function(a){b("bs_curry")._1(f,0);return b("bs_curry")._1(c,0)},d);e.current=b("bs_caml_option").some(a);return 0},[e,f,c,d]),i=g.useCallback(function(c){c=e.current;if(c!==void 0){b("bs_curry")._1(f,0);return b("bs_curry")._1(a,0)}else return 0},[f,a]);g.useEffect(function(){return function(a){return b("bs_curry")._1(f,0)}},[f]);return[h,i,f]}f.useLongPress=a}),null);
__d("LongpressHook.re",["bs_curry","LongpressHook.bs"],(function(a,b,c,d,e,f){a=function(a){a=b("bs_curry")._3(b("LongpressHook.bs").useLongPress,a.onClick,a.onLongPress,a.ms);return a};f.useLongPress=a}),null);
__d("M4Icon.bs",["cssVar","CurrentUser"],(function(a,b,c,d,e,f,g){"use strict";c={};function a(a){if(b("CurrentUser").isWorkUser())if(typeof a==="number")switch(a){case 0:return"#FFFFFF";case 1:return"#BEC3C9";case 2:return"#8D949E"}else return"#373e4c";else if(typeof a==="number")switch(a){case 0:return"#FFFFFF";case 1:return"#bec2c9";case 2:return"#8D949E"}else return a[0]}d=0;e=1;f.Style=c;f.white=d;f.light=e;f.getColor=a}),null);
__d("M4IconSVG.bs",["React"],(function(a,b,c,d,e,f){"use strict";var g=b("React");function a(a){var b=a.size;a=a.children;b=b!==void 0?b:"16px";a=g.Children.toArray(a);return g.jsx("svg",{children:a,className:"svgIcon",height:b,width:b,version:"1.1",viewBox:"0 0 16 16",x:"0px",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",xmlSpace:"preserve",y:"0px"},"svg")}c=a;f.make=c}),null);
__d("M4IconSettings.bs",["React","M4IconSVG.bs"],(function(a,b,c,d,e,f){"use strict";var g=b("React");function a(a){var c=a.filled;a=a.color;c=c!==void 0?c:!0;a=a!==void 0?a:"blue";var d={fill:"none",stroke:a,strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:"10"};return g.jsx(b("M4IconSVG.bs").make,{children:c?g.jsx("path",{d:"M15.5,8.9V7.1l-2.2-0.5c-0.1-0.5-0.3-0.9-0.6-1.3l1.2-1.9l-1.2-1.2l-1.9,1.2C10.3,3,9.9,2.8,9.4,2.7L8.9,0.5 H7.1L6.6,2.7C6.1,2.8,5.7,3,5.2,3.2L3.3,2.1L2.1,3.3l1.2,1.9C3,5.7,2.8,6.1,2.7,6.6L0.5,7.1v1.7l2.2,0.5c0.1,0.5,0.3,0.9,0.6,1.3 l-1.2,1.9l1.2,1.2l1.9-1.2c0.4,0.2,0.9,0.4,1.3,0.6l0.5,2.2h1.7l0.5-2.2c0.5-0.1,0.9-0.3,1.3-0.6l1.9,1.2l1.2-1.2l-1.2-1.9 c0.2-0.4,0.4-0.9,0.6-1.3L15.5,8.9z M8,11c-1.7,0-3-1.3-3-3c0-1.7,1.3-3,3-3c1.7,0,3,1.3,3,3C11,9.7,9.7,11,8,11z",fill:a,stroke:a},"all"):g.jsxs("g",{children:[g.jsx("path",{style:d,d:"M15.5,8.9V7.1l-2.2-0.5c-0.1-0.5-0.3-0.9-0.6-1.3l1.2-1.9l-1.2-1.2l-1.9,1.2C10.3,3,9.9,2.8,9.4,2.7L8.9,0.5\n          \t\t\tH7.1L6.6,2.7C6.1,2.8,5.7,3,5.2,3.2L3.3,2.1L2.1,3.3l1.2,1.9C3,5.7,2.8,6.1,2.7,6.6L0.5,7.1v1.7l2.2,0.5c0.1,0.5,0.3,0.9,0.6,1.3\n          \t\t\tl-1.2,1.9l1.2,1.2l1.9-1.2c0.4,0.2,0.9,0.4,1.3,0.6l0.5,2.2h1.7l0.5-2.2c0.5-0.1,0.9-0.3,1.3-0.6l1.9,1.2l1.2-1.2l-1.2-1.9\n          \t\t\tc0.2-0.4,0.4-0.9,0.6-1.3L15.5,8.9z"},"outer"),g.jsx("circle",{style:d,cx:"8",cy:"8",r:"2.5"},"inner")]},"filled")})}c=a;d=a;f.make=c;f.jsComponent=d}),null);
__d("ChatTabMenuIcon.bs",["React","M4Icon.bs","M4IconSettings.bs"],(function(a,b,c,d,e,f){"use strict";var g=b("React");function a(a){a=a.iconStyle;a=b("M4Icon.bs").getColor(a);return g.createElement(b("M4IconSettings.bs").make,{filled:!0,color:a})}c=a;d=a;f.make=c;f.jsComponent=d}),null);
__d("M4IconCamcorder.bs",["React","M4IconSVG.bs"],(function(a,b,c,d,e,f){"use strict";var g=b("React");function a(a){var c=a.filled;a=a.color;c=c!==void 0?c:!0;a=a!==void 0?a:"blue";var d={fill:c?a:"none",stroke:a};return g.jsxs(b("M4IconSVG.bs").make,{children:[g.jsx("path",{style:d,d:"M9.5,13.5h-7c-1.1,0-2-0.9-2-2v-7c0-1.1,0.9-2,2-2h7c1.1,0,2,0.9,2,2v7C11.5,12.6,10.6,13.5,9.5,13.5z"},"body"),g.jsx("line",{stroke:c?"none":a,x1:"13.5",x2:"13.5",y1:"5",y2:"11"},"focus-ring"),g.jsx("path",{style:d,d:"M15,3.6l-3.5,3V8v1.4l3.5,3c0.2,0.2,0.5,0,0.5-0.3V8V3.9C15.5,3.6,15.2,3.4,15,3.6z"},"lens")]})}c=a;d=a;f.make=c;f.jsComponent=d}),null);
__d("M4IconPhone.bs",["React","M4IconSVG.bs"],(function(a,b,c,d,e,f){"use strict";var g=b("React");function a(a){var c=a.filled;a=a.color;c=c!==void 0?c:!0;a=a!==void 0?a:"blue";c={fill:c?a:"none",stroke:a};return g.jsx(b("M4IconSVG.bs").make,{children:g.jsx("path",{style:c,d:"M8.8,11.6c0.1,0,0.1,0.1,0.2,0.1c0.4,0.2,0.8,0.1,1-0.3c0.1-0.2,0.2-0.4,0.3-0.6c0.2-0.2,0.5-0.6,0.8-0.7 C11.5,10,11.8,10,12,10c0.4,0,0.9,0.4,1.6,0.8c0.7,0.4,1.2,0.8,1.5,1c0.2,0.2,0.3,0.4,0.3,0.6c0,0.4,0,1.2-0.7,1.9 c-1,1.1-2.5,1.6-4.3,1c-1.8-0.6-4.1-1.7-6-3.7s-3.1-4.2-3.7-6s-0.2-3.3,1-4.3c0.7-0.6,1.4-0.7,1.9-0.7c0.2,0,0.5,0.1,0.6,0.3 c0.2,0.3,0.6,0.8,1,1.5C5.7,3.1,6,3.6,6,4c0,0.3,0,0.6-0.1,0.8C5.8,5.1,5.5,5.4,5.2,5.6C5,5.8,4.8,5.9,4.7,6C4.3,6.1,4.1,6.6,4.3,7 c0,0.1,0.1,0.1,0.1,0.2C5.5,9,7,10.5,8.8,11.6z"},"all")})}c=a;d=a;f.make=c;f.jsComponent=d}),null);
__d("ChatVideoCallIcon.bs",["React","M4Icon.bs","M4IconPhone.bs","M4IconCamcorder.bs"],(function(a,b,c,d,e,f){"use strict";var g=b("React");function a(a){var c=a.isAudio;a=a.iconStyle;a=b("M4Icon.bs").getColor(a);if(c)return g.createElement(b("M4IconPhone.bs").make,{filled:!0,color:a});else return g.createElement(b("M4IconCamcorder.bs").make,{filled:!0,color:a})}c=a;d=a;f.make=c;f.jsComponent=d}),null);
__d("M4IconClose.bs",["React","M4IconSVG.bs"],(function(a,b,c,d,e,f){"use strict";var g=b("React");function a(a){a=a.color;a=a!==void 0?a:"blue";return g.createElement(b("M4IconSVG.bs").make,{children:g.jsx("g",{children:g.jsx("g",{children:g.jsxs("g",{children:[g.jsx("path",{d:"M5.833,778.833 L16.167,789.167"},"stroke1"),g.jsx("path",{d:"M16.167,778.833 L5.833,789.167"},"stroke2")],stroke:a,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5",transform:"translate(709.000000, 320.000000)"},"group"),transform:"translate(-712.000000, -1096.000000)"},"iconName"),fill:"none",fillRule:"evenodd",stroke:"none",strokeWidth:"1"},"close")})}c=a;f.make=c}),null);
__d("M4IconPhoto.bs",["React","M4IconSVG.bs"],(function(a,b,c,d,e,f){"use strict";var g=b("React");function a(a){var c=a.filled;a=a.color;c=c!==void 0?c:!0;a=a!==void 0?a:"blue";var d={fill:"none",stroke:a,strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:"10"};return g.jsxs(b("M4IconSVG.bs").make,{children:[c?g.jsxs("g",{children:[g.jsx("path",{d:"M1.3,13.1L2,1.7c0-0.1,0-0.2,0-0.4L1.2,1.4C0.5,1.5,0,2.4,0,3.4l0.6,10.9c0,0.5,0.2,0.9,0.4,1.3C1.4,15.8,1.7,16,1.9,16 c0,0,0.1,0,0.1,0l0.3,0C1.7,15.4,1.2,14.3,1.3,13.1z",fill:a},"bg"),g.jsx("path",{d:"M13,6.2c-0.2-0.2-0.6-0.3-0.8-0.1L9.4,8.5c-0.2,0.1-0.2,0.4,0,0.6L10,9.8c0.2,0.2,0.2,0.6-0.1,0.8c-0.1,0.1-0.2,0.1-0.4,0.1 c-0.2,0-0.3-0.1-0.4-0.2L7.3,8.3C7.1,8.1,6.7,8,6.5,8.2l-2.6,2l-0.4,3.1c0,0.5,0.2,1.6,0.7,1.7l8.8,0.6c0.2,0,0.5,0,0.7-0.2 c0.2-0.2,0.5-0.7,0.6-0.9l0.6-5.9L13,6.2z",fill:a},"hills"),g.jsx("path",{style:d,d:"M12.9,15.5l-8.2-0.7C4,14.7,3.4,14,3.4,13.2l1-11.4C4.5,1,5.2,0.5,6,0.5l8.2,0.7C15,1.3,15.5,2,15.5,2.8 l-1,11.4C14.4,15,13.7,15.6,12.9,15.5z"},"frame")]},"filled"):g.jsxs("g",{children:[g.jsx("path",{d:"M2.1,14.7c-0.1-0.1-0.2-0.3-0.2-0.5l0-0.1c-0.1-0.3-0.1-0.7-0.1-1.1l0-0.1L1,3.3c0-0.5,0.3-0.9,0.8-0.9l1-0.1l0.1-0.7\n              c0-0.1,0-0.2,0.1-0.4L1.7,1.4c-1,0.1-1.8,1-1.7,2l0.9,10.9c0,0.5,0.3,0.9,0.7,1.3C1.9,15.8,2.3,16,2.8,16c0.1,0,0.1,0,0.2,0l0.5,0\n              C2.8,15.7,2.4,15.2,2.1,14.7z",fill:a},"bg"),g.jsx("path",{style:d,d:"M12.9,15.5l-8.3-0.7c-0.8-0.1-1.4-0.8-1.3-1.6l1-11.4C4.3,1,5.1,0.4,5.8,0.5l8.3,0.7C15,1.3,15.5,2,15.5,2.8 l-1,11.4C14.4,15,13.7,15.6,12.9,15.5z"},"frame"),g.jsx("polyline",{style:d,points:"3.5,11 6.9,8.6 9.2,11.3 "},"left-hill"),g.jsx("polyline",{style:d,points:"14.6,9 12.5,6.5 8.3,10 "},"right-hill")]},"outline"),g.jsx("circle",{cx:"7.5",cy:"4.5",fill:a,r:"1.5"},"sun")]})}c=a;f.make=c}),null);
__d("M4IconPhoto.re",["M4IconPhoto.bs"],(function(a,b,c,d,e,f){(function(a){return null});a=b("M4IconPhoto.bs").make;f.make=a}),null);
__d("M4IconSend.bs",["React","M4IconSVG.bs"],(function(a,b,c,d,e,f){"use strict";var g=b("React");function a(a){var c=a.filled;a=a.color;c=c!==void 0?c:!0;a=a!==void 0?a:"blue";return g.jsx(b("M4IconSVG.bs").make,{children:c?g.jsx("path",{d:"M11,8.3L2.6,8.8C2.4,8.8,2.3,8.9,2.3,9l-1.2,4.1c-0.2,0.5,0,1.1,0.4,1.5C1.7,14.9,2,15,2.4,15c0.2,0,0.4,0,0.6-0.1l11.2-5.6 C14.8,9,15.1,8.4,15,7.8c-0.1-0.4-0.4-0.8-0.8-1L3,1.1C2.5,0.9,1.9,1,1.5,1.3C1,1.7,0.9,2.3,1.1,2.9L2.3,7c0,0.1,0.2,0.2,0.3,0.2 L11,7.7c0,0,0.3,0,0.3,0.3S11,8.3,11,8.3z",fill:a},"filled"):g.jsxs("g",{children:[g.jsx("path",{d:"M2.4,1.6l12,6c0.7,0.4,0.7,1.4,0,1.8l-12,6C1.7,15.8,0.8,15,1,14.2l1.7-5.4c0.1-0.2,0.1-0.4,0-0.6L1,2.8 C0.8,2,1.7,1.2,2.4,1.6z",fill:"none",stroke:a,strokeMiterlimit:"10"},"perimeter"),g.jsx("line",{fill:"none",stroke:a,strokeMiterlimit:"10",x1:"2.8",x2:"14.8",y1:"8.5",y2:"8.5"},"center-line")]},"outline")})}c=a;d=a;f.make=c;f.jsComponent=d}),null);
__d("WorkChatRedesignedMessageListCheck.bs",["gkx","CurrentUser","MessengerEnvironment"],(function(a,b,c,d,e,f){"use strict";a=b("gkx")("895574")&&b("CurrentUser").isWorkUser()&&b("MessengerEnvironment").messengerui;f.enabled=a}),null);
__d("WorkChatRedesignedMessageListCheck.re",["WorkChatRedesignedMessageListCheck.bs"],(function(a,b,c,d,e,f){a=b("WorkChatRedesignedMessageListCheck.bs").enabled;f.enabled=a}),null);
__d("messengerCustomColorUtils",["ChatConfig"],(function(a,b,c,d,e,f){"use strict";function a(a,c){c=c||{};b("ChatConfig").getBool("chat_tab_has_gradients")||(c.backgroundColor=a);return c}e.exports={customBubbleStyle:a}}),null);
__d("MessengerBotMenuDataFetcher",["AsyncRequest","Cache","MessengerBotComposerWebGraphQLQuery","XMessengerBotsMenuController"],(function(a,b,c,d,e,f){"use strict";a=function(){function a(){this.$1=new(b("Cache"))(),this.$2=new(b("Cache"))()}var c=a.prototype;c.setMenuItemsCache=function(a,b){this.$1.set(a,b)};c.getMenuItems=function(a,c,d){var e=this;if(this.$1.has(a)){c(this.$1.get(a));return}var f=b("XMessengerBotsMenuController").getURIBuilder().setString("page_id",a).getURI();new(b("AsyncRequest"))().setURI(f).setHandler(function(b){b=b.payload.menu;e.$1.set(a,b);c(b)}).setErrorHandler(function(a){d()}).send()};c.getHasPageSetting=function(a,c,d,e){var f=this;if(!this.$2.has(a)){var g=b("MessengerBotComposerWebGraphQLQuery").getURI({node_id:a});new(b("AsyncRequest"))().setURI(g).setHandler(function(b){b=b.payload.data.node;b=b&&b.commerce_page_settings||[];f.$2.set(a,b);c(b.indexOf(e)!==-1)}).setErrorHandler(function(b){f.$2.set(a,[]),d()}).setAllowCrossPageTransition(!0).send()}g=this.$2.get(a)||[];c(g.indexOf(e)!==-1);return g.indexOf(e)!==-1};return a}();e.exports=new a()}),null);
__d("MessengerTabsThreadSearchLoader",["Promise","Bootloader","nullthrows"],(function(a,b,c,d,e,f){"use strict";a={_store:null,_actions:null,_promise:null,getStoreEnforce:function(){b("nullthrows")(this._store,"Tab thread search store is not loaded");return this._store},getActionsEnforce:function(){b("nullthrows")(this._actions,"Tab thread search actions are not loaded");return this._actions},isLoaded:function(){return this._store&&this._actions},load:function(){var a=this;this._promise||(this._promise=new(b("Promise"))(function(c){b("Bootloader").loadModules(["MessengerThreadSearchActions","MessengerTabsThreadSearchStore"],function(b,d){a._store=d.get(),a._actions=b,c({store:d,actions:b})},"MessengerTabsThreadSearchLoader")}));return this._promise}};e.exports=a}),null);
__d("AutoFocusableLink.react",["Link.react","ReactDOM"],(function(a,b,c,d,e,f){"use strict";a=function(a){babelHelpers.inheritsLoose(c,a);function c(){return a.apply(this,arguments)||this}var d=c.prototype;d.componentDidMount=function(){this.props.autoFocus&&b("ReactDOM").findDOMNode(this).focus()};return c}(b("Link.react"));e.exports=a}),null);
__d("CustomColorHighlighting.react",["cssVar","csx","cx","React","UserAgent","guid","joinClasses","prop-types"],(function(a,b,c,d,e,f,g,h,i){"use strict";var j=b("React");a="._fy2";c="._43by";d="._mh6";f=b("UserAgent").isEngine("Gecko")?"._mh6 *::-moz-selection":"._mh6 ::selection";g=b("UserAgent").isEngine("Gecko")?"._43by *::-moz-selection":"._43by ::selection";var k=a+a,l=c+c,m=d+f,n=d+d,o=c+g,p="rgba(255, 255, 255, 0.3)";h=function(a){babelHelpers.inheritsLoose(c,a);function c(c){c=a.call(this,c)||this;c.state={id:"cch_"+b("guid")()};return c}var d=c.prototype;d.UNSAFE_componentWillMount=function(){this.$1()};d.componentWillUnmount=function(){this.$2(),this.state.styleTag&&document.head.removeChild(this.state.styleTag)};d.UNSAFE_componentWillReceiveProps=function(a){this.props.customColor&&!a.customColor?this.$2():a.customColor!==this.props.customColor&&this.$3(a.customColor)};d.render=function(){return j.jsx("span",{className:b("joinClasses")("_mh6",this.props.className),id:this.state.id,children:this.props.children})};d.$1=function(){var a=this,b=document.createElement("style");b.appendChild(document.createTextNode(""));document.head.appendChild(b);this.setState({styleSheet:b.sheet,styleTag:b},function(){return a.$3(a.props.customColor)})};d.$4=function(a,b,c){try{a.insertRule?a.insertRule(b+"{"+c+"}",0):a.addRule&&a.addRule(b,c,0)}catch(a){}};d.$5=function(a){"removeRule"in a?a.removeRule(0):"deleteRule"in a&&a.deleteRule(0)};d.$2=function(){if(this.state.styleSheet){if(this.state.styleSheet.rules)while(this.state.styleSheet.rules.length)this.$5(this.state.styleSheet);if(this.state.styleSheet.cssRules)while(this.state.styleSheet.cssRules.length)this.$5(this.state.styleSheet)}};d.$6=function(a){a=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a);var b=parseInt(a[1],16),c=parseInt(a[2],16);a=parseInt(a[3],16);return"rgba("+b+","+c+","+a+",0.2)"};d.$3=function(a){this.$2();a=a||this.props.customColor;if(a){var b=this.$6(a);b="background: "+b;this.$4(this.state.styleSheet,"#"+this.state.id+m,b);this.$4(this.state.styleSheet,"#"+this.state.id+" "+k,"color: "+a);this.$4(this.state.styleSheet,"#"+this.state.id+" "+l,"background-color: "+a);this.$4(this.state.styleSheet,"#"+this.state.id+n+" "+o,"background-color: "+p)}};return c}(j.PureComponent);h.propTypes={className:b("prop-types").string,customColor:b("prop-types").string};e.exports=h}),null);
__d("EmojiOnlyMessage.react",["cx","EmojiImageURL","EmojiLikeConstants","FBEmojiResource","FBEmojiUtils","Image.react","MessengerHotlikeEmoji.bs","React","prop-types"],(function(a,b,c,d,e,f,g){"use strict";var h=b("React");a=function(a){babelHelpers.inheritsLoose(c,a);function c(){return a.apply(this,arguments)||this}var d=c.prototype;d.render=function(){var a="_1ift _1ifu",c=0,d=this.props.contents.map(function(d){c++;var e=d.emojiKey;if(e){e=b("MessengerHotlikeEmoji.bs").isMessengerHotlike(e)?b("EmojiImageURL").getMessengerURL(e,b("EmojiLikeConstants").sizeMap.dp32):new(b("FBEmojiResource"))(b("FBEmojiUtils").resolveAliasFromKey(e)||e).getImageURL(b("EmojiLikeConstants").sizeMap.dp32);return h.jsx(b("Image.react"),{alt:d.text,className:a,src:e},c)}else return h.jsx("span",{children:d.text},c)});return h.jsx("div",{tabIndex:"0",children:d})};return c}(h.Component);a.propTypes={contents:(c=b("prop-types")).arrayOf(c.shape({emojiKey:c.string,text:c.string.isRequired})).isRequired};e.exports=a}),null);
__d("HotLikeSound",["MercurySoundsConfig","SoundPlayer","StickerConstants"],(function(a,b,c,d,e,f){"use strict";var g=[(a=b("MercurySoundsConfig")).hot_like_grow_mp3_url,a.hot_like_grow_ogg_url],h=[a.hot_like_pop_mp3_url,a.hot_like_pop_ogg_url],i=[a.hot_like_outgoing_small_mp3_url,a.hot_like_outgoing_small_ogg_url],j=[a.hot_like_outgoing_medium_mp3_url,a.hot_like_outgoing_medium_ogg_url],k=[a.hot_like_outgoing_large_mp3_url,a.hot_like_outgoing_large_ogg_url],l=function(){return!1};c={setCheckSoundEnabledFunc:function(a){l=a},start:function(){this._play(g)},stop:function(){b("SoundPlayer").stop(g)},pop:function(){this.stop(),this._play(h)},snap:function(a){this.stop(),a===b("StickerConstants").HOT_LIKE_SMALL_STICKER_ID&&this._play(i),a===b("StickerConstants").HOT_LIKE_MEDIUM_STICKER_ID&&this._play(j),a===b("StickerConstants").HOT_LIKE_LARGE_STICKER_ID&&this._play(k)},_play:function(a){l()&&b("SoundPlayer").play(a)}};e.exports=c}),null);
__d("MercuryAttachmentLayoutTypeHelper",[],(function(a,b,c,d,e,f){"use strict";a={isAdminType:function(a){var b;return(a==null?void 0:(b=a.xma_layout_info)==null?void 0:b.layout_type)==="ADMIN"||(a==null?void 0:(b=a.share)==null?void 0:(a=b.xma_layout_info)==null?void 0:a.layout_type)==="ADMIN"}};e.exports=a}),null);
__d("isMessengerMessageRemoved",[],(function(a,b,c,d,e,f){"use strict";function a(a){return a.removed_timestamp!==null&&a.removed_timestamp!==void 0&&a.removed_timestamp!==0||a.attachments!=null&&a.attachments.length>0&&!!a.attachments[0].share&&!!a.attachments[0].share.style_list&&a.attachments[0].share.style_list.length>0&&a.attachments[0].share.style_list[0]==="globally_deleted_message_placeholder"}e.exports=a}),null);
__d("MessageReplyPermissions",["MercuryAttachmentLayoutTypeHelper","MercuryConfig","MessagingTag","MessengerBotMenuDataFetcher","MNCommercePageSetting","RepliedToMessageStatusForGraphQL","emptyFunction","getPageIDFromThreadID","isMessengerMessageRemoved"],(function(a,b,c,d,e,f){"use strict";a={canReplyToMessage:function(a){var c=b("getPageIDFromThreadID")(a.thread_id);if(c!=null){c=b("MessengerBotMenuDataFetcher").getHasPageSetting(c,b("emptyFunction"),b("emptyFunction"),b("MNCommercePageSetting").COMPOSER_INPUT_DISABLED);if(c)return!1}if(a.folder===b("MessagingTag").PENDING||a.folder===b("MessagingTag").OTHER)return!1;return b("isMessengerMessageRemoved")(a)?!1:this.isRepliableMessage(a)||this._canRenderM3RedesignReply(a)},bubbleContainsRepliedToMessage:function(a,b){return!b&&this._canRenderM3RedesignReply(a)},isRepliableMessage:function(a){var c,d=a.log_message_type==="log:video-call"||a.log_message_type==="log:phone-call";if(d)return!1;d=a.attachments&&a.attachments.length>0?a.attachments[0]:null;if(b("MercuryAttachmentLayoutTypeHelper").isAdminType(d))return!1;if(d!==null&&((c=d.share)==null?void 0:c.style_list[0])==="rtc_call_log")return!1;c=d==null?void 0:d.attach_type;return!!a.body||c==="photo"||c==="video"||c==="sticker"||c==="third_party_sticker"||c==="animated_image"||a.attachments&&a.attachments.length>=1},_canRenderM3RedesignReply:function(a){if(!b("MercuryConfig").SM3BD)return!1;if(a.status!==b("RepliedToMessageStatusForGraphQL").VALID)return!0;a=a.message;var c=a.attachments&&a.attachments.length===1&&a.attachments[0].attach_type;return!!a.body||b("MercuryConfig").RTPE&&c==="photo"||b("MercuryConfig").RTVE&&c==="video"||b("MercuryConfig").RTSE&&(c==="sticker"||c==="third_party_sticker")||b("MercuryConfig").RTGE&&c==="animated_image"||b("MercuryConfig").RTOAE&&a.attachments&&a.attachments.length>=1}};e.exports=a}),null);
__d("MessageThreadAssociatedObjectUtils",[],(function(a,b,c,d,e,f){"use strict";a={shouldRender:function(a){return a&&a.room_type==="GROUP"&&!a.is_workplace_community},isLinkedToGroupChat:function(a){return a&&a.room_type==="GROUP"&&!a.is_workplace_community}};e.exports=a}),null);
__d("MessengerMentionSource",[],(function(a,b,c,d,e,f){"use strict";a=Object.freeze({REPLY:"reply",ATSIGN:"@",TYPEAHEAD:"typeahead"});e.exports=a}),null);
__d("MessengerSupportedEmojiUtils",["cx","EmojiImageURL","EmojiLikeConstants","EmojiRenderer","EmoticonEmojiList","FBEmojiAliases","FBEmojiResource","Image.react","MessengerEmojiTransitionMapping.bs","MessengerHotlikeEmoji.bs","MessengerSupportedEmoji","React","SupportedEmoji3","SupportedFacebookEmoji","Utf16","joinClasses"],(function(a,b,c,d,e,f,g){"use strict";var h=b("React"),i=/_fe0f/g,j=new RegExp("(\r\n|[ \r\n]|\\s)");a={getSupportedEmojiKey:function(a){if(!a)return null;var c=null,d=this.parse(a);if(d.length===1&&d[0].length===a.length){a=d[0].emoji.map(function(a){return b("Utf16").decode(a)});c=a.map(function(a){return a.toString(16)}).join("_").replace(i,"")}if(c){d=b("FBEmojiAliases")[c];d&&(c=d.replace(i,""))}return this.isSupportedEmojiKey(c)?c:null},isSupportedEmoji:function(a){return!!this.getSupportedEmojiKey(a)},isSupportedEmojiKey:function(a){if(!a)return!1;if(!b("MessengerHotlikeEmoji.bs").isMessengerHotlike(a)){var c=function(a){var c=b("FBEmojiAliases")[a];return c?c.replace(i,""):a}(a);return!!b("SupportedFacebookEmoji")[c]||!!b("SupportedEmoji3")[c]}return!!b("MessengerSupportedEmoji").emoji[a]},isMessengerSupportedEmojiKey:function(a){return!!(a&&b("MessengerSupportedEmoji").emoji[a])},getSupportedEmojiCodesArray:function(a){if(!a)return null;var c=this.parse(a);if(c.length===1&&c[0].length===a.length){a=c[0].emoji.map(function(a){return b("Utf16").decode(a)});c=a.map(function(a){return a.toString(16)}).join("_").replace(i,"");if(this.isSupportedEmojiKey(c))return a}return null},getEmojiKeyFromCodes:function(a){a=a.map(function(a){return a.toString(16)}).join("_").replace(i,"");var c=b("FBEmojiAliases")[a];return c?c.replace(i,""):a},getClassSizeMap:function(){var a,c=b("EmojiLikeConstants").size;return a={},a[c.XSMALL]="_2560",a[c.SMALL]="_1ifu",a[c.MEDIUM]="_19_r",a[c.LARGE]="_19_s",a},getEmojiMatchObj:function(a){a=this.parse(a,1);if(a.length!==1)return null;var c=a[0].emoji,d=a[0].emoji.map(function(a){return b("Utf16").decode(a)});b("MessengerEmojiTransitionMapping.bs").hasGender(d)&&!b("MessengerEmojiTransitionMapping.bs").getGender(d)&&(d=b("MessengerEmojiTransitionMapping.bs").makeFemale(d));d=d.map(function(a){return a.toString(16)}).join("_").replace(i,"");return{emoji_key:d,emoji_str:c.join(""),is_supported:this.isSupportedEmojiKey(d),offset:a[0].offset,length:a[0].length}},getNewEmojiData:function(a,c){if(!a)return null;a=this.getSupportedEmojiKey(a);if(!a)return null;var d=this.getClassSizeMap();c=this.transferSize(c);b("EmojiLikeConstants").sizeMap[c]||(c=b("EmojiLikeConstants").size.XSMALL);d=b("joinClasses")(d[c],"_1ift");c=b("EmojiLikeConstants").sizeMap[c];c=b("MessengerHotlikeEmoji.bs").isMessengerHotlike(a)?b("EmojiImageURL").getMessengerURL(a,c):new(b("FBEmojiResource"))(a).getImageURL(c);return c==null?null:{emoji:h.jsx(b("Image.react"),{className:d,src:c}),emoji_key:a,url:c}},getHotLikeEmojiDataTransition:function(a,c){if(!a)return null;a=this.getSupportedEmojiKey(a,!0);if(!a)return null;var d=this.getClassSizeMap();c=this.transferSize(c);var e=c===b("EmojiLikeConstants").size.MEDIUM?b("EmojiLikeConstants").size.LARGE:c;b("EmojiLikeConstants").sizeMap[c]||(c=b("EmojiLikeConstants").size.XSMALL);d=b("joinClasses")(d[c],"_1ift");c=b("EmojiLikeConstants").sizeMap[e];e=b("MessengerHotlikeEmoji.bs").isMessengerHotlike(a)?b("EmojiImageURL").getMessengerURL(a,c):new(b("FBEmojiResource"))(a).getImageURL(c);return e==null?null:{emoji:h.jsx(b("Image.react"),{className:d,src:e}),emoji_key:a,url:e}},getHotLikeEmojiData:function(a,c){if(!a)return null;a=this.getSupportedEmojiKey(a);if(!a)return null;var d=this.getClassSizeMap();c=this.transferSize(c);var e=c===b("EmojiLikeConstants").size.MEDIUM?b("EmojiLikeConstants").size.LARGE:c;b("EmojiLikeConstants").sizeMap[c]||(c=b("EmojiLikeConstants").size.XSMALL);d=b("joinClasses")(d[c],"_1ift");c=b("EmojiLikeConstants").sizeMap[e];e=b("MessengerHotlikeEmoji.bs").isMessengerHotlike(a)?b("EmojiImageURL").getMessengerURL(a,c):new(b("FBEmojiResource"))(a).getImageURL(c);return e==null?null:{emoji:h.jsx(b("Image.react"),{className:d,src:e}),emoji_key:a,url:e}},getEmojiOnlyContents:function(a){a=a||"";var c=[],d=function(a){var b=j.exec(a),d="";while(b&&b.length&&b.index===0)d+=b[0],a=a.replace(j,""),b=j.exec(a);d.length>0&&c.push({text:d});return a};while(!0){a=d(a);var e=b("EmoticonEmojiList").noncapturingRegexp.exec(a);if(e&&e.index===0){var f=b("EmoticonEmojiList").names[e[1]];f=b("EmoticonEmojiList").emote2emojis[f];c.push({emojiKey:f,text:e[1]});a=a.replace(e[1],"")}else break}while(a.length>0&&a.trim().length>0){a=d(a);f=this.getEmojiMatchObj(a);if(f&&f.is_supported)c.push({emojiKey:f.emoji_key,text:f.emoji_str}),a=a.replace(f.emoji_str,"");else return null}return c},getUrl:function(a,c){a=a.replace(i,"");c=this.transferSize(c);if(!b("MessengerHotlikeEmoji.bs").isMessengerHotlike(a)){var d=b("FBEmojiAliases")[a];d&&(a=d.replace(i,""));return!this.isSupportedEmojiKey(a)?null:new(b("FBEmojiResource"))(a).getImageURL(b("EmojiLikeConstants").sizeMap[c])}return!b("MessengerSupportedEmoji").emoji[a]?null:b("EmojiImageURL").getMessengerURL(a,b("EmojiLikeConstants").sizeMap[c])},containsEmoji:function(a){return this.parse(a,1).length===1},parse:function(a,c){return b("EmojiRenderer").parse(a,c)},transferSize:function(a){return b("EmojiLikeConstants").sizeMapTransfer[a]||a}};e.exports=a}),null);
__d("messengerIterateEmoji",["MessengerSupportedEmoji","ifRequired"],(function(a,b,c,d,e,f){"use strict";function a(a,c,d,e){var f=String(a);while(f){a=b("ifRequired")("MessengerSupportedEmojiUtils",function(a){return a.getEmojiMatchObj(f)},function(){return b("MessengerSupportedEmoji").getEmojiMatchObj(f)});if(a){var g=a.offset+a.length,h=f.substr(0,a.is_supported?a.offset:g);d(h);a.is_supported&&c(a.emoji_str,a.emoji_key,e);h=f.substr(g);f=h}else break}d(f)}e.exports=a}),null);
__d("MessengerTextWithEmoticons.react",["cx","fbt","BaseTextWithDecoration.react","EmojiImageURL","EmoticonEmojiList","FBEmojiResource","FBEmojiUtils","Image.react","MessengerHotlikeEmoji.re","React","messengerIterateEmoji","messengerIterateEmoticons"],(function(a,b,c,d,e,f,g,h){"use strict";var i=b("React");function j(a,c,d,e,f){var g=e===!0?128:16;f=f!=null?f:!a&&!b("MessengerHotlikeEmoji.re").isMessengerHotlike(d)?new(b("FBEmojiResource"))(b("FBEmojiUtils").resolveAliasFromKey(d)||d).getImageURL(g):b("EmojiImageURL").getMessengerURL(d,g);a=e===!0?"_1ift _5m3a":"_1ift _2560";return i.jsx(b("Image.react"),{alt:c,className:a,src:f})}function k(a,c,d){var e=d===!0?128:16,f=b("EmoticonEmojiList").emote2emojis[c],g=f?b("MessengerHotlikeEmoji.re").isMessengerHotlike(f)?b("EmojiImageURL").getMessengerURL(f,e):new(b("FBEmojiResource"))(f).getImageURL(e):null;if(g!=null&&g!==""){f=String.fromCodePoint(parseInt(f,e));e=d===!0?"_1ift _5m3a":"_1ift _2560";return i.jsx(b("Image.react"),{alt:f,className:e,src:g})}d=h._("{emoticonName} emoticon",[h._param("emoticonName",c)]);return i.jsx("span",{"aria-label":d,children:a})}function l(a,b,c){return function(d,e,f){var g=function(c,d,a){e(b(c,d,a))};a(String(d),g,f,c)}}a=function(a){babelHelpers.inheritsLoose(c,a);function c(){return a.apply(this,arguments)||this}var d=c.prototype;d.shouldComponentUpdate=function(a){return a.text!==this.props.text};d.render=function(){var a=[l(b("messengerIterateEmoji"),j.bind(null,!!this.props.forceMessengerEmoji),this.props.customSize),l(b("messengerIterateEmoticons"),k,this.props.customSize)];return i.jsx(b("BaseTextWithDecoration.react"),babelHelpers["extends"]({},this.props,{text:this.props.text,decorators:a}))};return c}(i.Component);a.renderEmoji=j;e.exports=a}),null);
__d("ReasonBootloadOnRender.react",["LoadOnRender.react","React","promiseDone"],(function(a,b,c,d,e,f){var g=b("React");a=function(a){"use strict";babelHelpers.inheritsLoose(c,a);function c(){var c,d;for(var e=arguments.length,f=new Array(e),g=0;g<e;g++)f[g]=arguments[g];return(c=d=a.call.apply(a,[this].concat(f))||this,d.$1=function(a){b("promiseDone")(d.props.loader.load(),a)},c)||babelHelpers.assertThisInitialized(d)}var d=c.prototype;d.render=function(){return g.jsx(b("LoadOnRender.react"),{placeholder:this.props.placeholder,loader:this.$1,component:this.props.component})};return c}(g.Component);e.exports=a}),null);
__d("ReasonResource",["Promise","JSResourceReference","promiseDone"],(function(a,b,c,d,e,f){"use strict";var g=function(c){babelHelpers.inheritsLoose(a,c);function a(){return c.apply(this,arguments)||this}var d=a.prototype;d.load=function(){var a=this;return new(b("Promise"))(function(c){b("promiseDone")(a.getFullComponent(),function(a){c(a.jsComponent)})})};d.getFullComponent=function(){return this.__reference.load()};d.setResourceReference=function(a){this.__reference=a;return this};return a}(b("JSResourceReference"));function a(a){return new g(a.getModuleId()).setResourceReference(a)}e.exports=a}),null);
__d("MercuryMessageObject",["BanzaiODS","MercuryIDs","MercuryLocalIDs","MercuryMessageClientState","MercurySendMessageFields","MercurySingletonProvider","MessengerObjectAssociationType","MessengerState.bs","RepliedToMessageStatusForGraphQL","SiteData","md5"],(function(a,b,c,d,e,f){a=function(){"use strict";a.getForFBID=function(a){return i.getForFBID(a)};a.get=function(){return i.get()};function a(a){this.$1=a}var c=a.prototype;c.constructHotLikeObject=function(a,c,d,e,f){c=g(this.$1,"ma-type:user-generated-message",c,d);d={body:a,has_attachment:!1,html_body:!1,attachments:[],specific_to_list:[],participants_to_hash:[],creator_info:void 0,tags:e||[],signatureID:f,ui_push_phase:b("SiteData").push_phase};return babelHelpers["extends"]({},c,d)};c.constructPhotoMessageObject=function(a,c,d,e,f){c=g(this.$1,"ma-type:user-generated-message",c,d,a);d={has_attachment:!1,html_body:!1,attachments:[],specific_to_list:[],participants_to_hash:[],creator_info:void 0,tags:e||[],signatureID:f,ui_push_phase:b("SiteData").push_phase};return babelHelpers["extends"]({},c,d)};c.constructTextMessageObject=function(a,c,d,e,f,h,i,j,k,l){h=g(this.$1,"ma-type:user-generated-message",h,i,d);i=f.params&&f.type;d=c.length>0;a={body:typeof a==="string"?a.replace(/^\s+/,"").replace(/\s+$/,""):"",has_attachment:i||d,raw_attachments:d?c:void 0,shareable_attachment:i?{share_params:f.params.get("data"),share_type:f.type}:void 0,profile_ranges:e,profile_xmd:e,verse_group_role_xmd:l,mib_direct_message_data:null,html_body:!1,attachments:[],specific_to_list:[],participants_to_hash:[],creator_info:void 0,tags:j||[],signatureID:k,ui_push_phase:b("SiteData").push_phase};return babelHelpers["extends"]({},h,a)};c.constructUserGeneratedMessageObject=function(a,b,c,d,e,f,h){b=g(this.$1,"ma-type:user-generated-message",b,c,h);c={body:typeof a==="string"?a.replace(/^\s+/,"").replace(/\s+$/,""):"",has_attachment:!1,html_body:!1,attachments:[],specific_to_list:d||[],participants_to_hash:[],creator_info:e,tags:f||[]};return babelHelpers["extends"]({},b,c)};c.constructStickerMessageObject=function(a,c,d,e,f,h){c=g(this.$1,"ma-type:user-generated-message",c,d,h);d={has_attachment:!0,html_body:!1,attachments:[],sticker_id:a,specific_to_list:[],participants_to_hash:[],tags:e||[],signatureID:f,ui_push_phase:b("SiteData").push_phase};return babelHelpers["extends"]({},c,d)};c.constructAttachmentMessageObject=function(a,b,c){a=g(this.$1,"ma-type:user-generated-message",a,b,c);b={attachments:[],specific_to_list:[],participants_to_hash:[]};return babelHelpers["extends"]({},a,b,{tags:[]})};c.constructLogMessageObject=function(a,b,c,d){a=g(this.$1,"ma-type:log-message",a,b);b={log_message_type:c,log_message_data:d,ephemeral_ttl_mode:d&&d.untypedData&&d.untypedData.ttl};return babelHelpers["extends"]({},a,b)};c.constructCTAConfirmationMessageObject=function(a,b,c,d,e,f){a=this.constructUserGeneratedMessageObject(a,b,c,null,null,e,null);b=d?{quick_replies:d,ignore_for_webhook:!1}:{ignore_for_webhook:!0};f&&(b.postback_data=JSON.stringify(f));return babelHelpers["extends"]({},a,{platform_xmd:JSON.stringify(b)})};c.normalizeNewMessage=function(a){a.status===void 0&&(a.status=0);a.offline_threading_id=a.offline_threading_id||b("MercuryLocalIDs").generateOfflineThreadingID(a.timestamp);a.offline_threading_id||b("BanzaiODS").bumpEntityKey(3303,"chat.web","invalid_otid_generated");a.message_id=a.message_id||a.offline_threading_id;var c=b("MercuryIDs").getParticipantIDFromUserID(this.$1);a.specific_to_list=a.specific_to_list||[];a.participants_to_hash=a.participants_to_hash||[];a.specific_to_list.length&&a.specific_to_list.indexOf(c)===-1&&a.specific_to_list.push(c);a.participants_to_hash.length&&a.participants_to_hash.indexOf(c)===-1&&a.participants_to_hash.push(c);var d=!1;if(!a.thread_id)a.thread_id="root:"+a.offline_threading_id;else{var e,f=b("MessengerState.bs").getThreadMetaNow(this.$1,a.thread_id);f&&f.ephemeral_ttl_mode!==null&&a.ephemeral_ttl_mode===void 0&&(a.ephemeral_ttl_mode=f.ephemeral_ttl_mode);((e=f)!=null?(e=e.associated_object)!=null?e.name:e:e)&&((e=f)!=null?e.object_association_type:e)===b("MessengerObjectAssociationType").GENERAL_CHAT&&(d=!0)}if(!d)if(a.specific_to_list.length==1)a.thread_id="user:"+this.$1;else if(a.specific_to_list.length==2){f=a.specific_to_list[0]==c?a.specific_to_list[1]:a.specific_to_list[0];a.thread_id=b("MercuryIDs").getThreadIDFromParticipantID(f)}if(!a.specific_to_list.length){e=b("MercuryIDs").tokenize(a.thread_id);d=e.type;f=e.value;d=="user"&&(a.specific_to_list=["fbid:"+f,c])}a.to_list_md5=this.sortAndHash(a.participants_to_hash);a[b("MercurySendMessageFields").MANUAL_RETRY_CNT]||(a[b("MercurySendMessageFields").MANUAL_RETRY_CNT]=0)};c.sortAndHash=function(a){if(!a||a.length===0)return null;a=a.map(function(a){return b("MercuryIDs").getUserIDFromParticipantID(a)});return a.some(function(a){return a==null})?null:b("md5")(a.sort(function(a,b){if(a==null||b==null)throw new Error("invalid participant id in to_list_md5 creation");if(a.length<b.length)return-1;return a.length>b.length?1:a.localeCompare(b)}).join(":"))};c.normalizeResendMessage=function(a){a.status=7,a.timestamp=Date.now(),a[b("MercurySendMessageFields").MANUAL_RETRY_CNT]+=1};c.normalizeAddAttachmentPlaceholder=function(a,c,d){d.preview_attachments.length>0&&(a.has_attachment=!0,a.preview_attachments=d.preview_attachments),a.client_state=b("MercuryMessageClientState").DO_NOT_SEND_TO_SERVER,a.status=7,a.upload_id=c};return a}();function g(a,c,d,e,f){var g=h(d)?["source:chat"]:[],i=Date.now();c={action_type:c,thread_id:e,author:b("MercuryIDs").getParticipantIDFromUserID(a),author_email:null,timestamp:i,is_unread:!1,is_filtered_content:!1,is_filtered_content_bh:!1,is_filtered_content_account:!1,is_filtered_content_quasar:!1,is_filtered_content_invalid_app:!1,is_spoof_warning:!1,source:d,source_tags:g,replied_to_message:f?{message:f,status:b("RepliedToMessageStatusForGraphQL").VALID}:void 0};return c}function h(a){switch(a){case"source:chat:web":case"source:chat:jabber":case"source:chat:iphone":case"source:chat:meebo":case"source:chat:orca":case"source:chat:test":case"source:chat":return!0;default:return!1}}var i=new(b("MercurySingletonProvider"))(a);e.exports=a}),null);
__d("MercuryMessageActions",["AsyncRequest","Bootloader","CurrentUser","MercuryDispatcher","MercuryMessageObject","MercuryServerRequests","MercurySingletonMixin","MessengerState.bs","WorkChatSavedMessagesOnHeaderMenuNux"],(function(a,b,c,d,e,f){"use strict";a=function(){function a(a){this.$1=a,this.$2=b("MercuryMessageObject").getForFBID(this.$1),this.__serverRequests=b("MercuryServerRequests").getForFBID(this.$1),this.__dispatcher=b("MercuryDispatcher").getForFBID(this.$1)}var c=a.prototype;c.send=function(a,b,c){this.$2.normalizeNewMessage(a),this.__dispatcher.handleUpdate(this.__constructClientSingleMessagePayload(babelHelpers["extends"]({},a),"client_send_message")),this.__serverRequests.sendNewMessage(a,c),b!=null&&b(a.thread_id)};c.resend=function(a,b){a=babelHelpers["extends"]({},a);this.$2.normalizeResendMessage(a);this.send(a,void 0,b)};c.addAttachmentPlaceholder=function(a,b,c){this.$2.normalizeAddAttachmentPlaceholder(a,b,c),this.$2.normalizeNewMessage(a),this.__dispatcher.handleUpdate(this.__constructClientSingleMessagePayload(babelHelpers["extends"]({},a),"client_send_message"))};c.cancelAttachmentPlaceholder=function(a,b){this.__dispatcher.handleUpdate(this.__constructClientSingleMessagePayload({upload_id:a,upload_data:b,action_type:"ma-type:cancel-attachment-placeholder"},"client_send_message"))};c.confirmAttachmentPlaceholder=function(a,b){this.__dispatcher.handleUpdate(this.__constructClientSingleMessagePayload({upload_id:a,upload_data:b,action_type:"ma-type:confirm-attachment-placeholder"},"client_send_message"))};c["delete"]=function(a,b,c){this.__dispatcher.handleUpdate(this.$3(a,b,"ma-type:delete-messages",c||"client_delete_messages"))};c.changeSaveStatus=function(a,c,d){var e=b("MessengerState.bs").getServerMessageID(b("CurrentUser").getID(),a.message_id);this.__dispatcher.handleUpdate(this.__constructClientSingleMessagePayload({thread_id:a.thread_id,messageId:e,tags_to_add:c?["message:save"]:[],tags_to_delete:c?[]:["message:save"],action_type:"ma-type:mutate_tags"},d||"client_update_saved_message_status"));b("Bootloader").loadModules(["XMessengerDotComSaveController","SavedStateActions","CollectionsDisplaySurface","CollectionCurationMechanisms","WorkChatSavedMessagesTypedLogger","SavedMessagesEvent","useWorkGalahadEventEmitter"],function(d,f,g,h,i,j,k){new(b("AsyncRequest"))().setURI(d.getURIBuilder().getURI()).setData({action:c?f.SAVE:f.UNSAVE,surface:g.MESSENGER_DOT_COM_MESSAGE,mechanism:h.RIGHT_CLICK,message_id:e}).setHandler(function(){if(c&&b("WorkChatSavedMessagesOnHeaderMenuNux").shouldShowNux){var d=k(["toggleNavHeaderMenu","showSavedMessageNux"]);d[0];d=d[1];d()}new i().setEvent(c?j.SAVE:j.UNSAVE).setThreadID(a.thread_id).setMessageID(e).log()}).send()},"MercuryMessageActions")};c.__constructClientSingleMessagePayload=function(a,b){return{actions:[a],from_client:!0,payload_source:b}};c.$3=function(a,b,c,d){return{actions:[{action_type:c,thread_id:a,message_ids:b}],from_client:!0,payload_source:d}};return a}();c=Object.assign(a,b("MercurySingletonMixin"),{_instances:{}});e.exports=c}),null);
__d("WorkChatBulkUpdatePinnedThreadsMutation",["ClientIDs","CurrentUser","MercuryIDs","RelayFBEnvironment","RelayModern","Timezone","TimezoneNamesData","WorkChatBulkUpdatePinnedThreadsMutation.graphql"],(function(a,b,c,d,e,f){"use strict";var g,h=b("ClientIDs").getNewClientID,i=b("RelayModern").commitMutation;b("RelayModern").graphql;b("Timezone").registerNamesModule(b("TimezoneNamesData"));var j=g!==void 0?g:g=b("WorkChatBulkUpdatePinnedThreadsMutation.graphql");function a(a){var c=a.threadIDs,d=a.source,e=a.onCompleted;a=a.onError;c=c.map(function(a){return{thread_fbid:b("MercuryIDs").getThreadFBIDFromThreadID(a),update_type:"MARK_PINNED"}});return i(b("RelayFBEnvironment"),{mutation:j,variables:{input:{client_mutation_id:h(),actor_id:b("CurrentUser").getID(),threads_pin_status:c,source:d}},onCompleted:e,onError:a})}e.exports={commit:a}}),null);
__d("MercuryThreadActions",["codedError","cssVar","fbt","invariant","AsyncDialog","AsyncRequest","AsyncResponse","Bootloader","CurrentUser","EmojiLikeConstants","IgnoreMessagesTypedLogger","JSResource","MercuryAPIArgsSource","MercuryDispatcher","MercuryIDs","MercuryMessageActions","MercuryMessageObject","MercuryMessengerBlockingUtils","MercuryServerPayloadPreprocessor","MercuryServerRequests","MercurySingletonProvider","MercuryThreadIDMap","MercuryThreadlistConstants","MercuryViewer","MessagingTag","MessengerConfig","MessengerEmojiTransitionMapping.bs","MessengerParticipants.bs","MessengerState.re","MessengerThreadThemeUpdateWebGraphQLMutation","NFXContextFactory","PageCommItemStatus","React","ReloadPage","URI","WebGraphQL","WorkChatBulkUpdatePinnedThreadsMutation","XChatRemoveParticipantAsyncController","XGroupsJoinChatController","XMessagingBlockMessagesController","XMessagingGroupJoinableAcceptController","XMessagingGroupJoinableRejectController","XMessagingGroupJoinThroughHashController","XMessagingGroupJoinThroughPrivateLinkController","XMessagingGroupSetApprovalController","XMessagingJoinableLinkController","XMessagingSaveAdminsController","XMessagingSaveGroupThreadDescriptionController","XMessagingSaveNicknameController","XMessagingSaveThreadColorController","XMessagingSaveThreadEmojiController","XMessagingSetThreadNameController","XMessagingUnblockMessagesController","XNFXIgnoreMessagesActionController","XNFXMessengerBlockActionController","ex","lazyLoadComponent"],(function(a,b,c,d,e,f,g,h,i,j){"use strict";var k,l=b("React"),m=b("lazyLoadComponent")(b("JSResource")("MessengerSimpleDialogReact").__setRef("MercuryThreadActions"));a=function(){function a(a){this.$1=a,this.__serverRequests=b("MercuryServerRequests").getForFBID(this.$1),this.__dispatcher=b("MercuryDispatcher").getForFBID(this.$1),this.__payloadPreprocessor=b("MercuryServerPayloadPreprocessor").getForFBID(this.$1),this.__mercuryThreadIDMap=b("MercuryThreadIDMap").getForFBID(this.$1),this.__messageActions=b("MercuryMessageActions").getForFBID(this.$1),this.__messageObject=b("MercuryMessageObject").getForFBID(this.$1)}a.getForFBID=function(a){return n.getForFBID(a)};a.get=function(){return n.get()};var c=a.prototype;c.markRead=function(a,b){this.batchMarkRead([a],b)};c.batchMarkRead=function(a,b){this.__dispatcher.handleUpdate(this.$2(a,!0,b))};c.markUnread=function(a,b){this.batchMarkUnread([a],b)};c.batchMarkUnread=function(a,b){this.__dispatcher.handleUpdate(this.$2(a,!1,b))};c.markSeen=function(a,b){this.__dispatcher.handleUpdate(this.__constructClientPayload([a],"ma-type:mark_thread_seen","client_mark_thread_seen",{persistent:b}))};c.archive=function(a,b){this.batchArchive([a],b)};c.batchArchive=function(a,b){var c=this;a.forEach(function(a){c.__serverRequests.changeThreadArchivedStatus(a,!0,b)});this.__dispatcher.handleUpdate(this.$3(a,!0))};c.unarchive=function(a,b){this.batchUnarchive([a],b)};c.batchUnarchive=function(a,b){var c=this;a.forEach(function(a){c.__serverRequests.changeThreadArchivedStatus(a,!1,b)});this.__dispatcher.handleUpdate(this.$3(a,!1))};c.pin=function(a,c,d){var e=b("MessengerState.re").getPinnedThreadlist(b("CurrentUser").getID()),f=b("CurrentUser").isWorkUser(),h=f?b("MercuryThreadlistConstants").MAX_PINNED_THREADS:b("MessengerConfig").MPT;e=e.length>=h;if(e){e=g._(1545078,function(a){return a._("Unable to pin chat")},function(a,b){return a._("You can pin up to {max_threads} chats. To pin this chat, unpin another chat and try again.",[a._param("max_threads",b.max_threads)])},{max_threads:h});var j=f?i._("You can't pin any more chats"):e.summary,k=f?i._("You can't pin more than 15 chats on Workplace. To pin this chat, try unpinning another chat."):e.description;b("Bootloader").loadModules(["MessengerDialogs.bs"],function(a){a.showDialog(function(){return l.jsx(l.Suspense,{fallback:l.jsx("div",{}),children:l.jsx(m,{title:j,body:k})})})},"MercuryThreadActions")}else this.batchPin([a],d),this.$4(a,!0,c)};c.batchPin=function(a,b){var c=this;a.forEach(function(a){c.__serverRequests.changeThreadPinnedStatus(a,!0,b)});this.__dispatcher.handleUpdate(this.$5(a,!0))};c.unpin=function(a,b,c){b===void 0&&(b=null),this.batchUnpin([a],c),this.$4(a,!1,b)};c.batchUnpin=function(a,b){var c=this;a.forEach(function(a){c.__serverRequests.changeThreadPinnedStatus(a,!1,b)});this.__dispatcher.handleUpdate(this.$5(a,!1))};c.bulkPinThreadsUpdate=function(a,c){b("WorkChatBulkUpdatePinnedThreadsMutation").commit({threadIDs:a,source:c}),this.__dispatcher.handleUpdate(this.$5(a,!0))};c.pinMessage=function(a,b){this.__dispatcher.handleUpdate(this.$6(a,b))};c.unpinMessage=function(a,b){this.__dispatcher.handleUpdate(this.$7(a,b))};c.markPageFollowUp=function(a,b){this.batchMarkPageFollowUp([a],b)};c.batchMarkPageFollowUp=function(a,b){var c=this;a.forEach(function(a){c.__serverRequests.changeThreadPageFollowUpStatus(a,!0,b)});this.__dispatcher.handleUpdate(this.$8(a,!0))};c.unmarkPageFollowUp=function(a,b){this.batchUnmarkPageFollowUp([a],b)};c.batchUnmarkPageFollowUp=function(a,b){var c=this;a.forEach(function(a){c.__serverRequests.changeThreadPageFollowUpStatus(a,!1,b)});this.__dispatcher.handleUpdate(this.$8(a,!1))};c.markSpam=function(a,b){this.batchMarkSpam([a],b)};c.batchMarkSpam=function(a,c){var d=this;a.forEach(function(a){d.__serverRequests.markThreadSpam(a,c)});this.__dispatcher.handleUpdate(this.$9(a,b("MessagingTag").SPAM))};c.unmarkSpam=function(a,b){this.batchUnmarkSpam([a],b)};c.batchUnmarkSpam=function(a,c){var d=this;a.forEach(function(a){d.__serverRequests.unmarkThreadSpam(a,c)});this.__dispatcher.handleUpdate(this.$9(a,b("MessagingTag").INBOX))};c.changeFolder=function(a,b){this.batchChangeFolder([a],b)};c.batchChangeFolder=function(a,b){var c=this;a.forEach(function(a){c.__serverRequests.changeThreadFolder(a,b)});this.__dispatcher.handleUpdate(this.$9(a,b))};c["delete"]=function(a,b){this.batchDelete([a],b)};c.batchDelete=function(a,b){this.__serverRequests.deleteThreads(a,b),this.__dispatcher.handleUpdate(this.__constructClientPayload(a,"ma-type:delete-thread","client_delete_thread"))};c.unmute=function(a){this.updateMuteSetting(a,0)};c.updateMuteSetting=function(a,b){this.__serverRequests.changeMutingOnThread(a,b),this.__dispatcher.handleUpdate(this.__constructClientPayload([a],"ma-type:change-mute-settings","client_change_mute_settings",{mute_until:b}))};c.updateMentionsMuteSetting=function(a,b){b=b?1:0;this.__serverRequests.changeMentionsMutingOnThread(a,b);this.__dispatcher.handleUpdate(this.__constructClientPayload([a],"ma-type:change-mute-settings","client_change_mute_settings",{mentions_mute_mode:b}))};c.updateReactionsMuteSetting=function(a,b){b=b?1:0;this.__serverRequests.changeReactionsMutingOnThread(a,b);this.__dispatcher.handleUpdate(this.__constructClientPayload([a],"ma-type:change-mute-settings","client_change_mute_settings",{reactions_mute_mode:b}))};c.blockMessagesForGroupThread=function(a,c,d,e){var f=b("MercuryIDs").getUserIDFromParticipantID(c);this.__mercuryThreadIDMap.getServerIDFromClientID(a,function(a){a=b("XNFXMessengerBlockActionController").getURIBuilder().setEnum("entry_point",d).setEnum("location","www_chat_head").setInt("thread_fbid",a).setInt("responsible_id",f).getURI();b("AsyncDialog").send(new(b("AsyncRequest"))(a).setRelativeTo(e),function(a){a.subscribe("confirm",function(){a.hide()})})})};c.blockMessages=function(a,c,d){var e=this,f="",g=b("MercuryIDs").getUserIDFromThreadID(a);g!=null||j(0,400);var h=b("MessengerParticipants.bs").getNow(b("MercuryIDs").getParticipantIDFromUserID(g));f=h&&h.short_name;h=b("XNFXMessengerBlockActionController").getURIBuilder().setInt("thread_fbid",g).setEnum("entry_point",c).setEnum("location","www_chat_head").getURI();b("AsyncDialog").send(new(b("AsyncRequest"))(h),function(c){c.subscribe("confirm",function(){c.hide(),d&&d(f),e.changeFolder(a,b("MessagingTag").OTHER)})})};c.unblockMessages=function(a,c){var d=this;c==null&&(c=b("MercuryIDs").getUserIDFromThreadID(a));if(c===null)throw new Error(b("ex")("Expected user ID to unblock messages for, got null"));c=b("NFXContextFactory").withEntReportable({reportable_ent_token:c,story_location:"messenger",initial_action_name:b("MercuryMessengerBlockingUtils").block_messages});new(b("AsyncRequest"))(new(k||(k=b("URI")))("/ajax/nfx/messenger_undo_block").addQueryData({context:c})).setHandler(function(){return d.changeFolder(a,b("MessagingTag").INBOX)}).send()};c.ignoreMessages=function(a){a=b("XNFXIgnoreMessagesActionController").getURIBuilder().setInt("thread_fbid",a).setEnum("location","www_chat_head").getURI();b("AsyncDialog").send(new(b("AsyncRequest"))(a))};c.blockOnMessengerDotCom=function(a){var c=b("XMessagingBlockMessagesController").getURIBuilder().getURI();new(b("IgnoreMessagesTypedLogger"))().setEvent("block_confirmed").setThreadID(b("MercuryIDs").getThreadFBIDFromThreadID(a)).setPlatform("messengerdotcom").log();new(b("AsyncRequest"))(c).setMethod("POST").setData({fbid:b("MercuryIDs").getUserIDFromThreadID(a)}).send()};c.blockIgnoreOnMessengerDotCom=function(a,c,d){var e=this;b("Bootloader").loadModules(["MessengerActions"],function(b){a&&b.selectThread(c),e.blockOnMessengerDotCom(c),d&&d()},"MercuryThreadActions")};c.unblockOnMessengerDotCom=function(a){var c=this,d=b("XMessagingUnblockMessagesController").getURIBuilder().getURI();new(b("AsyncRequest"))(d).setMethod("POST").setData({fbid:b("MercuryIDs").getUserIDFromThreadID(a)}).setHandler(function(){return c.changeFolder(a,b("MessagingTag").INBOX)}).send()};c.leaveGroup=function(a){this.__messageActions.send(this.__messageObject.constructLogMessageObject("source:titan:web",a,"log:unsubscribe",{removed_participants:[b("MercuryViewer").getID()]}),null,b("MercuryAPIArgsSource").WEBMESSENGER)};c.removeFromGroup=function(a,c){var d=b("XChatRemoveParticipantAsyncController").getURIBuilder().getURI();a={request_user_id:this.$1,tid:a,uid:c};new(b("AsyncRequest"))(d).setMethod("POST").setData(a).send()};c.changeThreadTheme=function(a,c,d){var e=this;this.__mercuryThreadIDMap.getServerIDFromClientID(a,function(a){b("WebGraphQL").exec(new(b("MessengerThreadThemeUpdateWebGraphQLMutation"))({data:{client_mutation_id:"0",actor_id:e.$1,thread_id:a,theme_id:c,source:d}}))})};c.changeThreadColor=function(a,c,d){var e=this;this.__mercuryThreadIDMap.getServerIDFromClientID(a,function(a){a={request_user_id:e.$1,thread_or_other_fbid:a,color_choice:c!="#0084ff"?c:null};var f=b("XMessagingSaveThreadColorController").getURIBuilder().setEnum("source",d).getURI();new(b("AsyncRequest"))(f).setMethod("POST").setData(a).send()})};c.changeThreadEmoji=function(a,c,d){var e=this;this.__mercuryThreadIDMap.getServerIDFromClientID(a,function(a){a={request_user_id:e.$1,thread_or_other_fbid:a,emoji_choice:void 0};var f=String.fromCodePoint.apply(String,c);b("MessengerEmojiTransitionMapping.bs").hasGender(c)&&(f=String.fromCodePoint.apply(String,b("MessengerEmojiTransitionMapping.bs").removeAllModifiers(c)));f!==String.fromCodePoint.apply(String,b("EmojiLikeConstants").FB_THUMBS_UP_EMOJI)&&f!==String.fromCodePoint.apply(String,b("EmojiLikeConstants").THUMBS_UP_EMOJI_CODES)&&(a.emoji_choice=f);f=b("XMessagingSaveThreadEmojiController").getURIBuilder().setEnum("source",d).getURI();new(b("AsyncRequest"))(f).setMethod("POST").setData(a).send()})};c.changeThreadNicknames=function(a,c,d,e){var f=this;this.__mercuryThreadIDMap.getServerIDFromClientID(a,function(a){a={request_user_id:f.$1,thread_or_other_fbid:a,participant_id:c,nickname:d};var g=b("XMessagingSaveNicknameController").getURIBuilder().setEnum("source",e).getURI();new(b("AsyncRequest"))(g).setMethod("POST").setData(a).send()})};c.changeGroupThreadDescription=function(a,c,d){var e=this;this.__mercuryThreadIDMap.getServerIDFromClientID(a,function(a){a={request_user_id:e.$1,thread_fbid:a,description:c};var f=b("XMessagingSaveGroupThreadDescriptionController").getURIBuilder().setEnum("source",d).getURI();new(b("AsyncRequest"))(f).setMethod("POST").setData(a).send()})};c.changeGroupThreadName=function(a,c){var d=this;this.__mercuryThreadIDMap.getServerIDFromClientID(a,function(a){a={request_user_id:d.$1,thread_id:a,thread_name:c};var e=b("XMessagingSetThreadNameController").getURIBuilder().getURI();new(b("AsyncRequest"))(e).setMethod("POST").setData(a).send()})};c.setApprovalMode=function(a,c){var d=b("XMessagingGroupSetApprovalController").getURIBuilder().getURI();new(b("AsyncRequest"))(d).setMethod("POST").setData({request_user_id:this.$1,set_mode:a,thread_fbid:c.thread_fbid}).send()};c.changeGroupAdmins=function(a,c,d){a={request_user_id:this.$1,thread_fbid:a,admin_ids:c,add:d};c=b("XMessagingSaveAdminsController").getURIBuilder().getURI();new(b("AsyncRequest"))(c).setMethod("POST").setData(a).send()};c.joinThroughHash=function(a,c,d){a={request_user_id:this.$1,link_hash:a};var e=b("XMessagingGroupJoinThroughHashController").getURIBuilder().getURI();new(b("AsyncRequest"))(e).setMethod("POST").setData(a).setHandler(function(){return c()}).setErrorHandler(function(a){d()||b("AsyncResponse").defaultErrorHandler(a)}).setTransportErrorHandler(function(){d()}).send()};c.joinThroughPrivateLink=function(a){a={request_user_id:this.$1,link_hash:a};var c=b("XMessagingGroupJoinThroughPrivateLinkController").getURIBuilder().getURI();new(b("AsyncRequest"))(c).setMethod("POST").setData(a).send()};c.chatJoinThroughHash=function(a,c){a={request_user_id:this.$1,link_hash:a};var d=b("XGroupsJoinChatController").getURIBuilder().getURI(),e=function(){return b("ReloadPage").now()};new(b("AsyncRequest"))(d).setMethod("POST").setData(a).setHandler(c&&typeof c==="function"?c:e).send()};c.createJoinableLink=function(a,c){var d=this;if(b("MessengerState.re").isEmptyLocalThread(b("CurrentUser").getID(),a))return;this.__mercuryThreadIDMap.getServerIDFromClientID(a,function(a){a={request_user_id:d.$1,thread_fbid:a};var e=b("XMessagingJoinableLinkController").getURIBuilder().setEnum("action","create_link").getURI();new(b("AsyncRequest"))(e).setMethod("POST").setData(a).setHandler(function(a){a=a.getPayload();a&&c(a)}).send()})};c.revokeAndRegenerateJoinableLink=function(a,c){var d=this;if(b("MessengerState.re").isEmptyLocalThread(b("CurrentUser").getID(),a))return;this.__mercuryThreadIDMap.getServerIDFromClientID(a,function(e){e={request_user_id:d.$1,thread_fbid:e};var f=b("XMessagingJoinableLinkController").getURIBuilder().setEnum("action","revoke_link").getURI();new(b("AsyncRequest"))(f).setMethod("POST").setData(e).setHandler(function(b){return d.createJoinableLink(a,c)}).send()})};c.acceptToJoinableGroup=function(a,c){a={request_user_id:this.$1,thread_fbid:a,user_id:c};c=b("XMessagingGroupJoinableAcceptController").getURIBuilder().getURI();new(b("AsyncRequest"))(c).setMethod("POST").setData(a).send()};c.rejectToJoinableGroup=function(a,c){a={request_user_id:this.$1,thread_fbid:a,user_id:c};c=b("XMessagingGroupJoinableRejectController").getURIBuilder().getURI();new(b("AsyncRequest"))(c).setMethod("POST").setData(a).send()};c.addParticipants=function(a,b){this.__dispatcher.handleUpdate(this.__constructClientPayload([a],"ma-type:add-participants","client_add_participants",{participants:b}))};c.movePendingToInbox=function(a){this.__dispatcher.handleUpdate(this.__constructClientPayload([a],"ma-type:move_pending_to_inbox","client_move_pending_to_inbox"))};c.updateCommStatus=function(a,c){this.__dispatcher.handleUpdate(this.$10(a,c));c=c===b("PageCommItemStatus").DONE;this.__dispatcher.handleUpdate(this.$3(a,c))};c.updateCommItemOwner=function(a,b,c,d){this.__dispatcher.handleUpdate(this.$11(a,b,c,d))};c.$2=function(a,b,c){return this.__constructClientPayload(a,"ma-type:change_read_status","client_change_read_status",{mark_as_read:b,source:c,timestamp:0})};c.$11=function(a,b,c,d){return this.__constructClientPayload(a,"ma-type:update-comm-item-owner","client_update_comm_item_owner",{id:c,name:b,profile_pic_uri:d})};c.$3=function(a,b){return this.__constructClientPayload(a,"ma-type:change-archived-status","client_change-archived_status",{archived:b})};c.$5=function(a,b){return this.__constructClientPayload(a,"ma-type:change-pinned-status","client_change-pinned_status",{is_pinned:b,thread_pin_timestamp:Math.floor(Date.now()/1e3)})};c.$6=function(a,b){return this.__constructClientPayload([a],"ma-type:pin-message","server_change-pinned_messages",{pin_message_action:{message:b}})};c.$7=function(a,b){return this.__constructClientPayload([a],"ma-type:unpin-message","server_change-pinned_messages",{unpin_message_action:{message_id:b}})};c.$8=function(a,b){return this.__constructClientPayload(a,"ma-type:change-page-follow-up-status","client_change_page_follow_up_status",{is_page_follow_up:b})};c.$10=function(a,b){return this.__constructClientPayload(a,"ma-type:update-comm-status","client_update_comm_status",{comm_status:b})};c.$9=function(a,b){return this.__constructClientPayload(a,"ma-type:change-folder","client_change_folder",{new_folder:b})};c.__constructClientPayload=function(a,b,c,d){return{actions:a.map(function(a){return babelHelpers["extends"]({action_type:b,thread_id:a},d)}),from_client:!0,payload_source:c}};c.$4=function(a,c,d){b("Bootloader").loadModules(["ChatPinnedThreadsTypedLogger","ChatPinnedThreadsEvent"],function(e,f){new e().setEvent(c?f.PIN_THREAD:f.UNPIN_THREAD).setIsWorkplace(b("CurrentUser").isWorkUser()).setThreadID(a).setEntryPoint(d).log()},"MercuryThreadActions")};return a}();var n=new(b("MercurySingletonProvider"))(a);e.exports=a}),null);
__d("applyMessengerEmoticonToContentBlock",["CharacterMetadata","EmoticonEmojiList"],(function(a,b,c,d,e,f){"use strict";function a(a,c,d,e){if(!b("EmoticonEmojiList").names[d])return c;var f=c.getCharacterList(),g=a.createEntity("EMOTICON","IMMUTABLE",{type:b("EmoticonEmojiList").names[d],originalEmoticon:d}).getLastCreatedEntityKey();return c.merge({characterList:f.slice(0,e).concat(f.slice(e,e+d.length).map(function(a){return b("CharacterMetadata").applyEntity(a,g)}),f.slice(e+d.length))})}e.exports=a}),null);
__d("applyMessengerEmoticonToContentState",["EmoticonEmojiList","applyMessengerEmoticonToContentBlock","getTextAfterNearestEntity"],(function(a,b,c,d,e,f){"use strict";function a(a,c){var d=c.getAnchorKey(),e=c.getAnchorOffset(),f=a.getBlockForKey(d),g=b("getTextAfterNearestEntity")(f,e),h=b("EmoticonEmojiList").regexp.exec(g);if(!h)return a;var i=h[1];if(!i&&e!==g.length)return a;i=h[2];g=e-g.length;g=g+h.index+h[1].length;h=a.getBlockMap().set(d,b("applyMessengerEmoticonToContentBlock")(a,f,i,g));return a.merge({blockMap:h,selectionBefore:c,selectionAfter:c.merge({anchorOffset:e,focusOffset:e})})}e.exports=a}),null);
__d("MercuryShareAttachmentRenderLocations",[],(function(a,b,c,d,e,f){"use strict";var g={CHAT:"chat",CHAT_PREVIEW:"chat_preview",COMPOSER:"ufi_composer",MESSENGER:"messenger",PAGES_INBOX:"pages_inbox",getValues:function(){return[g.CHAT,g.CHAT_PREVIEW,g.COMPOSER,g.MESSENGER,g.PAGES_INBOX]},isPreview:function(a){return a===g.CHAT_PREVIEW}};e.exports=g}),null);
__d("MercuryNotificationRenderer",["fbt","CurrentUser","MercuryAssert","MercuryIDs","MercuryViewer","MessengerParticipants.bs","MessengerState.bs"],(function(a,b,c,d,e,f,g){var h="source:messenger_growth:event_upcoming_bump";function a(a,c){b("MercuryAssert").isThreadID(a),b("MessengerState.bs").getThreadMeta(b("CurrentUser").getID(),a,function(d){b("MessengerState.bs").getThreadMessagesRange(b("CurrentUser").getID(),a,0,1,function(e){e=e.length&&e[e.length-1];var f=[];e.tags!==void 0&&(f=f.concat(e.tags));e.log_message_data&&(e.log_message_data.message_type=="confirm_friend_request"||e.log_message_data.message_type=="work_invite_claimed")?c(g._("New contact added")):f.indexOf(h)!==-1?c(g._("You have an upcoming event.")):e&&e.author!=b("MercuryViewer").getID()?b("MessengerParticipants.bs").get(e.author,function(e){var f=e.short_name,h=d.custom_nickname;if(h){e=b("MercuryIDs").getUserIDFromParticipantID(e.id);h[e]&&(f=h[e])}d.name?c(g._("{senderName} messaged {groupName}",[g._param("senderName",f),g._param("groupName",d.name)])):b("MercuryIDs").isGroupChat(a)?c(g._("{name} messaged your group",[g._param("name",f)])):c(g._("{name} messaged you",[g._param("name",f)]))}):c(g._("New message"))})})}e.exports={renderDocumentTitle:a}}),null);
__d("SoundSynchronizer",["SoundPlayer","WebStorage","createArrayFromMixed"],(function(a,b,c,d,e,f){var g,h="fb_sounds_playing3";function i(){var a=(g||(g=b("WebStorage"))).getLocalStorage();if(a)try{a=a[h];if(a){a=JSON.parse(a);if(Array.isArray(a))return a}}catch(a){}return[]}function j(a){var c=(g||(g=b("WebStorage"))).getLocalStorage();if(c){var d=i();d.push(a);while(d.length>5)d.shift();try{c[h]=JSON.stringify(d)}catch(a){}}}function k(a){return i().some(function(b){return b===a})}a={play:function(a,c,d){a=b("createArrayFromMixed")(a);c=c||a[0]+Math.floor(Date.now()/1e3);if(k(c))return;b("SoundPlayer").play(a,{loop:!!d});j(c)},isSupported:function(){return!!(g||(g=b("WebStorage"))).getLocalStorage()}};e.exports=a}),null);
__d("SoundRPC",["requireCond","cr:950105","FBJSON","SecurePostMessage","SoundSynchronizer"],(function(a,b,c,d,e,f){function g(a,c,d){b("SoundSynchronizer").play(a,c,d)}a={playLocal:g,playRemote:function(a,c,d,e){c={name:"SoundRPC",data:{paths:c,sync:d,loop:e}};b("SecurePostMessage").sendMessageAllowAnyOrigin_UNSAFE(a,b("FBJSON").stringify(c))},supportsRPC:function(){return!!window.postMessage},_listen:function(){var a=function(a){if(!/\.facebook.com$/.test(a.origin))return;var c={};try{a=a.data;typeof a==="string"&&(c=b("FBJSON").parse(a))}catch(a){}a=c;c=a.name;a=a.data;c==="SoundRPC"&&a!=null&&typeof a==="object"&&g(a.paths,a.sync,a.loop)};b("cr:950105")!=null?b("cr:950105").listen(window,"message",a):window.addEventListener("message",a)}};e.exports=a}),null);
__d("Sound",["SoundInitialData","SoundPlayer","SoundRPC","SoundSynchronizer","URI","UserAgent_DEPRECATED","Visibility","isFacebookURI"],(function(a,b,c,d,e,f){var g,h=null,i=!1;c={init:function(a){},play:function(a,c,d){h?b("SoundRPC").playRemote(h.contentWindow,a,c,!1):b("SoundRPC").playLocal(a,c,d),i=!0},hasPlayedSoundBefore:function(){return i},playOnlyIfImmediate:function(a,c,d){if(!i&&b("Visibility").isHidden())return;this.play(a,c,d)},stop:function(a){h||b("SoundPlayer").stop(a)}};d=new(g||b("URI"))(location.href);d.getSubdomain()&&d.getSubdomain()!=="comet"&&d.getSubdomain()!=="www"&&d.setSubdomain("www");f=d.getDomain();function a(){if(b("UserAgent_DEPRECATED").ie()<9)return!1;return b("SoundInitialData").RPC_DISABLED?!1:b("SoundSynchronizer").isSupported()&&b("SoundRPC").supportsRPC()}b("isFacebookURI")(d)&&location.host!==f&&a()&&(h=document.createElement("iframe"),h.setAttribute("src","//"+f+"/sound_iframe.php"),h.style.display="none",document.body&&document.body.appendChild(h));e.exports=c}),null);
__d("MercuryBrowserAlerts",["ArbiterMixin","Bootloader","ChatActivity","ChatConfig","ChatOptions","ChatTitleBarBlinker","CurrentUser","Event","MercuryIDs","MercuryIgnoredBlockedParticipants.bs","MercuryThreadInfo","MercuryViewer","MessagingTag","MessengerState.bs","Sound","UserActivity"],(function(a,b,c,d,e,f){"use strict";var g=3,h=6e5,i=new Map(),j=null;function k(){return!b("UserActivity").isOnTab()&&!b("UserActivity").hasBeenInactive()}function l(){i=new Map()}function m(a){b("ChatOptions").getSetting("sound")&&!k()&&b("Sound").play([b("ChatConfig").get("sound.notif_ogg_url"),b("ChatConfig").get("sound.notif_mp3_url")],a,!1)}var n=Object.assign({init:function(){var a=this;b("Event").listen(window,"focus",function(){l(),window.clearInterval(j)});b("Event").listen(window,"blur",function(){j=window.setInterval(l,h)});b("CurrentUser").isWorkUser()&&(this._availabilityStatusStore=null,b("Bootloader").loadModules(["WorkChatAvailabilityStatusStore"],function(b){a._availabilityStatusStore=b},"MercuryBrowserAlerts"))},messageReceived:function(a){var c=this._availabilityStatusStore&&this._availabilityStatusStore.getIsDoNotDisturb(b("MercuryIDs").getUserIDFromParticipantID(b("MercuryViewer").getID()));if(c||a.author&&b("MercuryViewer").isViewer(a.author)||!a.is_unread||a.folder!=b("MessagingTag").INBOX&&a.folder!=b("MessagingTag").ARCHIVED)return;var d=a.thread_id,e=b("ChatActivity").isActive();if(e){var f=!1;n.inform("before-alert",{threadID:d,cancelAlert:function(){f=!0}})}b("MessengerState.bs").getThreadMeta(b("CurrentUser").getID(),d,function(c){var h=b("MercuryThreadInfo").isMuted(c),j=b("MercuryIDs").getUserIDFromParticipantID(b("MercuryViewer").getID());if(h)if(!b("MercuryThreadInfo").areMentionsMuted(c)){if(!a.profile_ranges||!a.profile_ranges.some||!a.profile_ranges.some(function(a){return a.id===j}))return}else return;var k=b("CurrentUser").getID();b("MessengerState.bs").compute(k,function(h){h=h.blocked_ids;if(b("MercuryIgnoredBlockedParticipants.bs").isPresentInGroupThread(k,h,c))return;h=a.timestamp;if(e)f||m(h);else{b("ChatTitleBarBlinker").blink(d,h);var j=i.get(d)||0;j<g&&(i.set(d,j+1),m(h))}b("ChatTitleBarBlinker").blinkingElsewhere()})})}},b("ArbiterMixin"));e.exports=n}),null);
__d("MercuryMessageGroup",["MercuryAttachmentLayoutTypeHelper","MercuryShareAttachmentRenderLocations","MercuryThreadlistConstants","MessengerLightweightActionUtils","MessengerMessage.bs","enumerate"],(function(a,b,c,d,e,f){"use strict";var g={calculateMessageGroups:function(a,c){var d=[],e=null,f={value:null};a=b("enumerate")(a);var h;while(!(h=a.next()).done){var i=g.canAppendMessageToLastGroup(f.value,h.value,c);i||(e=[],d.push(e));e.push(h.value);f=h}return d},canAppendMessageToLastGroup:function(a,c,d){var e=b("MercuryThreadlistConstants").GROUPING_THRESHOLD;if(!a||h(a,d)||h(c,d)||a.author!=c.author||a.timestamp<c.timestamp-e||a.is_spoof_warning!==c.is_spoof_warning||a.page_admin_notes||c.replied_to_message||c.is_forwarded)return!1;d=b("MessengerMessage.bs").getPersona(a);e=b("MessengerMessage.bs").getPersona(c);return!d&&!e?!0:d===null||e===null?!1:d.id===e.id}};function h(a,c){var d=a.has_attachment;d&&(c===b("MercuryShareAttachmentRenderLocations").MESSENGER||c===b("MercuryShareAttachmentRenderLocations").CHAT)&&(d=i(a));return!!(b("MessengerLightweightActionUtils").isLWAMessage(a)||a.action_type=="ma-type:log-message"||d||a.html_body||a.body&&a.body.length>b("MercuryThreadlistConstants").MAX_CHARS_BEFORE_BREAK)}function i(a){a=a.attachments[0];return!a||a.attach_type==="sticker"||a.attach_type==="animated_image"||b("MercuryAttachmentLayoutTypeHelper").isAdminType(a)}e.exports=g}),null);
__d("PagesMessageListGreeting.react",["cx","FluxContainer","PagesMessagingMercuryChatTabActions","PagesMessagingMercuryChatTabStore","React"],(function(a,b,c,d,e,f,g){"use strict";var h=b("React");a=function(a){babelHelpers.inheritsLoose(c,a);function c(){return a.apply(this,arguments)||this}c.getStores=function(){return[b("PagesMessagingMercuryChatTabStore")]};c.calculateState=function(a,c){if(c.messageCount>0)return{shouldShowGreeting:!1};a=b("PagesMessagingMercuryChatTabStore").getStateByThread(c.threadID);return{greetingContent:a.pagesGreetingContent,shouldShowGreeting:a.pagesGreetingShouldShow}};var d=c.prototype;d.componentDidMount=function(){b("PagesMessagingMercuryChatTabActions").requestGreetingConfig(this.props.threadID)};d.render=function(){return!this.state.shouldShowGreeting||!this.state.greetingContent||this.state.greetingContent.trim().length===0?null:h.jsx("div",{className:"_4fsh _3-8z",children:this.state.greetingContent})};return c}(h.PureComponent);e.exports=b("FluxContainer").create(a,{withProps:!0})}),null);
__d("ChatMessageList.react",["cx","requireCond","CurrentUser","MercuryIDs","MercuryMessageGroup","MercuryShareAttachmentRenderLocations","MessengerDomIDs.bs","MessengerLightweightActionUtils","MessengerMessage.bs","MessengerParticipantUtils.bs","MessengerPresenceProvider.bs","cr:832269","PagesMessageListGreeting.react","React","ReactDOM","immutable","nullthrows","prop-types"],(function(a,b,c,d,e,f,g){"use strict";var h=b("MessengerDomIDs.bs").ids,i=b("MessengerPresenceProvider.bs").jsComponent,j=b("React"),k=2,l=1e3*60*60,m=6,n=function(a){var b;b=(b=a)!=null?(b=b.log_message_data)!=null?b.message_type:b:b;switch(b){case"group_poll":return(b=a)!=null?(b=b.log_message_data)!=null?(b=b.untypedData)!=null?b.question_id:b:b:b;case"instant_game_update":return(b=a)!=null?(b=b.log_message_data)!=null?(b=b.untypedData)!=null?b.game_id:b:b:b;case"lightweight_event_create":case"lightweight_event_update":case"lightweight_event_delete":case"lightweight_event_update_time":case"lightweight_event_update_title":case"lightweight_event_update_location":case"lightweight_event_notify_before_event":case"lightweight_event_notify":case"lightweight_event_rsvp":return(b=a)!=null?(b=b.log_message_data)!=null?(b=b.untypedData)!=null?b.event_id:b:b:b;case"confirm_friend_request":b=((b=a)!=null?(b=b.log_message_data)!=null?(b=b.untypedData)!=null?b.friend_request_subtype:b:b:b)||((b=a)!=null?(b=b.log_message_data)!=null?(b=b.untypedData)!=null?b.subtype:b:b:b);return!b||b.toLowerCase()!=="icebreaker"?null:q(a);case"messenger_icebreaker_vote_cast":return q(a);default:return null}},o=function(a){return b("MessengerLightweightActionUtils").isLWAMessage(a)?"lwa":null};a=function(a){babelHelpers.inheritsLoose(c,a);function c(){var b,c,d;for(var e=arguments.length,f=new Array(e),g=0;g<e;g++)f[g]=arguments[g];return(c=d=a.call.apply(a,[this].concat(f))||this,d.state={activeMessageID:null,messageGroups:[],prevMessages:null,newMessagesGroupIndex:Infinity,lastReadTimestamp:((b=d.props.thread)==null?void 0:b.last_read_timestamp)||Infinity,newMessagesCountForDisplay:0},d.$5=function(a){d.setState(function(b){return{activeMessageID:b.activeMessageID===a?null:b.activeMessageID}})},d.$6=function(a){d.setState({activeMessageID:a})},c)||babelHelpers.assertThisInitialized(d)}c.getDerivedStateFromProps=function(a,c){if(c.prevMessages!==a.messages)if(b("cr:832269")!==null){var d=c.lastReadTimestamp;c=a.location;var e=a.messages,f=a.thread,g=b("MercuryIDs").getParticipantIDFromUserID(b("CurrentUser").getID());(f==null?void 0:f.snippet_sender)===g&&(d=Infinity);f=e.slice().reverse().find(function(a){return a.author===g});f&&f.timestamp>d&&(d=f.timestamp);f=a.messages.filter(function(a){return a.timestamp<=d});var h=a.messages.filter(function(a){return a.timestamp>d});f=b("MercuryMessageGroup").calculateMessageGroups(f,c);c=b("MercuryMessageGroup").calculateMessageGroups(h,c);h=h.filter(function(a){return a.log_message_type==null}).length;return{messageGroups:[].concat(f,c),prevMessages:e,newMessagesGroupIndex:f.length,newMessagesCountForDisplay:h,lastReadTimestamp:d}}else return{messageGroups:b("MercuryMessageGroup").calculateMessageGroups(a.messages,a.location),prevMessages:a.messages};else return null};var d=c.prototype;d.render=function(){var a=this,c=this.props,d=c.DateBreak,e=c.forGameChat,f=c.location,g=c.MessageGroup,q=c.CollapsedLogMessageGroup,v=[],w=[];c=this.props.thread&&this.props.thread.solid_color;var x=c?{backgroundColor:c}:null,y=this.state.activeMessageID,z=this.state.messageGroups,A=z.length,B=this.props.readReceipts;c=B.last();var C=c?c.watermark:0,D=b("MercuryIDs").getParticipantIDFromUserID(this.props.viewer),E={};for(var c=this.props.messages.length-1;c>=0;c--){var F=this.props.messages[c],G=n(F)||o(F);G&&!E[G]&&(E[G]=F.message_id)}var H=function(h){var n=h>0?z[h-1]:null;n=n&&n.length>0?n[n.length-1]:null;var H=z[h],J=H[0],K=H[H.length-1],L=!1;b("cr:832269")!=null&&h>0&&h===a.state.newMessagesGroupIndex&&a.state.newMessagesCountForDisplay>0&&v.push(j.jsx("div",{ref:"newMessageDivider",children:j.jsx(b("cr:832269"),{newMessagesCount:a.state.newMessagesCountForDisplay})},"new-message-divider"));if(!n||J.timestamp-n.timestamp>l){L=!0;n=j.jsx(d,{date:new Date(J.timestamp),ref:"db:"+J.message_id},"db:"+J.message_id);w.length===0&&v.push(n)}n=o(J);if(n&&E[n]!==J.message_id){n=a.$1(J,E);v.push(n);return"continue"}if(J.action_type=="ma-type:log-message"){n=(G=J)!=null?(G=G.log_message_data)!=null?G.message_type:G:G;var M=(F=J)!=null?(F=F.log_message_data)!=null?(F=F.untypedData)!=null?F.friend_request_subtype:F:F:F,N=n==="parties_presence",O=n==="instant_game_update",P=n==="group_poll";M=n==="messenger_icebreaker_vote_cast"||n==="confirm_friend_request"&&M&&M.toLowerCase()==="icebreaker";var Q=["lightweight_event_create","lightweight_event_update","lightweight_event_delete","lightweight_event_update_time","lightweight_event_update_title","lightweight_event_update_location","lightweight_event_notify_before_event","lightweight_event_notify","lightweight_event_rsvp"].includes(n);if((f===b("MercuryShareAttachmentRenderLocations").CHAT||f===b("MercuryShareAttachmentRenderLocations").MESSENGER)&&(J.log_message_type==="log:video-call"||J.log_message_type==="log:phone-call"||n==="messenger_call_log")){n=a.$2(J,D,z,A,h,B,C,K,E);v.push(n)}else{n=a.$3(J,E);c=J.message_id;!O&&!P&&!Q&&!M&&w.push(n);if(N)return"continue";(w.length===H.length||O||P||Q||M)&&(a.$4(w,v,c,x,q),w=[]);(O||P||Q||M)&&v.push(n)}return"continue"}H=b("immutable").List(H);var R=r(z,A,h,E),S=!t(B,H,R),T=s(C,K),U=u(a.props.deliveryTimestamp,K),V=H.first().author,W=b("MessengerMessage.bs").getPersona(K),X=D===J.author;N=X?0:m+k;var Y=a.props.maxBubbleWidth?a.props.maxBubbleWidth-N:null;v.push(j.jsx(i,{subscribeToIDs:V?[V]:null,children:function(c){return j.jsx(g,{activeMessageID:p(y,H),author:V,deliveryTimestamp:U,forGameChat:e,hasDateBreak:L,isCanonical:a.props.isCanonical,isFromViewer:X,isPageMessage:a.props.isPageMessage,isOnline:V?b("MessengerParticipantUtils.bs").has(c,V):!1,lastReadTimestamp:T,maxBubbleWidth:Y,messages:H,nextTimestamp:R,onReactionSwap:a.props.onReactionSwap,onAttachmentLoad:a.props.onAttachmentLoad,onMessageDeselect:a.$5,onMessageSelect:a.$6,onStickerClick:a.props.onStickerClick,onReplyToMessage:a.props.onReplyToMessage,pageID:a.props.isPageMessage===!0?a.props.viewer:null,persona:W,readReceipts:S?B:b("immutable").OrderedMap(),ref:function(b){return a.refs["mg:"+J.message_id]=b},thread:a.props.thread,threadID:a.props.threadID,scrollToRepliedMessage:a.props.scrollToRepliedMessage},"mg:"+J.message_id)}},"pp:"+J.message_id))};for(var I=0;I<A;I++){var J=H(I);if(J==="continue")continue}J=this.props.threadID||this.props.thread&&this.props.thread.thread_id||this.props.thread&&this.props.thread.thread_fbid;H=null;f===b("MercuryShareAttachmentRenderLocations").MESSENGER&&J&&this.props.isPageMessage&&(H=j.jsx(b("PagesMessageListGreeting.react"),{messageCount:w.length+A,threadID:J}));return j.jsxs("div",{id:f===b("MercuryShareAttachmentRenderLocations").MESSENGER?h.CONVERSATION:null,children:[H,v]})};d.getMessageElement=function(a,c){if(c===!0){var d=this.refs["db:"+a];if(d)return b("ReactDOM").findDOMNode(d)}d=this.$7(a);if(!d)return null;d=d[0].message_id;var e=this.refs["mg:"+d];if(!e)return null;return c===!0&&d===a?b("ReactDOM").findDOMNode(e):e.getMessageElement(a)};d.getMessageComponent=function(a){var b=this.$7(a);if(!b)return null;b=b[0].message_id;b=this.refs["mg:"+b];return!b?null:b.getMessage(a)};d.$7=function(a){return this.state.messageGroups.find(function(b){return b.some(function(b){return b.message_id===a})})};d.$4=function(a,b,c,d,e){a.length!==0&&(a.length>1?b.push(j.jsx(e,{style:d,children:a},"mg:"+c)):b.push(j.jsx("div",{children:a},"mg:"+c)))};d.$2=function(a,c,d,e,f,g,h,k,l){var m=this,n,o,p=this.props.MessageGroup;o=((o=a)!=null?(o=o.log_message_data)!=null?o.untypedData:o:o)||{};n=(n=a)!=null?(n=n.log_message_data)!=null?n.message_type:n:n;if(n==="messenger_call_log"){n={message_type:"messenger_call_log",call_capture_attachments:o.call_capture_attachments,caller:b("MercuryIDs").getParticipantIDFromUserID(b("nullthrows")(o.caller_id,"caller id")),callee:b("MercuryIDs").getParticipantIDFromUserID(b("nullthrows")(o.callee_id,"callee id")),server_info_data:o.server_info,thread_id:a.thread_fbid,answered:o.event!=="missed_call",log_message_type:o.video?"log:video-call":"log:phone-call",event:o.event,added_participants:null,removed_participants:null,untypedData:null,image:null,name:null};a=babelHelpers["extends"]({},a,{log_message_data:n})}o={attach_type:"share",share:{style_list:["rtc_call_log","fallback"],log_message_body:a.log_message_body,log_message_data:a.log_message_data,log_message_type:a.log_message_type,timestamp:a.timestamp}};n=babelHelpers["extends"]({},a,{attachments:[o],body:""});var q=b("immutable").List([n]),v=r(d,e,f,l),w=!t(g,q,v),x=s(h,k),y=u(this.props.deliveryTimestamp,k),z=q.first().author;return j.jsx(i,{subscribeToIDs:z?[z]:null,children:function(d){return j.jsx(p,{author:q.first().author,deliveryTimestamp:y,forGameChat:m.props.forGameChat,isCanonical:m.props.isCanonical,isFromViewer:c===a.author,isOnline:z?b("MessengerParticipantUtils.bs").has(d,z):!1,isPageMessage:m.props.isPageMessage,lastReadTimestamp:x,maxBubbleWidth:m.props.maxBubbleWidth,messages:q,nextTimestamp:v,onAttachmentLoad:m.props.onAttachmentLoad,onMessageDeselect:m.$5,onMessageSelect:m.$6,onStickerClick:m.props.onStickerClick,readReceipts:w?g:b("immutable").OrderedMap(),thread:m.props.thread,threadID:m.props.threadID})}},a.message_id)};d.$3=function(a,c){var d=this.props.LogMessage,e=n(a);c=e?c[e]:null;return a.log_message_type!=="log:error-msg"?j.jsx(d,{className:this.props.location===b("MercuryShareAttachmentRenderLocations").CHAT?"_5w0o":null,onLogMessageExpanded:this.props.onAttachmentLoad,loadMoreMessages:this.props.loadMoreMessages,message:a,onImageLoad:this.props.onAttachmentLoad,viewer:this.props.viewer,isPageMessage:this.props.isPageMessage,thread:this.props.thread,isLastOfType:c===a.message_id},a.message_id):null};d.$1=function(a,c){c=c[b("nullthrows")(o(a),"other group id first message")];var d=this.props.LogMessage;return j.jsx(d,{className:this.props.location===b("MercuryShareAttachmentRenderLocations").CHAT?"_5w0o":null,onLogMessageExpanded:this.props.onAttachmentLoad,loadMoreMessages:this.props.loadMoreMessages,message:a,onImageLoad:this.props.onAttachmentLoad,viewer:this.props.viewer,thread:this.props.thread,isLastOfType:c===a.message_id},a.message_id)};return c}(j.PureComponent);a.propTypes={CollapsedLogMessageGroup:(c=b("prop-types")).func.isRequired,DateBreak:c.func.isRequired,deliveryTimestamp:c.number.isRequired,forGameChat:c.bool,isCanonical:c.bool,isPageMessage:c.bool,location:c.string.isRequired,LogMessage:c.func.isRequired,loadMoreMessages:c.func,MessageGroup:c.func.isRequired,onAttachmentLoad:c.func,onStickerClick:c.func,onReplyToMessage:c.func,readReceipts:c.instanceOf(b("immutable").OrderedMap).isRequired,viewer:c.string.isRequired,thread:c.object,threadID:c.string,scrollToRepliedMessage:c.func};function p(a,b){return b.find(function(b){return b.message_id===a})?a:null}function q(a){return(a=a)!=null?(a=a.log_message_data)!=null?(a=a.untypedData)!=null?a.icebreaker_type:a:a:a}function r(a,b,c,d){if(c>=b-1)return Infinity;var e=a[c+1][0],f=o(e);if(f&&d[f]!==e.message_id||((f=e)!=null?f.action_type:f)=="ma-type:log-message")return r(a,b,c+1,d);else return e.timestamp}function s(a,b){return b.timestamp>a?a:Infinity}function t(a,b,c){return b.isEmpty()||!a.isEmpty()&&(a.last().action<b.first().timestamp||a.first().action>=c)}function u(a,b){return b.timestamp>a?a:Infinity}e.exports=a}),null);
__d("MercuryLastMessageIndicator.react",["cx","fbt","CurrentUser","MercuryIDs","MercuryViewer","MessengerParticipants.bs","MessengerReadReceipt.bs","MessengerTextWithEmoticons.react","React","TooltipData","XWorkplaceMarketingDefaultController","emptyFunction","formatDate","immutable","joinClasses","prop-types"],(function(a,b,c,d,e,f,g,h){var i=b("React"),j=b("immutable").Set,k=function(a,c,d){a=b("MessengerReadReceipt.bs").getSeenTimestamp(a,d,c[0]);d=a.action*.001;return{seenTimestamp:d,seenByData:null}},l=function(a,c,d){var e={};for(var f=0;f<a.length;f++){var g=a[f];e[g]=b("MessengerParticipants.bs").getNow(g)}g=null;c&&c.custom_nickname&&(g=c.custom_nickname);f={};var h=Object.keys(e);for(var i=0;i<h.length;i++){var j=h[i],k=e[j],l;!k?l=b("MessengerParticipants.bs").getDefaultName():(l=k.short_name,g&&g[k.fbid]&&(l=g[k.fbid]));f[j]=l}var m;k=!1;j=!1;n(a,d,c)?j=!0:a.length==1?m=" "+f[a[0]]:a.length==2?m=" "+f[a[0]]+", "+f[a[1]]:a.length==3?m=" "+f[a[0]]+", "+f[a[1]]+", "+f[a[2]]:a.length>3&&(m=" "+f[a[0]]+", "+f[a[1]]+", ",k=!0);return{seenTimestamp:null,seenByData:{seenByAll:j,text:m,showTooltip:k,seenBy:a}}},m=function(a,c,d,e){e=b("MessengerReadReceipt.bs").getSeenBy(a,e,!0);if(e.length===0)return{seenTimestamp:null,seenByData:null};var f=b("MercuryIDs").getUserIDFromThreadID(d);if(f)return k(a,e,d);else return l(e,c)},n=function(a,c,d){var e=d?d.participants.length:0;a=a.length;c&&c.author!=b("MercuryViewer").getID()&&(!d||d.participants.indexOf(c.author)>-1)&&a++;return e>2&&a>=e-1};a=function(a){"use strict";babelHelpers.inheritsLoose(c,a);function c(){var b,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return(b=c=a.call.apply(a,[this].concat(e))||this,c.state={seenTimestamp:null,seenByData:null},b)||babelHelpers.assertThisInitialized(c)}c.getDerivedStateFromProps=function(a,b){return m(a.readReceipts,a.thread,a.threadID,a.lastMessage)};var d=c.prototype;d.shouldComponentUpdate=function(a,b){if(a.thread!==this.props.thread||a.threadID!==this.props.threadID||a.lastMessage!==this.props.lastMessage||a.isTyping!==this.props.isTyping||a.readReceipts!==this.props.readReceipts||b.seenTimestamp!==this.state.seenTimestamp)return!0;a=this.state.seenByData;b=b.seenByData;if(!a&&!b)return!1;if(!a||!b)return!0;if(a.seenByAll!==b.seenByAll||a.showTooltip!==b.showTooltip||a.text!==b.text)return!0;return!j(a.seenBy).equals(j(b.seenBy))?!0:!1};d.componentDidUpdate=function(){if(!this.isVisible())return;this.props.indicatorDidShow&&this.props.indicatorDidShow()};d.componentWillUnmount=function(){this.$1&&this.$1.release()};d.$2=function(){return!this.props.lastMessage?[]:this.props.lastMessage.source_tags||this.props.lastMessage.tags||[]};d.$3=function(){if(this.props.isTyping)return i.jsxs("div",{className:this.$4([]),children:[i.jsx("div",{className:"_510h"}),i.jsx("span",{className:"_510f",ref:"text",children:"\xa0"})]});var a=this.$2(),c=this.state.seenByData,d=this.state.seenTimestamp;if(c)return i.jsxs("div",{className:this.$4(a),children:[i.jsx("div",{className:"_510h"}),i.jsx("span",{className:"_510f",children:this.$5(c)})]});else if(d)return i.jsxs("div",{className:this.$4(a),children:[i.jsx("div",{className:"_510h"}),i.jsx("span",{className:"_510f",ref:"text",children:this.$6(d)})]});else return i.jsx("div",{className:this.$4(a),children:b("CurrentUser").isWorkUser()?i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"_510h"}),i.jsx("span",{className:"_510f",ref:"text",children:this.$7(a)})]}):null})};d.render=function(){return i.jsx("div",{className:"_4gd0",children:this.$3()})};d.$6=function(a){var c=Date.now()*.001,d;a<c-518400?d="M j":a<c-86400?d="D g:ia":d="g:ia";return h._("Seen {timestamp}",[h._param("timestamp",b("formatDate")(a,d))])};d.$7=function(a){if(a.includes("source:messenger"))return i.jsx("a",{href:"https://www.facebook.com/workplace/features/workplace-chat",className:"fcg",target:"_blank",children:h._("Sent from Workplace Chat")});else if(a.includes("source:mobile")){var c="/workplace/mobile";return i.jsx("a",{href:c,className:"fcg",target:"_blank",children:h._("Sent from Mobile")})}else if(a.includes("source:email"))return i.jsx("span",{children:h._("Sent from email")});else if(a.includes("source:workchat:desktop")){c=b("XWorkplaceMarketingDefaultController").getURIBuilder().setString("path","chat-app").setString("ref","last-message-indicator").getURI();return i.jsx("a",{href:c,className:"fcg",target:"_blank",children:h._("Sent from the desktop app")})}return null};d.$4=function(a){var c=this.props.lastMessage&&this.props.lastMessage.author&&b("MercuryViewer").isViewer(this.props.lastMessage.author);c="_510g"+(c?" _510e":"");var d=null;this.props.isTyping?d=null:this.state.seenByData!==null||this.state.seenTimestamp!==null?d="seen":a.includes("source:messenger")||a.includes("source:mobile")?d="sentFromMobile":a.includes("source:workchat:desktop")?d="sentFromDesktop":a.includes("source:email")&&(d="sentFromEmail");return b("joinClasses")(c,d)};d.isVisible=function(){var a=this.$2();return a.includes("source:messenger")||a.includes("source:mobile")||a.includes("source:email")||a.includes("source:workchat:desktop")?!0:this.state.seenTimestamp!==null||this.state.seenByData!==null};d.$5=function(a){var c=a.seenByAll;if(c)return h._("Seen by everyone");c=a.text;if(!c)return null;c=i.jsx(b("MessengerTextWithEmoticons.react"),{renderEmoji:!0,renderEmoticons:!0,text:c});var d=a.showTooltip;if(!d)return h._("Seen by {names}",[h._param("names",c)]);else{d=this.$8(a);return h._("Seen by {names}{=num more link}",[h._param("names",c),h._param("=num more link",d)])}};d.$8=function(a){if(!a.text||!a.showTooltip)return null;var c={},d=0,e=null;b("MessengerParticipants.bs").getMulti(a.seenBy,function(b){e=a.seenBy.map(function(a){return b[a].name}).join("\r\n"),d=Object.keys(b).length-2});c=Object.assign({"data-tooltip-alignh":"center"},b("TooltipData").propsFor(e,"above"));var f=h._({"*":"{num} more"},[h._param("num",d,[0])]);return i.jsx("span",babelHelpers["extends"]({className:"more"},c,{children:f}))};return c}(i.Component);a.propTypes={indicatorDidShow:(c=b("prop-types")).func,lastMessage:c.object,readReceipts:c.any,threadID:c.string.isRequired,isTyping:c.bool.isRequired};a.defaultProps={indicatorDidShow:b("emptyFunction")};e.exports=a}),null);
__d("MercuryMessageRendererUtils",["cx","invariant","HovercardLink","MercuryViewer","MessengerTextWithEmoticons.react","React"],(function(a,b,c,d,e,f,g,h){"use strict";var i=b("React");a={getLinkToParticipant:function(a,c){var d=a.fbid,e=b("HovercardLink").constructEndpoint({id:d});c=c&&c.custom_nickname&&c.custom_nickname[d];c&&(c=i.jsx(b("MessengerTextWithEmoticons.react"),{renderEmoticons:!0,renderEmoji:!0,text:c}));d=c?c:a.name;return a.href?i.jsx("a",{className:"_5wzt",href:a.href,"data-hovercard":e,children:d}):d},moveCurrentUserToFront:function(a){a===void 0&&(a=[]);a||h(0,2427);var c=a.indexOf(b("MercuryViewer").getID());if(c>0){c=a.filter(function(a){return a!==b("MercuryViewer").getID()});return[b("MercuryViewer").getID()].concat(c)}return a}};e.exports=a}),null);
__d("convertMIGColorToFIGColor",["cssVar"],(function(a,b,c,d,e,f,g){"use strict";var h={"#0077e5":"#4080ff","#44bec7":"#54C7EC","#ffc300":"#f5c33b","#fa3c4c":"#F35369","#d696bb":"#d696bb","#6699cc":"#7596c8","#13cf13":"#42b72a","#ff7e29":"#F7923B","#e68585":"#e68585","#7646ff":"#8C72CB","#20cef5":"#54C7EC","#67b868":"#A3CE71","#d4a88c":"#cfa588","#ff5ca1":"#EC7EBD","#a695c7":"#AF9CDA"};function a(a){return a&&h[a]||a||""}e.exports=a}),null);
__d("MercuryLogMessageRenderer",["cx","fbt","invariant","ix","Bootloader","CurrentUser","Image.react","MercuryLogMessageType","MercuryMessageRendererUtils","MercuryViewer","MessengerAdminGroupUtils","MessengerLightweightActionUtils","MessengerParticipants.bs","MessengerState.bs","MessengerTextWithEmoticons.react","React","TooltipLink.react","UserAgent","convertMIGColorToFIGColor"],(function(a,b,c,d,e,f,g,h,i,j){"use strict";var k=b("React");a={renderText:function(a,c,d,e){c=c||b("MessengerState.bs").getThreadMetaNow(b("CurrentUser").getID(),a.thread_id);if(b("MessengerLightweightActionUtils").isLWAMessage(a)){e(b("MessengerLightweightActionUtils").getCollapsedLWAText(a));return}switch(a.log_message_type){case b("MercuryLogMessageType").SUBSCRIBE:var f=a.author;a.log_message_data||i(0,2425);var g=a.log_message_data.added_participants;g||i(0,2426);f=g.length===1&&f===g[0];g=c&&b("MessengerAdminGroupUtils").isWorkFroup(c)&&b("MessengerAdminGroupUtils").isWorkSyncedChatThreadMemberSyncMessage(a);f||g?b("Bootloader").loadModules(["MercuryJoinableMessageRenderer"],function(b){b.renderText(a,c,e)},"MercuryLogMessageRenderer"):m(a,e);break;case b("MercuryLogMessageType").UNSUBSCRIBE:b("MessengerAdminGroupUtils").isJoinableThread(c)?b("MessengerAdminGroupUtils").isGroupChat(c)?A(a,e):s(a,e):r(a,e);break;case b("MercuryLogMessageType").THREAD_NAME:c&&b("MessengerAdminGroupUtils").isWorkFroup(c)&&b("MessengerAdminGroupUtils").isWorkSyncedChatThreadCreationMessage(a)?v(a,e):c&&b("MessengerAdminGroupUtils").isJoinableThread(c)?b("MessengerAdminGroupUtils").isGroupChat(c)?B(a,c,e):t(a,c,e):w(a,c,e);break;case b("MercuryLogMessageType").THREAD_IMAGE:c&&b("MessengerAdminGroupUtils").isJoinableThread(c)?b("MessengerAdminGroupUtils").isGroupChat(c)?C(a,c,e):x(a,c,e):y(a,c,e);break;case b("MercuryLogMessageType").WALLPAPER:z(a,e);break;case b("MercuryLogMessageType").GENERIC_ADMIN_TEXT:var h=b("convertMIGColorToFIGColor")(c&&c.solid_color);b("Bootloader").loadModules(["MercuryXMATRenderer"],function(b){e(b.renderText(h,a,d))},"MercuryLogMessageRenderer");break;default:b("Bootloader").loadModules(["MercurySpecialLogMessageRenderer"],function(b){b.renderText(a,e)},"MercuryLogMessageRenderer");break}},renderIcon:function(a){return k.jsx(b("Image.react"),{className:l(a.log_message_type,a.log_message_data),src:j("99239")})}};e.exports=a;function l(a,c){c=!!(c&&c.answered);var d=!a||a===b("MercuryLogMessageType").GENERIC_ADMIN_TEXT;return"_5wzu"+(a===b("MercuryLogMessageType").SUBSCRIBE?" _5wzj":"")+(a===b("MercuryLogMessageType").UNSUBSCRIBE?" _5wzk":"")+(a===b("MercuryLogMessageType").THREAD_NAME?" _5wzl":"")+(a===b("MercuryLogMessageType").THREAD_IMAGE?" _5wzm":"")+(a===b("MercuryLogMessageType").VIDEO_CALL&&c?" _5wzn":"")+(a===b("MercuryLogMessageType").VIDEO_CALL&&!c?" _5wzo":"")+(a===b("MercuryLogMessageType").PHONE_CALL&&c?" _5wzp":"")+(a===b("MercuryLogMessageType").PHONE_CALL&&!c?" _5wzq":"")+(a===b("MercuryLogMessageType").SERVER_ERROR?" _5wzr":"")+(d?" _2r5l":"")}function m(a,c){a.log_message_data||i(0,1204);var d=b("MercuryMessageRendererUtils").moveCurrentUserToFront(a.log_message_data.added_participants);d||i(0,1205);switch(d.length){case 1:n(a,c,d);break;case 2:o(a,c,d);break;case 3:p(a,c,d);break;default:q(a,c,d);break}}function n(a,c,d){var e=[a.author,d[0]];b("MessengerParticipants.bs").getMulti(e,function(e){a.author===b("MercuryViewer").getID()?c(h._("You added {subscriber1}.",[h._param("subscriber1",b("MercuryMessageRendererUtils").getLinkToParticipant(e[d[0]]))])):d[0]===b("MercuryViewer").getID()?c(h._("{actor} added you.",[h._param("actor",b("MercuryMessageRendererUtils").getLinkToParticipant(e[a.author]))])):c(h._("{actor} added {subscriber1}.",[h._param("actor",b("MercuryMessageRendererUtils").getLinkToParticipant(e[a.author])),h._param("subscriber1",b("MercuryMessageRendererUtils").getLinkToParticipant(e[d[0]]))]))})}function o(a,c,d){var e=[a.author].concat(d);b("MessengerParticipants.bs").getMulti(e,function(e){a.author===b("MercuryViewer").getID()?c(h._("You added {subscriber1} and {subscriber2}.",[h._param("subscriber1",b("MercuryMessageRendererUtils").getLinkToParticipant(e[d[0]])),h._param("subscriber2",b("MercuryMessageRendererUtils").getLinkToParticipant(e[d[1]]))])):d[0]===b("MercuryViewer").getID()?c(h._("{actor} added you and {subscriber2}.",[h._param("actor",b("MercuryMessageRendererUtils").getLinkToParticipant(e[a.author])),h._param("subscriber2",b("MercuryMessageRendererUtils").getLinkToParticipant(e[d[1]]))])):c(h._("{actor} added {subscriber1} and {subscriber2}.",[h._param("actor",b("MercuryMessageRendererUtils").getLinkToParticipant(e[a.author])),h._param("subscriber1",b("MercuryMessageRendererUtils").getLinkToParticipant(e[d[0]])),h._param("subscriber2",b("MercuryMessageRendererUtils").getLinkToParticipant(e[d[1]]))]))})}function p(a,c,d){var e=[a.author].concat(d);b("MessengerParticipants.bs").getMulti(e,function(e){if(a.author===b("MercuryViewer").getID())c(h._("You added {subscriber1}, {subscriber2} and {subscriber3}.",[h._param("subscriber1",b("MercuryMessageRendererUtils").getLinkToParticipant(e[d[0]])),h._param("subscriber2",b("MercuryMessageRendererUtils").getLinkToParticipant(e[d[1]])),h._param("subscriber3",b("MercuryMessageRendererUtils").getLinkToParticipant(e[d[2]]))]));else if(d[0]===b("MercuryViewer").getID())c(h._("{actor} added you, {subscriber2} and {subscriber3}.",[h._param("actor",b("MercuryMessageRendererUtils").getLinkToParticipant(e[a.author])),h._param("subscriber2",b("MercuryMessageRendererUtils").getLinkToParticipant(e[d[1]])),h._param("subscriber3",b("MercuryMessageRendererUtils").getLinkToParticipant(e[d[2]]))]));else{var f;c(h._("{actor} added {subscriber1}, {subscriber2} and {subscriber3}.",[h._param("actor",(f=b("MercuryMessageRendererUtils")).getLinkToParticipant(e[a.author])),h._param("subscriber1",f.getLinkToParticipant(e[d[0]])),h._param("subscriber2",f.getLinkToParticipant(e[d[1]])),h._param("subscriber3",f.getLinkToParticipant(e[d[2]]))]))}})}function q(a,c,d){var e=[a.author].concat(d);b("MessengerParticipants.bs").getMulti(e,function(e){function f(a){var c=k.jsx("div",{children:a.map(function(a){return k.jsx("div",{children:a.name})})});return k.jsx(b("TooltipLink.react"),{alignH:"center",position:"above",tooltip:c,children:h._({"*":"{num} more"},[h._param("num",a.length,[0])])})}var g=d.map(function(a){return e[a]});a.author===b("MercuryViewer").getID()?c(h._("You added {subscriber1}, {subscriber2} and {more_people}.",[h._param("subscriber1",b("MercuryMessageRendererUtils").getLinkToParticipant(g[0])),h._param("subscriber2",b("MercuryMessageRendererUtils").getLinkToParticipant(g[1])),h._param("more_people",f(g.slice(2)))])):d[0]===b("MercuryViewer").getID()?c(h._("{actor} added you, {subscriber2} and {more_people}.",[h._param("actor",b("MercuryMessageRendererUtils").getLinkToParticipant(e[a.author])),h._param("subscriber2",b("MercuryMessageRendererUtils").getLinkToParticipant(g[1])),h._param("more_people",f(g.slice(2)))])):c(h._("{actor} added {subscriber1}, {subscriber2} and {more_people}.",[h._param("actor",b("MercuryMessageRendererUtils").getLinkToParticipant(e[a.author])),h._param("subscriber1",b("MercuryMessageRendererUtils").getLinkToParticipant(g[0])),h._param("subscriber2",b("MercuryMessageRendererUtils").getLinkToParticipant(g[1])),h._param("more_people",f(g.slice(2)))]))})}function r(a,c){var d=[a.author];a.log_message_data||i(0,2425);var e=a.log_message_data.removed_participants;e||i(0,2427);var f;e.length===1&&(f=e[0],d.push(f));b("MessengerParticipants.bs").getMulti(d,function(d){var e=d[a.author];d=d[f];a.author===b("MercuryViewer").getID()?!f||f===a.author?c(h._("You left the conversation.")):c(h._("You removed {name} from the conversation.",[h._param("name",b("MercuryMessageRendererUtils").getLinkToParticipant(d))])):!f||f===a.author?c(h._("{actor} left the conversation.",[h._param("actor",b("MercuryMessageRendererUtils").getLinkToParticipant(e))])):f===b("MercuryViewer").getID()?c(h._("{actor} removed you from the conversation.",[h._param("actor",b("MercuryMessageRendererUtils").getLinkToParticipant(e))])):c(h._("{actor} removed {name} from the conversation.",[h._param("actor",b("MercuryMessageRendererUtils").getLinkToParticipant(e)),h._param("name",b("MercuryMessageRendererUtils").getLinkToParticipant(d))]))})}function s(a,c){var d=[a.author];a.log_message_data||i(0,2425);var e=a.log_message_data.removed_participants;e||i(0,2427);var f;e.length===1&&(f=e[0],d.push(f));b("MessengerParticipants.bs").getMulti(d,function(d){var e=d[a.author];d=d[f];a.author===b("MercuryViewer").getID()?!f||f===a.author?c(h._("You left the room.")):c(h._("You removed {name} from the room.",[h._param("name",b("MercuryMessageRendererUtils").getLinkToParticipant(d))])):!f||f===a.author?c(h._("{actor} left the room.",[h._param("actor",b("MercuryMessageRendererUtils").getLinkToParticipant(e))])):f===b("MercuryViewer").getID()?c(h._("{actor} removed you from the room.",[h._param("actor",b("MercuryMessageRendererUtils").getLinkToParticipant(e))])):c(h._("{actor} removed {name} from the room.",[h._param("actor",b("MercuryMessageRendererUtils").getLinkToParticipant(e)),h._param("name",b("MercuryMessageRendererUtils").getLinkToParticipant(d))]))})}function t(a,c,d){a.log_message_data||i(0,2425);var e=a.log_message_data.name,f="_5wzs"+(b("UserAgent").isBrowser("Chrome")?" _4fbd":"");if(a.author===b("MercuryViewer").getID())if(e){var g=k.jsx(b("MessengerTextWithEmoticons.react"),{renderEmoticons:!0,renderEmoji:!0,text:e});d(h._("You named the room: {name}.",[h._param("name",k.jsx("span",{className:f,children:g}))]))}else d(h._("You removed the room name."));else b("MessengerParticipants.bs").get(a.author,function(a){a=b("MercuryMessageRendererUtils").getLinkToParticipant(a,c);if(e){var g=k.jsx(b("MessengerTextWithEmoticons.react"),{renderEmoticons:!0,renderEmoji:!0,text:e});d(h._("{actor} named the room: {name}.",[h._param("actor",a),h._param("name",k.jsx("span",{className:f,children:g}))]))}else d(h._("{actor} removed the room name.",[h._param("actor",a)]))})}function u(a,c,d,e,f){a.author===b("MercuryViewer").getID()?f(h._("You named the group {thread_name}. Your group is also on Facebook.",[h._param("thread_name",k.jsx("span",{className:e,children:k.jsx(b("MessengerTextWithEmoticons.react"),{renderEmoticons:!0,renderEmoji:!0,text:d})}))])):b("MessengerParticipants.bs").get(a.author,function(a){a=b("MercuryMessageRendererUtils").getLinkToParticipant(a,c);f(h._("{actor} named the group {thread_name}. Your group is also on Facebook.",[h._param("actor",a),h._param("thread_name",k.jsx("span",{className:e,children:k.jsx(b("MessengerTextWithEmoticons.react"),{renderEmoticons:!0,renderEmoji:!0,text:d})}))]))})}function v(a,c){a.log_message_data||i(0,2425);var d=a.log_message_data.name,e="_5wzs"+(b("UserAgent").isBrowser("Chrome")?" _4fbd":"");if(d){a.source==="source:work:defaultgroupchat:creation"?c(h._("You can now chat to this group on Workplace Chat.")):c(h._("You can now chat to {name} on Workplace Chat.",[h._param("name",k.jsx("span",{className:e,children:k.jsx(b("MessengerTextWithEmoticons.react"),{renderEmoticons:!0,renderEmoji:!0,text:d})}))]));return}}function w(a,c,d){a.log_message_data||i(0,2425);var e=a.log_message_data.name,f="_5wzs"+(b("UserAgent").isBrowser("Chrome")?" _4fbd":"");if(e&&a.tags&&a.tags.indexOf("source:messenger_growth:event_upcoming_bump")!==-1)d(h._("The group has been named {name}.",[h._param("name",k.jsx("span",{className:f,children:k.jsx(b("MessengerTextWithEmoticons.react"),{renderEmoticons:!0,renderEmoji:!0,text:e})}))]));else if(e&&a.tags&&a.tags.indexOf("source:groupsync:naming")!==-1)u(a,c,e,f,d);else if(a.author===b("MercuryViewer").getID())if(e){var g=k.jsx(b("MessengerTextWithEmoticons.react"),{renderEmoticons:!0,renderEmoji:!0,text:e});d(h._("You named the conversation: {name}.",[h._param("name",k.jsx("span",{className:f,children:g}))]))}else d(h._("You removed the conversation name."));else b("MessengerParticipants.bs").get(a.author,function(a){a=b("MercuryMessageRendererUtils").getLinkToParticipant(a,c);if(e){var g=k.jsx(b("MessengerTextWithEmoticons.react"),{renderEmoticons:!0,renderEmoji:!0,text:e});d(h._("{actor} named the conversation: {name}.",[h._param("actor",a),h._param("name",k.jsx("span",{className:f,children:g}))]))}else d(h._("{actor} removed the conversation name.",[h._param("actor",a)]))})}function x(a,c,d){a.author===b("MercuryViewer").getID()?(a.log_message_data||i(0,2425),a.log_message_data.image?d(h._("You changed the room picture.")):d(h._("You removed the room picture."))):b("MessengerParticipants.bs").get(a.author,function(e){e=b("MercuryMessageRendererUtils").getLinkToParticipant(e,c);a.log_message_data||i(0,2425);a.log_message_data.image?d(h._("{actor} changed the room picture.",[h._param("actor",e)])):d(h._("{actor} removed the room picture.",[h._param("actor",e)]))})}function y(a,c,d){a.tags!==void 0&&a.tags.indexOf("source:messenger_growth:event_upcoming_bump")!==-1?d(h._("The conversation picture has been set.")):a.author===b("MercuryViewer").getID()?(a.log_message_data||i(0,2425),a.log_message_data.image?d(h._("You changed the conversation picture.")):d(h._("You removed the conversation picture."))):b("MessengerParticipants.bs").get(a.author,function(e){e=b("MercuryMessageRendererUtils").getLinkToParticipant(e,c);a.log_message_data||i(0,2425);a.log_message_data.image?d(h._("{actor} changed the conversation picture.",[h._param("actor",e)])):d(h._("{actor} removed the conversation picture.",[h._param("actor",e)]))})}function z(a,c){a.author===b("MercuryViewer").getID()?c(h._("You changed the wallpaper.")):b("MessengerParticipants.bs").get(a.author,function(a){a=b("MercuryMessageRendererUtils").getLinkToParticipant(a);c(h._("{actor} changed the wallpaper.",[h._param("actor",a)]))})}function A(a,c){var d=[a.author];a.log_message_data||i(0,2425);var e=a.log_message_data.removed_participants;e||i(0,2427);var f;e.length===1&&(f=e[0],d.push(f));b("MessengerParticipants.bs").getMulti(d,function(d){var e=d[a.author];d=d[f];a.author===b("MercuryViewer").getID()?!f||f===a.author?c(h._("You left the chat.")):c(h._("You removed {name} from the chat.",[h._param("name",b("MercuryMessageRendererUtils").getLinkToParticipant(d))])):!f||f===a.author?c(h._("{actor} left the chat.",[h._param("actor",b("MercuryMessageRendererUtils").getLinkToParticipant(e))])):f===b("MercuryViewer").getID()?c(h._("{actor} removed you from the chat.",[h._param("actor",b("MercuryMessageRendererUtils").getLinkToParticipant(e))])):c(h._("{actor} removed {name} from the chat.",[h._param("actor",b("MercuryMessageRendererUtils").getLinkToParticipant(e)),h._param("name",b("MercuryMessageRendererUtils").getLinkToParticipant(d))]))})}function B(a,c,d){a.log_message_data||i(0,2425);var e=a.log_message_data.name,f="_5wzs"+(b("UserAgent").isBrowser("Chrome")?" _4fbd":"");if(a.author===b("MercuryViewer").getID())if(e){var g=k.jsx(b("MessengerTextWithEmoticons.react"),{renderEmoticons:!0,renderEmoji:!0,text:e});d(h._("You named the chat {name}.",[h._param("name",k.jsx("span",{className:f,children:g}))]))}else d(h._("You removed the chat name."));else b("MessengerParticipants.bs").get(a.author,function(a){a=b("MercuryMessageRendererUtils").getLinkToParticipant(a,c);if(e){var g=k.jsx(b("MessengerTextWithEmoticons.react"),{renderEmoticons:!0,renderEmoji:!0,text:e});d(h._("{actor} named the chat {name}.",[h._param("actor",a),h._param("name",k.jsx("span",{className:f,children:g}))]))}else d(h._("{actor} removed the chat name.",[h._param("actor",a)]))})}function C(a,c,d){a.author===b("MercuryViewer").getID()?(a.log_message_data||i(0,2425),a.log_message_data.image?d(h._("You changed the chat picture.")):d(h._("You removed the chat picture."))):b("MessengerParticipants.bs").get(a.author,function(e){e=b("MercuryMessageRendererUtils").getLinkToParticipant(e,c);a.log_message_data||i(0,2425);a.log_message_data.image?d(h._("{actor} changed the chat picture.",[h._param("actor",e)])):d(h._("{actor} removed the chat picture.",[h._param("actor",e)]))})}}),null);
__d("MercuryLogMessage.react",["cx","fbt","DOMDimensions","MercuryLogMessageRenderer","MercuryLogMessageType","React","ShimButton.react","cancelAnimationFrame","emptyFunction","formatDate","joinClasses","prop-types","requestAnimationFrame"],(function(a,b,c,d,e,f,g,h){"use strict";var i=b("React");a=function(a){babelHelpers.inheritsLoose(c,a);function c(){var b,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return(b=c=a.call.apply(a,[this].concat(e))||this,c.state={messageText:null},c.$1=!1,c.$4=function(){c.$5()},b)||babelHelpers.assertThisInitialized(c)}var d=c.prototype;d.componentDidMount=function(){this.$1=!0,this.UNSAFE_componentWillReceiveProps(this.props)};d.componentWillUnmount=function(){this.$1=!1,this.$2&&b("cancelAnimationFrame")(this.$2)};d.$3=function(){return i.jsx(b("ShimButton.react"),{form:"link",onClick:this.$4,children:h._("Show previous messages.")})};d.$5=function(){var a=this.props.loadMoreMessages&&this.props.loadMoreMessages();if(!this.$1)return;if(a)this.setState({messageText:this.$3()});else{a=h._("Couldn't find previous messages.");this.setState({messageText:a})}};d.UNSAFE_componentWillReceiveProps=function(a){if(a.message.log_message_type===b("MercuryLogMessageType").SERVER_ERROR)return;b("MercuryLogMessageRenderer").renderText(a.message,a.thread,a.isLastOfType,function(a){this.$1&&this.setState({messageText:a})}.bind(this))};d.shouldComponentUpdate=function(a,b){return this.state.messageText!=b.messageText||a.maxWidth!==this.props.maxWidth};d.componentDidUpdate=function(){this.$6()};d.render=function(){return i.jsx("div",babelHelpers["extends"]({},this.props,{className:b("joinClasses")(this.props.className,"_5ye6"),ref:"wrap",style:babelHelpers["extends"]({},this.props.style,this.$7()),title:b("formatDate")(new Date(this.props.message.timestamp),"g:ia"),children:i.jsxs("div",{className:"_5ye7",children:[b("MercuryLogMessageRenderer").renderIcon(this.props.message),i.jsx("span",{"data-testid":void 0,children:this.state.messageText})]})}))};d.$7=function(){return this.props.maxWidth?{maxWidth:this.props.maxWidth}:null};d.$6=function(){var a=this;this.$2&&b("cancelAnimationFrame")(this.$2);if(!this.$1)return;this.$2=b("requestAnimationFrame")(function(){a.props.onImageLoad&&a.props.onImageLoad(b("DOMDimensions").getElementDimensions(a.refs.wrap).height),delete a.$2})};return c}(i.Component);a.propTypes={loadMoreMessages:(c=b("prop-types")).func,maxWidth:c.number,message:c.object.isRequired,onImageLoad:c.func,thread:c.object,isLastOfType:c.bool.isRequired};a.defaultProps={onImageLoad:b("emptyFunction")};e.exports=a}),null);
__d("MessengerQuickReplyUtils",["fbt"],(function(a,b,c,d,e,f,g){"use strict";a={localizeTitleIfNecessary:function(a){return a.map(function(a){return a.content_type==="location"?Object.assign(a,{title:g._("Send Location")}):a})},birthdayDataToString:function(a){var b=a.month,c=a.day;a=a.year;b=b+"/"+c+"/"+a;return b}};e.exports=a}),null);
__d("MessengerUserProfileLocationUtils",["MessengerBusinessQuickReplyLocationQueryWebGraphQLQuery","RelayFBEnvironment","RelayHooks","WebGraphQL","MessengerUserProfileLocationUtilsQuery.graphql"],(function(a,b,c,d,e,f){"use strict";var g,h=b("RelayHooks").fetchQuery;b("RelayHooks").graphql;function i(){return h(b("RelayFBEnvironment"),g!==void 0?g:g=b("MessengerUserProfileLocationUtilsQuery.graphql"),{}).toPromise()}function a(){return i().then(function(a){var c=null,d=null;a=a==null?void 0:(a=a.viewer)==null?void 0:(a=a.user)==null?void 0:a.address;a!==null&&(c=(a==null?void 0:a.region)===""?null:a==null?void 0:a.region,d=(a==null?void 0:a.postal_code)===""?null:a==null?void 0:a.postal_code);if(c!==null&&d!==null)return{region:c,postal_code:d};else return b("WebGraphQL").exec(new(b("MessengerBusinessQuickReplyLocationQueryWebGraphQLQuery"))({})).then(function(a){a=(a=a)!=null?a.in_thread_user_fuzzy_location_search:a;if(a!==null){var b;c=c===null?(b=a)!=null?b.state:b:c;d=d===null?(b=a)!=null?b.zip_code:b:d}return{region:c,postal_code:d}})})}e.exports={FetchMessengerUserRegionAndPostalCode:a}}),null);
__d("MercuryQuickReply.react",["cx","BootloadedComponent.react","JSResource","MercuryIDs","MessengerQuickCamOrigins","MessengerQuickReplyUtils","MessengerUserProfileLocationUtils","MessengerViewBirthdayQueryWebGraphQLQuery","MessengerViewerContactMethodsWebGraphQLQuery","React","WebGraphQL","XUISpinner.react","gkx","promiseDone","prop-types"],(function(a,b,c,d,e,f,g){"use strict";var h=b("MessengerUserProfileLocationUtils").FetchMessengerUserRegionAndPostalCode,i=b("React");a=function(a){babelHelpers.inheritsLoose(c,a);function c(){var b,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return(b=c=a.call.apply(a,[this].concat(e))||this,c.state={viewerBirthday:null,viewerEmail:null,viewerPhone:null,viewerState:null,viewerZipCode:null},b)||babelHelpers.assertThisInitialized(c)}var d=c.prototype;d.componentDidMount=function(){this.$1(this.props.lastMessage)!==null&&this.props.quickReplyDidShow()};d.componentDidUpdate=function(a){this.$1(this.props.lastMessage)!==null&&this.$1(a.lastMessage)===null&&this.props.quickReplyDidShow(),this.$2(this.props.lastMessage)};d.render=function(){var a=this,c=this.props.lastMessage,d=b("MercuryIDs").getParticipantIDFromUserID(this.props.viewer);if(!c||c.author===d)return null;d=this.$1(c);if(Array.isArray(d)){var e=d.every(function(b){return b.content_type==="user_birthday"&&a.state.viewerBirthday===null||b.content_type==="user_email"&&a.state.viewerEmail===null||b.content_type==="user_phone_number"&&a.state.viewerPhone===null||b.content_type==="user_state"&&a.state.viewerState===null||b.content_type==="user_zip_code"&&a.state.viewerZipCode===null});if(!e){e=b("MessengerQuickReplyUtils").localizeTitleIfNecessary(d);return i.jsx("div",{className:"_419m",children:i.jsx(b("BootloadedComponent.react"),{bootloadLoader:b("JSResource")("MessengerBotsQuickReplyButtonList.react").__setRef("MercuryQuickReply.react"),bootloadPlaceholder:i.jsx(b("XUISpinner.react"),{className:"_5h-9"}),isSponsored:c.is_sponsored,messageId:c.message_id,options:e,pageId:b("MercuryIDs").getUserIDFromParticipantID(c.author),threadID:c.thread_id,quickCamOriginLocation:this.props.quickCamOriginLocation,viewer:this.props.viewer,viewerBirthday:this.state.viewerBirthday,viewerEmail:this.state.viewerEmail,viewerPhone:this.state.viewerPhone,viewerState:this.state.viewerState,viewerZipCode:this.state.viewerZipCode})})}}return null};d.$1=function(a){a=a&&a.platform_xmd&&JSON.parse(a.platform_xmd);return Array.isArray(a&&a.quick_replies)?a&&a.quick_replies:null};d.$2=function(a){var c=this;a=this.$1(a);if(!a||a.length===0)return;var d=b("gkx")("953755");d&&a.some(function(a){return a.content_type==="user_birthday"})&&b("promiseDone")(b("WebGraphQL").exec(new(b("MessengerViewBirthdayQueryWebGraphQLQuery"))({})),function(a){a=(a=a)!=null?(a=a.viewer)!=null?(a=a.user)!=null?a.birthdate:a:a:a;if(a!==null){var b,d;d=(d=a)!=null?d.month:d;b=(b=a)!=null?b.day:b;a=(a=a)!=null?a.year:a;d&&b&&a&&c.setState({viewerBirthday:{day:b,month:d,year:a}})}});a.some(function(a){return a.content_type==="user_state"||a.content_type==="user_zip_code"})&&(!this.state.viewerState||!this.state.viewerZipCode)&&b("promiseDone")(h(),function(a){var b=a==null?void 0:a.region;a=a==null?void 0:a.postal_code;c.setState({viewerState:b,viewerZipCode:a})});a.some(function(a){return a.content_type==="user_email"||a.content_type==="user_phone_number"})&&b("promiseDone")(b("WebGraphQL").exec(new(b("MessengerViewerContactMethodsWebGraphQLQuery"))({})),function(a){var b;b=(b=a)!=null?(b=b.viewer)!=null?(b=b.user)!=null?b.all_phones:b:b:b;a=(a=a)!=null?(a=a.viewer)!=null?a.all_emails:a:a;var d=b?b.find(function(a){return a.is_preferred}):null;!d&&b&&(d=b[0]);b=a?a.find(function(a){return a.is_primary}):null;c.setState({viewerEmail:(a=b)!=null?a.display_email:a,viewerPhone:(b=d)!=null?(b=b.phone_number)!=null?b.universal_number:b:b})})};return c}(i.PureComponent);a.propTypes={quickReplyDidShow:(c=b("prop-types")).func.isRequired,lastMessage:c.object,quickCamOriginLocation:c.oneOf(b("MessengerQuickCamOrigins").getValues()).isRequired,threadID:c.string.isRequired,viewer:c.string.isRequired};e.exports=a}),null);
__d("MessengerEmojiSpan.react",["cx","EmojiLikeConstants","MessengerSupportedEmojiUtils","React","cssURL","prop-types"],(function(a,b,c,d,e,f,g){"use strict";var h=b("React");a=function(a){babelHelpers.inheritsLoose(c,a);function c(){return a.apply(this,arguments)||this}var d=c.prototype;d.render=function(){if(this.props.entityKey==null)return null;var a=this.props.contentState.getEntity(this.props.entityKey);a=a.getData();a=a.type;a=b("MessengerSupportedEmojiUtils").getUrl(a,b("EmojiLikeConstants").size.SMALL);a=a?a:"";return h.jsx("span",{className:"_21wj",style:{backgroundImage:b("cssURL")(a)},"data-offset-key":this.props.offsetKey,children:h.jsx("span",{className:"_7464",children:this.props.children})})};return c}(h.PureComponent);a.propTypes={children:(c=b("prop-types")).arrayOf(c.object),contentState:c.object.isRequired,entityKey:c.string,offsetKey:c.string};e.exports=a}),null);
__d("MessengerEmoticonSpan.react",["cx","EmojiLikeConstants","EmoticonEmojiList","MessengerSupportedEmojiUtils","React","cssURL","prop-types"],(function(a,b,c,d,e,f,g){"use strict";var h=b("React");a=function(a){babelHelpers.inheritsLoose(c,a);function c(){return a.apply(this,arguments)||this}var d=c.prototype;d.render=function(){if(this.props.entityKey==null)return null;var a=this.props.contentState.getEntity(this.props.entityKey);a=a.getData();a=a.type;a=b("EmoticonEmojiList").emote2emojis[a];a=b("MessengerSupportedEmojiUtils").getUrl(a,b("EmojiLikeConstants").size.XSMALL);a=a?a:"";return h.jsx("span",{className:"_21wj",style:{backgroundImage:b("cssURL")(a)},"data-offset-key":this.props.offsetKey,children:h.jsx("span",{className:"_7464",children:this.props.children})})};return c}(h.PureComponent);a.propTypes={children:(c=b("prop-types")).arrayOf(c.object),contentState:c.object.isRequired,entityKey:c.string,offsetKey:c.string};e.exports=a}),null);
__d("MessengerMentionsEntityDecorator.react",["cx","React"],(function(a,b,c,d,e,f,g){"use strict";var h=b("React");a=function(a){babelHelpers.inheritsLoose(b,a);function b(){return a.apply(this,arguments)||this}var c=b.prototype;c.render=function(){return h.jsx("span",{className:"_fy2",children:this.props.children})};return b}(h.PureComponent);e.exports=a}),null);
__d("createMessengerMentionDraftEntity",[],(function(a,b,c,d,e,f){"use strict";function a(a,b){return a.createEntity("MENTION","SEGMENTED",{mid:b.getUniqueID()})}e.exports=a}),null);
__d("DataSource",["ArbiterMixin","AsyncRequest","SearchI18nMatch","TokenizeUtil","createArrayFromMixed","createObjectFrom","emptyFunction","killswitch","mixin","str2rstr"],(function(a,b,c,d,e,f){a=function(a){"use strict";babelHelpers.inheritsLoose(c,a);function c(c){var d;d=a.call(this)||this;d._maxResults=c.maxResults||10;d.token=c.token;d.queryData=c.queryData||{};d.queryEndpoint=c.queryEndpoint||"";d.bootstrapData=c.bootstrapData||{};d.bootstrapEndpoint=c.bootstrapEndpoint||"";d.globalKeywordsEndpoint=c.globalKeywordsEndpoint||"";d._indexedFields=c.indexedFields||["text","tokens"];d._titleFields=c.titleFields||[];d._alwaysPrefixMatch=c.alwaysPrefixMatch||!1;d._deduplicationKey=c.deduplicationKey||null;d._enabledLocalCache=c.enabledLocalCache!=null?c.enabledLocalCache:!0;d._enabledQueryCache=c.enabledQueryCache!=null?c.enabledQueryCache:!0;d._disableAllCaches=c.disableAllCaches!=null?c.disableAllCaches:!1;d._enabledMergeUids=c.enabledMergeUids!=null?c.enabledMergeUids:!1;d._queryExactMatch=c.queryExactMatch||!1;d._acrossTransitions=c.acrossTransitions||!1;d._minQueryLength=c.minQueryLength||-1;d._enforceNewRequestIDUponFetch=c.enforceNewRequestIDUponFetch||!1;d._minExactMatchLength=4;d._filters=[];d._headerflags=c.headerflags||new Map();d.transport=null;d.setExclusions(c.exclusions);d.backendUnicodeMatch=new(b("SearchI18nMatch"))({prefix_kana_hiragana_to_katakana:!!c.kanaNormalization});d.cacheUnicodeMatch=new(b("SearchI18nMatch"))({prefix_kana_hiragana_to_katakana:!!c.kanaNormalization});return d}var d=c.prototype;d.init=function(){this.init=b("emptyFunction"),this._fields=b("createObjectFrom")(this._indexedFields),this._activeQueries=0,this.dirty()};d.dirty=function(){this.value="";this._bootstrapped=!1;this._bootstrapping=!1;this._data=Object.create(null);this.localCache={};this.queryCache={};this.queryIDs={};this.inform("dirty",{});return this};d.bootstrap=function(a){a===void 0&&(a=!1);if(this._bootstrapped&&!a)return;this.bootstrapWithoutToken();this._bootstrapped=!0;this._bootstrapping=!0;this.inform("bootstrap",{bootstrapping:!0})};d.bootstrapWithoutToken=function(){this.fetch(this.bootstrapEndpoint,this.bootstrapData,{bootstrap:!0,token:this.token})};d.bootstrapWithToken=function(){var a=babelHelpers["extends"]({},this.bootstrapData);a.token=this.token;var c=b("killswitch")("DATA_SOURCE_USE_FETCH_CONTEXT_EMPTY_STRING")?{bootstrap:!0,replaceCache:!0,value:""}:{bootstrap:!0,replaceCache:!0};this.fetch(this.bootstrapEndpoint,a,c)};d.query=function(a,b,c,d,e){this.inform("beforeQuery",babelHelpers["extends"]({value:a,local_only:b,exclusions:c,time_waited:d},e));d=Date.now();if(this._disableAllCaches){this.dirty();if(!a){this.bootstrap();return!0}}else this._enabledQueryCache||(this.queryCache={},this.queryIDs={});var f=this.buildUids(a,[],c),g=this.respond(a,f);this.value=a;this.inform("query",babelHelpers["extends"]({value:a,results:g},e));var h=this.tokenizeBackend(a).flatValue;if(b||!h||this._isQueryTooShort(h)||!this.queryEndpoint||Object.prototype.hasOwnProperty.call(this.getQueryCache(),h)||!this.shouldFetchMoreResults(g)){this.inform("logPerformanceTiming",babelHelpers["extends"]({field:"cache_keypress_render",value:Date.now()-d},e));this.inform("completeCacheFetch");return!1}this.inform("queryEndpoint",babelHelpers["extends"]({value:a},e));this.fetch(this.queryEndpoint,this.getQueryData(a,f),babelHelpers["extends"]({value:a,exclusions:c},e));return!0};d._isQueryTooShort=function(a){return a.length<this._minQueryLength};d._tokenize=function(a,c){return b("TokenizeUtil").parse(a,c)};d.tokenizeBackend=function(a,b){a=this.backendUnicodeMatch.prefixMatchPrepare(a);return this._tokenize(a,b)};d.tokenizeCache=function(a,b){a=this.cacheUnicodeMatch.prefixMatchPrepare(a);return this._tokenize(a,b)};d.shouldFetchMoreResults=function(a){return a.length<this._maxResults};d.getQueryData=function(a,b){a=babelHelpers["extends"]({value:a},this.queryData);b=b||[];b.length&&(a.existing_ids=b.join(","));this._bootstrapping&&(a.bsp=!0);return a};d.setQueryData=function(a,b){b&&(this.queryData={});Object.assign(this.queryData,a);return this};d.setBootstrapData=function(a,b){b&&(this.bootstrapData={});Object.assign(this.bootstrapData,a);return this};d.getExclusions=function(){return b("createArrayFromMixed")(this._exclusions)};d.setExclusions=function(a){this._exclusions=a?a.map(String):[]};d.addFilter=function(a){var b=this._filters;b.push(a);return{remove:function(){b.splice(b.indexOf(a),1)}}};d.clearFilters=function(){this._filters=[]};d.notify=function(a,b,c,d){b=this.buildData(b);this.inform("notify",{value:a,results:b,isAsync:!!c,rootid:d});return b};d.respond=function(a,b,c){b=this.buildData(b);this.processResults(a,b,c);this.inform("respond",{value:a,results:b,isAsync:!!c});return b};d.respondWithResults=function(a,b,c){this.processResults(a,b,c);this.inform("respond",{value:a,results:b,isAsync:!!c});return b};d.processResults=function(a,b,c){if(this.bootstrapData.alwaysShowEcho){c=-1;for(var d=0;d<b.length;++d)if(b[d].text.toLowerCase()===a.toLowerCase()){c=d;break}d={};c===-1?(d={bootstrapped:!1,index:0,query:a,render_type:"hashtag",text:a,type:"hashtag",uid:this.getUniqueID()},b.map(function(a){a.index+=1}),b.unshift(d)):c>0&&(d=b.splice(c,1)[0],b.unshift(d),b.map(function(a,b){a.index=b}))}};d.getUniqueID=function(){var a="_"+Math.random().toString(36).substr(2,9);while(this._data[a]!==void 0)a="_"+Math.random().toString(36).substr(2,9);return a};d.fetch=function(a,c,d){var e=this;if(!a)return;(this._enforceNewRequestIDUponFetch||c.request_id===void 0)&&(c.request_id=this._guid(),d.request_id=c.request_id);c=new(b("AsyncRequest"))().setURI(a).setData(c).setMethod("GET").setReadOnly(!0).setAllowCrossPageTransition(this._acrossTransitions).setHandler(function(a){this.fetchHandler(a,d||{})}.bind(this));if(a===this.queryEndpoint){for(var f=this._headerflags,g=Array.isArray(f),h=0,f=g?f:f[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var i;if(g){if(h>=f.length)break;i=f[h++]}else{h=f.next();if(h.done)break;i=h.value}i=i;var j=i[0];i=i[1];c.setRequestHeader(j,i)}c.setFinallyHandler(function(){this._activeQueries--,this._activeQueries||this.inform("activity",{activity:!1})}.bind(this))}c.setErrorHandler(function(a){return e.asyncErrorHandler(a,d)});this.inform("beforeFetch",{request:c,fetch_context:d});c.send();this.transport=c.transport;a===this.queryEndpoint&&(this._activeQueries||this.inform("activity",{activity:!0}),this._activeQueries++)};d.fetchHandler=function(a,b){var c=b.value,d=b.exclusions;a.getPayload().requestID!==void 0&&(b.request_id=a.getPayload().requestID);var e=this.getQueryIDs(),f=this.tokenizeBackend(c||"").flatValue;e[f]=b.request_id;!c&&b.replaceCache&&(this.localCache={});this.inform("buildQueryCache",{});e=a.getPayload().entries;this.addEntries(e,c);this.inform("fetchComplete",{entries:e,response:a,value:c,fetch_context:b});f=!c&&this.value?this.value:c;this.respond(f,this.buildUids(f,[],d),!0);c||(this._bootstrapping&&(this._bootstrapping=!1,this.inform("bootstrap",{bootstrapping:!1})),b.token&&a.getPayload().token!==b.token&&this.bootstrapWithToken())};d.addEntries=function(a,c){a=this.processEntries(b("createArrayFromMixed")(a||[]),c);var d=a;this._enabledMergeUids&&(d=this.buildUids(c,a));if(c){var e=this.getQueryCache();c=this.tokenizeBackend(c).flatValue;e[c]=d}else this.fillCache(d);return a};d.processEntries=function(a,b){return a.map(function(a,c){var d=a.uid=a.uid+"",e=this.getEntry(d);!e?(e=a,e.query=b,e.bootstrapped=!b,this.setEntry(d,e)):Object.assign(e,a);this.processEntry(e,b);e.index===void 0&&(e.index=c);return d},this)};d.processEntry=function(a,b){};d.getAllEntries=function(){return this._data||{}};d.getEntry=function(a){return this._data[a]||null};d.setEntry=function(a,b){this._data[a]=b};d.fillCache=function(a){if(!this._enabledLocalCache)return;var b=this.localCache;a.forEach(function(a){var c=this.getEntry(a);if(!c)return;c=this.tokenizeCache(this.getTextToIndex(c)).tokens;for(var d=0,e=c.length;d<e;++d){var f=c[d];Object.prototype.hasOwnProperty.call(b,f)||(b[f]={});b[f][a]=!0}},this)};d.getTextToIndex=function(a){if(a.textToIndex&&!a.needs_update)return a.textToIndex;a.needs_update=!1;a.textToIndex=this.getTextToIndexFromFields(a,this._indexedFields);return a.textToIndex};d.getTextToIndexFromFields=function(a,b){var c=[];for(var d=0;d<b.length;++d){var e=a[b[d]];e&&c.push(e.join?e.join(" "):e)}return c.join(" ")};d.mergeUids=function(a,b,c,d){this.inform("mergeUids",{local_uids:a,query_uids:b,new_uids:c,value:d});this._checkExtendedMatch(d,a);return this.deduplicateByKey(a.sort(this.bootstrapSort.bind(this)).concat(b,c))};d.bootstrapSort=function(a,b){a=this.getEntry(a);b=this.getEntry(b);if(a.extended_match!==b.extended_match)return a.extended_match?1:-1;if(a.index!==b.index)return a.index-b.index;if(a.text.length!==b.text.length)return a.text.length-b.text.length;return a.text===b.text?a.uid<b.uid?-1:1:a.text<b.text?-1:1};d._checkExtendedMatch=function(a,c){var d=this._alwaysPrefixMatch?b("TokenizeUtil").isPrefixMatch:b("TokenizeUtil").isQueryMatch;for(var e=0;e<c.length;++e){var f=this.getEntry(c[e]);f.extended_match=f.tokens?!d(a,f.text):!1}};d.buildUids=function(a,c,d){c||(c=[]);if(!a)return c;d||(d=[]);var e=this.buildCacheResults(a,this.localCache),f=this.buildQueryResults(a);e=this.mergeUids(e,f,c,a);var g=b("createObjectFrom")(d.concat(this._exclusions));f=e.filter(function(b){if(Object.prototype.hasOwnProperty.call(g,b)||!this.getEntry(b))return!1;for(var c=0;c<this._filters.length;++c)if(!this._filters[c](this.getEntry(b),a))return!1;return g[b]=!0},this);return this.uidsIncludingExact(a,f)};d.uidsIncludingExact=function(a,c){var d=c.length;if(d<=this._maxResults||b("str2rstr")(a).length<this._minExactMatchLength)return c;for(var e=0;e<d;++e){var f=this.getEntry(c[e]);if(f.text==null&&f.text_lower==null)continue;f.text_lower||(f.text_lower=f.text.toLowerCase());if(f.text_lower===this.tokenizeCache(a).flatValue){if(e>=this._maxResults){f=c.splice(e,1)[0];c.splice(this._maxResults-1,0,f)}break}}return c};d.buildData=function(a){var b=[],c=Math.min(a.length,this._maxResults);for(var d=0;d<c;++d)b.push(this.getEntry(a[d]));return b};d.findBestPreviousQuery=function(a,b){var c=0,d=null;if(this._queryExactMatch)return Object.prototype.hasOwnProperty.call(b,a)?a:null;for(var e in b)a.indexOf(e)===0&&e.length>c&&(c=e.length,d=e);return d};d.findQueryCache=function(a){a=this.findBestPreviousQuery(a,this.getQueryCache());return this.getQueryCache()[a]||[]};d.buildQueryResults=function(a){a=this.tokenizeBackend(a).flatValue;var b=this.findQueryCache(a);if(Object.prototype.hasOwnProperty.call(this.getQueryCache(),a))return b;a=this.filterQueryResults(a,b);return a};d.filterQueryResults=function(a,c){var d=this._alwaysPrefixMatch?b("TokenizeUtil").isPrefixMatch:b("TokenizeUtil").isQueryMatch;return c.filter(function(b){return d(a,this.getTextToIndex(this.getEntry(b)))},this)};d.buildCacheResults=function(a,b){var c=this.tokenizeCache(a,this._alwaysPrefixMatch),d=this._alwaysPrefixMatch?c.sortedTokens:c.tokens,e=d.length;c=c.isPrefixQuery?e-1:null;var f={},g={},h={},i=[],j=!1,k={},l=0;for(var m=0;m<e;++m){var n=d[m];if(!Object.prototype.hasOwnProperty.call(k,n))l++,k[n]=!0;else continue;for(var o in b)if(!Object.prototype.hasOwnProperty.call(f,o)&&o===n||(this._alwaysPrefixMatch||c===m)&&this.cacheUnicodeMatch.prefixMatch(o,n)){o===n?(Object.prototype.hasOwnProperty.call(g,o)&&(j=!0),f[o]=!0):((Object.prototype.hasOwnProperty.call(f,o)||Object.prototype.hasOwnProperty.call(g,o))&&(j=!0),g[o]=!0);for(var p in b[o])(m===0||Object.prototype.hasOwnProperty.call(h,p)&&h[p]==l-1)&&(h[p]=l)}}n=a.toLowerCase();for(o in b)if(!Object.prototype.hasOwnProperty.call(f,o)&&this.cacheUnicodeMatch.prefixMatch(o,n))for(p in b[o])h[p]=l;for(var q in h)h[q]==l&&i.push(q);(j||l<e)&&(i=this.filterQueryResults(a,i));this._titleFields&&this._titleFields.length>0&&(i=this.filterNonTitleMatchQueryResults(a,i));return i};d.filterNonTitleMatchQueryResults=function(a,c){return c.filter(function(c){var d=this.tokenizeCache(a),e=d.tokens.length;if(e===0)return!0;c=this.getTitleTerms(this.getEntry(c));d=d.tokens[0];return e===1||this._alwaysPrefixMatch?b("TokenizeUtil").isPrefixMatch(d,c)||this.cacheUnicodeMatch.prefixMatch(c,d):b("TokenizeUtil").isQueryMatch(d,c)},this)};d.getTitleTerms=function(a){a.titleToIndex||(a.titleToIndex=this.getTextToIndexFromFields(a,this._titleFields));return a.titleToIndex};d.deduplicateByKey=function(a){if(!this._deduplicationKey)return a;var c=b("createObjectFrom")(a.map(this._getDeduplicationKey.bind(this)),a);return a.filter(function(a){return c[this._getDeduplicationKey(a)]==a}.bind(this))};d._getDeduplicationKey=function(a){var b=this.getEntry(a);if(b[this._deduplicationKey])return b[this._deduplicationKey]+"";else return"__"+a+"__"};d.getQueryCache=function(){return this.queryCache};d.getQueryIDs=function(){return this.queryIDs};d.setMaxResults=function(a){this._maxResults=a,this.value&&this.respond(this.value,this.buildUids(this.value))};d.getMaxResults=function(){return this._maxResults};d.updateToken=function(a){this.token=a;this.dirty();return this};d.getResponseHeaderValue=function(a){var b="";this.transport&&(b=this.transport.getResponseHeader(a),b||(b=""));return b};d._guid=function(){var a=Date.now(),b="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(b){var c=Math.floor((a+Math.random()*16)%16);a=Math.floor(a/16);b=(b=="x"?c:c&7|8).toString(16);return b});return b};return c}(b("mixin")(b("ArbiterMixin")));Object.assign(a.prototype,{events:["bootstrap","query","respond"],asyncErrorHandler:b("emptyFunction")});e.exports=a}),null);
__d("MercuryAudienceRestrictedTypeaheadDataSource",["CurrentUser","DataSource","OrderedFriendsList","ShortProfiles"],(function(a,b,c,d,e,f){a=function(a){"use strict";babelHelpers.inheritsLoose(c,a);function c(b){b=b||{};b.kanaNormalization=!0;b.maxResults=5;b.minQueryLength=2;b=a.call(this,b)||this;b.$MercuryAudienceRestrictedTypeaheadDataSource1=!1;b.$MercuryAudienceRestrictedTypeaheadDataSource2=!1;b.$MercuryAudienceRestrictedTypeaheadDataSource3={};b.$MercuryAudienceRestrictedTypeaheadDataSource4=!0;b.queryCache={};b.localCache={};b.queryIDs={};return b}var d=c.prototype;d.dirty=function(){return this};d.buildData=function(b){return a.prototype.buildData.call(this,b)};d.query=function(b,c,d,e){c=c||b.length===1;return a.prototype.query.call(this,b,c,d,e)};d.getQueryData=function(b,c){return babelHelpers["extends"]({},a.prototype.getQueryData.call(this,b,c))};d.setEntry=function(a,b){this.$MercuryAudienceRestrictedTypeaheadDataSource3[a]=b};d.getEntry=function(a){return this.$MercuryAudienceRestrictedTypeaheadDataSource3[a]||null};d.getCachedShortProfileIDs=function(){var a=b("ShortProfiles").getCachedProfileIDs();a=a.filter(function(a){var c=b("ShortProfiles").getNow(a);return a==b("CurrentUser").getID()||c&&(c.type==="friend"||c.type==="fb4c")});return a};d.isBootstrapped=function(){return this.$MercuryAudienceRestrictedTypeaheadDataSource1};d.isBootstrapping=function(){return this.$MercuryAudienceRestrictedTypeaheadDataSource2};d.processEntries=function(c,d){c=c&&c.map(function(a){a.index==null&&(a.render_type==="friend"||a.render_type==="fb4c")&&(a.index=b("OrderedFriendsList").getActiveRank(a.uid));return a});return a.prototype.processEntries.call(this,c)};d.mergeUids=function(b,c,d,e){var f=this;c=c.sort(function(a,b){a=f.getEntry(a);b=f.getEntry(b);return a&&a.index&&b&&b.index?a.index-b.index:0});return a.prototype.mergeUids.call(this,b,c,d,e)};d.setQueryData=function(b,c){return a.prototype.setQueryData.call(this,b)};d.respond=function(b,c,d){return a.prototype.respond.call(this,b,c,d)};d.setShowThreads=function(a){this.$MercuryAudienceRestrictedTypeaheadDataSource4=a};return c}(b("DataSource"));e.exports=a}),null);
__d("MercuryErrorInfo",["fbt","MessengerMessage.bs"],(function(a,b,c,d,e,f,g){var h={getMessage:function(a){var b="";h.isConnectionError(a)?(b=g._("This message didn't send.").toString(),h.isTransient(a)&&(b=g._("{message} Check your internet connection and click to try again.",[g._param("message",b)]).toString())):(a&&a.description?b=a.description:b=g._("This message failed to send.").toString(),h.isTransient(a)&&(b=g._("{message} Click to send again.",[g._param("message",b)]).toString()));return b},isConnectionError:function(a){return a&&a.type==2?a.code===1001||a.code===1004||a.code===1006:!1},isTransient:function(a){return a&&a.is_transient},isPermanent:function(a){return a?!this.isTransient(a):!1},hasErrorStatus:function(a){return b("MessengerMessage.bs").hasError(a)}};e.exports=h}),null);
__d("getGroupNameTooltipFromParticipantIDs",["fbt","MercuryViewer","MessengerParticipants.bs"],(function(a,b,c,d,e,f,g){"use strict";var h=10,i="\n";function a(a,c){var d=[],e=b("MercuryViewer").getID();a=a&&a.filter(function(a){return a!==e});if(!a||!a.length){c(null);return}var f=a.length,j=f-h;j>1&&(a=a.slice(0,h));b("MessengerParticipants.bs").getMulti(a,function(a){for(var b in a){var e=a[b];d.push(e.name)}if(j>1){e=g._("and {number of hidden chat participants} more.",[g._param("number of hidden chat participants",j)]);d.push(e)}c(d.join(i))})}function c(a){var c=[],d=b("MercuryViewer").getID();a=a&&a.filter(function(a){return a!==d});if(!a||!a.length)return null;c=a.map(function(a){a=b("MessengerParticipants.bs").getNow(a);return a&&a.name}).filter(function(a){return!!a});a=a.length-(a.length-c.length)-h;if(a>1){c=c.slice(0,h);a=g._("and {number of hidden chat participants} more.",[g._param("number of hidden chat participants",a)]);c.push(a)}return c.join(i)}e.exports={getGroupNameTooltipFromParticipantIDs:c,getGroupNameTooltipFromParticipantIDsAsync:a}}),null);
__d("getProfileRangesForContentState",["emptyFunction"],(function(a,b,c,d,e,f){"use strict";var g=b("emptyFunction").thatReturnsTrue;function a(a,b){var c=[],d=0;a.getBlockMap().forEach(function(e){var f=e.getText();e.findEntityRanges(g,function(f,g){var h=e.getEntityAt(f);if(h){h=a.getEntity(h);if(h.getType()==="MENTION"){var i=f+d;h=h.getData().mid;var j=null;b&&h===b?j="t":b&&h===b+"-active"?(h=b,j="a"):/^\d+$/.test(h)&&(j="p");j!==null&&c.push({id:h,offset:i,length:g-f,type:j})}}});d+=f.length+1});return c}e.exports=a}),null);
__d("getThreadTypeNameFromThreadType",["MessagingThreadType"],(function(a,b,c,d,e,f){"use strict";function a(a){for(var c in b("MessagingThreadType"))if(b("MessagingThreadType")[c]===a)return c;return""}e.exports=a}),null);
__d("getVisibleValueForContentStateWithMessengerEmoji",["EmojiFormat.bs","emptyFunction"],(function(a,b,c,d,e,f){"use strict";function a(a){var c=a.getBlockMap().map(function(c){var d=c.getText(),e="";c.findEntityRanges(b("emptyFunction").thatReturnsTrue,function(f,g){var h=c.getEntityAt(f);if(!h)e+=d.slice(f,g);else{h=a.getEntity(h);if(h.getType()==="EMOTICON")e+=h.getData().originalEmoticon;else if(h.getType()==="EMOJI"){h=h.getData().type;h=b("EmojiFormat.bs").codeStringToCodeArray(h);e+=String.fromCodePoint.apply(String,h)}else e+=d.slice(f,g)}});return e});return c.join("\n")}e.exports=a}),null);
__d("insertMessengerEmojiIntoContentState",["DraftModifier","EmojiFormat.bs"],(function(a,b,c,d,e,f){"use strict";function a(a,c,d,e){var f=c.createEntity("EMOJI","IMMUTABLE",{type:a});f=f.getLastCreatedEntityKey();var g=d.isCollapsed();if(g)return b("DraftModifier").insertText(c,d,b("EmojiFormat.bs").codeStringToUnicode(a),e,f);else return b("DraftModifier").replaceText(c,d,b("EmojiFormat.bs").codeStringToUnicode(a),e,f)}e.exports=a}),null);
__d("handleBeforeInputForMessengerEmoji",["EditorState","MessengerSupportedEmojiUtils","insertMessengerEmojiIntoContentState"],(function(a,b,c,d,e,f){"use strict";function a(a,c){var d=a.getSelection();if(!d.isCollapsed()||!c)return a;c=b("MessengerSupportedEmojiUtils").getEmojiMatchObj(c);if(!c||!c.is_supported)return a;c=b("insertMessengerEmojiIntoContentState")(c.emoji_key,a.getCurrentContent(),d,a.getCurrentInlineStyle());return b("EditorState").push(a,c,"insert-characters")}e.exports=a}),null);
__d("handleBeforeInputForMessengerEmoticon",["DraftModifier","EditorState","applyMessengerEmoticonToContentState"],(function(a,b,c,d,e,f){"use strict";var g=new RegExp(/[\s\'\".,!?]/);function a(a,c){var d=a.getSelection();if(!d.isCollapsed()||!c||!g.test(c))return a;var e=a.getCurrentContent();d=b("applyMessengerEmoticonToContentState")(e,d);if(d===e)return a;e=b("DraftModifier").insertText(d,d.getSelectionAfter(),c);return b("EditorState").push(a,e,"insert-characters")}e.exports=a}),null);
__d("handleSoftNewlineForMessengerEmoticon",["DraftModifier","EditorState","applyMessengerEmoticonToContentState"],(function(a,b,c,d,e,f){"use strict";function a(a){var c=a.getCurrentContent(),d=a.getSelection(),e=b("applyMessengerEmoticonToContentState")(c,d);c=b("DraftModifier").splitBlock(e,c===e?d:e.getSelectionAfter());return b("EditorState").push(a,c,"split-block")}e.exports=a}),null);
__d("MercuryTypingAnimation_DEPRECATED.react",["cx","React","joinClasses"],(function(a,b,c,d,e,f,g){"use strict";var h=b("React");a=function(a){babelHelpers.inheritsLoose(c,a);function c(){return a.apply(this,arguments)||this}var d=c.prototype;d.render=function(){return h.jsx("div",{className:b("joinClasses")("_4a0v _1x3z",this.props.className),children:h.jsxs("div",{className:"_4b0g",children:[h.jsx("div",{className:"_5pd7"}),h.jsx("div",{className:"_5pd7"}),h.jsx("div",{className:"_5pd7"})]})})};return c}(h.PureComponent);e.exports=a}),null);
__d("MercuryCanonicalGroupThreadManager",["Bootloader","KeyedCallbackManager","MercuryIDs","MercuryServerDispatcher","MercuryServerPayloadPreprocessor","MercurySingletonProvider","MessengerServerPayloadTransformer.bs","SubscriptionsHandler"],(function(a,b,c,d,e,f){"use strict";a=function(){function a(a){this.$1=a,this.$2=new(b("KeyedCallbackManager"))(),this.$3=b("MercuryServerPayloadPreprocessor").getForFBID(this.$1),this.$4={},this.$7(),this.$8(),this.$6={}}a.getForFBID=function(a){return g.getForFBID(a)};a.get=function(){return g.get()};var c=a.prototype;c.getCanonicalGroupThreadIDForParticipants=function(a,b){a=this.$9(a);var c=this.$10(a);c=this.$2.executeOrEnqueue(c,b);this.$11(a);return c};c.unsubscribe=function(a){a&&this.$2.unsubscribe(a)};c.$10=function(a){return a.sort().join(",")};c.$12=function(a,c){c=b("MercuryIDs").getThreadIDFromThreadFBID(c);this.$2.setResource(a,c);this.$4[c]=a};c.$11=function(a){var c=this.$10(a);c={canonical_group_key:c,participants:a};b("MercuryServerDispatcher").trySend("/ajax/mercury/search_canonical_groups.php",c,null,this.$1)};c.$7=function(){var a=this;b("MercuryServerDispatcher").registerEndpoints({"/ajax/mercury/search_canonical_groups.php":{request_user_id:this.$1,mode:b("MercuryServerDispatcher").IMMEDIATE,handler:function(b){a.handleUpdate(b)}}})};c.$9=function(a){a.indexOf(this.$1)===-1&&a.push(this.$1);return a};c.handleUpdate=function(a){if(a.graphql_payload){var c=b("MessengerServerPayloadTransformer.bs").transformThread(a.viewer,a.graphql_payload,a.for_page);this.$3.handleUpdate({threads:[c],payload_source:"server_search"})}c=a.canonical_group;if(c)for(var d in c)this.$12(d,c[d])};c.getNow=function(a){a=this.$10(this.$9(a));return this.$2.getResource(a)};c.$8=function(){var a=this;b("Bootloader").loadModules(["MercuryThreadInformer"],function(c){c=c.getForFBID(a.$1);var d=new(b("SubscriptionsHandler"))();d.addSubscriptions(c.subscribe("threads-deleted",function(b,c){for(var d in c)a.$4[d]&&(a.$2.setResource(a.$4[d],void 0),delete a.$4[d])}));a.$5=d},"MercuryCanonicalGroupThreadManager")};return a}();var g=new(b("MercurySingletonProvider"))(a);e.exports=a}),null);
__d("MercuryDeliveryState",["MercuryIDs","MercuryServerRequests","MercurySingletonProvider","MercuryThreadIDMap","MercuryThreadInformer","UserActivity","debounceAcrossTransitions"],(function(a,b,c,d,e,f){"use strict";a=function(){a.getForFBID=function(a){return g.getForFBID(a)};a.get=function(){return g.get()};function a(a){var c=this;this.$8=function(){if(c.$5.length===0&&Object.keys(c.$6).length===0)return;var a=c.$5.map(function(a){return a.message_id});a&&c.$2.sendDeliveryReceipts(a,c.$6);c.$6={};c.$5=[]};this.$1=a;this.$2=b("MercuryServerRequests").getForFBID(this.$1);this.$3=b("MercuryThreadInformer").getForFBID(this.$1);this.$4=b("MercuryThreadIDMap").getForFBID(this.$1);this.$5=[];this.$6={};this.$3.subscribe("messages-received",this.$7.bind(this));b("UserActivity").subscribe(b("debounceAcrossTransitions")(this.$8,300,this))}var c=a.prototype;c.$7=function(a,b){var c=this;for(var d in b){a=b[d];a.forEach(function(a){c.$9(a)&&(c.$5.push(a),c.$4.getServerIDFromClientID(d,function(b){c.$6[b]||(c.$6[b]=[]),c.$6[b].push(a.message_id)}))})}this.$8()};c.$9=function(a){var c=a.author?b("MercuryIDs").getUserIDFromParticipantID(a.author):null;if(c===this.$1)return!1;return!a.is_unread?!1:!0};return a}();var g=new(b("MercurySingletonProvider"))(a);e.exports=a}),null);
__d("MercuryReadOnlyReason",["fbt","Link.react","MercuryConfig","React","URI"],(function(a,b,c,d,e,f,g){"use strict";var h,i=b("React");a={getReason:function(a){a===void 0&&(a=!1);if(a){a=b("MercuryConfig").DYIDeepLink;return g._("Sorry, this conversation isn't active any more because messages can no longer be sent to email addresses. After 1 May 2016, conversations with email addresses will only be available in a copy of your Facebook data. {download your information}",[g._param("download your information",i.jsx("a",{href:a,children:g._("Learn more")}))])}else if(b("MercuryConfig").ViewerIsReadOnly)return g._("You've been temporarily blocked from sending messages. {learn more about blocks}",[g._param("learn more about blocks",i.jsx(b("Link.react"),{href:new(h||(h=b("URI")))("https://www.facebook.com/help/181183045316843"),target:"_blank",children:"Learn more"}))]);else if(b("MercuryConfig").ColdOpenBlock)return g._("You're temporarily blocked from starting new conversations. {learn more about blocks}",[g._param("learn more about blocks",i.jsx(b("Link.react"),{href:new(h||(h=b("URI")))("https://www.facebook.com/help/181183045316843"),target:"_blank",children:"Learn more"}))]);else return g._("You cannot reply to this conversation.")}};e.exports=a}),null);
__d("MercurySyncEnvironment",["Arbiter","ChannelInitialData","CurrentUser","MercurySyncDeltaHandler"],(function(a,b,c,d,e,f){"use strict";function a(){if(!b("ChannelInitialData").channelConfig)return;b("MercurySyncDeltaHandler").get();b("Arbiter").inform("MercurySyncDeltaHandler/initSeqID",{fbid:b("CurrentUser").getAccountID(),seqID:b("ChannelInitialData").channelConfig?b("ChannelInitialData").channelConfig.sequenceId:0})}e.exports={setUp:a}}),null);
__d("MercuryTriodeSourceUtil",["MessengerEnvironment"],(function(a,b,c,d,e,f){"use strict";a={getMercuryTriodeSource:function(){return b("MessengerEnvironment").messengerdotcom?"source:messenger:web":"source:titan:web"}};e.exports=a}),null);
__d("shouldAddMRefParam",["isFacebookURI"],(function(a,b,c,d,e,f){a=function(a){if(!b("isFacebookURI")(a)||a.getFragment())return!1;return/^\/events\//.test(a.getPath())?!0:!1};e.exports=a}),null);
__d("isWebMessengerURI",[],(function(a,b,c,d,e,f){function a(a){return/^(\/messages)/.test(a.getPath())}e.exports=a}),null);
__d("MessengerHoverCardLink",["URI"],(function(a,b,c,d,e,f){var g,h={getBaseURI:function(){return new(g||(g=b("URI")))("/ajax/hovercard/chat.php")},constructEndpoint:function(a){return new(g||(g=b("URI")))(h.getBaseURI()).setQueryData({id:a.id,type:"chat"})}};e.exports=h}),null);
__d("CoworkerThreadContextBanner.react",["ix","cx","fbt","FlexLayout.react","Image.react","MessengerEnvironment","React","XUIText.react","asset"],(function(a,b,c,d,e,f,g,h,i){"use strict";var j=b("React");function a(a){a=b("MessengerEnvironment").messengerui;return j.jsx("div",{className:(a?"":"_80n8")+(a?" _1li-":""),children:j.jsxs(b("FlexLayout.react"),{className:(a?"":"_80n9")+(a?" _80nc":""),align:"center",children:[j.jsx("div",{className:"_80nd"+(a?"":" _80ne")+(a?" _80nf":""),children:j.jsx(b("Image.react"),{src:g("558200")})}),j.jsxs("div",{className:"_80ng",children:[j.jsx(b("XUIText.react"),{className:"_80nh",children:i._("Member of your colleague group")}),j.jsx(b("XUIText.react"),{className:"_80ni",children:i._("Colleague conversation")})]})]})})}e.exports=a}),null);
__d("FantaFRXUtil",["AsyncRequest","FRXURI","MercuryIDs","MercuryThreadIDMap"],(function(a,b,c,d,e,f){"use strict";var g=b("MercuryThreadIDMap").get();a={isFRXEligible:function(a,c){return b("MercuryIDs").isLocalThread(c)?!1:a!=null&&a.thread_fbid!==null&&a.message_count>0},isEmptyThread:function(a){return a!=null&&a.thread_id!==null&&g.getServerIDFromClientIDNow(a.thread_id)==null},FRXClicked:function(a,c,d,e){e===void 0&&(e="report_button");var f=b("MercuryIDs").getUserIDFromThreadID(a)||"",h=btoa("EntMessengerViewer1To1Thread:"+f),i="messenger_direct_thread_details";if(Boolean(c)){c=b("MercuryIDs").isLocalThread(a);c=c?g.getServerIDFromClientIDNow(a):b("MercuryIDs").getThreadFBIDFromThreadID(a);c!=null&&(h=btoa("EntMessengerViewerGroupThread:"+c),i="messenger_group_thread_details");d!=null&&(f=b("MercuryIDs").getUserIDFromParticipantID(d),i="messenger_group_thread_members_list")}a=b("FRXURI").withEntMessageThread({reportable_ent_token:h,story_location:i,entry_point:e,responsible_id:f});new(b("AsyncRequest"))(a).send()},FRXClickedForEmptyThread:function(a,c){c===void 0&&(c="report_button");a=b("MercuryIDs").getUserIDFromThreadID(a)||"";var d="messenger_empty_direct_thread";d=b("FRXURI").withEntMessageThread({reportable_ent_token:a,story_location:d,entry_point:c,responsible_id:a});new(b("AsyncRequest"))(d).send()}};e.exports=a}),null);
__d("ChatTabSRXUtil",["CurrentUser","FantaFRXUtil","MercuryIDs","getPageIDFromThreadID"],(function(a,b,c,d,e,f){"use strict";a={isSRXEligible:function(a,c){return b("MercuryIDs").isCanonical(c)&&(!b("getPageIDFromThreadID")(c)||a!=null&&a.is_canonical_neo_user)&&!b("CurrentUser").isWorkUser()&&b("FantaFRXUtil").isFRXEligible(a,c)}};e.exports=a}),null);
__d("ChatTabBlockerComposer.react",["cx","fbt","Bootloader","MercuryIDs","MercuryThreadActions","MessengerParticipants.bs","React","XUIButton.react"],(function(a,b,c,d,e,f,g,h){"use strict";var i=b("MercuryThreadActions").get(),j=b("React");a=function(a){babelHelpers.inheritsLoose(c,a);function c(){return a.apply(this,arguments)||this}var d=c.prototype;d.render=function(){var a=this,c=this.$1();return j.jsxs("div",{className:"_7ubs",children:[j.jsx("div",{className:"_7ubt",children:c?h._("You've blocked {name}. You can't message or call them in this chat, and you won't receive their messages or calls.",[h._param("name",c)]):h._("You've blocked this person. You can't message or call them in this chat, and you won't receive their messages or calls.")}),j.jsxs("div",{className:"_7ubu",children:[j.jsx(b("XUIButton.react"),{label:h._("Unblock"),onClick:function(){i.blockMessages(a.props.threadID,"thread_view_blocker_composer"),a.$2()},className:"_7ubv"}),j.jsx(b("XUIButton.react"),{label:h._("Something's wrong"),onClick:function(){a.props.onSomethingWrong&&a.props.onSomethingWrong(a.props.threadID,!1,"block_composer")},className:"_7ubv"})]})]})};d.$2=function(){var a=this,c=b("MercuryIDs").getThreadFBIDFromThreadID(this.props.threadID);b("Bootloader").loadModules(["MessengerThreadDamagingActionsTypedLogger","MessengerBlockActionEnum"],function(b,d){new b().setName(d.MESSENGER_INTEGRITY_BLOCK_VIEW_ENTER).setEntryPoint("thread_view_blocker_composer").setOtherUserID(c).setThreadID(c).setClientUserID(a.props.viewer).setSource("canonical_thread").log()},"ChatTabBlockerComposer.react")};d.$1=function(){if(!this.props.threadID)return null;var a=b("MercuryIDs").getParticipantIDFromFromThreadID(this.props.threadID);a=b("MessengerParticipants.bs").getNow(a);return a==null?void 0:a.short_name};return c}(j.PureComponent);e.exports=a}),null);
__d("MessengerReactionsFlyoutButtonBootloader.react",["AutoFocusableLink.react","JSResource","React","lazyLoadComponent"],(function(a,b,c,d,e,f){"use strict";var g=b("React"),h=b("lazyLoadComponent")(b("JSResource")("MessengerReactionsFlyoutButton.react").__setRef("MessengerReactionsFlyoutButtonBootloader.react"));a=function(a){var c=g.jsx(g.Suspense,{fallback:g.jsx(b("AutoFocusableLink.react"),{label:"flyout button",className:a.iconClassName}),children:g.jsx(h,babelHelpers["extends"]({},a,{className:a.iconClassName}))});return g.jsxs("li",{className:a.interactionClassName,children:[" ",c," "]})};e.exports=a}),null);
__d("ChatRemovedMessageTombstoneBubble.react",["cx","DOMDimensions","MessengerInnerDecorators.react","React","ReactDOM","RemovedMessageTombstoneContent","immutable","prop-types"],(function(a,b,c,d,e,f,g){"use strict";var h=b("React"),i=4;a=function(a){babelHelpers.inheritsLoose(c,a);function c(){var c,d;for(var e=arguments.length,f=new Array(e),g=0;g<e;g++)f[g]=arguments[g];return(c=d=a.call.apply(a,[this].concat(f))||this,d.$1=0,d.state={bubbleWidth:null},d.$3=function(){var a=b("ReactDOM").findDOMNode(d.refs.bubble);if(!a)return;a=b("DOMDimensions").getElementDimensions(a).width;var c=b("ReactDOM").findDOMNode(d.refs.content),e=b("DOMDimensions").getElementDimensions(c).width;c=c?e+b("DOMDimensions").measureElementBox(b("ReactDOM").findDOMNode(d.refs.contentWrapper)||{},"width",!0,!1,!1):0;c=c+i;e>0&&c<d.props.maxBubbleWidth&&a-c-d.getBoxWidth()>0&&d.setState({bubbleWidth:c})},c)||babelHelpers.assertThisInitialized(d)}var d=c.prototype;d.componentDidMount=function(){this.$2(this.props)};d.componentDidUpdate=function(a){(a.maxBubbleWidth!==this.props.maxBubbleWidth||a.participants!==this.props.participants)&&this.$2(a)};d.render=function(){var a=this.props,c=a.message,d=a.maxBubbleWidth;a=a.participants;a=b("RemovedMessageTombstoneContent").getRemovedMessageTombstoneContent(c,a).toString();return h.jsxs("div",{className:"_1e-x _n4o",children:[h.jsxs("div",{className:"_3_bl",children:[h.jsx("div",{className:"_3_bp"}),h.jsx("div",{ref:"bubble",className:"_3_om _72_y _5wdf",style:{maxWidth:d,width:this.state.bubbleWidth,wordWrap:a.length>=15?"break-word":"inherit"},children:h.jsx("div",{className:"_72_z"+(this.props.message&&this.props.message.isSelected?" _1yok":""),ref:"contentWrapper",children:h.jsx("span",{className:"_5yl5",ref:"content",children:h.jsx("span",{children:a})})})})]}),h.jsx(b("MessengerInnerDecorators.react"),{className:"_1z_2",message:c,isFromViewer:!1,hovered:this.props.hovered,messageProps:this.props,isSavedView:!1})]})};d.$2=function(a){var c=b("ReactDOM").findDOMNode(this.refs.bubble);if(a.maxBubbleWidth!==this.props.maxBubbleWidth||a.participants!==this.props.participants||b("DOMDimensions").getElementDimensions(c).width>this.props.maxBubbleWidth){a=this.props.maxBubbleWidth;this.setState({bubbleWidth:a},this.$3);return}this.$3()};d.getBoxWidth=function(){this.$1||(this.$1=b("DOMDimensions").measureElementBox(b("ReactDOM").findDOMNode(this.refs.bubble)||{},"width",!0,!0,!1));return this.$1};return c}(h.Component);a.propTypes={hovered:(c=b("prop-types")).bool.isRequired,message:c.object.isRequired,maxBubbleWidth:c.number.isRequired,participants:c.instanceOf(b("immutable").Map).isRequired};e.exports=a}),null);
__d("ChatRemovedMessageTombstoneInner.react",["cx","fbt","ChatRemovedMessageTombstoneBubble.react","Locale","MercuryTimestamp","MessengerMessage.bs","React","TooltipData","immutable","isRTL","prop-types"],(function(a,b,c,d,e,f,g,h){"use strict";var i=b("React");a=function(a){babelHelpers.inheritsLoose(c,a);function c(){return a.apply(this,arguments)||this}var d=c.prototype;d.render=function(){var a=this.props.message,c={},d=b("MessengerMessage.bs").isOutbound(a);if(d||this.props.needsTimestampTooltip){var e=h._("{time}",[h._param("time",b("MercuryTimestamp").getPreciseTimestamp(a.timestamp))]);Object.assign(c,b("TooltipData").propsFor(e,d?"right":"left"))}e=a.body&&a.body!==""?b("isRTL")(a.body):b("Locale").isRTL();return i.jsx("div",babelHelpers["extends"]({className:"_5wd9"+(e?" direction_rtl":"")+(e?"":" direction_ltr")+" clearfix",ref:"inner"},c,{children:i.jsx(b("ChatRemovedMessageTombstoneBubble.react"),{hovered:this.props.hovered,maxBubbleWidth:this.props.maxBubbleWidth,message:a,participants:this.props.participants})}))};return c}(i.Component);a.propTypes={hovered:(c=b("prop-types")).bool.isRequired,message:c.object.isRequired,maxBubbleWidth:c.number.isRequired,needsTimestampTooltip:c.bool};e.exports=a}),null);
__d("ChatRemovedMessageTombstone.react",["csx","cx","ChatRemovedMessageTombstoneInner.react","MercuryErrorInfo","MercuryIDs","MessengerMessage.bs","React","immutable","joinClasses","prop-types"],(function(a,b,c,d,e,f,g,h){"use strict";var i=b("React");a=function(a){babelHelpers.inheritsLoose(c,a);function c(){var b,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return(b=c=a.call.apply(a,[this].concat(e))||this,c.state={hovered:!1},c.$1=function(){return c.setState({hovered:!0})},c.$2=function(){return c.setState({hovered:!1})},b)||babelHelpers.assertThisInitialized(c)}var d=c.prototype;d.render=function(){var a=this.props.message,c=b("MessengerMessage.bs").isInbound(a),d=b("MercuryIDs").isGroupChat(a.thread_id),e=b("MercuryErrorInfo").hasErrorStatus(a);c="_5wd4"+(c?" _1nc7":"")+(c?"":" _1nc6")+""+(c&&d?" _5ysy":"")+(e?" _1zcs":"");return i.jsxs("div",{className:c,onMouseEnter:this.$1,onMouseLeave:this.$2,children:[i.jsx("div",{className:b("joinClasses")("._1dlq","_h8t"),children:i.jsx(b("ChatRemovedMessageTombstoneInner.react"),{hovered:this.state.hovered,maxBubbleWidth:this.props.maxBubbleWidth,message:a,needsTimestampTooltip:this.props.needsTimestampTooltip,participants:this.props.participants})}),i.jsx("div",{className:"_40qi"})]})};return c}(i.Component);a.propTypes={message:(c=b("prop-types")).object.isRequired,maxBubbleWidth:c.number.isRequired,needsTimestampTooltip:c.bool,participants:c.instanceOf(b("immutable").Map).isRequired};e.exports=a}),null);
__d("getInlineBoundingRect",["Rect"],(function(a,b,c,d,e,f){function a(a,c){var d=a.getClientRects();if(!c||d.length===0)return b("Rect").getElementBounds(a);var e,f=!1;for(var g=0;g<d.length;g++){var h=new(b("Rect"))(Math.round(d[g].top),Math.round(d[g].right),Math.round(d[g].bottom),Math.round(d[g].left),"viewport").convertTo("document"),i=h.getPositionVector(),j=i.add(h.getDimensionVector());if(!e||i.x<=e.l&&i.y>e.t){if(f)break;e=new(b("Rect"))(i.y,j.x,j.y,i.x,"document")}else e.t=Math.min(e.t,i.y),e.b=Math.max(e.b,j.y),e.r=j.x;h.contains(c)&&(f=!0)}e||(e=b("Rect").getElementBounds(a));return e}e.exports=a}),null);
__d("nl2br",["DOM"],(function(a,b,c,d,e,f){var g=/(\r\n|[\r\n])/;function a(a){return a.split(g).map(function(a){return g.test(a)?b("DOM").create("br"):a})}e.exports=a}),null);
__d("Tooltip",["fbt","invariant","Arbiter","AsyncRequest","ContextualLayer","ContextualLayerAutoFlip","CSS","DOM","Event","Style","TooltipData","Vector","emptyFunction","getElementText","getInlineBoundingRect","getOrCreateDOMID","gkx","killswitch","nl2br","setImmediate"],(function(a,b,c,d,e,f,g,h){var i=null,j=null,k=null,l=null,m=null,n=null,o=null,p=!1,q=[],r=[];function s(){if(!m){n=b("DOM").create("div",{className:"tooltipContent","data-testid":"tooltip_testid"});o=b("getOrCreateDOMID")(n);var a=b("DOM").create("i",{className:"arrow"});a=b("DOM").create("div",{className:"uiTooltipX"},[n,a]);m=new(b("ContextualLayer"))({},a);m.shouldSetARIAProperties(!1);m.enableBehavior(b("ContextualLayerAutoFlip"));b("gkx")("764802")&&(m.getRoot().style.pointerEvents="none")}}function t(a,c){v._show(a,g._("Loading...")),new(b("AsyncRequest"))(c).setHandler(function(b){v._show(a,b.getPayload()),m&&m.updatePosition()}).setErrorHandler(b("emptyFunction")).send()}var u;b("Event").listen(document.documentElement,"mouseover",function(a){u=a,b("setImmediate")(function(){u=null})});var v=babelHelpers["extends"]({},b("TooltipData"),{isActive:function(a){return a===i},process:function(a,c){if(!b("DOM").contains(a,c))return;if(a!==i){v.fetchIfNecessary(a);c=v._get(a);if(c.suppress)return;c.delay?v._showWithDelay(a,c.delay):v.show(a)}},fetchIfNecessary:function(a){var b=a.getAttribute("data-tooltip-uri");b&&(a.removeAttribute("data-tooltip-uri"),t(a,b))},suspend:function(){p=!0},hide:function(){var a=i,c,d=p;p=!1;try{b("Arbiter").inform("tooltip/requesthide",{context:a}),c=p}finally{p=d}c||v.commitHide(a)},commitHide:function(a){if(!j||a!==j){if(a&&m){m.hide();i=null;while(q.length)q.pop().remove()}b("Arbiter").inform("tooltip/hide",{context:a})}},_show:function(a,b){v._store({context:a,content:b}),v.isActive(a)&&v.show(a)},show:function(a){var c,d=p;p=!1;try{b("Arbiter").inform("tooltip/requestshow",{context:a}),c=p}finally{p=d}c||v.commitShow(a)},commitShow:function(a){var c=function(){a.removeAttribute("aria-describedby");var c=v._get(a);c.className&&m&&b("CSS").removeClass(m.getRoot(),c.className);v.hide()},d=function(a){b("DOM").contains(i,a.getTarget())||c()};j=a;s();a!==i&&(b("killswitch")("TOOLTIP_FIX_HIDE_ACTIVE_TOOLTIP_BEFORE_NEW_ONE")?v.commitHide(a):v.commitHide(i));j=null;a!==i&&b("Arbiter").inform("tooltip/beforeshow",{context:a});var e=v._get(a);if(e.suppress||v.allSuppressed)return;var f=e.content;if(e.overflowDisplay){if(a.offsetWidth>=a.scrollWidth)return;f||(f=b("getElementText")(a))}var g=f?function(){a.setAttribute("aria-describedby",o),m&&m.show()}:function(){},k=0,l=e.offsetY?parseInt(e.offsetY,10):0;if(e.position==="left"||e.position==="right")l=(a.offsetHeight-28)/2;else if(e.alignH!=="center"){var p=a.offsetWidth;p<32&&(k=(p-32)/2*(e.alignH==="right"?-1:1))}p=u?b("Vector").getEventPosition(u):b("Vector").getElementPosition(a);m||h(0,4328);m.setContextWithBounds(a,b("getInlineBoundingRect")(a,p)).setOffsetX(k).setOffsetY(l).setPosition(e.position).setAlignment(e.alignH);if(typeof f==="string"){b("CSS").addClass(m.getRoot(),"invisible_elem");p=b("DOM").create("span",{},b("nl2br")(f));k=b("DOM").create("div",{className:"tooltipText"},p);b("DOM").setContent(n,k);g();b("CSS").removeClass(m.getRoot(),"invisible_elem")}else b("DOM").setContent(n,f),g();q.push(b("Event").listen(document.documentElement,"mouseover",d),b("Event").listen(document.documentElement,"focusin",d));l=b("Style").getScrollParent(a);l!==window&&q.push(b("Event").listen(l,"scroll",c));e.persistOnClick||q.push(b("Event").listen(a,"click",c));e.className&&b("CSS").addClass(m.getRoot(),e.className);i=a},_showWithDelay:function(a,c){a!==k&&v._clearDelay();if(!l){var d=function(a){b("DOM").contains(k,a.getTarget())||v._clearDelay()};r.push(b("Event").listen(document.documentElement,"mouseover",d),b("Event").listen(document.documentElement,"focusin",d));k=a;l=setTimeout(function(){v._clearDelay(),v.show(a)},c)}},_clearDelay:function(){clearTimeout(l);k=null;l=null;while(r.length)r.pop().remove()}});b("Event").listen(window,"scroll",v.hide);e.exports=v}),null);
__d("ChatGroupCannotAddBackDialog.react",["fbt","FDSButton.react","FDSModal.react","FDSModalFooter.react","FDSModalHeader.react","FDSSection.react","FDSText.react","React"],(function(a,b,c,d,e,f,g){"use strict";var h=b("React");a=function(a){babelHelpers.inheritsLoose(c,a);function c(){return a.apply(this,arguments)||this}var d=c.prototype;d.render=function(){return h.jsx(b("FDSModal.react"),{isShown:!0,onHide:this.props.onHide,footer:h.jsx(b("FDSModalFooter.react"),{primaryButton:h.jsx(b("FDSButton.react"),{use:"primary",label:g._("Close"),onClick:this.props.onHide})}),header:h.jsx(b("FDSModalHeader.react"),{title:g._("{name} left the group",[g._param("name",this.props.name)])}),width:410,children:h.jsx(b("FDSSection.react"),{children:h.jsx(b("FDSText.react"),{size:"body1",children:g._("{name} can't be added to this group again.",[g._param("name",this.props.name)])})})})};return c}(h.Component);e.exports=a}),null);
__d("ChatTabAddBackPreventedQuery",["RelayFBEnvironment","RelayModern","promiseDone","ChatTabAddBackPreventedQuery.graphql"],(function(a,b,c,d,e,f){"use strict";var g,h=b("RelayModern").fetchQuery;b("RelayModern").graphql;var i=g!==void 0?g:g=b("ChatTabAddBackPreventedQuery.graphql");a={fetch:function(a,c){b("promiseDone")(h(b("RelayFBEnvironment"),i,{thread_id:a}),function(a){c(a.message_thread.non_addable_recipients.nodes.map(function(a){return a.id}))})}};e.exports=a}),null);
__d("MercuryTypeaheadDataSource",["CurrentUser","DataSource","OrderedFriendsList","ShortProfiles"],(function(a,b,c,d,e,f){var g=[],h={},i={},j={},k=[],l=[],m=[],n=!1,o=!1;a=function(a){"use strict";babelHelpers.inheritsLoose(c,a);function c(b){var c;b=b||{};b.kanaNormalization=!0;c=a.call(this,b)||this;c.showDefaultList=b.showDefaultList||!1;return c}var d=c.prototype;d.dirty=function(){this.$MercuryTypeaheadDataSource1=g;this.localCache=i;this.queryCache=h;this.queryIDs=j;this.defaultList=k;this.topEntryIDs=l;this.nullStateExclusions=m;return this};d.bootstrap=function(){if(n||o)return!1;o=!0;b("ShortProfiles").fetchAll().then(function(){this.updateBootstrapData(),o=!1,n=!0,this.showDefaultList&&this.inform("show-default",{impressions:this.defaultList})}.bind(this),function(){}.bind(this));return!0};d.updateBootstrapData=function(){var a=this.getCachedShortProfileIDs(),c=b("CurrentUser").isWorkUser()?"fb4c":"friend";a=a.map(function(a){var d=b("ShortProfiles").getNow(a),e=a==b("CurrentUser").getID()?c:d.type,f=[d.additionalName,d.alternateName].concat(d.searchTokens||[]).join(" "),g=d.name,h=null;return{uid:a,index:b("OrderedFriendsList").getActiveRank(a),text:g,subtext:h,tokens:f,localized_text:d.name,additional_text:d.additionalName,photo:d.thumbSrc,render_type:e,type:"user"}});a.length&&this.addEntries(a);if(!this.showDefaultList)return;l=a.sort(function(a,b){return a.index-b.index}).map(function(a){return a.uid});this.defaultList=this.buildData(l.slice(0,5));this.topEntryIDs=l};d.updateDefaultList=function(a){var b=this;if(!a)return;this.nullStateExclusions.includes(a)?this.nullStateExclusions=this.nullStateExclusions.filter(function(b){return b!==a}):this.nullStateExclusions.push(a);k=this.topEntryIDs.filter(function(a){return!b.nullStateExclusions.includes(a)});this.defaultList=this.buildData(k.slice(0,5))};d.query=function(b,c,d,e){c=c||b.length===1;return a.prototype.query.call(this,b,c,d,e)};d.getQueryData=function(b,c){return babelHelpers["extends"]({},a.prototype.getQueryData.call(this,b,c))};d.setEntry=function(a,b){this.$MercuryTypeaheadDataSource1[a]=b};d.getEntry=function(a){return this.$MercuryTypeaheadDataSource1[a]||null};d.getCachedShortProfileIDs=function(){var a=b("ShortProfiles").getCachedProfileIDs();a=a.filter(function(a){var c=b("ShortProfiles").getNow(a);return a==b("CurrentUser").getID()||c.type==="friend"||c.type==="fb4c"});return a};d.isBootstrapped=function(){return n};d.isBootstrapping=function(){return o};d.processEntries=function(c,d){c=c.map(function(a){a.index==null&&(a.render_type==="friend"||a.render_type==="fb4c")&&(a.index=b("OrderedFriendsList").getActiveRank(a.uid));return a});return a.prototype.processEntries.call(this,c)};d.mergeUids=function(b,c,d,e){var f=this;c=c.sort(function(a,b){return f.getEntry(a).index-f.getEntry(b).index});return a.prototype.mergeUids.call(this,b,c,d,e)};d.setShowDefaultList=function(a){this.showDefaultList=a};return c}(b("DataSource"));e.exports=a}),null);
__d("ChatTabTypeaheadDataSource",["MercuryConfig","MercuryTypeaheadDataSource"],(function(a,b,c,d,e,f){a=function(a){"use strict";babelHelpers.inheritsLoose(c,a);function c(c){c=c||{};c.maxResults=5;c.showDefaultList=b("MercuryConfig").ChatComposer;c=a.call(this,c)||this;c.$ChatTabTypeaheadDataSource1=!0;return c}var d=c.prototype;d.buildData=function(b){var c=this,d=[],e=[],f=[],g=[],h=[],i=[],j=[],k=!this.$ChatTabTypeaheadDataSource1;b.forEach(function(b){var i=a.prototype.getEntry.call(c,b);switch(i.render_type){case"friend":d.push(b);break;case"thread":c.$ChatTabTypeaheadDataSource1&&e.push(b);break;case"commerce_page":k||h.push(b);break;case"non_friend":f.push(b);break;case"fb4c":g.push(b);break;case"page":k||h.push(b);break;case"internal_bot_page":i=!k||i.can_add_to_group_chat;i&&j.push(b);break;default:break}},this);b=i.concat(d,g,e,h,f,j);return a.prototype.buildData.call(this,b)};d.query=function(b,c,d,e){return a.prototype.query.call(this,b,c,d,e)};d.respond=function(b,c,d){return a.prototype.respond.call(this,b,c,d)};d.setShowThreads=function(a){this.$ChatTabTypeaheadDataSource1=a};return c}(b("MercuryTypeaheadDataSource"));e.exports=a}),null);
__d("ChatTabTypeaheadAddMemberDataSource",["fbt","ChatGroupCannotAddBackDialog.react","ChatTabAddBackPreventedQuery","ChatTabTypeaheadDataSource","DOM","React","ReactDOM"],(function(a,b,c,d,e,f,g){"use strict";var h=b("React"),i=b("DOM").create("div",{id:"ChatTabTypeaheadAddMemberDataSource_dialog"}),j=!1,k=new Map();a=function(a){babelHelpers.inheritsLoose(c,a);function c(b){return a.call(this,b)||this}var d=c.prototype;d.setQueryData=function(c,d){c.thread_id&&b("ChatTabAddBackPreventedQuery").fetch(c.thread_id,function(a){k.set(c.thread_id,new Set(a))});return a.prototype.setQueryData.call(this,c,d)};d.processResults=function(b,c,d){var e=k.get(this.queryData.thread_id);e&&c.forEach(function(a,b,c){e.has(a.uid)&&(c[b]=babelHelpers["extends"]({},a,{disabled:!0,subtext:g._("Left the group"),onSelectDisabled:function(){return l(a.text)}}))});a.prototype.processResults.call(this,b,c,d)};return c}(b("ChatTabTypeaheadDataSource"));function l(a){if(j)return;j=!0;b("ReactDOM").render(h.jsx(b("ChatGroupCannotAddBackDialog.react"),{name:a,onHide:function(){b("ReactDOM").unmountComponentAtNode(i),j=!1}}),i)}e.exports=a}),null);
__d("MessengerSecondarySearchFunnelConstants",[],(function(a,b,c,d,e,f){"use strict";a=Object.freeze({MESSENGER_DOT_COM:"messenger_dot_com",WWW:"www"});b=Object.freeze({ABANDON:"abandon",CREATE_GROUP:"create_group",ENTER_THREAD:"enter_thread",RESULT_SELECTED:"result_selected",SEND:"send",SINGLE_RESULT_SELECTED:"single_result_selected"});c=Object.freeze({ACTION:"action"});d=Object.freeze({EXISTING_TAB:"existing_tab",JEWEL:"jewel",SIDEBAR:"sidebar",COMPOSER:"composer"});f=Object.freeze({END:"end",IMPRESSIONS:"impressions",MICRO_SESSION_ENDED:"micro_session_ended",MICRO_SESSION_STARTED:"micro_session_started",QUERY_CHANGED:"query_changed",RESULT_SELECTED:"result_selected",REENTER_OMNIPICKER:"reentered_omnipicker",SOURCE_ENDED:"source_ended",SOURCE_STARTED:"source_started",START:"start",TOKEN_REMOVED:"token_removed",CLICK_OTHER_THREAD:"clicked_on_other_thread"});var g=Object.freeze({BROADCAST:"broadcast",GROUP_CREATION:"group_creation",OMNIPICKER:"omnipicker",SHARE:"share"}),h=Object.freeze({DIRECT_SEND:"direct_send",ADD:"add"}),i=Object.freeze({FINISHED:"finished",FAILED:"failed"}),j=Object.freeze({BROADCAST:9500,GROUP_CREATE:9501,M_APP_COMPOSER:9502}),k=Object.freeze({QUERY:"query",NO_QUERY:"no_query"}),l=Object.freeze({BOOTSTRAP:"bootstrap",LOCAL:"local",LOCAL_AND_SERVER:"local_and_server",LOCAL_CONTACTS:"local_contacts",ORDERED_GCF_FRIENDLIST:"local_ordered_gcf_friendlist",QUERY_CACHE:"query_cache",SERVER:"server",SHORT_PROFILES:"local_short_profiles",SUGGESTED_RECIPIENTS:"local_suggested_recipients"});e.exports={FUNNEL_NAME:"MESSENGER_SECONDARY_SEARCH_FUNNEL",CLIENTS:a,END_ACTIONS:b,END_REASONS:c,ENTRY_SURFACES:d,EVENTS:f,SEARCH_SURFACES:g,SELECTION_TYPES:h,SOURCE_STATUSES:i,LOGGING_IDS:j,MICRO_SESSION_TYPES:k,SOURCES:l}}),null);
__d("LazyWorkMultiCompanyChatTooltip.react",["JSResource","lazyLoadComponent","react"],(function(a,b,c,d,e,f){"use strict";var g,h=g||b("react"),i=b("lazyLoadComponent")(b("JSResource")("WorkMultiCompanyChatTooltip.react").__setRef("LazyWorkMultiCompanyChatTooltip.react"));function a(a){return h.jsx(h.Suspense,{fallback:a.children,children:h.jsx(i,{children:a.children})})}e.exports=a}),null);
__d("WorkChatExtensionAvailabilityFetcher",["Promise","WebGraphQL","WebStorage","WorkChatExtensionsDrawersQueryWebGraphQLQuery"],(function(a,b,c,d,e,f){"use strict";var g,h=36e5;function i(a){(g||(g=b("WebStorage"))).setItemGuarded(g.getLocalStorage(),"hasWorkChatExtension",a.toString()),g.setItemGuarded(g.getLocalStorage(),"hasWorkChatExtensionFetchTime",Date.now().toString())}e.exports={checkHasChatExtension:function(){return new(b("Promise"))(function(a,c){c=(g||(g=b("WebStorage"))).getLocalStorageForRead();var d=c?c.getItem("hasWorkChatExtension"):null;c=c?c.getItem("hasWorkChatExtensionFetchTime")||0:0;return d==="true"&&Date.now()-parseInt(c,10)<h?a(!0):b("WebGraphQL").exec(new(b("WorkChatExtensionsDrawersQueryWebGraphQLQuery"))({})).then(function(a){a=((a=a)!=null?(a=a.viewer)!=null?(a=a.messenger_platform_drawers_info)!=null?(a=a[0])!=null?a.drawer_elements:a:a:a:a)||[];a=a.length>0;i(a);return a})})},setChatExtensionAvailability:i}}),null);
__d("WorkUserEmojiWithTooltipBootloader.react",["JSResource","lazyLoadComponent","react"],(function(a,b,c,d,e,f){"use strict";var g,h=g||b("react"),i=b("lazyLoadComponent")(b("JSResource")("WorkUserEmojiWithTooltip.react").__setRef("WorkUserEmojiWithTooltipBootloader.react"));function a(a){return h.jsx(h.Suspense,{fallback:null,children:h.jsx(i,babelHelpers["extends"]({},a))})}e.exports=a}),null);
__d("ScriptPathState",["Arbiter"],(function(a,b,c,d,e,f){var g,h,i,j,k=100,l={setIsUIPageletRequest:function(a){i=a},setUserURISampleRate:function(a){j=a},reset:function(){g=null,h=!1,i=!1},_shouldUpdateScriptPath:function(){return h&&!i},_shouldSendURI:function(){return Math.random()<j},getParams:function(){var a={};l._shouldUpdateScriptPath()?l._shouldSendURI()&&g!==null&&(a.user_uri=g.substring(0,k)):a.no_script_path=1;return a}};b("Arbiter").subscribe("pre_page_transition",function(a,b){h=!0,g=b.to.getUnqualifiedURI().toString()});e.exports=a.ScriptPathState=l}),null);
__d("goOrReplace",["Env","URI","isFacebookURI"],(function(a,b,c,d,e,f){var g,h;function a(a,c,d){c=new(g||(g=b("URI")))(c);(h||(h=b("Env"))).isCQuick&&b("isFacebookURI")(c)&&c.addQueryData({cquick:(h||(h=b("Env"))).iframeKey,cquick_token:h.iframeToken,ctarget:h.iframeTarget});c=c.toString();d?a.replace(c):a.href==c?a.reload():a.href=c}e.exports=a}),null);
__d("AjaxPipeRequest",["invariant","Arbiter","AsyncRequest","AsyncRequestConfig","BigPipe","ContextualComponent","CSS","DOM","Env","PageEvents","PageletGK","PageletSet","ScriptPathState","URI","containsNode","ge","goOrReplace","performance","performanceAbsoluteNow"],(function(a,b,c,d,e,f,g){var h,i,j,k,l=b("PageletGK").destroyDomAfterEventHandler,m,n=0;function o(a,c){var d=b("ge")(a);if(!d)return;c||(d.style.minHeight="100px");c=b("PageletSet").getPageletIDs();for(var e=0;e<c.length;e++){var f=c[e];if(b("PageletSet").hasPagelet(f)){var g=b("PageletSet").getPagelet(f);b("containsNode")(d,g.getRoot())&&b("PageletSet").removePagelet(f)}}b("Arbiter").inform(b("PageEvents").AJAXPIPE_ONBEFORECLEARCANVAS,{canvasID:a});function h(a){var c=b("ContextualComponent").forNode(a);c&&c.unmount();b("DOM").empty(a)}l?(b("Arbiter").inform("pagelet/destroy",{id:null,root:d}),h(d)):(h(d),b("Arbiter").inform("pagelet/destroy",{id:null,root:d}))}function p(a,c){a=b("ge")(a);a&&!c&&(a.style.minHeight="100px")}c=function(){"use strict";function c(a,c,d){this._allowIrrelevantRequests=!1;this._canvas_id=a;this._uri=c;this._query_data=d;a=new(b("AsyncRequest"))();a.disableInteractionServerTracing();a.setReplaceTransportMarkers(!1);this._request=a;this._allow_cross_page_transition=!0;this._arbiter=new(b("Arbiter"))();this._requestID=n++}var d=c.prototype;d.getArbiter=function(){return this._arbiter};d.setData=function(a){this._query_data=a;return this};d.getData=function(){return this._query_data};d.setAllowCrossPageTransition=function(a){this._allow_cross_page_transition=a;return this};d.setAppend=function(a){this._append=a;return this};d._getAsyncRequestType=function(){return b("AsyncRequestConfig").useFetchStreamAjaxPipeTransport?"useFetchWithIframeFallback":"useIframeTransport"};d.send=function(){this._arbiter.inform(b("PageEvents").AJAXPIPE_SEND,{rid:this._requestID,quickling:!!this._isQuickling,ts:(h||(h=b("performanceAbsoluteNow")))()},"persistent");var a={ajaxpipe:1,ajaxpipe_token:(i||(i=b("Env"))).ajaxpipe_token};Object.assign(a,b("ScriptPathState").getParams());b("ScriptPathState").reset();var c=this._request;if(c==null)return this;c.setOption(this._getAsyncRequestType(),!0).delayPreDisplayJS().setURI(this._uri).setData(Object.assign(a,this._query_data)).setPreBootloadHandler(this._preBootloadHandler.bind(this)).setInitialHandler(this._onInitialResponse.bind(this)).setHandler(this._onResponse.bind(this)).setMethod("GET").setReadOnly(!0).setAllowCrossPageTransition(this._allow_cross_page_transition).setAllowIrrelevantRequests(this._allowIrrelevantRequests);this._automatic?this._relevantRequest=m:m=this._request;if(this._isQuickling){a=(j||(j=b("performance"))).clearResourceTimings||(j||(j=b("performance"))).webkitClearResourceTimings;a&&a.call(j||(j=b("performance")))}c.send();return this};d._preBootloadFirstResponse=function(a){return!1};d._fireDomContentCallback=function(){var a=this._request;a&&a.cavalry&&a.cavalry.setTimeStamp("t_domcontent");this._arbiter.inform(b("PageEvents").AJAXPIPE_DOMREADY,!0,"state")};d._fireOnloadCallback=function(){window.console&&console.timeStamp&&console.timeStamp('perf_trace {"name": "e2e", "parent": "PageEvents.AJAXPIPE_ONLOAD"}');var a=this._request;a!=null&&a.cavalry&&(a.cavalry.setTimeStamp("t_hooks"),a.cavalry.setTimeStamp("t_layout"),a.cavalry.setTimeStamp("t_onload"));this._arbiter.inform(b("PageEvents").AJAXPIPE_ONLOAD,{lid:this.pipe.lid,rid:this._requestID,ts:(h||(h=b("performanceAbsoluteNow")))()},"state")};d._isRelevant=function(a){return this._request===m||this._automatic&&this._relevantRequest===m||this._jsNonBlock||m!=null&&m.getAllowIrrelevantRequests()};d._preBootloadHandler=function(a){var c=this._request,d=a.getPayload();if(!d||d.redirect||!this._isRelevant(a))return!1;var e=!1;a.is_first&&(!this._append&&!this._displayCallback&&!d.isCometResponse&&o(this._canvas_id,this._constHeight),e=this._preBootloadFirstResponse(a),c!=null||g(0,36),this.pipe=new(b("BigPipe"))({config:d.bigPipeConfig,arbiter:this._arbiter,rootNodeID:this._canvas_id,lid:c.lid,rid:this._requestID,isAjax:!0,domContentCallback:this._fireDomContentCallback.bind(this),onloadCallback:this._fireOnloadCallback.bind(this),domContentEvt:b("PageEvents").AJAXPIPE_DOMREADY,onloadEvt:b("PageEvents").AJAXPIPE_ONLOAD,jsNonBlock:this._jsNonBlock,automatic:this._automatic,displayCallback:this._displayCallback,allowIrrelevantRequests:this._allowIrrelevantRequests}),this.pipe.setPageID(c.lid));return e};d._redirect=function(c){if(c.redirect){if(c.force||!this.isPageActive(c.redirect)){var d=["ajaxpipe","ajaxpipe_token"].concat(this.getSanitizedParameters());b("goOrReplace")(window.location,new(k||(k=b("URI")))(c.redirect).removeQueryData(d),!0)}else{d=a.PageTransitions;d.go(c.redirect,!0)}return!0}else return!1};d.isPageActive=function(a){return!0};d.getSanitizedParameters=function(){return[]};d._versionCheck=function(a){return!0};d._onInitialResponse=function(a){var b=a.getPayload();if(!this._isRelevant(a))return!1;if(!b)return!0;return this._redirect(b)||!this._versionCheck(b)?!1:!0};d._processFirstResponse=function(a){this._arbiter.inform(b("PageEvents").AJAXPIPE_FIRST_RESPONSE,{lid:this.pipe.lid,quickling:!!this._isQuickling});a=a.getPayload();var c=b("ge")(this._canvas_id);a=a.canvas_class;c!=null&&a!=null&&b("CSS").setClass(c,a)};d.setFirstResponseCallback=function(a){this._firstResponseCallback=a;return this};d.setFirstResponseHandler=function(a){this._processFirstResponse=a;return this};d._onResponse=function(a){var c=a.payload;if(!this._isRelevant(a))return b("AsyncRequest").suppressOnloadToken;a.is_first&&(this._processFirstResponse(a),this._firstResponseCallback&&this._firstResponseCallback(),c.provides=c.provides||[],c.provides.push("uipage_onload"));if(c){if("content"in c.content){this._append&&(c.append=this._canvas_id);var d=c.content.content;delete c.content.content;c.content[this._canvas_id]=d}this.pipe.onPageletArrive(c)}a.is_last&&p(this._canvas_id,this._constHeight);return b("AsyncRequest").suppressOnloadToken};d.setNectarModuleDataSafe=function(a){this._request!=null&&this._request.setNectarModuleDataSafe(a);return this};d.setFinallyHandler=function(a){this._request!=null&&this._request.setFinallyHandler(a);return this};d.setErrorHandler=function(a){this._request!=null&&this._request.setErrorHandler(a);return this};d.setTransportErrorHandler=function(a){this._request!=null&&this._request.setTransportErrorHandler(a);return this};d.setResetHandler=function(a){this._resetHandler=a;return this};d.abort=function(){this._request!=null&&this._request.abort();this._reset();return this};d.abandon=function(){this._request!=null&&this._request.abandon();this._reset();return this};d._reset=function(){m==this._request&&(m=null),this._request=null,this._resetHandler&&this._resetHandler()};d.setJSNonBlock=function(a){this._jsNonBlock=a;return this};d.setAutomatic=function(a){this._automatic=a;return this};d.setDisplayCallback=function(a){this._displayCallback=a;return this};d.setConstHeight=function(a){this._constHeight=a;return this};d.setAllowIrrelevantRequests=function(a){this._allowIrrelevantRequests=a;return this};d.getAsyncRequest=function(){return this._request};c.getCurrentRequest=function(){return m};c.setCurrentRequest=function(a){m=a};return c}();c.clearCanvas=o;e.exports=c}),null);
__d("isAdsExcelAddinURI",[],(function(a,b,c,d,e,f){var g=new RegExp("(^|\\.)fbaddins\\.com$","i"),h=["https"];function a(a){if(a.isEmpty()&&a.toString()!=="#")return!1;return!a.getDomain()&&!a.getProtocol()?!1:h.indexOf(a.getProtocol())!==-1&&g.test(a.getDomain())}e.exports=a}),null);
__d("isValidAsyncSignalURI",[],(function(a,b,c,d,e,f){var g=new RegExp("((^|\\.)instagram\\.com$)|((^|\\.)wit\\.ai$)|((^|\\.)accountkit\\.com$)","i"),h=["https"];function a(a){if(a.isEmpty()&&a.toString()!=="#")return!1;return!a.getDomain()&&!a.getProtocol()?!1:h.includes(a.getProtocol())&&g.test(a.getDomain())}e.exports=a}),null);
__d("AsyncSignal",["Promise","ErrorGuard","QueryString","Run","TimeSlice","TrackingConfig","URI","ZeroRewrites","getAsyncParams","isAdsExcelAddinURI","isFacebookURI","isMessengerDotComURI","isValidAsyncSignalURI","isWorkplaceDotComURI","memoize","promiseDone"],(function(a,b,c,d,e,f){var g,h,i;function a(a,c){this.data=c||{},this.uri=a.toString(),b("TrackingConfig").domain&&this.uri.charAt(0)=="/"&&(this.uri=b("TrackingConfig").domain+this.uri)}a.prototype.setHandler=function(a){this.handler=a;return this};a.prototype.setTimeout=function(a){this.timeout=a;return this};a.prototype.send=function(){b("TimeSlice").guard(this._send.bind(this),"AsyncSignal send",{propagationType:b("TimeSlice").PropagationType.ORPHAN})()};a.prototype._send=function(){var a=this.handler,c=this.data;c.asyncSignal=(Math.random()*1e4|0)+1;var d=b("ZeroRewrites").rewriteURI(new(g||(g=b("URI")))(this.uri));d=b("isFacebookURI")(d)||b("isMessengerDotComURI")(d)||b("isAdsExcelAddinURI")(d)||b("isWorkplaceDotComURI")(d)||b("isValidAsyncSignalURI")(d);if(d)Object.assign(c,b("getAsyncParams")("POST"));else throw new Error("'"+this.uri+"' is an external URL, you should not send async signals to offsite links.");var e=b("QueryString").appendToUrl(this.uri,c);i||(i=new(b("Promise"))(function(a){b("Run").onAfterLoad(a)}));d=i.then(function(){return new(b("Promise"))(function(a,b){var c=new Image();c.onload=a;c.onerror=c.onabort=b;c.src=e})});if(a){var f=!1,j=b("memoize")(function(){(h||(h=b("ErrorGuard"))).applyWithGuard(a,null,[f])});b("promiseDone")(d.then(function(){f=!0,j()},j));this.timeout&&setTimeout(j,this.timeout)}return this};e.exports=a}),null);
__d("FullScreen",["ArbiterMixin","CSS","Event","Keys","UserAgent","UserAgent_DEPRECATED","mixin","throttle"],(function(a,b,c,d,e,f){var g={},h=!1,i=function(a){b("Event").getKeyCode(a)===b("Keys").ESC&&a.stopPropagation()},j=function(){h||(document.addEventListener("keydown",i,!0),h=!0)},k=function(){h&&(document.removeEventListener("keydown",i,!0),h=!1)};a=function(a){"use strict";babelHelpers.inheritsLoose(c,a);function c(){return a.apply(this,arguments)||this}var d=c.prototype;d.listenForEvent=function(a){var c=b("throttle")(this.onChange,0,this);g[a.id]||(g[a.id]=!0,b("Event").listen(a,{webkitfullscreenchange:c,mozfullscreenchange:c,MSFullscreenChange:c,fullscreenchange:c}))};d.enableFullScreen=function(a){this.listenForEvent(a);if(a.webkitRequestFullScreen)b("UserAgent_DEPRECATED").chrome()?a.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT):a.webkitRequestFullScreen();else if(a.mozRequestFullScreen)a.mozRequestFullScreen();else if(a.msRequestFullscreen)j(),a.msRequestFullscreen();else if(a.requestFullScreen)a.requestFullScreen();else return!1;return!0};d.disableFullScreen=function(){if(document.webkitCancelFullScreen)document.webkitCancelFullScreen();else if(document.mozCancelFullScreen)document.mozCancelFullScreen();else if(document.msExitFullscreen)document.msExitFullscreen();else if(document.cancelFullScreen)document.cancelFullScreen();else if(document.exitFullScreen)document.exitFullScreen();else return!1;return!0};d.isFullScreen=function(){return document.webkitIsFullScreen||document.fullScreen||document.mozFullScreen||document.msFullscreenElement};d.toggleFullScreen=function(a){if(this.isFullScreen()){this.disableFullScreen();return!1}else return this.enableFullScreen(a)};d.onChange=function(){var a=this.isFullScreen();b("CSS").conditionClass(document.body,"fullScreen",a);this.inform("changed");a||k()};d.isSupportedWithKeyboardInput=function(){return this.isSupported()&&!b("UserAgent").isBrowser("Safari")};d.isSupported=function(){var a=document.webkitFullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled||document.fullscreenEnabled;return a||document.webkitCancelFullScreen||document.mozCancelFullScreen||document.msExitFullscreen||document.cancelFullScreen||document.exitFullScreen};return c}(b("mixin")(b("ArbiterMixin")));c=new a();d=b("throttle")(c.onChange,0,c);b("Event").listen(document,{webkitfullscreenchange:d,mozfullscreenchange:d,MSFullscreenChange:d,fullscreenchange:d});e.exports=c}),null);
__d("RedditLinkRanges",["RedditLinkMatcher","UnicodeUtils"],(function(a,b,c,d,e,f){"use strict";var g;a={REDDIT_PREFIX:"https://reddit.com",get:function(a,c){c===void 0&&(c=0);c=c;var d=a.substr(c),e=b("RedditLinkMatcher").match(d);if(!e)return[];var f=e.lnk;e=e.idx;d=(g||(g=b("UnicodeUtils"))).strlen(d.substr(0,e));c+=d;e="";switch(f[1].toLowerCase()){case"r":e=this.REDDIT_PREFIX+f;break;case"u":e=this.REDDIT_PREFIX+f;break;default:switch(f[0].toLowerCase()){case"r":e=this.REDDIT_PREFIX+"/"+f;break;case"u":e=this.REDDIT_PREFIX+"/"+f;break;default:return[]}}d=f.length;f=[{offset:c,length:d,entity:{url:e}}];return f.concat(this.get(a,c+d))}};e.exports=a}),null);
__d("URLScraper",["ArbiterMixin","DataStore","Event","URLMatcher","mixin"],(function(a,b,c,d,e,f){var g="scraperLastPermissiveMatch";a=function(a){"use strict";babelHelpers.inheritsLoose(c,a);function c(b,c){var d;d=a.call(this)||this;d.input=b;d.enable();d.getValueFn=c;return d}var d=c.prototype;d.reset=function(){b("DataStore").set(this.input,g,null)};d.enable=function(){if(this.events)return;var a=function(a){window.setTimeout(this.check.bind(this,a),30)};this.events=b("Event").listen(this.input,{paste:a.bind(this,!1),keydown:a.bind(this,!0)})};d.disable=function(){if(!this.events)return;for(var a in this.events)this.events[a].remove();this.events=null};d.check=function(a){var d=this.getValueFn?this.getValueFn():this.input.value;if(a&&c.trigger(d))return;a=c.match(d);d=b("URLMatcher").permissiveMatch(d);d&&d!=b("DataStore").get(this.input,g)&&(b("DataStore").set(this.input,g,d),this.inform("match",{url:a||d,alt_url:d}))};return c}(b("mixin")(b("ArbiterMixin")));Object.assign(a,b("URLMatcher"));e.exports=a}),null);
__d("getURLRanges",["UnicodeUtils","URI","URLScraper"],(function(a,b,c,d,e,f){"use strict";var g,h;function a(a){var c=[],d=0;while(!0){var e=a.substr(d),f=b("URLScraper").match(e);if(!f)break;if(!(g||(g=b("URI"))).isValidURI(f))break;var i=f;/^[a-z][a-z0-9\-+.]+:\/\//i.test(f)||(i="http://"+f);var j=e.indexOf(f);e=(h||(h=b("UnicodeUtils"))).strlen(e.substr(0,j));d+=e;j=f.length;c.push({offset:d,length:f.length,entity:{url:i}});d+=j}return c}e.exports=a}),null);
__d("P2PActionConstants",[],(function(a,b,c,d,e,f){"use strict";a=Object.freeze({PAYMENT_METHODS_UPDATED:"credit_cards_updated",PAYMENT_METHODS_UPDATED_ERROR:"credit_cards_updated_error",CHANNEL_EVENTS_ALLOWED:"channel_events_allowed",CHANNEL_EVENTS_IGNORED:"channel_events_ignored",PAYMENT_METHOD_SAVING:"credit_card_saving",PAYMENT_METHOD_ADDED:"credit_card_added",PAYMENT_METHOD_ADDED_ERROR:"credit_card_added_error",PAYMENT_METHOD_DELETED:"credit_card_deleted",PAYMENT_METHOD_DELETED_ERROR:"credit_card_deleted_error",PAYMENT_METHOD_UPDATED:"credit_card_updated",PAYMENT_METHOD_UPDATED_ERROR:"credit_card_updated_error",PRESET_PAYMENT_METHOD_UPDATED:"preset_credit_card_updated",PRESET_PAYMENT_METHOD_UPDATED_ERROR:"preset_credit_card_updated_error",PAYMENT_METHOD_VERIFIED:"credit_card_verified",PAYMENT_METHOD_VERIFIED_ERROR:"credit_card_verified_error",TRANSFERS_UPDATED:"transfers_updated",TRANSFERS_UPDATED_ERROR:"transfers_updated_error",NUX_TRANSFERS_UPDATED:"nux_transfers_updated",TRANSFER_ADDED:"transfer_added",TRANSFER_ADDED_ERROR:"transfer_added_error",TRANSFER_UPDATED:"transfer_updated",TRANSFER_UPDATED_ERROR:"transfer_updated_error",TRANSFER_ACCEPTED:"transfer_accepted",TRANSFER_DECLINED:"transfer_declined",CHAT_SEND_VIEW_OPENED:"chat_send_view_opened",CHAT_SEND_VIEW_CLOSED:"chat_send_view_closed",BIN_NUMBER_VALIDATED:"bin_number_validated",BIN_NUMBER_VALIDATED_ERROR:"bin_number_validated_error",USER_ELIGIBILITY_UDPATED:"user_eligibility_updated",FRIENDS_LIST_UPDATED:"friends_list_updated",DIALOG_SHOWN:"dialog_shown",DIALOG_CLOSED:"dialog_closed",BANNER_STATES_UPDATED:"banner_states_updated",BANNER_DISMISSED:"banner_dismissed",BANNER_VIEWED:"banner_viewed",BANNER_COMPLETED:"banner_completed",PLATFORM_CONTEXT_ADDED:"platform_context_added",PLATFORM_CONTEXT_BANNER_DISMISSED:"platform_context_banner_dismissed",PLATFORM_CONTEXT_PRODUCT_ITEM_SOLD:"platform_context_product_item_sold",PLATFORM_CONTEXT_CHANGED:"platform_context_changed",EXTENSIVE_TRANSFER_DETAILS_UPDATED:"extensive_transfer_details_updated",PAYMENT_REQUEST_INITIATED:"payment_request_initiated",PAYMENT_REQUEST_INITIATED_COMPLETE:"payment_request_initiated_completed",PAYMENT_REQUEST_CREATED:"payment_request_created",PAYMENT_REQUEST_CREATED_ERROR:"payment_request_created_error",PAYMENT_REQUEST_UPDATED:"payment_request_updated",PAYMENT_REQUEST_DECLINE_INITIATED:"payment_request_decline_initiated",PAYMENT_REQUEST_DECLINED:"payment_request_declined",PAYMENT_REQUEST_DECLINE_ERROR:"payment_request_decline_error",PAYMENT_REQUESTS_FETCHED:"payment_requests_fetched",PAYMENT_REQUEST_CANCEL_INITIATED:"payment_request_cancel_initiated",PAYMENT_REQUEST_CANCELED:"payment_request_canceled",PAYMENT_REQUEST_CANCEL_ERROR:"payment_request_cancel_error"});e.exports=a}),null);
__d("P2PActions",["ChatOpenTab","ChatOpenTabEventLogger","FantaTabActions","P2PActionConstants","P2PDispatcher","ifRequired","setImmediate"],(function(a,b,c,d,e,f){"use strict";a={updateCreditCards:function(a){b("P2PDispatcher").dispatch({type:b("P2PActionConstants").PAYMENT_METHODS_UPDATED,data:a})},updateCreditCardsError:function(){b("P2PDispatcher").dispatch({type:b("P2PActionConstants").PAYMENT_METHODS_UPDATED_ERROR})},ignoreCreditCardChannelEvents:function(){b("P2PDispatcher").dispatch({type:b("P2PActionConstants").CHANNEL_EVENTS_IGNORED})},allowCreditCardChannelEvents:function(){b("P2PDispatcher").dispatch({type:b("P2PActionConstants").CHANNEL_EVENTS_ALLOWED})},creditCardSaving:function(){b("P2PDispatcher").dispatch({type:b("P2PActionConstants").PAYMENT_METHOD_SAVING})},addCreditCard:function(a){b("P2PDispatcher").dispatch({type:b("P2PActionConstants").PAYMENT_METHOD_ADDED,data:a})},addCreditCardError:function(a){b("P2PDispatcher").dispatch({type:b("P2PActionConstants").PAYMENT_METHOD_ADDED_ERROR,data:a})},updatePresetCreditCard:function(a){b("P2PDispatcher").dispatch({type:b("P2PActionConstants").PRESET_PAYMENT_METHOD_UPDATED,data:a})},updatePresetCreditCardError:function(a){b("P2PDispatcher").dispatch({type:b("P2PActionConstants").PRESET_PAYMENT_METHOD_UPDATED_ERROR,data:a})},updateCreditCard:function(a){b("P2PDispatcher").dispatch({type:b("P2PActionConstants").PAYMENT_METHOD_UPDATED,data:a})},updateCreditCardError:function(a){b("P2PDispatcher").dispatch({type:b("P2PActionConstants").PAYMENT_METHOD_UPDATED_ERROR,data:a})},deleteCreditCard:function(a){b("P2PDispatcher").dispatch({type:b("P2PActionConstants").PAYMENT_METHOD_DELETED,data:a})},deleteCreditCardError:function(a){b("P2PDispatcher").dispatch({type:b("P2PActionConstants").PAYMENT_METHOD_DELETED_ERROR,data:a})},verifyCreditCard:function(a){b("P2PDispatcher").dispatch({type:b("P2PActionConstants").PAYMENT_METHOD_VERIFIED,data:a})},verifyCreditCardError:function(a){b("P2PDispatcher").dispatch({type:b("P2PActionConstants").PAYMENT_METHOD_VERIFIED_ERROR,data:a})},updateTransfers:function(a){b("P2PDispatcher").dispatch({type:b("P2PActionConstants").TRANSFERS_UPDATED,data:a})},updateTransfersError:function(a){b("P2PDispatcher").dispatch({type:b("P2PActionConstants").TRANSFERS_UPDATED_ERROR,data:a})},updateNUXTransfers:function(a){b("P2PDispatcher").dispatch({type:b("P2PActionConstants").NUX_TRANSFERS_UPDATED,data:a})},transferAdded:function(a){b("P2PDispatcher").dispatch({type:b("P2PActionConstants").TRANSFER_ADDED,data:a})},transferAddedError:function(a){b("P2PDispatcher").dispatch({type:b("P2PActionConstants").TRANSFER_ADDED_ERROR,data:a})},transferUpdated:function(a){b("P2PDispatcher").dispatch({type:b("P2PActionConstants").TRANSFER_UPDATED,data:a})},transferUpdatedError:function(a){b("P2PDispatcher").dispatch({type:b("P2PActionConstants").TRANSFER_UPDATED_ERROR,data:a})},transferAccepted:function(){b("P2PDispatcher").dispatch({type:b("P2PActionConstants").TRANSFER_ACCEPTED})},transferDeclined:function(a){b("P2PDispatcher").dispatch({type:b("P2PActionConstants").TRANSFER_DECLINED,data:a})},chatSendViewOpened:function(a){function c(){b("P2PDispatcher").dispatch({type:b("P2PActionConstants").CHAT_SEND_VIEW_OPENED,data:a})}b("ChatOpenTab").canOpenTab()&&!a.fromChatTab?(a.fromChatTab||(b("FantaTabActions").openTab(a.threadID),b("ChatOpenTabEventLogger").logAutoOpen("p2pAction",a.threadID)),c()):(b("ifRequired")("MessengerActions",function(c){b("setImmediate")(function(){c.selectThread(a.threadID)})}),c())},chatSendViewClosed:function(a){b("P2PDispatcher").dispatch({type:b("P2PActionConstants").CHAT_SEND_VIEW_CLOSED,data:a})},binNumberValidated:function(a){b("P2PDispatcher").dispatch({type:b("P2PActionConstants").BIN_NUMBER_VALIDATED,data:a})},binNumberValidatedError:function(a){b("P2PDispatcher").dispatch({type:b("P2PActionConstants").BIN_NUMBER_VALIDATED_ERROR,data:a})},friendsListUpdated:function(a){b("P2PDispatcher").dispatch({type:b("P2PActionConstants").FRIENDS_LIST_UPDATED,data:a})},userEligibilityUpdated:function(a){b("P2PDispatcher").dispatch({type:b("P2PActionConstants").USER_ELIGIBILITY_UDPATED,data:a})},showDialog:function(a,c){b("P2PDispatcher").dispatch({type:b("P2PActionConstants").DIALOG_SHOWN,data:{dialogClass:a,dialogProps:c}})},hideDialog:function(){b("P2PDispatcher").dispatch({type:b("P2PActionConstants").DIALOG_CLOSED})},bannerStatesUpdated:function(a){b("P2PDispatcher").dispatch({type:b("P2PActionConstants").BANNER_STATES_UPDATED,data:a})},bannerDismissed:function(a){b("P2PDispatcher").dispatch({type:b("P2PActionConstants").BANNER_DISMISSED,data:a})},bannerCompleted:function(a){b("P2PDispatcher").dispatch({type:b("P2PActionConstants").BANNER_COMPLETED,data:a})},addPlatformContext:function(a){b("P2PDispatcher").dispatch({type:b("P2PActionConstants").PLATFORM_CONTEXT_ADDED,data:a})},platformContextBannerDismissed:function(a){b("P2PDispatcher").dispatch({type:b("P2PActionConstants").PLATFORM_CONTEXT_BANNER_DISMISSED,data:a})},platformContextProductItemSold:function(a){b("P2PDispatcher").dispatch({type:b("P2PActionConstants").PLATFORM_CONTEXT_PRODUCT_ITEM_SOLD,data:a})},platformContextChanged:function(a){b("P2PDispatcher").dispatch({type:b("P2PActionConstants").PLATFORM_CONTEXT_CHANGED,data:a})},extensiveTransferDetailsLoaded:function(a){b("P2PDispatcher").dispatch({type:b("P2PActionConstants").EXTENSIVE_TRANSFER_DETAILS_UPDATED,data:a})},paymentRequestInitiated:function(){b("P2PDispatcher").dispatch({type:b("P2PActionConstants").PAYMENT_REQUEST_INITIATED})},paymentRequestInitiatedComplete:function(){b("P2PDispatcher").dispatch({type:b("P2PActionConstants").PAYMENT_REQUEST_INITIATED_COMPLETE})},paymentRequestCreated:function(a){b("P2PDispatcher").dispatch({type:b("P2PActionConstants").PAYMENT_REQUEST_CREATED,data:a})},paymentRequestCreatedError:function(a){b("P2PDispatcher").dispatch({type:b("P2PActionConstants").PAYMENT_REQUEST_CREATED_ERROR,data:a})},paymentRequestUpdated:function(a){b("P2PDispatcher").dispatch({type:b("P2PActionConstants").PAYMENT_REQUEST_UPDATED,data:a})},paymentRequestDeclineInitiated:function(){b("P2PDispatcher").dispatch({type:b("P2PActionConstants").PAYMENT_REQUEST_DECLINE_INITIATED})},paymentRequestDeclined:function(a){b("P2PDispatcher").dispatch({type:b("P2PActionConstants").PAYMENT_REQUEST_DECLINED,data:a})},paymentRequestDeclineError:function(a){b("P2PDispatcher").dispatch({type:b("P2PActionConstants").PAYMENT_REQUEST_DECLINE_ERROR,data:a})},paymentRequestCancelInitiated:function(){b("P2PDispatcher").dispatch({type:b("P2PActionConstants").PAYMENT_REQUEST_CANCEL_INITIATED})},paymentRequestCanceled:function(a){b("P2PDispatcher").dispatch({type:b("P2PActionConstants").PAYMENT_REQUEST_CANCELED,data:a})},paymentRequestCancelError:function(a){b("P2PDispatcher").dispatch({type:b("P2PActionConstants").PAYMENT_REQUEST_CANCEL_ERROR,data:a})},paymentRequestsFetched:function(a){b("P2PDispatcher").dispatch({type:b("P2PActionConstants").PAYMENT_REQUESTS_FETCHED,data:a})}};e.exports=a}),null);
__d("P2PAPIUtils",["fbt","CreditCardFormParam","guid"],(function(a,b,c,d,e,f,g){var h=[1001,1004,1006,1002],i={getRandomDigits:function(a){return Math.random().toString().slice(2,2+a)},genRequestID:function(){return"id:"+b("guid")()+":"+Date.now()},genOfflineThreadingID:function(){return Date.now()+""+i.getRandomDigits(6)},getUncaughtErrorMessage:function(a){return a&&h.indexOf(a)!==-1?g._("Sorry, we were unable to complete your request. Please check that you are connected to the Internet or refresh this page and try again."):g._("Sorry, something went wrong. Please try again later.")},prepareCardMutationData:function(a){var c={},d=a[b("CreditCardFormParam").CARD_NUMBER].replace(/ /g,"");c[b("CreditCardFormParam").CARD_NUMBER]=d;if(typeof a[b("CreditCardFormParam").CARD_EXPIRATION]==="string"){var e=a[(d=b("CreditCardFormParam")).CARD_EXPIRATION].split("/");c[d.MONTH]=e[0];c[d.YEAR]=e[1];c[d.CARD_EXPIRATION]={};c[d.CARD_EXPIRATION][d.MONTH]=c[d.MONTH];c[d.CARD_EXPIRATION][d.YEAR]=c[d.YEAR]}else{c[(d=b("CreditCardFormParam")).MONTH]=a[d.CARD_EXPIRATION][d.MONTH];c[d.YEAR]=a[d.CARD_EXPIRATION][d.YEAR]}return babelHelpers["extends"]({},a,c)}};e.exports=i}),null);
__d("P2PLoadingMask.react",["cx","React","XUISpinner.react"],(function(a,b,c,d,e,f,g){"use strict";var h=b("React");a=function(a){babelHelpers.inheritsLoose(c,a);function c(){return a.apply(this,arguments)||this}var d=c.prototype;d.render=function(){var a=this.props.visible;a=a===void 0?!1:a;return!Boolean(a)?null:h.jsxs("div",{className:"_3de",children:[h.jsx(b("XUISpinner.react"),{background:"dark",size:"large",className:"_3df"}),h.jsx("div",{className:"_3dg"})]})};return c}(h.Component);e.exports=a}),null);
__d("P2PAbstractSendMoneyButton.react",["cx","fbt","React","TooltipLink.react","joinClasses"],(function(a,b,c,d,e,f,g,h){"use strict";var i=b("React");a=function(a){babelHelpers.inheritsLoose(c,a);function c(){var b,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return(b=c=a.call.apply(a,[this].concat(e))||this,c.$1=!1,c.$3=function(){c.props.onMouseDown&&c.props.onMouseDown(),c.$1=c.props.isActive},c.$2=function(a){a.stopPropagation();if(c.$1){c.$1=!1;return}c.props.onClick()},b)||babelHelpers.assertThisInitialized(c)}var d=c.prototype;d.render=function(){return i.jsx(b("TooltipLink.react"),{alignH:"center",className:b("joinClasses")(this.props.className,(this.props.isActive?"open":"")+(this.props.isDisabled?" disabled":"")+(this.props.isActive?" _10gz":"")+(this.props.isDisabled?" _10g-":"")+(!this.props.isMessenger&&!this.props.className?" _5uqy":"")+(this.props.isMessenger?" _3ggc":"")),href:"#",onClick:this.$2,onMouseDown:this.$3,onMouseOver:this.props.onMouseOver,position:"above",role:"button",title:this.$4(),children:this.getButton()})};d.getButton=function(){return this.props.button?this.props.button:i.jsx("i",{className:"_5s8l"})};d.$4=function(){return this.props.isDisabled?null:h._("Send money")};return c}(i.Component);e.exports=a}),null);
__d("P2PSendMoneyContainerBootloader.react",["cx","Bootloader","DeferredComponent.react","MercuryIDs","MessengerEnvironment","P2PAbstractSendMoneyButton.react","P2PActions","P2PLoadingMask.react","P2PLogger","P2PSendMoneyDialogStore","React","ReactLayeredComponentMixin_DEPRECATED","XUIContextualDialog.react","createReactClass_DEPRECATED","emptyFunction","getPageIDFromThreadID","prop-types"],(function(a,b,c,d,e,f,g){"use strict";var h=b("React"),i=b("MessengerEnvironment").messengerui,j=i?282:260;a=b("createReactClass_DEPRECATED")({displayName:"P2PSendMoneyContainerBootloader",propTypes:{button:b("prop-types").node,className:b("prop-types").string,ContextualDialog:b("prop-types").func,flyoutAlignment:b("prop-types").oneOf(["left","center","right"]),fromChatTab:b("prop-types").bool,onTrigger:b("prop-types").func,participantIDs:b("prop-types").array,referrer:b("prop-types").string,threadID:b("prop-types").string},refs_dialog:null,refs_placeholderButton:null,getInitialState:function(){return{showPlaceholderDialog:!1,shouldBootloadImmediately:b("P2PSendMoneyDialogStore").isAnyChatSendViewOpen()}},mixins:[b("ReactLayeredComponentMixin_DEPRECATED")],_clicked:!1,_onComponentLoad:b("emptyFunction"),_bootloadCalled:!1,_sendMoneyDialogStoreSub:null,log:function(a,c){b("P2PLogger").log(a,babelHelpers["extends"]({www_event_referrer:this.props.referrer,www_event_flow:"UI_Flow_P2P_Send"},c))},componentWillUnmount:function(){this.removeDialogStoreSub()},onDialogStoreChange:function(){this._bootloadComponentNow(),this.removeDialogStoreSub()},removeDialogStoreSub:function(){this._sendMoneyDialogStoreSub&&(this._sendMoneyDialogStoreSub.remove(),this._sendMoneyDialogStoreSub=null)},onPlaceholderClick:function(){var a=this.props.threadID?b("MercuryIDs").tokenize(this.props.threadID).value:null;this._handleDialogVisibility(!this.state.showPlaceholderDialog);this.log("UI_Actn_Send_Money_Button_Placeholder_Clicked",{object_id:a});this._bootloadComponentNow();this._clicked=!1},_handleDialogVisibility:function(a){!a?b("P2PActions").chatSendViewClosed({threadID:this.props.threadID}):b("P2PActions").chatSendViewOpened({referrer:this.props.referrer,threadID:this.props.threadID,fromChatTab:this.props.fromChatTab}),this.setState({showPlaceholderDialog:a})},renderLayers:function(){var a=this,c={};if(this.state.showPlaceholderDialog){var d=this.props.ContextualDialog||b("XUIContextualDialog.react");c.placeholderDialog=h.jsx(d,{alignment:this.props.flyoutAlignment?this.props.flyoutAlignment:i?"right":"left",contextRef:function(){return a.refs_placeholderButton},onBlur:function(){a._clicked||a._handleDialogVisibility(!1),a._clicked=!1},ref:function(b){return a.refs_dialog=b},shown:!0,width:j,position:"above",children:h.jsx("div",{className:"_c_5",children:h.jsx(b("P2PLoadingMask.react"),{visible:!0})})})}return c},render:function(){return this._isPageChat()?null:h.jsx(b("DeferredComponent.react"),babelHelpers["extends"]({deferredComponent:this._bootloadComponent,deferredPlaceholder:this._renderPlaceholder()},this.props))},_renderPlaceholder:function(){var a=this;return h.jsx(b("P2PAbstractSendMoneyButton.react"),{button:this.props.button,className:this.props.className,isActive:!1,isDisabled:!1,isMessenger:i,onClick:this.onPlaceholderClick,onMouseDown:function(){a._clicked=!0},onMouseOver:this._bootloadComponentNow,ref:function(b){return a.refs_placeholderButton=b}})},_bootloadComponent:function(a){this._onComponentLoad=a.bind(this),this.state.shouldBootloadImmediately?this._bootloadComponentNow():this._sendMoneyDialogStoreSub=b("P2PSendMoneyDialogStore").addListener("change",this.onDialogStoreChange)},_bootloadComponentNow:function(){var a=this;if(this._bootloadCalled)return;this._bootloadCalled=!0;b("Bootloader").loadModules(["P2PSendMoneyContainer.react"],function(b){a.removeDialogStoreSub(),a._onComponentLoad(b),a.setState({showPlaceholderDialog:!1})},"P2PSendMoneyContainerBootloader.react")},_isPageChat:function(){return!!this._getPageID()},_getPageID:function(){return b("getPageIDFromThreadID")(this.props.threadID)}});e.exports=a}),null);
__d("P2PTriggersUtils",["P2PGKValues"],(function(a,b,c,d,e,f){var g=/\$((\d{1,3}(,\d{3})*)|\d+)(\.\d{1,2})?(?=\s|\.\s|\,\s|$|\.$|\,$|\?|\!|\")/;a={canSeeTriggers:function(a){return!b("P2PGKValues").P2PEnabled?!1:!0},getMatches:function(a){return a.match(g)}};e.exports=a}),null);